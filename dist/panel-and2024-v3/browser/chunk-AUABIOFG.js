import{a as Mt,b as Pe,c as Ot}from"./chunk-CAPBYSFN.js";import{a as wt}from"./chunk-532GEG3Z.js";import{a as De}from"./chunk-G7T3QOEL.js";import{a as Ke,b as Nt}from"./chunk-DY74HANX.js";import{a as Tt,h as Dt}from"./chunk-OWL6IWUO.js";import{B as le,C as de,D as me,E as ce,G as Pt,a as Te,c as ee,d as te,k as ie,n as ze,o as ve,w as oe,y as Ft,z as se}from"./chunk-RQ3IJGD3.js";import{P as Ge,Q as Xe,R as Je,S as Ie,_ as Ve,b as q,c as y,d as H,da as Fe,e as W,ea as ut,fa as _e,h as qe,i as He,j as Ct,ja as we,k as G,m as X,pa as ne,q as J,qa as re,sa as ae,t as We,ta as Ye,u as Ee}from"./chunk-XQXY4DEL.js";import{a as xt}from"./chunk-F6TCIJ3A.js";import{a as bt,c as yt,f as Z,g as Et,h as It,j as Vt}from"./chunk-2CSXOGE3.js";import{$a as h,Ab as ke,Ba as v,C as ue,Cb as Re,Ce as ct,Da as c,Eb as k,Lc as Y,O as T,Od as be,Q as R,Qa as i,Ra as e,Sa as S,Ta as zt,Ua as vt,Ub as j,Vb as $,Wa as F,Y as E,Za as z,Zb as St,_ as B,ac as Ue,c as A,cb as Ce,fa as g,ga as _,gf as pt,hb as lt,ib as dt,jb as mt,kb as I,lb as a,m as C,mb as V,nb as f,ob as he,pb as xe,qa as U,qb as N,ra as s,rb as M,rf as Q,sa as L,sb as O,sf as fe,uf as ge,vb as Le,ve as ye,ye as K}from"./chunk-53NX3MDI.js";import{a as x,b as Oe,f as st}from"./chunk-SIAVTO45.js";var Qe=st(ut());var Xt=["searchBar"],Jt=["searchBarE"];function Yt(d,p){if(d&1){let n=F();i(0,"tr")(1,"td"),a(2),e(),i(3,"td"),a(4),e(),i(5,"td"),a(6),e(),i(7,"td"),a(8),e(),i(9,"td")(10,"a",34),z("click",function(){let r=g(n).$implicit,t=h();return _(t.showModalIn(r))}),a(11,"Editar"),e()()()}if(d&2){let n=p.$implicit,o=h();s(2),V(n.customerName),s(2),he("",n.firstName," ",n.lastName,""),s(2),V(n.email),s(2),V(n.status),s(2),c("nzSize",o.size)}}function Kt(d,p){if(d&1){let n=F();i(0,"tr")(1,"td"),a(2),e(),i(3,"td"),a(4),e(),i(5,"td"),a(6),e(),i(7,"td"),a(8),e(),i(9,"td")(10,"a",34),z("click",function(){let r=g(n).$implicit,t=h();return _(t.showModalInE(r))}),a(11,"Editar"),e()()()}if(d&2){let n=p.$implicit,o=h();s(2),V(n.customerName),s(2),he("",n.firstName," ",n.lastName,""),s(2),V(n.vendorName),s(2),V(n.status),s(2),c("nzSize",o.size)}}function Qt(d,p){if(d&1){let n=F();i(0,"li",39),z("click",function(){g(n);let r=h().$implicit,t=h();return _(t.generarPase(r.userId,r.uid))}),a(1,"Generar Pase"),e()}}function Zt(d,p){if(d&1){let n=F();i(0,"tr")(1,"td"),a(2),e(),i(3,"td"),a(4),e(),i(5,"td"),a(6),e(),i(7,"td"),a(8),e(),i(9,"td")(10,"a",35),a(11,"Ver Comprobante"),e()(),i(12,"td")(13,"a",36),S(14,"i",37),e(),i(15,"nz-dropdown-menu",null,14)(17,"ul",38)(18,"li",39),z("click",function(){let r=g(n).$implicit,t=h();return _(t.openModal(r.userId))}),a(19,"Ver Detalle"),e(),i(20,"li",39),z("click",function(){let r=g(n).$implicit,t=h();return _(t.validarPago(r.uid))}),a(21,"Validar Pago"),e(),i(22,"li",39),z("click",function(){let r=g(n).$implicit,t=h();return _(t.rechazarPago(r))}),a(23,"Rechazar Pago"),e(),v(24,Qt,2,0,"li",40),e()()()()}if(d&2){let n=p.$implicit,o=I(16),r=h();s(2),V(n.customerName),s(2),V(n.product.description),s(2),V(n.product.price),s(2),V(n.status),s(2),Ce("href",n.url,U),s(3),c("nzDropdownMenu",o),s(11),c("ngIf",r.readytoGenerateBoardinPass)}}function ei(d,p){d&1&&a(0,` Nuevo pase
`)}function ti(d,p){if(d&1&&S(0,"nz-option",73),d&2){let n=p.$implicit;c("nzValue",n.id)("nzLabel",n.name)}}function ii(d,p){if(d&1&&(zt(0),a(1),vt()),d&2){let n=h().$implicit;s(),f("(",n.frequencies,")")}}function ni(d,p){if(d&1&&(i(0,"div")(1,"nz-option",74),S(2,"i",75),a(3),v(4,ii,2,1,"ng-container",76),a(5),e()()),d&2){let n=p.$implicit;s(),c("nzLabel",n.name)("nzValue",n.id),s(2),f(" ",n.name," "),s(),c("ngIf",n.frequencies),s(),f(" $",n.price," ")}}function ri(d,p){if(d&1&&(i(0,"nz-option",74),S(1,"i",75),a(2),e()),d&2){let n=p.$implicit;c("nzLabel",n.name)("nzValue",n.routeId),s(2),f(" ",n.name,"")}}function ai(d,p){if(d&1&&(i(0,"nz-option",74),S(1,"i",75),a(2),S(3,"br"),a(4),e()),d&2){let n=p.$implicit;c("nzLabel",n.name)("nzValue",n.stopPointId),s(2),f(" ",n.name," "),s(2),f(" ",n.description," ")}}function oi(d,p){d&1&&(i(0,"div",62)(1,"nz-form-item")(2,"nz-form-label"),a(3,"Fecha Compromiso "),e(),S(4,"nz-date-picker",77),e()())}function si(d,p){if(d&1){let n=F();i(0,"form",41),z("ngSubmit",function(){g(n);let r=h();return _(r.submitForm())}),i(1,"nz-form-item")(2,"nz-form-label",42),a(3,"Empresa"),e(),i(4,"nz-select",43),z("ngModelChange",function(r){g(n);let t=h();return _(t.onCustomerSelected(r))}),v(5,ti,1,2,"nz-option",44),e()(),i(6,"nz-form-item")(7,"nz-form-label",42),a(8,"Servicio"),e(),i(9,"nz-select",45),z("ngModelChange",function(r){g(n);let t=h();return _(t.onProductSelected(r,t.products))}),v(10,ni,6,5,"div",27),e()(),i(11,"nz-form-item")(12,"nz-form-label",42),a(13,"Operaci\xF3n"),e(),i(14,"nz-select",46),z("ngModelChange",function(r){g(n);let t=h();return _(t.onRouteSelected(r,t.routes))}),v(15,ri,3,3,"nz-option",47),e()(),i(16,"nz-form-item")(17,"nz-form-label",42),a(18,"Estaciones"),e(),i(19,"nz-select",48),v(20,ai,5,4,"nz-option",47),e()(),i(21,"nz-form-item")(22,"nz-form-label",42),a(23,"Turno"),e(),i(24,"nz-select",49),S(25,"nz-option",50)(26,"nz-option",51)(27,"nz-option",52),e()(),i(28,"nz-form-item")(29,"nz-form-label",42),a(30,"Tipo de Pago"),e(),i(31,"nz-select",53),z("ngModelChange",function(r){g(n);let t=h();return _(t.changePayment(r))}),S(32,"nz-option",54)(33,"nz-option",55)(34,"nz-option",56),e()(),i(35,"nz-form-item")(36,"div",57)(37,"div",58)(38,"nz-form-label"),a(39,"Cantidad a pagar "),e(),i(40,"nz-input-number",59),z("ngModelChange",function(r){g(n);let t=h();return _(t.onAmountChange(r))}),e()(),v(41,oi,5,0,"div",60),e()(),i(42,"div",57)(43,"div",58)(44,"nz-form-item")(45,"nz-form-label"),a(46,"Total a pagar"),e(),i(47,"nz-input-number",61),z("ngModelChange",function(r){g(n);let t=h();return _(t.onAmountChange(r))}),e()()(),i(48,"div",62)(49,"nz-form-item")(50,"nz-form-label"),a(51,"\xBFEs cortes\xEDa?"),e(),i(52,"nz-switch",63),z("ngModelChange",function(r){g(n);let t=h();return _(t.onCourtesyChange(r))}),e()()()(),i(53,"nz-form-item")(54,"nz-form-label",64),a(55,"Tipo de Referencia"),e(),i(56,"nz-select",65),S(57,"nz-option",66)(58,"nz-option",67)(59,"nz-option",68),e()(),i(60,"nz-form-item")(61,"nz-form-control")(62,"label",69),a(63,"Activar pase"),e()()(),i(64,"div",57)(65,"div",70)(66,"nz-form-item")(67,"nz-form-label"),a(68,"V\xE1lido desde"),e(),S(69,"nz-date-picker",71),e()(),i(70,"div",70)(71,"nz-form-item")(72,"nz-form-label"),a(73,"V\xE1lido hasta"),e(),i(74,"nz-date-picker",72),z("ngModelChange",function(r){g(n);let t=h();return _(t.onChangeValidTo(r))}),e()()()()()}if(d&2){let n=h();c("formGroup",n.validateForm),s(5),c("ngForOf",n.customers),s(5),c("ngForOf",n.products),s(5),c("ngForOf",n.routes),s(5),c("ngForOf",n.stopPoints),s(20),c("nzMin",50)("nzMax",5e3)("nzStep",1)("nzFormatter",n.formatterDollar)("nzParser",n.parserDollar),s(),c("ngIf",n.isAnticipo),s(6),c("disabled",!1)("nzMin",50)("nzMax",5e3)("nzStep",1)("nzFormatter",n.formatterDollar)("nzParser",n.parserDollar),s(27),c("nzDisabledDate",n.disabledDate)}}function li(d,p){if(d&1){let n=F();i(0,"button",78),z("click",function(){g(n);let r=h();return _(r.handleCancel())}),a(1,"Cancelar"),e(),i(2,"button",79),z("click",function(){g(n);let r=h();return _(r.submitForm())}),a(3,"Generar Pase"),e()}if(d&2){let n=h();s(2),c("nzLoading",n.isConfirmLoading)}}function di(d,p){if(d&1&&(i(0,"div")(1,"form",80)(2,"nz-form-item")(3,"nz-form-label",81),a(4,"Cliente"),e(),i(5,"nz-form-control",82),S(6,"input",83),e()(),i(7,"nz-form-item")(8,"nz-form-label",81),a(9,"Operacion"),e(),i(10,"nz-form-control",82),S(11,"input",84),e()(),i(12,"nz-form-item")(13,"nz-form-label",81),a(14,"Horario"),e(),i(15,"nz-form-control",82),S(16,"input",85),e()(),i(17,"nz-form-item")(18,"nz-form-label",81),a(19,"Telefono"),e(),i(20,"nz-form-control",82),S(21,"input",86),e()(),i(22,"nz-form-item")(23,"nz-form-label",81),a(24,"Correo"),e(),i(25,"nz-form-control",82),S(26,"input",87),e()(),i(27,"nz-form-item")(28,"nz-form-label",81),a(29,"Identificacion"),e(),i(30,"nz-form-control",82),S(31,"input",88),e()()()()),d&2){let n=h();s(),c("formGroup",n.viewDetalle),s(2),c("nzSm",8)("nzXs",24),s(2),c("nzSm",16)("nzXs",24),s(3),c("nzSm",8)("nzXs",24),s(2),c("nzSm",16)("nzXs",24),s(3),c("nzSm",8)("nzXs",24),s(2),c("nzSm",16)("nzXs",24),s(3),c("nzSm",8)("nzXs",24),s(2),c("nzSm",16)("nzXs",24),s(3),c("nzSm",8)("nzXs",24),s(2),c("nzSm",16)("nzXs",24),s(3),c("nzSm",8)("nzXs",24),s(2),c("nzSm",16)("nzXs",24)}}function mi(d,p){if(d&1){let n=F();i(0,"button",89),z("click",function(){g(n);let r=h();return _(r.handleCancelView())}),a(1,"Aceptar"),e()}}function ci(d,p){if(d&1&&(i(0,"div")(1,"form",80)(2,"nz-form-item")(3,"nz-form-label",81),a(4,"Estatus"),e(),i(5,"nz-form-control",82)(6,"nz-select",90),S(7,"nz-option",91),e()()()()()),d&2){let n=h();s(),c("formGroup",n.signupForm),s(2),c("nzSm",8)("nzXs",24),s(2),c("nzSm",16)("nzXs",24)}}function pi(d,p){if(d&1){let n=F();i(0,"button",89),z("click",function(){g(n);let r=h();return _(r.handleOKEdit())}),a(1,"Aceptar"),e(),i(2,"button",89),z("click",function(){g(n);let r=h();return _(r.handleCancelEdit())}),a(3,"Cancelar"),e()}}function ui(d,p){if(d&1&&S(0,"nz-option",99),d&2){let n=p.$implicit;c("nzLabel",n.name)("nzValue",n.id)}}function hi(d,p){if(d&1&&(i(0,"div")(1,"form",80)(2,"nz-form-item")(3,"nz-form-label",92),a(4,"Empresa "),e(),i(5,"nz-select",93),v(6,ui,1,2,"nz-option",94),e()(),i(7,"nz-form-item")(8,"nz-form-label",95),a(9,"Estatus"),e(),i(10,"nz-select",96),S(11,"nz-option",97)(12,"nz-option",98),e()()()()),d&2){let n=h();s(),c("formGroup",n.signupFormE),s(2),c("nzSpan",4),s(2),c("nzMaxTagCount",3),s(),c("ngForOf",n.listOfCustomer),s(2),c("nzSm",4),s(2),c("nzMaxTagCount",3)}}function fi(d,p){if(d&1){let n=F();i(0,"button",89),z("click",function(){g(n);let r=h();return _(r.handleOKEditE())}),a(1,"Aceptar"),e(),i(2,"button",89),z("click",function(){g(n);let r=h();return _(r.handleCancelEditE())}),a(3,"Cancelar"),e()}}var $n=(()=>{let p=class p{constructor(o,r){this.fb=o,this.afs=r,this.dataUsuariosList=[],this.dataEjecutoresList=[],this.dataTransferList=[],this.isEditModal=!1,this.isEditModalE=!1,this.isViewInfo=!1,this.isVisible1=!1,this.dashboardService=E(De),this.authService=E(K),this.usersService=E(_e),this.accountsService=E(Z),this.customersService=E(Fe),this.productsService=E(Ke),this.routesService=E(ae),this.stopSubscription$=new A,this.size="large",this.readytoGenerateBoardinPass=!1,this.currentUserSelected=[],this.products=[],this.stopPoints=[],this.paymentSelected="",this.productSelected=[],this.isConfirmLoading=!1,this.disabledDate=t=>!1,this.formatterPercent=t=>`${t} %`,this.parserPercent=t=>t.replace(" %",""),this.formatterDollar=t=>`$ ${t}`,this.parserDollar=t=>t.replace("$ ",""),this.isAnticipo=!1,this.isValidDescriptionPaymentType=!1,this.currentLine="",this.stopIdValue=""}ngOnInit(){this.authService.user.subscribe(r=>{this.user=r,this.user!==null&&this.user!==void 0&&this.user.idSegment!==void 0&&this.accountsService.getSegmentLevel(this.user.idSegment).pipe(T(this.stopSubscription$),C(t=>{let l=t.payload.id,m=t.payload.data();return x({id:l},m)}),R(t=>(this.infoSegment=t,t))).subscribe()}),this.signupForm=this.fb.group({status:[""],id:[""]}),this.signupFormE=this.fb.group({status:[""],id:[""],customerId:[""],customerName:[""]}),this.viewDetalle=this.fb.group({status:[""],id:[""],customerId:[""],customerName:[""],email:[""],phoneNumber:[""],studentId:[""],defaultRouteName:[""],defaultRound:[""]}),this.validateForm=this.fb.group({active:[!0,[y.required]],amount:[0,[y.required]],authorization:[""],category:["",[y.required]],conciliated:[!1,[y.required]],creation_date:[new Date().toISOString(),[y.required]],currency:["MXN",[y.required]],customer_id:["",[y.required]],customerId:[""],date_created:[new Date,[y.required]],due_date:[new Date,[y.required]],description:["",[y.required]],error_message:[""],fee:this.fb.group({amount:[0],currency:["MXN"],tax:[0]}),is_courtesy:[!1],method:["cash",[y.required]],name:["",[y.required]],operation_date:[new Date().toISOString(),[y.required]],operation_type:["in",[y.required]],order_id:[""],payment_method:this.fb.group({barcode_url:[""],reference:[""],type:["cash"]}),price:[0,[y.required]],product_description:["",[y.required]],product_id:["",[y.required]],round:["",[y.required]],routeId:["",[y.required]],routeName:["",[y.required]],status:["completed",[y.required]],stopDescription:["",[y.required]],stopId:["",[y.required]],stopName:["",[y.required]],transaction_type:["charge",[y.required]],validFrom:[new Date,[y.required]],validTo:[new Date,[y.required]],isTaskIn:[!1,[y.required]],isTaskOut:[!1,[y.required]],isOpenpay:[!1,[y.required]],paidApp:["web",[y.required]],realValidTo:[],payment:["",[y.required]],amountPayment:[0,[y.required]],typePayment:[""],promiseDate:[new Date],baja:[""],fileURL:[""],frequencies:[""]});let o=new Date;this.validateForm.controls.promiseDate.setValue(o),this.validateForm.controls.validTo.setValue(""),this.validateForm.controls.validFrom.setValue(o),this.validateForm.get("stopId").valueChanges.subscribe(r=>{this.onStopPointSelected(r,this.stopPoints)})}fillData(){this.dataUsuariosList.length<=1&&(this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1?this.usersService.getPreRegisterInfoByCustomer(this.user.customerId).subscribe(o=>{this.dataUsuarios=o,this.dataUsuariosList=this.dataUsuarios}):this.usersService.getPreRegisterInfo().subscribe(o=>{this.dataUsuarios=o,this.dataUsuariosList=this.dataUsuarios}))}fillDataT(){this.dataTransferList.length<=1&&(this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1?(this.usersService.getTransferInfoByCustomer(this.user.customerId).subscribe(o=>{this.dataTransfer=o,this.dataTransferList=this.dataTransfer}),this.accountsService.getAccountsByCustomer(this.user.customerId).pipe(T(this.stopSubscription$),C(o=>o.map(r=>{let t=r.payload.doc.id,l=r.payload.doc.data();return x({id:t},l)}))).subscribe(o=>{this.customers=o}),this.routesService.getProducts(this.user.customerId).pipe(T(this.stopSubscription$),C(o=>o.map(r=>{let t=r.payload.doc.id,l=r.payload.doc.data();return x({id:t},l)}))).subscribe(o=>{this.products=o})):this.usersService.getTransferInfo().subscribe(o=>{this.dataTransfer=o,this.dataTransferList=this.dataTransfer,this.cCollection=this.afs.collection("customers",r=>r.where("active","==",!0)),this.customerSubscription=this.cCollection.snapshotChanges().pipe(C(r=>r.map(t=>{let l=t.payload.doc.id,m=t.payload.doc.data();return x({id:l},m)}))).subscribe(r=>{this.customers=r,console.log(this.customers)})}))}fillDataE(){this.dataEjecutoresList.length<=1&&(this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1?this.usersService.getPreRegisterInfoEByCustomer(this.user.customerId).subscribe(o=>{this.dataEjecutores=o,this.dataEjecutoresList=this.dataEjecutores}):this.usersService.getPreRegisterInfoE().subscribe(o=>{this.dataEjecutores=o,this.dataEjecutoresList=this.dataEjecutores})),this.infoSegment.nivelNum==1?this.accountsService.getAccountsByCustomer(this.user.customerId).pipe(T(this.stopSubscription$),C(o=>{let r=o.payload.id,t=o.payload.data();return x({id:r},t)})).subscribe(o=>{this.listOfCustomer=[o]}):this.accountsService.getAccounts().pipe(T(this.stopSubscription$),C(o=>o.map(r=>{let t=r.payload.doc.id,l=r.payload.doc.data();return x({id:t},l)}))).subscribe(o=>{this.listOfCustomer=o})}ngOnDestroy(){this.stopSubscription$.next(!1),this.stopSubscription$.complete(),this.dataUsuariosList=[],this.dataEjecutoresList=[]}showModalInE(o){this.signupFormE.controls.status.setValue(o.status),this.signupFormE.controls.id.setValue(o.uid),this.isEditModalE=!0}showModalIn(o){this.signupForm.controls.id.setValue(o.uid),this.signupForm.controls.status.setValue(o.status),this.isEditModal=!0}openModal(o){this.isViewInfo=!0,console.log(o),this.usersService.getUserInfo(o).subscribe(r=>{let t=r.payload.data();if(this.currentUserSelected=t,t){let l={id:t.displayName,studentId:t.studentId,phoneNumber:t.phoneNumber,email:t.email,customerName:t.customerName,customerId:t.customerId,defaultRouteName:t.defaultRouteName,defaultRound:t.defaultRound};this.viewDetalle.patchValue(x({},l))}console.log(this.viewDetalle.value)})}handleCancelEdit(){this.isEditModal=!1}handleCancelView(){this.isViewInfo=!1}handleCancelEditE(){this.isEditModalE=!1}handleOKEdit(){this.usersService.updateUserPreRegister(this.signupForm.controls.id.value,this.signupForm.controls.status.value),this.isEditModal=!1}handleOKEditE(){let o=this.signupFormE.value;this.usersService.updateUserPreRegisterE(this.signupFormE.controls.id.value,this.signupFormE.controls.status.value,this.signupFormE.controls.customerId.value,this.signupFormE.controls.customerName.value),this.isEditModalE=!1}handleCancel(){this.isVisible1=!1}handleOk(){this.isConfirmLoading=!0,setTimeout(()=>{this.isVisible1=!1,this.isConfirmLoading=!1},3e3)}initializeItems(){this.dataUsuarios=this.dataUsuariosList,this.dataEjecutores=this.dataEjecutoresList,this.dataTransfer=this.dataTransferList}getItems(o){let r=o;if(!r){this.dataUsuarios=this.dataUsuariosList.slice();return}let t=r.toLowerCase();this.dataUsuarios=this.dataUsuariosList.filter(l=>Object.values(l).some(m=>String(m).toLowerCase().includes(t)))}getItemsE(o){let r=o;if(!r){this.dataEjecutores=this.dataEjecutoresList.slice();return}let t=r.toLowerCase();this.dataEjecutores=this.dataEjecutoresList.filter(l=>Object.values(l).some(m=>String(m).toLowerCase().includes(t)))}getItemsT(o){let r=o;if(!r){this.dataTransfer=this.dataTransferList.slice();return}let t=r.toLowerCase();this.dataTransfer=this.dataTransferList.filter(l=>Object.values(l).some(m=>String(m).toLowerCase().includes(t)))}validarPago(o){this.usersService.updateTransfer(o,"accepted"),this.readytoGenerateBoardinPass=!0}rechazarPago(o){this.usersService.updateTransfer(o.uid,"rejected"),this.readytoGenerateBoardinPass=!1}onAmountChange(o){o>0&&this.validateForm.controls.is_courtesy.setValue(!1)}onProductSelected(o,r){console.log(o),this.productSelected=[];let l=Qe.default.filter(r,m=>m.id==o)[0];this.productSelected=l,console.log(this.productSelected),this.validateForm.controls.name.setValue(l.name),this.validateForm.controls.description.setValue(l.description),this.validateForm.controls.product_description.setValue(l.description),this.validateForm.controls.amount.setValue(l.price),this.validateForm.controls.is_courtesy.setValue(!1),this.validateForm.controls.price.setValue(l.price),this.validateForm.controls.category.setValue(l.category),this.validateForm.controls.validFrom.setValue(l.validFrom.toDate()),this.validateForm.controls.validTo.setValue(l.validTo.toDate()),this.validateForm.controls.realValidTo.setValue(l.validTo.toDate().toISOString()),this.validateForm.controls.isTaskIn.setValue(l.isTaskIn),this.validateForm.controls.isTaskOut.setValue(l.isTaskOut),this.validateForm.controls.frequencies.setValue(l.frequencies)}generarPase(o,r){this.usersService.getUserInfo(o).subscribe(t=>{let l=t.payload.data();this.currentUserSelected=l,this.currentLine=r,this.isVisible1=!0})}submitForm(){console.log(this.validateForm);var o,r=0;let t=this.validateForm.controls.validTo.value||new Date,l=this.validateForm.controls.is_courtesy.value||!1;var m=this.validateForm.controls.promiseDate.value||"",u=this.validateForm.controls.creation_date.value.toString();let b=this.validateForm.controls.typePayment.value;this.validateForm.controls.customer_id.setValue(this.currentUserSelected.customerId),this.validateForm.controls.customerId.setValue(this.currentUserSelected.customerId);let w=this.validateForm.controls.amount.value,P=this.validateForm.controls.payment.value;P=="Anticipo"&&(w=this.validateForm.controls.amountPayment.value);let D=this.validateForm.controls.frequencies.value||0;D>0&&(r=Number(D)*80);let Ne=this.productSelected?.weeks||0,je=this.fb.group({}),ot=this.productSelected?.rangeWeeks||{};for(let[Se,pe]of Object.entries(ot))je.addControl(Se,this.fb.control(pe));P=="Mensualidad"&&(m=this.validateForm.controls.validTo.value||new Date);let Me={authorization:"portalAuth",operation_type:"in",method:this.validateForm.controls.payment.value,transaction_type:"charge",card:{type:"",brand:"",address:"",card_number:"",holder_name:"",expiration_year:"",expiration_month:"",allows_charges:"",allows_payouts:"",bank_name:"",bank_code:"",points_card:"",points_type:""},status:this.validateForm.controls.status.value,conciliated:!1,creation_date:u,operation_date:new Date().toISOString(),description:"Transfer validada  a traves de portal",error_message:"",order_id:"portalOrder",currency:"MXN",amount:this.validateForm.controls.amountPayment.value,customer:{name:this.currentUserSelected.firstName,last_name:this.currentUserSelected.lastName,email:this.currentUserSelected.email,phone_number:this.currentUserSelected.phoneNumber,address:"",creation_date:"",external_id:"",clabe:""},product:{product_id:this.validateForm.controls.product_id.value,amountTrips:r,frequencies:D,rangeWeeks:je.value,weeks:Ne,name:this.validateForm.controls.product_description.value},customerId:this.currentUserSelected.customerId,active:!0,category:"permanente",date_created:new Date().toISOString(),product_description:"Transfer validada  a traves de portal",product_id:this.validateForm.controls.product_id.value,name:this.validateForm.controls.name.value,isTaskIn:"false",isTaskOut:"false",type:"Servicio",isOpenpay:!1,paidApp:"portal",price:this.validateForm.controls.price.value,round:this.validateForm.controls.round.value,routeId:this.validateForm.controls.routeId.value,routeName:this.validateForm.controls.routeName.value,stopDescription:"",stopId:this.stopIdValue,stopName:this.validateForm.controls.stopDescription.value,validFrom:this.validateForm.controls.validFrom.value,validTo:t,idBoardingPass:this.currentUserSelected.uid,idPurchasteRequest:"",is_courtesy:l,typePayment:P,amountTrips:r,currentTrips:0};this.customersService.saveBoardingPassToUserPurchaseCollection(this.currentUserSelected.uid,Me).then(Se=>{this.isConfirmLoading=!1,console.log(Se),this.customersService.getLatestValidUserPurchasesAdvance(this.currentUserSelected.uid,2,m,P,u).pipe(ue(1),C(pe=>pe.map($e=>{let Ht=$e.payload.doc.data(),Wt=$e.payload.doc.id;return x({id:Wt},Ht)}))).subscribe(pe=>{this.customersService.saveBoardingPassDetailToUserPurchaseCollection(this.currentUserSelected.uid,pe[0].id,Me).then($e=>{this.customersService.createPurchaseCloud(Me,this.currentUserSelected,pe[0].id),this.usersService.updateTransfer(this.currentLine,"complete")}).catch($e=>{console.log("error")})},pe=>{console.log(pe)})}).catch(Se=>{})}enviarMensajeConfirmacion(o,r){let t={createdAt:new Date,from:"FyXKSXsUbYNtAbWL7zZ66o2f1M92",fromName:"Apps And Informa",msg:"Se confirm\xF3 la informaci\xF3n y se creo el pase de abordar con \xE9xito.",requestId:"suhB7YFAh6PYXCRuJhfD",token:r,uid:o,result:""},l={timestamp:new Date,title:"Apps And Informa General",from:"FyXKSXsUbYNtAbWL7zZ66o2f1M92",requestId:"suhB7YFAh6PYXCRuJhfD",body:"Se confirm\xF3 la informaci\xF3n y se creo el pase de abordar con \xE9xito.",token:r,uid:o};this.dashboardService.setMessage(l,o),this.dashboardService.setChatMessage(t).then(()=>{})}onCustomerSelected(o){let r=this.validateForm.get("customerId").value;this.routesService.getProducts(r).pipe(T(this.stopSubscription$),C(t=>t.map(l=>{let m=l.payload.doc.id,u=l.payload.doc.data();return x({id:m},u)}))).subscribe(t=>{this.products=t}),this.routesService.getRoutes(r).pipe(T(this.stopSubscription$),C(t=>t.map(l=>{let m=l.payload.doc.id,u=l.payload.doc.data();return x({id:m},u)}))).subscribe(t=>{this.routes=t})}onRouteSelected(o,r){let l=Qe.default.filter(r,u=>u.routeId==o)[0];this.validateForm.controls.routeName.setValue(l.name);let m=this.validateForm.get("customerId").value;this.accountsService.getStopsByCustomer(m,o).pipe(T(this.stopSubscription$),C(u=>u.map(b=>{let w=b.payload.doc.id,P=b.payload.doc.data();return x({id:w},P)}))).subscribe(u=>{this.stopPoints=u})}onChangeValidTo(o){let r=this.validateForm.controls.validFrom.value}onCourtesyChange(o){o&&this.validateForm.controls.amount.setValue(0)}changePayment(o){this.validateForm.controls.amountPayment.setValue(0),this.paymentSelected=o,o=="Mensualidad"?(this.isValidDescriptionPaymentType=!1,this.isAnticipo=!1,this.validateForm.controls.amountPayment.setValue(this.validateForm.controls.amount.value)):o=="Anticipo"?(this.isValidDescriptionPaymentType=!0,this.isAnticipo=!0,this.validateForm.controls.amountPayment.setValue(0)):(this.isAnticipo=!1,this.isValidDescriptionPaymentType=!0,this.validateForm.controls.amountPayment.setValue(0))}onStopPointSelected(o,r){let l=Qe.default.filter(this.stopPoints,m=>m.stopPointId===o)[0];l&&(this.stopIdValue=l.id,this.validateForm.patchValue({stopName:l.name,stopDescription:l.description})),console.log(this.stopIdValue),console.log(this.validateForm.value)}};p.\u0275fac=function(r){return new(r||p)(L(J),L(Y))},p.\u0275cmp=B({type:p,selectors:[["app-payments"]],viewQuery:function(r,t){if(r&1&&(lt(Xt,5),lt(Jt,5)),r&2){let l;dt(l=mt())&&(t.searchbar=l.first),dt(l=mt())&&(t.searchbarE=l.first)}},decls:108,vars:20,consts:[["searchBar",""],["basicTable",""],["searchBarE",""],["basicTable11",""],["basicTable2",""],["modalTitle",""],["modalContent",""],["modalPassFooter",""],["modalContent3",""],["modalFooterEdit1",""],["modalContent2",""],["modalFooterEdit",""],["modalContent112",""],["modalFooterEditE",""],["chatSetting","nzDropdownMenu"],[2,"margin","buttom 15px","margin-right","15px","margin-left","15px"],[1,"site-page-header-ghost-wrapper"],[2,"background-color","#f9fbfd",3,"nzGhost"],[2,"margin-left","350px"],[1,"body"],["nzTitle","Usuarios"],[1,"chat-list"],[1,"chat-user-tool"],["nz-button","","nzType","primary",3,"click"],["nz-icon","","nzTheme","outline",1,"search-icon","p-r-10","font-size-20"],["placeholder","Buscar",3,"keyup"],["ngSkipHydration","",3,"nzData"],[4,"ngFor","ngForOf"],["nzTitle","Ejecutores"],["nzTitle","Comprobantes"],[3,"nzVisibleChange","nzOnCancel","nzVisible","nzTitle","nzContent","nzFooter"],["nzTitle","Detalle Pago ","nzWidth","500px",3,"nzVisibleChange","nzOnCancel","nzVisible","nzFooter","nzContent"],["nzTitle","Editar Usuarios ","nzWidth","500px",3,"nzVisibleChange","nzOnCancel","nzVisible","nzFooter","nzContent"],["nzTitle","Editar Ejecutores","nzWidth","500px",3,"nzVisibleChange","nzOnCancel","nzVisible","nzFooter","nzContent"],["nz-button","","nzType","link",2,"color","#4F6F57","border","none",3,"click","nzSize"],["target","_blank",3,"href"],["nz-dropdown","",3,"nzDropdownMenu"],["nz-icon","","nzType","ellipsis","nzTheme","outline"],["nz-menu",""],["nz-menu-item","",3,"click"],["nz-menu-item","",3,"click",4,"ngIf"],["nz-form","","nzLayout","horizontal",3,"ngSubmit","formGroup"],[2,"width","100px"],["formControlName","customerId","nzAllowClear","","nzPlaceHolder","Seleccione una Empresa",2,"width","320px",3,"ngModelChange"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["formControlName","product_id","nzAllowClear","","nzPlaceHolder","Seleccionar producto / servicio",2,"width","320px",3,"ngModelChange"],["formControlName","routeId","nzAllowClear","","nzPlaceHolder","Selecciona la Operaci\xF3n",2,"width","320px",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["formControlName","stopId","nzAllowClear","","nzPlaceHolder","Selecciona la estaci\xF3n",2,"width","320px"],["formControlName","round","nzAllowClear","","nzPlaceHolder","Selecciona Turno",2,"width","320px"],["nzValue","D\xEDa","nzLabel","D\xEDa"],["nzValue","Tarde","nzLabel","Tarde"],["nzValue","Noche","nzLabel","Noche"],["formControlName","payment","nzAllowClear","","nzPlaceHolder","Selecciona un tipo de Pago",2,"width","320px",3,"ngModelChange"],["nzValue","Mensualidad","nzLabel","Mensualidad"],["nzValue","Anticipo","nzLabel","Anticipo"],["nzValue","Liquidacion","nzLabel","Liquidaci\xF3n"],[1,"row"],[1,"col-md-7"],["formControlName","amountPayment",3,"ngModelChange","nzMin","nzMax","nzStep","nzFormatter","nzParser"],["class","col-md-5",4,"ngIf"],["formControlName","amount",3,"ngModelChange","disabled","nzMin","nzMax","nzStep","nzFormatter","nzParser"],[1,"col-md-5"],["formControlName","is_courtesy","nzCheckedChildren","Si","nzUnCheckedChildren","No",3,"ngModelChange"],[2,"width","120px"],["formControlName","typePayment","nzAllowClear","","nzPlaceHolder","Selecciona una Referencia",2,"width","300px"],["nzValue","Transferencia","nzLabel","Transferencia"],["nzValue","Efectivo","nzLabel","Efectivo"],["nzValue","Sistema","nzLabel","Pago por Sistema"],["nz-checkbox","","formControlName","active"],[1,"col-md-6"],["formControlName","validFrom"],["formControlName","validTo",3,"ngModelChange","nzDisabledDate"],[3,"nzValue","nzLabel"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon",""],[4,"ngIf"],["formControlName","promiseDate",2,"width","150px"],["nz-button","",3,"click"],["nz-button","",3,"click","nzLoading"],["nz-form","",3,"formGroup"],["nzFor","status",3,"nzSm","nzXs"],[3,"nzSm","nzXs"],["id","customerName","formControlName","customerName"],["id","defaultRouteName","formControlName","defaultRouteName"],["id","defaultRound","formControlName","defaultRound"],["id","phoneNumber","formControlName","phoneNumber"],["id","email","formControlName","email"],["id","email","formControlName","studentId"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["formControlName","status"],["nzValue","active","nzLabel","Activo"],["nzFor","label",3,"nzSpan"],["formControlName","customerId","nzPlaceHolder","Selecciona una empresa",2,"width","250px",3,"nzMaxTagCount"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzFor","status",3,"nzSm"],["formControlName","status","nzPlaceHolder","Selecciona un status",2,"width","250px",3,"nzMaxTagCount"],["nzValue","accept","nzLabel","Aceptado"],["nzValue","reject","nzLabel","Rechazado"],[3,"nzLabel","nzValue"]],template:function(r,t){if(r&1){let l=F();i(0,"div",15)(1,"div",16)(2,"nz-page-header",17)(3,"nz-page-header-title",18),a(4,"Validaciones"),e(),i(5,"nz-page-header-subtitle"),a(6,"Listado de validaciones por aprobar "),e()()(),i(7,"div",19)(8,"nz-tabset")(9,"nz-tab",20)(10,"div",21)(11,"div",22)(12,"a",23),z("click",function(){return g(l),_(t.fillData())}),a(13,"Cargar Usuarios"),e(),S(14,"i",24),i(15,"input",25,0),z("keyup",function(){g(l);let u=I(16);return _(t.getItems(u.value))}),e()(),i(17,"div")(18,"nz-table",26,1)(20,"thead")(21,"tr")(22,"th"),a(23,"Empresa"),e(),i(24,"th"),a(25,"Nombre"),e(),i(26,"th"),a(27,"Email"),e(),i(28,"th"),a(29,"Estatus"),e(),i(30,"th"),a(31,"..."),e()()(),i(32,"tbody"),v(33,Yt,12,6,"tr",27),e()()()()(),i(34,"nz-tab",28)(35,"div",21)(36,"div",22)(37,"a",23),z("click",function(){return g(l),_(t.fillDataE())}),a(38,"Cargar Ejecutores"),e(),S(39,"i",24),i(40,"input",25,2),z("keyup",function(){g(l);let u=I(41);return _(t.getItemsE(u.value))}),e()(),i(42,"div")(43,"nz-table",26,3)(45,"thead")(46,"tr")(47,"th"),a(48,"Empresa"),e(),i(49,"th"),a(50,"Nombre"),e(),i(51,"th"),a(52,"Cliente"),e(),i(53,"th"),a(54,"Estatus"),e(),i(55,"th"),a(56,"..."),e()()(),i(57,"tbody"),v(58,Kt,12,6,"tr",27),e()()()()(),i(59,"nz-tab",29)(60,"div",21)(61,"div",22)(62,"a",23),z("click",function(){return g(l),_(t.fillDataT())}),a(63,"Cargar Comprobantes"),e(),S(64,"i",24),i(65,"input",25,2),z("keyup",function(){g(l);let u=I(41);return _(t.getItemsT(u.value))}),e()(),i(67,"div")(68,"nz-table",26,4)(70,"thead")(71,"tr")(72,"th"),a(73,"Empresa"),e(),i(74,"th"),a(75,"Producto"),e(),i(76,"th"),a(77,"Costo Producto"),e(),i(78,"th"),a(79,"Estatus"),e(),i(80,"th"),a(81,"Comprobante"),e(),i(82,"th"),a(83,"..."),e()()(),i(84,"tbody"),v(85,Zt,25,7,"tr",27),e()()()()()()()(),i(86,"nz-modal",30),O("nzVisibleChange",function(u){return g(l),M(t.isVisible1,u)||(t.isVisible1=u),_(u)}),z("nzOnCancel",function(){return g(l),_(t.handleCancel())}),v(87,ei,1,0,"ng-template",null,5,k)(89,si,75,18,"ng-template",null,6,k)(91,li,4,1,"ng-template",null,7,k),e(),i(93,"nz-modal",31),O("nzVisibleChange",function(u){return g(l),M(t.isViewInfo,u)||(t.isViewInfo=u),_(u)}),z("nzOnCancel",function(){return g(l),_(t.handleCancelView())}),v(94,di,32,25,"ng-template",null,8,k)(96,mi,2,0,"ng-template",null,9,k),e(),i(98,"nz-modal",32),O("nzVisibleChange",function(u){return g(l),M(t.isEditModal,u)||(t.isEditModal=u),_(u)}),z("nzOnCancel",function(){return g(l),_(t.handleCancelEdit())}),v(99,ci,8,5,"ng-template",null,10,k)(101,pi,4,0,"ng-template",null,11,k),e(),i(103,"nz-modal",33),O("nzVisibleChange",function(u){return g(l),M(t.isEditModalE,u)||(t.isEditModalE=u),_(u)}),z("nzOnCancel",function(){return g(l),_(t.handleCancelEditE())}),v(104,hi,13,6,"ng-template",null,12,k)(106,fi,4,0,"ng-template",null,13,k),e()}if(r&2){let l=I(19),m=I(44),u=I(69),b=I(88),w=I(90),P=I(92),D=I(95),Ne=I(97),je=I(100),ot=I(102),Me=I(105),Se=I(107);s(2),c("nzGhost",!1),s(16),c("nzData",t.dataUsuarios),s(15),c("ngForOf",l.data),s(10),c("nzData",t.dataEjecutores),s(15),c("ngForOf",m.data),s(10),c("nzData",t.dataTransfer),s(17),c("ngForOf",u.data),s(),N("nzVisible",t.isVisible1),c("nzTitle",b)("nzContent",w)("nzFooter",P),s(7),N("nzVisible",t.isViewInfo),c("nzFooter",Ne)("nzContent",D),s(5),N("nzVisible",t.isEditModal),c("nzFooter",ot)("nzContent",je),s(5),N("nzVisible",t.isEditModalE),c("nzFooter",Se)("nzContent",Me)}},dependencies:[j,$,be,Ee,We,Xe,Ge,Ie,Je,Dt,Ye,de,oe,se,ce,le,me,we,Pt,yt,bt,Et,It,Vt,ge,Q,fe,ie,ee,te,ne,re,He,q,H,W,G,X,ve,ze,Nt]});let d=p;return d})();var Be=st(ut());function gi(d,p){if(d&1&&(i(0,"nz-option",29),S(1,"i",30),a(2),e()),d&2){let n=p.$implicit;c("nzLabel",n.name)("nzValue",n.id),s(2),f(" ",n.name,"")}}function _i(d,p){if(d&1&&(i(0,"nz-option",29),S(1,"i",30),a(2),e()),d&2){let n=p.$implicit;c("nzLabel",n.name)("nzValue",n.routeId),s(2),f(" ",n.name,"")}}function zi(d,p){if(d&1){let n=F();i(0,"th",31),O("nzSortOrderChange",function(r){let t=g(n).$implicit;return M(t.sortOrder,r)||(t.sortOrder=r),_(r)}),a(1),e()}if(d&2){let n=p.$implicit;N("nzSortOrder",n.sortOrder),c("nzSortFn",n.sortFn)("nzFilters",n.listOfFilter)("nzFilterFn",n.filterFn),s(),f(" ",n.name," ")}}function vi(d,p){if(d&1&&(i(0,"tr")(1,"td"),a(2),e(),i(3,"td"),a(4),e(),i(5,"td"),a(6),e(),i(7,"td"),a(8),e(),i(9,"td"),a(10),e(),i(11,"td"),a(12),e(),i(13,"td"),a(14),e()()),d&2){let n=p.$implicit;s(2),V(n.turno),s(2),V(n.roundTrip),s(2),V(n.displayName),s(2),V(n.studentId),s(2),V(n.phoneNumber),s(2),V(n.email),s(2),V(n.status)}}function Si(d,p){if(d&1&&(i(0,"nz-option",29),S(1,"i",30),a(2),e()),d&2){let n=p.$implicit;c("nzLabel",n.name)("nzValue",n.id),s(2),f(" ",n.name,"")}}function Ci(d,p){if(d&1&&(i(0,"nz-option",29),S(1,"i",30),a(2),e()),d&2){let n=p.$implicit;c("nzLabel",n.name)("nzValue",n.routeId),s(2),f(" ",n.name,"")}}function xi(d,p){if(d&1){let n=F();i(0,"th",31),O("nzSortOrderChange",function(r){let t=g(n).$implicit;return M(t.sortOrder,r)||(t.sortOrder=r),_(r)}),a(1),e()}if(d&2){let n=p.$implicit;N("nzSortOrder",n.sortOrder),c("nzSortFn",n.sortFn)("nzFilters",n.listOfFilter)("nzFilterFn",n.filterFn),s(),f(" ",n.name," ")}}function bi(d,p){if(d&1&&(i(0,"tr")(1,"td"),a(2),e(),i(3,"td"),a(4),e(),i(5,"td"),a(6),e(),i(7,"td"),a(8),e(),i(9,"td"),a(10),e(),i(11,"td"),a(12),e(),i(13,"td"),a(14),e()()),d&2){let n=p.$implicit;s(2),V(n.turno),s(2),V(n.roundTrip),s(2),V(n.displayName),s(2),V(n.studentId),s(2),V(n.phoneNumber),s(2),V(n.email),s(2),V(n.status)}}function yi(d,p){if(d&1&&(i(0,"nz-option",29),a(1),e()),d&2){let n=p.$implicit;c("nzLabel",n.name)("nzValue",n.routeId),s(),V(n.name)}}function Ei(d,p){if(d&1&&(i(0,"nz-tag",43),a(1),e()),d&2){let n=h().$implicit,o=h(2);c("nzColor","red"),s(),f(" ",o.calculateRemaining(n.lunes),"")}}function Ii(d,p){if(d&1&&(i(0,"nz-tag",43),a(1),e()),d&2){let n=h().$implicit,o=h(2);c("nzColor","red"),s(),f(" ",o.calculateRemaining(n.martes),"")}}function Vi(d,p){if(d&1&&(i(0,"nz-tag",43),a(1),e()),d&2){let n=h().$implicit,o=h(2);c("nzColor","red"),s(),f(" ",o.calculateRemaining(n.miercoles),"")}}function Fi(d,p){if(d&1&&(i(0,"nz-tag",43),a(1),e()),d&2){let n=h().$implicit,o=h(2);c("nzColor","red"),s(),f(" ",o.calculateRemaining(n.jueves),"")}}function wi(d,p){if(d&1&&(i(0,"nz-tag",43),a(1),e()),d&2){let n=h().$implicit,o=h(2);c("nzColor","red"),s(),f(" ",o.calculateRemaining(n.viernes),"")}}function Ti(d,p){if(d&1&&(i(0,"tr")(1,"td")(2,"nz-tag",43),a(3),e()(),i(4,"td")(5,"nz-tag",43),a(6),e(),v(7,Ei,2,2,"nz-tag",45),e(),i(8,"td")(9,"nz-tag",43),a(10),e(),v(11,Ii,2,2,"nz-tag",45),e(),i(12,"td")(13,"nz-tag",43),a(14),e(),v(15,Vi,2,2,"nz-tag",45),e(),i(16,"td")(17,"nz-tag",43),a(18),e(),v(19,Fi,2,2,"nz-tag",45),e(),i(20,"td")(21,"nz-tag",43),a(22),e(),v(23,wi,2,2,"nz-tag",45),e()()),d&2){let n=p.$implicit,o=h(2);s(2),c("nzColor","blue"),s(),f(" ",n.time,""),s(2),c("nzColor","blue"),s(),f(" ",n.lunes,""),s(),c("ngIf",o.calculateRemaining(n.lunes)!==0),s(2),c("nzColor","blue"),s(),f(" ",n.martes,""),s(),c("ngIf",o.calculateRemaining(n.martes)!==0),s(2),c("nzColor","blue"),s(),f(" ",n.miercoles,""),s(),c("ngIf",o.calculateRemaining(n.miercoles)!==0),s(2),c("nzColor","blue"),s(),f(" ",n.jueves,""),s(),c("ngIf",o.calculateRemaining(n.jueves)!==0),s(2),c("nzColor","blue"),s(),f(" ",n.viernes,""),s(),c("ngIf",o.calculateRemaining(n.viernes)!==0)}}function Di(d,p){if(d&1&&(i(0,"nz-tag",43),a(1),e()),d&2){let n=h().$implicit,o=h(2);c("nzColor","red"),s(),f(" ",o.calculateRemaining(n.lunes),"")}}function Pi(d,p){if(d&1&&(i(0,"nz-tag",43),a(1),e()),d&2){let n=h().$implicit,o=h(2);c("nzColor","red"),s(),f(" ",o.calculateRemaining(n.martes),"")}}function Ni(d,p){if(d&1&&(i(0,"nz-tag",43),a(1),e()),d&2){let n=h().$implicit,o=h(2);c("nzColor","red"),s(),f(" ",o.calculateRemaining(n.miercoles),"")}}function Mi(d,p){if(d&1&&(i(0,"nz-tag",43),a(1),e()),d&2){let n=h().$implicit,o=h(2);c("nzColor","red"),s(),f(" ",o.calculateRemaining(n.jueves),"")}}function Oi(d,p){if(d&1&&(i(0,"nz-tag",43),a(1),e()),d&2){let n=h().$implicit,o=h(2);c("nzColor","red"),s(),f(" ",o.calculateRemaining(n.viernes),"")}}function Li(d,p){if(d&1&&(i(0,"tr")(1,"td")(2,"nz-tag",43),a(3),e()(),i(4,"td")(5,"nz-tag",43),a(6),e(),v(7,Di,2,2,"nz-tag",45),e(),i(8,"td")(9,"nz-tag",43),a(10),e(),v(11,Pi,2,2,"nz-tag",45),e(),i(12,"td")(13,"nz-tag",43),a(14),e(),v(15,Ni,2,2,"nz-tag",45),e(),i(16,"td")(17,"nz-tag",43),a(18),e(),v(19,Mi,2,2,"nz-tag",45),e(),i(20,"td")(21,"nz-tag",43),a(22),e(),v(23,Oi,2,2,"nz-tag",45),e()()),d&2){let n=p.$implicit,o=h(2);s(2),c("nzColor","blue"),s(),f(" ",n.time,""),s(2),c("nzColor","blue"),s(),f(" ",n.lunes,""),s(),c("ngIf",o.calculateRemaining(n.lunes)!==0),s(2),c("nzColor","blue"),s(),f(" ",n.martes,""),s(),c("ngIf",o.calculateRemaining(n.martes)!==0),s(2),c("nzColor","blue"),s(),f(" ",n.miercoles,""),s(),c("ngIf",o.calculateRemaining(n.miercoles)!==0),s(2),c("nzColor","blue"),s(),f(" ",n.jueves,""),s(),c("ngIf",o.calculateRemaining(n.jueves)!==0),s(2),c("nzColor","blue"),s(),f(" ",n.viernes,""),s(),c("ngIf",o.calculateRemaining(n.viernes)!==0)}}function ki(d,p){if(d&1){let n=F();i(0,"nz-tab",32)(1,"div",9)(2,"form",10),z("ngSubmit",function(){g(n);let r=h();return _(r.submitFormPaid())}),i(3,"table",11)(4,"tr")(5,"td",33)(6,"nz-form-item")(7,"nz-form-label",13),a(8,"Empresa"),e(),S(9,"input",34),e()()(),i(10,"tr")(11,"td",33)(12,"nz-form-item")(13,"nz-form-label",13),a(14,"Operaci\xF3n"),e(),i(15,"nz-select",35),z("ngModelChange",function(r){g(n);let t=h();return _(t.onRoutesSelect(r))}),v(16,yi,2,3,"nz-option",15),e(),i(17,"label",36),z("ngModelChange",function(r){g(n);let t=h();return _(t.onCheckboxChange(r))}),O("ngModelChange",function(r){g(n);let t=h();return M(t.chkBoardingP,r)||(t.chkBoardingP=r),_(r)}),a(18,"Pases Activos"),e()()(),i(19,"td",33)(20,"nz-form-item")(21,"nz-form-label",13),a(22,"Producto"),e(),i(23,"nz-select",37),z("ngModelChange",function(r){g(n);let t=h();return _(t.onProductSelect(r))}),i(24,"nz-option",29),a(25,"Cami\xF3n"),e(),i(26,"nz-option",29),a(27,"Camioneta"),e()(),S(28,"input",38),e()()(),i(29,"button",39),z("click",function(){g(n);let r=h();return _(r.submitM())}),a(30,"Aceptar"),e()(),i(31,"nz-table",40,1)(33,"thead")(34,"tr",41)(35,"th"),a(36,"Lunes"),e(),i(37,"th"),a(38,"Martes"),e(),i(39,"th"),a(40,"Miercoles"),e(),i(41,"th"),a(42,"Jueves"),e(),i(43,"th"),a(44,"Viernes"),e()()(),i(45,"tbody")(46,"tr",41)(47,"th"),a(48),e(),i(49,"th"),a(50),e(),i(51,"th"),a(52),e(),i(53,"th"),a(54),e(),i(55,"th"),a(56),e()()()(),i(57,"nz-table",42,1)(59,"thead")(60,"tr")(61,"th"),a(62,"Horario"),e(),i(63,"th"),a(64,"Lunes"),e(),i(65,"th"),a(66,"Martes"),e(),i(67,"th"),a(68,"Miercoles"),e(),i(69,"th"),a(70,"Jueves"),e(),i(71,"th"),a(72,"Viernes"),e()()(),i(73,"tbody"),v(74,Ti,24,17,"tr",25),e(),i(75,"tfoot")(76,"tr",41)(77,"td")(78,"nz-tag",43),a(79),e()(),i(80,"td")(81,"nz-tag",43),a(82),e()(),i(83,"td")(84,"nz-tag",43),a(85),e()(),i(86,"td")(87,"nz-tag",43),a(88),e()(),i(89,"td")(90,"nz-tag",43),a(91),e()(),i(92,"td")(93,"nz-tag",43),a(94),e()()()()(),i(95,"nz-table",44,2)(97,"thead")(98,"tr")(99,"th"),a(100,"Horario"),e(),i(101,"th"),a(102,"Lunes"),e(),i(103,"th"),a(104,"Martes"),e(),i(105,"th"),a(106,"Miercoles"),e(),i(107,"th"),a(108,"Jueves"),e(),i(109,"th"),a(110,"Viernes"),e()()(),i(111,"tbody"),v(112,Li,24,17,"tr",25),e(),i(113,"tfoot")(114,"tr",41)(115,"td")(116,"nz-tag",43),a(117),e()(),i(118,"td")(119,"nz-tag",43),a(120),e()(),i(121,"td")(122,"nz-tag",43),a(123),e()(),i(124,"td")(125,"nz-tag",43),a(126),e()(),i(127,"td")(128,"nz-tag",43),a(129),e()(),i(130,"td")(131,"nz-tag",43),a(132),e()()()()(),S(133,"nz-form-item"),e()()()}if(d&2){let n=h();s(2),c("formGroup",n.validateFormM),s(14),c("ngForOf",n.routesM),s(),N("ngModel",n.chkBoardingP),s(7),c("nzLabel",n.camion)("nzValue",n.camion),s(2),c("nzLabel",n.camioneta)("nzValue",n.camioneta),s(22),xe("Cr\xE9ditos: (",n.LunesFinal," / ",n.sumaTotal,") // ",n.porcentajeLunes.toFixed(2)," %"),s(2),xe("Cr\xE9ditos: (",n.MartesFinal," / ",n.sumaTotal,") // ",n.porcentajeMartes.toFixed(2)," %"),s(2),xe("Cr\xE9ditos: (",n.MiercolesFinal," / ",n.sumaTotal,") // ",n.porcentajeMiercoles.toFixed(2)," %"),s(2),xe("Cr\xE9ditos: (",n.JuevesFinal," / ",n.sumaTotal,") // ",n.porcentajeJueves.toFixed(2)," %"),s(2),xe("Cr\xE9ditos: (",n.ViernesFinal," / ",n.sumaTotal,") // ",n.porcentajeViernes.toFixed(2)," %"),s(),c("nzData",n.dataSet),s(17),c("ngForOf",n.dataSet),s(4),c("nzColor","green"),s(),f(" Total : ",n.grantotal,""),s(2),c("nzColor","green"),s(),f(" ",n.totalLunes,""),s(2),c("nzColor","green"),s(),f(" ",n.totalMartes,""),s(2),c("nzColor","green"),s(),f(" ",n.totalViernes,""),s(2),c("nzColor","green"),s(),f(" ",n.totalJueves,""),s(2),c("nzColor","green"),s(),f(" ",n.totalViernes,""),s(),c("nzData",n.dataSetEnd),s(17),c("ngForOf",n.dataSetEnd),s(4),c("nzColor","green"),s(),f(" Total : ",n.grantotalE,""),s(2),c("nzColor","green"),s(),f(" ",n.totalLunesE,""),s(2),c("nzColor","green"),s(),f(" ",n.totalMartesE,""),s(2),c("nzColor","green"),s(),f(" ",n.totalViernesE,""),s(2),c("nzColor","green"),s(),f(" ",n.totalJuevesE,""),s(2),c("nzColor","green"),s(),f(" ",n.totalViernesE,"")}}var rr=(()=>{let p=class p{constructor(o,r,t){this.afs=o,this.messageService=r,this.fb=t,this.isMederos=!1,this.customers=[],this.customerMed=[],this.accountId$=new A,this.routeId$=new A,this.stopSubscription$=new A,this.rowDataPay=[],this.rowData=[],this.userRoute=!1,this.userRouteP=!1,this.submitPayment=!0,this.contenedores="",this.contenedoresPay="",this.rowDataPre=[],this.rowDataPush=[],this.customersService=E(Fe),this.routesService=E(ae),this.usersService=E(_e),this.authService=E(K),this.accountsService=E(Z),this.productsService=E(Ke),this.infoSegment=[],this.dataSet=[{time:"",lunes:0,martes:0,miercoles:0,jueves:0,viernes:0}],this.dataSetEnd=[{time:"",lunes:0,martes:0,miercoles:0,jueves:0,viernes:0}],this.lunesP=0,this.martesP=0,this.miercolesP=0,this.juevesP=0,this.viernesP=0,this.lunesE=0,this.martesE=0,this.miercolesE=0,this.juevesE=0,this.viernesE=0,this.totalLunes=0,this.totalMartes=0,this.totalMiercoles=0,this.totalJueves=0,this.totalViernes=0,this.grantotal=0,this.LunesFinal=0,this.MartesFinal=0,this.MiercolesFinal=0,this.JuevesFinal=0,this.ViernesFinal=0,this.countE=0,this.countS=0,this.porcentajeLunes=0,this.porcentajeMartes=0,this.porcentajeMiercoles=0,this.porcentajeJueves=0,this.porcentajeViernes=0,this.sumaTotal=0,this.chkBoardingP=!1,this.totalLunesE=0,this.totalMartesE=0,this.totalMiercolesE=0,this.totalJuevesE=0,this.totalViernesE=0,this.grantotalE=0,this.carro=0,this.asientos=0,this.transportType="",this.camioneta="Camioneta",this.camion="Cami\xF3n",this.listOfColumns=[{name:"Turno",sortOrder:null,sortFn:(l,m)=>l.turno.localeCompare(m.turno),listOfFilter:[],filterFn:(l,m)=>l.some(u=>m.turno.indexOf(u)!==-1)},{name:"Tipo de Viaje",sortOrder:null,sortFn:(l,m)=>l.roundTrip.localeCompare(m.roundTrip),listOfFilter:[],filterFn:(l,m)=>l.some(u=>m.roundTrip.indexOf(u)!==-1)},{name:"Nombre",sortOrder:null,sortFn:(l,m)=>l.displayName.localeCompare(m.displayName),listOfFilter:[],filterFn:(l,m)=>l.some(u=>m.displayName.indexOf(u)!==-1)},{name:"Identificaci\xF3n",sortOrder:null,sortFn:null,listOfFilter:[],filterFn:null},{name:"Telefono",sortOrder:null,sortFn:null,listOfFilter:[],filterFn:null},{name:"Email",sortOrder:null,sortFn:null,listOfFilter:[],filterFn:null},{name:"Estatus",sortOrder:null,sortFn:null,listOfFilter:[],filterFn:null}],this.authService.user.subscribe(l=>{this.user=l,this.user!==null&&this.user!==void 0&&this.user.idSegment!==void 0&&this.accountsService.getSegmentLevel(this.user.idSegment).pipe(T(this.stopSubscription$),C(m=>{let u=m.payload.id,b=m.payload.data();return x({id:u},b)}),R(m=>(this.infoSegment=m,this.fillData(),m))).subscribe()})}ngOnInit(){this.validateForm=this.fb.group({customerId:["",[y.required]],customerName:[],routeId:["",[y.required]],routeName:["",[y.required]],round:["",[y.required]]}),this.validateFormP=this.fb.group({customerId:["",[y.required]],customerName:[],routeId:["",[y.required]],routeName:["",[y.required]],round:["",[y.required]]}),this.validateFormM=this.fb.group({customerId:["",[y.required]],customerName:[],routeId:["",[y.required]],productId:["",[y.required]],asientos:[0,y.required],chkBoardingP:[!1]})}fillData(){this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1?(this.cDocument=this.afs.collection("customers").doc(this.user.customerId),this.customerSubscription=this.cDocument.snapshotChanges().pipe(C(o=>{let r=o.payload.id,t=o.payload.data();return x({id:r},t)})).subscribe(o=>{this.isMederos=!0,this.customers=[o];let r=this.customers.filter(t=>t.isCarrusel);r.length>0&&(this.customerMed=r,this.getRoutesForMed(this.customerMed))})):(this.cCollection=this.afs.collection("customers",o=>o.where("active","==",!0)),this.customerSubscription=this.cCollection.snapshotChanges().pipe(C(o=>o.map(r=>{let t=r.payload.doc.id,l=r.payload.doc.data();return x({id:t},l)}))).subscribe(o=>{this.customers=o;let r=this.customers.filter(t=>t.isCarrusel);r.length>0&&(this.isMederos=!0,this.customerMed=r,this.getRoutesForMed(this.customerMed))}))}getRoutesForMed(o){this.validateFormM.controls.customerName.setValue(o[0].name),this.validateFormM.controls.customerId.setValue(o[0].id),this.routesService.getRoutes(o[0].id).pipe(T(this.stopSubscription$),C(r=>r.map(t=>{let l=t.payload.doc.id,m=t.payload.doc.data();return x({id:l},m)}))).subscribe(r=>{this.routesM=r}),this.productsService.getActiveProducts(o[0].id).pipe(T(this.stopSubscription$),C(r=>r.map(t=>{let l=t.payload.doc.id,m=t.payload.doc.data();return x({id:l},m)}))).subscribe(r=>{this.products=r})}submitM(){if(this.carro=this.validateFormM.get("asientos")?.value,this.validateFormM.valid){let o=this.validateFormM.get("customerId")?.value,r=this.validateFormM.get("routeId")?.value;this.chkBoardingP?this.routesService.getQuotesByRouteByBoardingPass(o,r,this.transportType).pipe(T(this.stopSubscription$),C(t=>t.map(l=>{let m=l.payload.doc.id,u=l.payload.doc.data();return Oe(x({},u),{id:m})})),C(t=>t.filter(l=>l.quotesData&&Array.isArray(l.quotesData)&&l.quotesData.some(m=>m.transportType===this.transportType))),C(t=>t.reduce((l,m)=>{let u=m.quotesData.filter(b=>b.transportType===this.transportType);return l.concat(u)},[]))).subscribe(t=>{console.log("Pases activos:"),console.log(t),t.length===0?this.sendMessage("info","No existen registros con estos criterios."):this.createDataSet(t)}):this.routesService.getQuotesByRouteandProgram(o,r,this.transportType).pipe(T(this.stopSubscription$),C(t=>t.map(l=>{let m=l.payload.doc.id,u=l.payload.doc.data();return Oe(x({},u),{id:m})}))).subscribe(t=>{t.length==0&&this.sendMessage("info","No existen registros con estos criterios."),this.createDataSet(t)})}else this.sendMessage("error","Datos invalidos favor de validar")}sendMessage(o,r){this.messageService.create(o,r)}onCheckboxChange(o){this.chkBoardingP=this.validateFormM.get("chkBoardingP")?.value}createDataSet(o){let r=this.selectedRoute.initialEnd,t=this.selectedRoute.initialStart,l=[],m=[];m=t.map(u=>({time:u,lunes:0,martes:0,miercoles:0,jueves:0,viernes:0})),l=r.map(u=>({time:u,lunes:0,martes:0,miercoles:0,jueves:0,viernes:0})),o.forEach(u=>{u.daysHour.forEach(b=>{let w=m.find(D=>D.time===b.startInit);if(w)switch(b.day){case 1:w.lunes+=1;break;case 2:w.martes+=1;break;case 3:w.miercoles+=1;break;case 4:w.jueves+=1;break;case 5:w.viernes+=1;break;default:break}let P=l.find(D=>D.time===b.endInit);if(P)switch(b.day){case 1:P.lunes+=1;break;case 2:P.martes+=1;break;case 3:P.miercoles+=1;break;case 4:P.jueves+=1;break;case 5:P.viernes+=1;break;default:break}})}),this.dataSet=m,this.dataSetEnd=l,this.calculateTotals()}onProductSelect(o){this.transportType=o}onRoutesSelect(o){let r=this.routesM.find(t=>t.id===o);r&&(this.selectedRoute=r)}calculateTotals(){this.totalLunes=this.dataSet.reduce((t,l)=>t+l.lunes,0),this.totalMartes=this.dataSet.reduce((t,l)=>t+l.martes,0),this.totalMiercoles=this.dataSet.reduce((t,l)=>t+l.miercoles,0),this.totalJueves=this.dataSet.reduce((t,l)=>t+l.jueves,0),this.totalViernes=this.dataSet.reduce((t,l)=>t+l.viernes,0),this.grantotal=this.totalLunes+this.totalMartes+this.totalMiercoles+this.totalJueves+this.totalViernes,this.totalLunesE=this.dataSetEnd.reduce((t,l)=>t+l.lunes,0),this.totalMartesE=this.dataSetEnd.reduce((t,l)=>t+l.martes,0),this.totalMiercolesE=this.dataSetEnd.reduce((t,l)=>t+l.miercoles,0),this.totalJuevesE=this.dataSetEnd.reduce((t,l)=>t+l.jueves,0),this.totalViernesE=this.dataSetEnd.reduce((t,l)=>t+l.viernes,0),this.grantotalE=this.totalLunesE+this.totalMartesE+this.totalMiercolesE+this.totalJuevesE+this.totalViernesE;let o=this.dataSet.length*this.carro,r=this.dataSetEnd.length*this.carro;this.sumaTotal=o+r,this.LunesFinal=this.totalLunes+this.totalLunesE,this.MartesFinal=this.totalMartes+this.totalMartesE,this.MiercolesFinal=this.totalMiercoles+this.totalMiercolesE,this.JuevesFinal=this.totalJueves+this.totalJuevesE,this.ViernesFinal=this.totalViernes+this.totalViernesE,this.porcentajeLunes=this.LunesFinal/this.sumaTotal*100,this.porcentajeMartes=this.MartesFinal/this.sumaTotal*100,this.porcentajeMiercoles=this.MiercolesFinal/this.sumaTotal*100,this.porcentajeJueves=this.JuevesFinal/this.sumaTotal*100,this.porcentajeViernes=this.ViernesFinal/this.sumaTotal*100}onCustomerSelectedC(o,r){if(o!=null&&!this.userRoute){this.userRoute=!0,this.routes=[],this.contenedores="",this.rowDataPay=[];let l=Be.filter(r,m=>m.id==o)[0];this.validateForm.controls.customerName.setValue(l.name),this.validateForm.controls.customerId.setValue(l.id),this.fillCustomerRoute(l.id)}}onCustomerSelectedP(o,r){if(console.log(o),console.log(this.userRouteP),o!=null&&!this.userRouteP){this.userRouteP=!0,this.routesP=[],this.contenedoresPay="",this.rowDataPre=[],this.rowData=[];let l=Be.filter(r,m=>m.id==o)[0];this.validateFormP.controls.customerName.setValue(l.name),this.validateFormP.controls.customerId.setValue(l.id),this.fillCustomerRouteP(l.id)}}calculateRemaining(o){return this.carro-o}ngOnDestroy(){this.stopSubscription$.next(void 0),this.stopSubscription$.complete()}fillCustomerRoute(o){this.routesService.getRoutes(o).pipe(T(this.stopSubscription$),C(r=>r.map(t=>{let l=t.payload.doc.id,m=t.payload.doc.data();return x({id:l},m)}))).subscribe(r=>{this.routes=r})}fillCustomerRouteP(o){this.routesService.getRoutes(o).pipe(T(this.stopSubscription$),C(r=>r.map(t=>{let l=t.payload.doc.id,m=t.payload.doc.data();return x({id:l},m)}))).subscribe(r=>{this.routesP=r})}onRouteSelected(o,r){this.routeId$.next(o);let l=Be.filter(r,m=>m.routeId==o)[0];this.validateForm.controls.routeName.setValue(l.name)}onRouteSelectedP(o,r){this.routeId$.next(o);let l=Be.filter(r,m=>m.routeId==o)[0];this.validateFormP.controls.routeName.setValue(l.name)}submitFormUnPaid(){this.userRoute=!1,this.rowDataPay=[];let o=this.validateForm.controls.customerId.value,r=this.validateForm.controls.routeId.value,t=this.validateForm.controls.round.value,l="";t==1?l="D\xEDa":t==2?l="Tarde":l="Nocturno",this.usersCollection=this.afs.collection("users",m=>m.where("status","==","preRegister").where("customerId","==",o).where("turno","==",t).where("defaultRoute","==",r).orderBy("displayName")),this.userSubscription=this.usersCollection.snapshotChanges().pipe(C(m=>m.map(u=>{let b=u.payload.doc.id,w=u.payload.doc.data();return x({id:b},w)}))).subscribe(m=>{this.loadUsers(m)})}loadUsers(o){this.rowDataPay=o,o.length<=14?this.contenedores=this.organigrama(o.length,13,19,40):o.length<=19?this.contenedores=this.organigrama(o.length,14,17,40):this.contenedores=this.organigrama(o.length,14,19,40)}loadUsersP(o){this.contenedoresPay="",this.rowData=o,this.rowData.length<=14?this.contenedoresPay=this.organigrama(this.rowData.length,13,19,40):this.rowData.length<=19?this.contenedoresPay=this.organigrama(this.rowData.length,14,17,40):this.contenedoresPay=this.organigrama(this.rowData.length,14,19,40)}onRoundSelected(){if(this.submitPayment){this.submitPayment=!1,this.userRouteP=!1,this.rowData=[],this.rowDataPre=[];let o=this.validateFormP.controls.customerId.value,r=this.validateFormP.controls.routeId.value,t=parseInt(this.validateFormP.controls.round.value,10),l="";t==1?l="D\xEDa":t==2?l="Tarde":l="Nocturno",this.usersCollection=this.afs.collection("users",m=>m.where("customerId","==",o).where("defaultRound","==",l).where("defaultRoute","==",r).orderBy("displayName")),this.userSubscription=this.usersCollection.snapshotChanges().pipe(C(m=>m.map(u=>{let b=u.payload.doc.id,w=u.payload.doc.data();return x({id:b},w)}))).subscribe(m=>{this.rowData=m,this.load()})}}load(){this.rowData.length>=1?(this.rowDataPush=[],this.rowData.forEach(o=>{let r=o.id;this.afs.collection(`users/${r}/boardingPasses`,t=>t.where("active","==",!0).limit(1)).get().subscribe(t=>{t.empty||(console.log(`El usuario con ID ${r} tiene un boardingPassessDetail activo.`),this.rowDataPush.push(x({},o)))})})):this.contenedoresPay="No existen coincidencias!"}submitFormPaid(){this.rowDataPre=[],this.submitPayment=!0,this.rowDataPre=this.rowDataPush,this.loadUsersP(this.rowDataPre)}organigrama(o,r,t,l){let m=0,u=0,b=0,w=0,P=!1;for(;o>0;)if(o>=l)b++,o-=l;else if(o>=t)u++,o-=t;else if(o>=r)m++,o-=r;else{w=o;break}let D="";return m>0&&(D+=`${m} camiones de 14 pasajeros, `,P=!0),u>0&&(D+=`${u} camiones de 19 pasajeros, `,P=!0),b>0&&(D+=`${b} camiones de 40 pasajeros, `,P=!0),w>0&&(D+=`y restan ${w} pasajeros sin asignacion, `),D!==""?P?D=`Se necesitan ${D} en total.`:D=`Se necesitan 0 camiones  ${D} en total.`:D="No se necesitan camiones.",D}resetFilters(){}resetFiltersPay(){}trackByName(o,r){return r.name}trackByNamePay(o,r){return r.name}sortBPay(){}sortBy(){}};p.\u0275fac=function(r){return new(r||p)(L(Y),L(ye),L(J))},p.\u0275cmp=B({type:p,selectors:[["app-organigrama"]],decls:90,vars:18,consts:[["filterTable",""],["borderedTable",""],["borderedTable1",""],[2,"margin","buttom 15px","margin-right","15px","margin-left","15px"],[1,"site-page-header-ghost-wrapper"],[2,"background-color","#f9fbfd",3,"nzGhost"],[2,"margin-left","350px"],[1,"body"],["nzTitle","Usuarios Interesados"],[2,"margin-bottom","10px"],["nz-form","","nzLayout","horizontal",3,"ngSubmit","formGroup"],[2,"width","1000px","border-collapse","collapse"],[2,"width","50%"],[2,"width","80px"],["formControlName","customerId","nzAllowClear","","nzPlaceHolder","Selecciona la Empresa",2,"width","300px",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["formControlName","routeId","nzAllowClear","","nzPlaceHolder","Selecciona la Operaci\xF3n",2,"width","300px",3,"ngModelChange"],["formControlName","round","nzAllowClear","","nzPlaceHolder","Selecciona Turno",2,"width","300px"],["nzValue","1","nzLabel","Matutino"],["nzValue","2","nzLabel","Vespertino"],["nzValue","3","nzLabel","Nocturno"],["nz-button","",3,"click"],[1,"table-operations"],["nzTableLayout","fixed","ngSkipHydration","",3,"nzData"],[3,"nzSortOrder","nzSortFn","nzFilters","nzFilterFn","nzSortOrderChange",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngFor","ngForOf"],["nzTitle","Usuarios con Pago"],["formControlName","round","nzAllowClear","","nzPlaceHolder","Selecciona Turno",2,"width","300px",3,"ngModelChange"],["nzTitle","Unidad Mederos Pagos",4,"ngIf"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon",""],[3,"nzSortOrderChange","nzSortOrder","nzSortFn","nzFilters","nzFilterFn"],["nzTitle","Unidad Mederos Pagos"],[2,"width","33%"],["nz-input","","id","customerName","formControlName","customerName",2,"width","300px"],["formControlName","routeId","nzAllowClear","","nzPlaceHolder","Selecciona la Operaci\xF3n",2,"width","250px",3,"ngModelChange"],["nz-checkbox","","formControlName","chkBoardingP",2,"margin-left","10px","margin-top","5px",3,"ngModelChange","ngModel"],["nzAllowClear","","nzPlaceHolder","Selecciona un Producto","formControlName","productId",2,"width","200px",3,"ngModelChange"],["nz-input","","type","number","formControlName","asientos","id","asientos","placeholder","# Asientos",2,"width","110px","height","30px"],["nz-button","","type","number",2,"margin-bottom","10px",3,"click"],["nzBordered","","nzSize","middle","nzTitle","Procentajes",1,"custom-table"],[2,"border-radius","1px"],["nzBordered","","nzSize","middle","nzTitle","Horario Entrada",3,"nzData"],[1,"m-b-0",3,"nzColor"],["nzBordered","","nzSize","middle","nzTitle","Horario Salida",3,"nzData"],["class","m-b-0",3,"nzColor",4,"ngIf"]],template:function(r,t){if(r&1){let l=F();i(0,"div",3)(1,"div",4)(2,"nz-page-header",5)(3,"nz-page-header-title",6),a(4,"Organigrama de Operaci\xF3n"),e(),i(5,"nz-page-header-subtitle"),a(6,"Reporte de usuarios "),e()()(),i(7,"div",7)(8,"nz-tabset")(9,"nz-tab",8)(10,"div",9)(11,"form",10),z("ngSubmit",function(){return g(l),_(t.submitFormUnPaid())}),i(12,"table",11)(13,"tbody")(14,"tr")(15,"td",12)(16,"nz-form-item")(17,"nz-form-label",13),a(18,"Empresa"),e(),i(19,"nz-select",14),z("ngModelChange",function(u){return g(l),_(t.onCustomerSelectedC(u,t.customers))}),v(20,gi,3,3,"nz-option",15),e()()()(),i(21,"tr")(22,"td",12)(23,"nz-form-item")(24,"nz-form-label",13),a(25,"Operaci\xF3n"),e(),i(26,"nz-select",16),z("ngModelChange",function(u){return g(l),_(t.onRouteSelected(u,t.routes))}),v(27,_i,3,3,"nz-option",15),e()(),i(28,"nz-form-label",13),a(29,"Turno"),e(),i(30,"nz-select",17),S(31,"nz-option",18)(32,"nz-option",19)(33,"nz-option",20),e(),i(34,"nz-form-item")(35,"nz-form-label"),a(36,"Programac\xF3n de Operaci\xF3n: "),e(),i(37,"b"),a(38),e()()()()()(),i(39,"button",21),z("click",function(){return g(l),_(t.submitFormUnPaid())}),a(40,"Aceptar"),e()()(),i(41,"div"),S(42,"div",22),i(43,"nz-table",23,0)(45,"thead")(46,"tr"),v(47,zi,2,5,"th",24),e()(),v(48,vi,15,7,"tr",25),e()()(),i(49,"nz-tab",26)(50,"div",9)(51,"form",10),z("ngSubmit",function(){return g(l),_(t.submitFormPaid())}),i(52,"table",11)(53,"tr")(54,"td",12)(55,"nz-form-item")(56,"nz-form-label",13),a(57,"Empresa"),e(),i(58,"nz-select",14),z("ngModelChange",function(u){return g(l),_(t.onCustomerSelectedP(u,t.customers))}),v(59,Si,3,3,"nz-option",15),e()()()(),i(60,"tr")(61,"td",12)(62,"nz-form-item")(63,"nz-form-label",13),a(64,"Operaci\xF3n"),e(),i(65,"nz-select",16),z("ngModelChange",function(u){return g(l),_(t.onRouteSelectedP(u,t.routesP))}),v(66,Ci,3,3,"nz-option",15),e()(),i(67,"nz-form-label",13),a(68,"Turno"),e(),i(69,"nz-select",27),z("ngModelChange",function(){return g(l),_(t.onRoundSelected())}),S(70,"nz-option",18)(71,"nz-option",19)(72,"nz-option",20),e(),i(73,"nz-form-item")(74,"nz-form-label"),a(75,"Programac\xF3n de Operaci\xF3n: "),e(),i(76,"b"),a(77),e()()()()(),i(78,"nz-form-item")(79,"button",21),z("click",function(){return g(l),_(t.submitFormPaid())}),a(80,"Aceptar"),e()()()(),i(81,"div"),S(82,"div",22),i(83,"nz-table",23,0)(85,"thead")(86,"tr"),v(87,xi,2,5,"th",24),e()(),v(88,bi,15,7,"tr",25),e()()(),v(89,ki,134,50,"nz-tab",28),e()()()}if(r&2){let l=I(44);s(2),c("nzGhost",!1),s(9),c("formGroup",t.validateForm),s(9),c("ngForOf",t.customers),s(7),c("ngForOf",t.routes),s(11),f(" ",t.contenedores,""),s(5),c("nzData",t.rowDataPay),s(4),c("ngForOf",t.listOfColumns)("ngForTrackBy",t.trackByName),s(),c("ngForOf",l.data),s(3),c("formGroup",t.validateFormP),s(8),c("ngForOf",t.customers),s(7),c("ngForOf",t.routesP),s(11),f(" ",t.contenedoresPay,""),s(6),c("nzData",t.rowDataPre),s(4),c("ngForOf",t.listOfColumns)("ngForTrackBy",t.trackByNamePay),s(),c("ngForOf",l.data),s(),c("ngIf",t.isMederos)}},dependencies:[j,$,be,Ee,We,Xe,Ge,Ie,Ve,Ye,de,Ft,oe,se,ce,le,me,ge,Q,fe,ie,ee,te,Tt,ne,re,He,q,Ct,H,W,G,X,ve,ze],styles:[".table-operations[_ngcontent-%COMP%]{margin-bottom:16px}.table-operations[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:8px}.custom-table[_ngcontent-%COMP%]{max-width:900px;margin:auto;height:160px}.custom-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .custom-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px;font-size:14px}.custom-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f0f0f0;text-align:center}.custom-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center}"]});let d=p;return d})();var _t=st(ut());var jt=(()=>{let p=class p{constructor(){this.audioUrl=""}};p.\u0275fac=function(r){return new(r||p)},p.\u0275cmp=B({type:p,selectors:[["app-audio-player"]],inputs:{audioUrl:"audioUrl"},decls:3,vars:1,consts:[["controls",""],["type","audio/mpeg",3,"src"]],template:function(r,t){r&1&&(i(0,"audio",0),S(1,"source",1),a(2," Your browser does not support the audio element. "),e()),r&2&&(s(),c("src",t.audioUrl,U))},encapsulation:2});let d=p;return d})();var $t=()=>({width:"300px",borderRadius:"4px",marginLeft:"160px"}),qt=()=>({width:"300px"});function Ui(d,p){if(d&1&&(i(0,"tr")(1,"td"),a(2),e(),i(3,"td"),a(4),ke(5,"date"),e(),i(6,"td"),a(7),e(),i(8,"td")(9,"a",31),a(10,"Ver Evidencia"),e()(),i(11,"td"),S(12,"app-audio-player",32),e()()),d&2){let n=p.$implicit;s(2),f(" ",n.displayName," "),s(2),V(Re(5,5,n.dateTimeStamp.toDate(),"yyyy-MM-dd HH:mm:ss")),s(3),f(" ",n.comentario," "),s(2),Ce("href",n.imageUrl,U),s(3),c("audioUrl",n.audioUrl)}}function Ai(d,p){if(d&1&&(i(0,"nz-table",29,0)(2,"thead")(3,"tr")(4,"th"),a(5,"PR"),e(),i(6,"th"),a(7,"Fecha"),e(),i(8,"th"),a(9,"Comentarios "),e(),i(10,"th"),a(11,"Audio"),e(),i(12,"th"),a(13,"..."),e()()(),i(14,"tbody"),v(15,Ui,13,8,"tr",30),e()()),d&2){let n=I(1),o=h();c("nzData",o.evidenceInfo)("nzLoading",o.loadingevidenceInfo)("nzLoadingDelay",500),s(15),c("ngForOf",n.data)}}function Bi(d,p){if(d&1&&(i(0,"nz-option",33),S(1,"i",34),a(2),S(3,"br"),a(4),e()),d&2){let n=p.$implicit;c("nzLabel",n.name)("nzValue",n.id),s(2),f(" ",n.name," "),s(2),f(" ",n.description,"")}}function ji(d,p){if(d&1&&S(0,"nz-option",35),d&2){let n=p.$implicit;c("nzValue",n.id)("nzLabel",n.displayName)}}function $i(d,p){if(d&1&&(i(0,"tr")(1,"td"),a(2),e(),i(3,"td"),a(4),ke(5,"date"),e(),i(6,"td"),a(7),e(),i(8,"td")(9,"a",31),a(10,"Ver Evidencia"),e()(),i(11,"td"),S(12,"app-audio-player",32),e()()),d&2){let n=p.$implicit;s(2),f(" ",n.displayName," "),s(2),V(Re(5,5,n.dateTimeStamp.toDate(),"yyyy-MM-dd HH:mm:ss")),s(3),f(" ",n.comentario," "),s(2),Ce("href",n.imageUrl,U),s(3),c("audioUrl",n.audioUrl)}}function qi(d,p){if(d&1&&(i(0,"nz-table",29,1)(2,"thead")(3,"tr")(4,"th"),a(5,"PR"),e(),i(6,"th"),a(7,"Fecha"),e(),i(8,"th"),a(9,"Comentarios "),e(),i(10,"th"),a(11,"Audio"),e(),i(12,"th"),a(13,"..."),e()()(),i(14,"tbody"),v(15,$i,13,8,"tr",30),e()()),d&2){let n=I(1),o=h();c("nzData",o.evidenceInfoDriver)("nzLoading",o.loadingevidenceInfoDriver)("nzLoadingDelay",500),s(15),c("ngForOf",n.data)}}function Hi(d,p){if(d&1&&S(0,"nz-option",35),d&2){let n=p.$implicit;c("nzValue",n.id)("nzLabel",n.name)}}function Wi(d,p){if(d&1&&S(0,"nz-option",35),d&2){let n=p.$implicit;c("nzValue",n.id)("nzLabel",n.name)}}function Gi(d,p){if(d&1&&(i(0,"tr")(1,"td"),a(2),e(),i(3,"td"),a(4),ke(5,"date"),e(),i(6,"td"),a(7),e(),i(8,"td")(9,"a",31),a(10,"Ver Evidencia"),e()(),i(11,"td"),S(12,"app-audio-player",32),e()()),d&2){let n=p.$implicit;s(2),f(" ",n.displayName," "),s(2),V(Re(5,5,n.dateTimeStamp.toDate(),"yyyy-MM-dd HH:mm:ss")),s(3),f(" ",n.comentario," "),s(2),Ce("href",n.imageUrl,U),s(3),c("audioUrl",n.audioUrl)}}function Xi(d,p){if(d&1&&(i(0,"nz-table",36,0)(2,"thead")(3,"tr")(4,"th"),a(5,"PR"),e(),i(6,"th"),a(7,"Fecha"),e(),i(8,"th"),a(9,"Comentarios "),e(),i(10,"th"),a(11,"Audio"),e(),i(12,"th"),a(13,"..."),e()()(),i(14,"tbody"),v(15,Gi,13,8,"tr",30),e()()),d&2){let n=I(1),o=h();c("nzData",o.evidenceInfoByProgram),s(15),c("ngForOf",n.data)}}function Ji(d,p){if(d&1&&S(0,"nz-option",35),d&2){let n=p.$implicit;c("nzValue",n.id)("nzLabel",n.name)}}function Yi(d,p){if(d&1&&S(0,"nz-option",35),d&2){let n=p.$implicit;c("nzValue",n.id)("nzLabel",n.name)}}function Ki(d,p){if(d&1&&(i(0,"tr")(1,"td"),a(2),e(),i(3,"td"),a(4),ke(5,"date"),e(),i(6,"td"),a(7),e(),i(8,"td")(9,"a",31),a(10,"Ver Evidencia"),e()(),i(11,"td"),S(12,"app-audio-player",32),e()()),d&2){let n=p.$implicit;s(2),f(" ",n.displayName," "),s(2),V(Re(5,5,n.dateTimeStamp.toDate(),"yyyy-MM-dd HH:mm:ss")),s(3),f(" ",n.comentario," "),s(2),Ce("href",n.imageUrl,U),s(3),c("audioUrl",n.audioUrl)}}function Qi(d,p){if(d&1&&(i(0,"nz-table",36,2)(2,"thead")(3,"tr")(4,"th"),a(5,"PR"),e(),i(6,"th"),a(7,"Fecha"),e(),i(8,"th"),a(9,"Comentarios "),e(),i(10,"th"),a(11,"Audio"),e(),i(12,"th"),a(13,"..."),e()()(),i(14,"tbody"),v(15,Ki,13,8,"tr",30),e()()),d&2){let n=I(1),o=h();c("nzData",o.evidenceInfoByRoute),s(15),c("ngForOf",n.data)}}var Cr=(()=>{let p=class p{constructor(o,r,t){this.afs=o,this.datePipe=r,this.fb=t,this.driverService=E(Mt),this.vendorsService=E(wt),this.accountsService=E(Z),this.customersService=E(Fe),this.routesService=E(ae),this.programService=E(Pe),this.loadingevidenceInfo=!1,this.loadingevidenceInfoByProgram=!1,this.loadingevidenceInfoDriver=!1,this.stopSubscription$=new A,this.infoLoad=[],this.customerList=[],this.programList=[],this.customerListRoute=[],this.RouteList=[],this.vendorsList=[],this.rolService=E(Te),this.authService=E(K),this.infoSegment=[],this.date=pt(),this.dateRoute=pt(),this.authService.user.subscribe(l=>{this.user=l,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&(this.rolService.getRol(this.user.rolId).valueChanges().subscribe(m=>{this.infoLoad=m,this.userlevelAccess=this.infoLoad.optionAccessLavel}),this.accountsService.getSegmentLevel(this.user.idSegment).pipe(T(this.stopSubscription$),C(m=>{let u=m.payload.id,b=m.payload.data();return x({id:u},b)}),R(m=>(this.infoSegment=m,m))).subscribe())}),this.dateFilterForm=this.fb.group({selectedDate:[null]}),this.dateFilterFormProgram=this.fb.group({selectedDate:[null],customerId:[],programId:[],name:[]}),this.dateFilterFormProgramRoute=this.fb.group({selectedDate:[null],customerId:[],routeId:[],name:[]}),this.dateFilterFormDriver=this.fb.group({selectedDate:[null],driverId:[],driver:[],vendorName:[],vendorId:[]}),this.vendorsService.getVendors().pipe(T(this.stopSubscription$),C(l=>l.map(m=>{let u=m.payload.doc.id,b=m.payload.doc.data();return Oe(x({},b),{id:u})}))).subscribe(l=>{this.vendorsList=l})}onDateChangeDriver(){this.evidenceInfoDriver=[],this.driversList=[]}ngOnDestroy(){this.stopSubscription$.next(void 0),this.stopSubscription$.complete()}onVendorSelected(o,r){if(o){this.evidenceInfoDriver=[],this.driversList=[];let l=_t.filter(this.vendorsList,m=>m.id==o)[0];this.fillDataDriver(l.id)}}fillDataDriver(o){this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1?this.driverService.getDriversbyCustomer(o,this.user.customerId).pipe(C(r=>r.map(t=>{let l=t.payload.doc.id,m=t.payload.doc.data();return x({id:l},m)}))).subscribe(r=>{console.log(r),this.driversList=r}):this.driverService.getDrivers(o).pipe(C(r=>r.map(t=>{let l=t.payload.doc.id,m=t.payload.doc.data();return x({id:l},m)}))).subscribe(r=>{console.log(r),this.driversList=r})}ngOnInit(){}onDriverSelected(o,r){if(this.evidenceInfoDriver=[],o){let t="";this.dateFilterFormDriver&&(t=this.dateFilterFormDriver.get("selectedDate").value);let l=this.datePipe.transform(t,"dd-MM-yyyy"),u=_t.filter(this.driversList,b=>b.id==o)[0];this.driverService.getEvidenceDriversperDriver(l.toString(),u.id).pipe(C(b=>b.map(w=>{let P=w.payload.doc.id,D=w.payload.doc.data();return x({id:P},D)}))).subscribe(b=>{this.evidenceInfoDriver=b,this.loadingevidenceInfoDriver=!1},b=>{this.loadingevidenceInfoDriver=!1})}}onDateChange(){this.loadingevidenceInfo=!0;let o=this.dateFilterForm.get("selectedDate").value;if(o!==void 0){let r=new Date(o);this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1?this.driverService.getEvidenceDriversbyCustomer(r,this.user.customerId).pipe(C(t=>t.map(l=>{let m=l.payload.doc.id,u=l.payload.doc.data();return x({id:m},u)}))).subscribe(t=>{this.evidenceInfo=t,this.loadingevidenceInfo=!1},t=>{console.error("Error fetching evidence:",t),this.loadingevidenceInfo=!1}):this.driverService.getEvidenceDrivers(r).pipe(C(t=>t.map(l=>{let m=l.payload.doc.id,u=l.payload.doc.data();return x({id:m},u)}))).subscribe(t=>{this.evidenceInfo=t,this.loadingevidenceInfo=!1},t=>{console.error("Error fetching evidence:",t),this.loadingevidenceInfo=!1})}}onDateChangeProgram(o){this.date=ct(new Date(o)),this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1?(this.cDocument=this.afs.collection("customers").doc(this.user.customerId),this.customerSubscription=this.cDocument.snapshotChanges().pipe(C(r=>{let t=r.payload.id,l=r.payload.data();return x({id:t},l)})).subscribe(r=>{this.customerList=[r]})):(this.cCollection=this.afs.collection("customers",r=>r.where("active","==",!0)),this.customerSubscription=this.cCollection.snapshotChanges().pipe(C(r=>r.map(t=>{let l=t.payload.doc.id,m=t.payload.doc.data();return x({id:l},m)}))).subscribe(r=>{this.customerList=r}))}onDateChangeProgramRoute(o){this.dateRoute=ct(new Date(o)),this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1?(this.cDocument=this.afs.collection("customers").doc(this.user.customerId),this.customerSubscription=this.cDocument.snapshotChanges().pipe(C(r=>{let t=r.payload.id,l=r.payload.data();return x({id:t},l)})).subscribe(r=>{this.customerListRoute=[r]})):(this.cCollection=this.afs.collection("customers",r=>r.where("active","==",!0)),this.customerSubscription=this.cCollection.snapshotChanges().pipe(C(r=>r.map(t=>{let l=t.payload.doc.id,m=t.payload.doc.data();return x({id:l},m)}))).subscribe(r=>{this.customerListRoute=r}))}onCustomerSelected(o){let r=this.dateFilterFormProgram.get("customerId").value;this.date!==void 0&&r!==void 0&&(this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1?this.programService.getProgramsByDaybyCustomer(this.date,this.user.customerId).pipe(ue(1),C(t=>t.map(l=>{let m=l.payload.doc.id,u=l.payload.doc.data();return x({id:m},u)})),R(t=>{this.programList=t})).subscribe():this.programService.getProgramsByDay(this.date).pipe(ue(1),C(t=>t.map(l=>{let m=l.payload.doc.id,u=l.payload.doc.data();return x({id:m},u)})),C(t=>{let l=new Set;return t.filter(m=>l.has(m.name)?!1:(l.add(m.name),!0))}),R(t=>{this.programList=t})).subscribe())}onCustomerSelectedRoute(o){let r=this.dateFilterFormProgramRoute.get("customerId").value;this.dateRoute!==void 0&&r!==void 0&&this.programService.getRoutesbyCustomer(r).pipe(ue(1),C(t=>t.map(l=>{let m=l.payload.doc.id,u=l.payload.doc.data();return x({id:m},u)})),R(t=>{this.RouteList=t})).subscribe()}onProgramSelected(){this.loadingevidenceInfoByProgram=!0;let o=this.dateFilterFormProgram.get("programId").value;console.log("programIdValue"+o),o!==void 0&&this.driverService.getEvidenceByProgram(o).pipe(C(r=>r.map(t=>{let l=t.payload.doc.id,m=t.payload.doc.data();return x({id:l},m)}))).subscribe(r=>{this.evidenceInfoByProgram=r,console.log(this.evidenceInfoByProgram)})}onRouteSelected(){let o=this.dateFilterFormProgramRoute.get("routeId").value;o!==void 0&&this.driverService.getEvidenceByRoute(o).pipe(C(r=>r.map(t=>{let l=t.payload.doc.id,m=t.payload.doc.data();return x({id:l},m)}))).subscribe(r=>{this.evidenceInfoByRoute=r,console.log(this.evidenceInfoByRoute)})}};p.\u0275fac=function(r){return new(r||p)(L(Y),L(Ue),L(J))},p.\u0275cmp=B({type:p,selectors:[["app-evidence"]],decls:72,vars:28,consts:[["basicTable",""],["basicTableDriver",""],["basicTableR",""],[2,"margin","buttom 15px","margin-right","15px","margin-left","15px"],[1,"site-page-header-ghost-wrapper"],[2,"background-color","#f9fbfd",3,"nzGhost"],[2,"margin-left","350px"],[1,"body"],["nzTitle","Evidencias Generales"],[2,"margin-bottom","10px",3,"formGroup"],["for","selectedDate"],["type","date","id","selectedDate","formControlName","selectedDate",3,"change"],[3,"nzData","nzLoading","nzLoadingDelay",4,"ngIf"],["nzTitle","Evidencias por PR"],[2,"width","160px"],[3,"formGroup"],["formControlName","vendorId","nzAllowClear","","nzPlaceHolder","Selecciona la estaci\xF3n",2,"width","450px",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["formControlName","driver","nzAllowClear","","nzPlaceHolder","Seleccione un PR",2,"width","450px",3,"ngModelChange"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nzTitle","Evidencias por Programa"],["for","selectedDate",2,"width","160px"],[3,"ngStyle"],[3,"nzSelectChange","ngStyle","nzFullscreen"],["formControlName","customerId","nzAllowClear","","nzPlaceHolder","Seleccione una Empresa",2,"width","450px",3,"ngModelChange"],["formControlName","programId","nzAllowClear","","nzPlaceHolder","Seleccione un PR",2,"width","450px",3,"ngModelChange"],["ngSkipHydration","",3,"nzData",4,"ngIf"],["nzTitle","Evidencias por Operaci\xF3n"],["formControlName","routeId","nzAllowClear","","nzPlaceHolder","Seleccione un PR",2,"width","450px",3,"ngModelChange"],[3,"nzData","nzLoading","nzLoadingDelay"],[4,"ngFor","ngForOf"],["target","_blank",3,"href"],[3,"audioUrl"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon",""],[3,"nzValue","nzLabel"],["ngSkipHydration","",3,"nzData"]],template:function(r,t){r&1&&(i(0,"div",3)(1,"div",4)(2,"nz-page-header",5)(3,"nz-page-header-title",6),a(4,"Evidencias"),e(),i(5,"nz-page-header-subtitle"),a(6,"Reporte de evidencias "),e()()(),i(7,"div",7)(8,"nz-tabset")(9,"nz-tab",8)(10,"div",9)(11,"label",10),a(12," Selecciona una Fecha: "),e(),i(13,"input",11),z("change",function(){return t.onDateChange()}),e()(),i(14,"div"),v(15,Ai,16,4,"nz-table",12),e()(),i(16,"nz-tab",13)(17,"div",9)(18,"nz-form-label",14),a(19," Selecciona una Fecha"),e(),i(20,"input",11),z("change",function(){return t.onDateChangeDriver()}),e()(),i(21,"div",15)(22,"nz-form-control")(23,"nz-form-label",14),a(24,"Divisi\xF3n"),e(),i(25,"nz-select",16),z("ngModelChange",function(m){return t.onVendorSelected(m,"vendorName")}),v(26,Bi,5,4,"nz-option",17),e()(),i(27,"nz-form-control")(28,"nz-form-label",14),a(29,"PR"),e(),i(30,"nz-select",18),z("ngModelChange",function(m){return t.onDriverSelected(m,"vendorName")}),v(31,ji,1,2,"nz-option",19),e()()(),i(32,"div"),v(33,qi,16,4,"nz-table",12),e()(),i(34,"nz-tab",20)(35,"div",15)(36,"nz-form-control")(37,"nz-form-label",21),a(38," Selecciona una Fecha "),e(),i(39,"div",22)(40,"nz-calendar",23),z("nzSelectChange",function(m){return t.onDateChangeProgram(m)}),e()()(),i(41,"nz-form-control")(42,"nz-form-label",14),a(43,"Empresa"),e(),i(44,"nz-select",24),z("ngModelChange",function(m){return t.onCustomerSelected(m)}),v(45,Hi,1,2,"nz-option",19),e()(),i(46,"nz-form-control")(47,"nz-form-label",14),a(48,"Programa"),e(),i(49,"nz-select",25),z("ngModelChange",function(){return t.onProgramSelected()}),v(50,Wi,1,2,"nz-option",19),e()()(),i(51,"div"),v(52,Xi,16,2,"nz-table",26),e()(),i(53,"nz-tab",27)(54,"div",15)(55,"nz-form-control")(56,"nz-form-label",21),a(57," Selecciona una Fecha "),e(),i(58,"div",22)(59,"nz-calendar",23),z("nzSelectChange",function(m){return t.onDateChangeProgramRoute(m)}),e()()(),i(60,"nz-form-control")(61,"nz-form-label",14),a(62,"Empresa"),e(),i(63,"nz-select",24),z("ngModelChange",function(m){return t.onCustomerSelectedRoute(m)}),v(64,Ji,1,2,"nz-option",19),e()(),i(65,"nz-form-control")(66,"nz-form-label",14),a(67,"Ruta"),e(),i(68,"nz-select",28),z("ngModelChange",function(){return t.onRouteSelected()}),v(69,Yi,1,2,"nz-option",19),e()()(),i(70,"div"),v(71,Qi,16,2,"nz-table",26),e()()()()()),r&2&&(s(2),c("nzGhost",!1),s(8),c("formGroup",t.dateFilterForm),s(5),c("ngIf",t.evidenceInfo),s(2),c("formGroup",t.dateFilterFormDriver),s(4),c("formGroup",t.dateFilterFormDriver),s(5),c("ngForOf",t.vendorsList),s(5),c("ngForOf",t.driversList),s(2),c("ngIf",t.evidenceInfoDriver),s(2),c("formGroup",t.dateFilterFormProgram),s(4),c("ngStyle",Le(24,$t)),s(),c("ngStyle",Le(25,qt))("nzFullscreen",!1)("nzFullscreen",!1),s(5),c("ngForOf",t.customerList),s(5),c("ngForOf",t.programList),s(2),c("ngIf",t.evidenceInfoByProgram),s(2),c("formGroup",t.dateFilterFormProgramRoute),s(4),c("ngStyle",Le(26,$t)),s(),c("ngStyle",Le(27,qt))("nzFullscreen",!1)("nzFullscreen",!1),s(5),c("ngForOf",t.customerListRoute),s(5),c("ngForOf",t.RouteList),s(2),c("ngIf",t.evidenceInfoByRoute))},dependencies:[j,$,St,Ot,be,Ee,Ie,Je,de,oe,se,ce,le,me,Q,ie,ee,te,ne,re,q,H,W,G,X,ve,ze,jt,Ue]});let d=p;return d})();function Zi(d,p){if(d&1&&(i(0,"nz-option",38),a(1),e()),d&2){let n=p.$implicit;c("nzLabel",n.name)("nzValue",n.id),s(),f(" ",n.name,"")}}function en(d,p){if(d&1&&(i(0,"a",42),a(1,"Ver Referencia"),e()),d&2){let n=h().$implicit;c("href",n.refrenceURL,U)}}function tn(d,p){if(d&1){let n=F();i(0,"tr")(1,"td"),a(2),e(),i(3,"td"),a(4),e(),i(5,"td"),a(6),e(),i(7,"td"),a(8),e(),i(9,"td"),a(10),e(),i(11,"td")(12,"a",40),z("click",function(){let r=g(n).$implicit,t=h(2);return _(t.loadUserInfoPanel(r.uidUsuario))}),a(13,"Ver"),e()(),i(14,"td"),v(15,en,2,1,"a",41),e(),i(16,"td")(17,"a",40),z("click",function(){let r=g(n).$implicit,t=h(2);return _(t.openSeguimientoModal(r.id,r.token,r.uidUsuario))}),a(18,"Seguimiento"),e()()()}if(d&2){let n=p.$implicit,o=h(2);s(2),f(" ",n.status," "),s(2),V(n.currentDate),s(2),he(" ",n.description," ",n.cancelUserComment," "),s(2),f(" ",o.getRouteNameById(n.routeId,n.customerId)," "),s(2),f(" ",n.bus," "),s(5),c("ngIf",n.refrenceURL)}}function nn(d,p){if(d&1&&(i(0,"nz-table",39,8)(2,"thead")(3,"tr")(4,"th"),a(5,"Status"),e(),i(6,"th"),a(7,"Fecha"),e(),i(8,"th"),a(9,"Descripci\xF3n"),e(),i(10,"th"),a(11,"Ruta"),e(),i(12,"th"),a(13,"Tipo"),e(),i(14,"th"),a(15,"Usuario"),e(),i(16,"th"),a(17,"Referencia"),e(),i(18,"th"),a(19,"..."),e()()(),i(20,"tbody"),v(21,tn,19,7,"tr",32),e()()),d&2){let n=I(1),o=h();c("nzData",o.mfDataM)("nzLoading",o.loadingmejorasData)("nzLoadingDelay",500),s(21),c("ngForOf",n.data)}}function rn(d,p){if(d&1&&(i(0,"a",42),a(1,"Ver Referencia"),e()),d&2){let n=h().$implicit;c("href",n.refrenceURL,U)}}function an(d,p){if(d&1){let n=F();i(0,"tr")(1,"td"),a(2),e(),i(3,"td"),a(4),e(),i(5,"td"),a(6),e(),i(7,"td"),a(8),e(),i(9,"td"),a(10),e(),i(11,"td")(12,"a",40),z("click",function(){let r=g(n).$implicit,t=h(2);return _(t.loadUserInfoPanel(r.uidUsuario))}),a(13,"Ver"),e()(),i(14,"td"),v(15,rn,2,1,"a",41),e(),i(16,"td")(17,"a",40),z("click",function(){let r=g(n).$implicit,t=h(2);return _(t.openSeguimientoModal(r.id,r.token,r.uidUsuario))}),a(18,"Seguimiento"),e()()()}if(d&2){let n=p.$implicit,o=h(2);s(2),f(" ",n.status," "),s(2),V(n.currentDate),s(2),he(" ",n.description," ",n.cancelUserComment," "),s(2),f(" ",o.getRouteNameById(n.routeId,n.customerId)," "),s(2),f(" ",n.bus," "),s(5),c("ngIf",n.refrenceURL)}}function on(d,p){if(d&1&&(i(0,"nz-table",43,9)(2,"thead")(3,"tr")(4,"th"),a(5,"Status"),e(),i(6,"th"),a(7,"Fecha"),e(),i(8,"th"),a(9,"Descripci\xF3n"),e(),i(10,"th"),a(11,"Ruta"),e(),i(12,"th"),a(13,"Tipo"),e(),i(14,"th"),a(15,"Usuario"),e(),i(16,"th"),a(17,"Referencia"),e(),i(18,"th"),a(19,"..."),e()()(),i(20,"tbody"),v(21,an,19,7,"tr",32),e()()),d&2){let n=I(1),o=h();c("nzData",o.mfData)("nzLoading",o.loadingmejorasData)("nzLoadingDelay",500),s(21),c("ngForOf",n.data)}}function sn(d,p){if(d&1&&(i(0,"nz-option",38),a(1),e()),d&2){let n=p.$implicit;c("nzLabel",n.name)("nzValue",n.id),s(),f(" ",n.name,"")}}function ln(d,p){if(d&1&&(i(0,"a",42),a(1,"Ver Referencia"),e()),d&2){let n=h().$implicit;c("href",n.refrenceURL,U)}}function dn(d,p){if(d&1){let n=F();i(0,"tr")(1,"td"),a(2),e(),i(3,"td"),a(4),e(),i(5,"td"),a(6),e(),i(7,"td"),a(8),e(),i(9,"td"),a(10),e(),i(11,"td")(12,"a",40),z("click",function(){let r=g(n).$implicit,t=h();return _(t.loadUserInfoPanel(r.uidUsuario))}),a(13,"Ver"),e()(),i(14,"td"),v(15,ln,2,1,"a",41),e(),i(16,"td")(17,"a",40),z("click",function(){let r=g(n).$implicit,t=h();return _(t.openSeguimientoModal(r.id,r.token,r.uidUsuario))}),a(18,"Seguimiento"),e()()()}if(d&2){let n=p.$implicit,o=h();s(2),f(" ",n.status," "),s(2),V(n.currentDate),s(2),he(" ",n.description," ",n.cancelUserComment," "),s(2),f(" ",o.getRouteNameById(n.routeId,n.customerId)," "),s(2),f(" ",n.bus," "),s(5),c("ngIf",n.refrenceURL)}}function mn(d,p){if(d&1&&(i(0,"nz-option",38),a(1),e()),d&2){let n=p.$implicit;c("nzLabel",n.name)("nzValue",n.id),s(),f(" ",n.name,"")}}function cn(d,p){if(d&1&&(i(0,"a",42),a(1,"Ver Referencia"),e()),d&2){let n=h().$implicit;c("href",n.refrenceURL,U)}}function pn(d,p){if(d&1){let n=F();i(0,"tr")(1,"td"),a(2),e(),i(3,"td"),a(4),e(),i(5,"td"),a(6),e(),i(7,"td"),a(8),e(),i(9,"td"),a(10),e(),i(11,"td")(12,"a",40),z("click",function(){let r=g(n).$implicit,t=h();return _(t.loadUserInfoPanel(r.uidUsuario))}),a(13,"Ver"),e()(),i(14,"td"),v(15,cn,2,1,"a",41),e(),i(16,"td")(17,"a",40),z("click",function(){let r=g(n).$implicit,t=h();return _(t.openSeguimientoModal(r.id,r.token,r.uidUsuario))}),a(18,"Seguimiento"),e()()()}if(d&2){let n=p.$implicit,o=h();s(2),f(" ",n.status," "),s(2),V(n.currentDate),s(2),he(" ",n.description," ",n.cancelUserComment," "),s(2),f(" ",o.getRouteNameById(n.routeId,n.customerId)," "),s(2),f(" ",n.bus," "),s(5),c("ngIf",n.refrenceURL)}}function un(d,p){if(d&1&&(i(0,"div",44)(1,"div")(2,"strong"),a(3,"Cliente:"),e(),a(4),e(),i(5,"div")(6,"strong"),a(7,"Nombre:"),e(),a(8),e(),i(9,"div")(10,"strong"),a(11,"Email:"),e(),a(12),e(),i(13,"div")(14,"strong"),a(15,"Telefono:"),e(),a(16),e()()),d&2){let n=h();s(4),f(" ",n.modalDataUser.customerName,""),s(4),f(" ",n.modalDataUser.displayName,""),s(4),f(" ",n.modalDataUser.email,""),s(4),f(" ",n.modalDataUser.phoneNumber,"")}}function hn(d,p){if(d&1){let n=F();i(0,"button",45),z("click",function(){g(n);let r=h();return _(r.closeProgramModal())}),a(1,"Aceptar"),e()}}function fn(d,p){if(d&1&&(i(0,"div",44)(1,"div")(2,"strong"),a(3,"Cliente:"),e(),a(4),e(),i(5,"div")(6,"strong"),a(7,"Conductor:"),e(),a(8),e(),i(9,"div")(10,"strong"),a(11,"Turno:"),e(),a(12),e(),i(13,"div")(14,"strong"),a(15,"Inicio:"),e(),a(16),e(),i(17,"div")(18,"strong"),a(19,"Fin:"),e(),a(20),e(),i(21,"div")(22,"strong"),a(23,"Veh\xEDculo:"),e(),a(24),e()()),d&2){let n=h();s(4),f(" ",n.modalData.customerName,""),s(4),f(" ",n.modalData.driver,""),s(4),f(" ",n.modalData.round,""),s(4),f(" ",n.modalData.startAt,""),s(4),f(" ",n.modalData.endAt,""),s(4),f(" ",n.modalData.vehicleName,"")}}function gn(d,p){if(d&1){let n=F();i(0,"button",45),z("click",function(){g(n);let r=h();return _(r.closeProgramModal())}),a(1,"Aceptar"),e()}}function _n(d,p){if(d&1&&(i(0,"div",49),a(1),e()),d&2){let n=h(2);s(),f(" ",n.errorMessage," ")}}function zn(d,p){if(d&1){let n=F();i(0,"div",44)(1,"nz-select",46),O("ngModelChange",function(r){g(n);let t=h();return M(t.selectedStatus,r)||(t.selectedStatus=r),_(r)}),S(2,"nz-option",22)(3,"nz-option",23)(4,"nz-option",24)(5,"nz-option",25),e(),i(6,"textarea",47),O("ngModelChange",function(r){g(n);let t=h();return M(t.response,r)||(t.response=r),_(r)}),a(7," "),e(),v(8,_n,2,1,"div",48),e()}if(d&2){let n=h();s(),N("ngModel",n.selectedStatus),s(5),N("ngModel",n.response),s(2),c("ngIf",n.errorMessage)}}function vn(d,p){if(d&1){let n=F();i(0,"button",45),z("click",function(){g(n);let r=h();return _(r.closeProgramModal())}),a(1,"Cerrar"),e(),i(2,"button",45),z("click",function(){g(n);let r=h();return _(r.handleOk())}),a(3,"Enviar"),e()}}var Mr=(()=>{let p=class p{constructor(o,r,t,l){this.afs=o,this.messageService=r,this.datePipe=t,this.fb=l,this.programService=E(Pe),this.authService=E(K),this.rolService=E(Te),this.routesService=E(ae),this.accountsService=E(Z),this.dashboardService=E(De),this.userService=E(_e),this.infoSegment=[],this.mfData=[],this.mfDataM=[],this.loadingmejorasData=!1,this.loadingincidenteData=!1,this.loadingopData=!1,this.infoLoad=[],this.stopSubscription$=new A,this.routeNames={},this.isProgramModalVisible=!1,this.isSeguimientoVisible=!1,this.isUserModalVisible=!1,this.modalData={},this.modalDataUser={},this.selectedDataUser=[],this.selectedStatus=null,this.response=null,this.errorMessage=null,this.selectedUserToken="",this.selectHelpCenterIdTicket="",this.selectedUidUser="",this.customersList=[],this.authService.user.subscribe(m=>{this.user=m,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&(this.rolService.getRol(this.user.rolId).valueChanges().subscribe(u=>{this.infoLoad=u,this.userlevelAccess=this.infoLoad.optionAccessLavel}),this.accountsService.getSegmentLevel(this.user.idSegment).pipe(T(this.stopSubscription$),C(u=>{let b=u.payload.id,w=u.payload.data();return x({id:b},w)}),R(u=>(this.infoSegment=u,u))).subscribe())}),this.dateFilterForm=this.fb.group({selectedOption:[null],status:[]}),this.dateFilterFormI=this.fb.group({selectedOption:[null],status:[]}),this.dateFilterFormO=this.fb.group({selectedOption:[null],status:[]}),this.getCustomersList()}ngOnDestroy(){this.stopSubscription$.next(void 0),this.stopSubscription$.complete()}ngOnInit(){}onDateChange(o){if(!(this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1))if(o=="1"){let r=this.dateFilterForm.get("selectedOption").value,t=this.dateFilterForm.get("status").value;r&&t?(this.programService.getHelpCenterAll("Mejora",r,t).pipe(C(l=>l.map(m=>{let u=m.payload.doc.id,b=m.payload.doc.data();return x({id:u},b)}))).subscribe(l=>{l.length>0&&(this.mfDataM=l,this.mfData.forEach(m=>{l.routeId&&this.getRouteNameById(m.routeId,m.customerId)}))}),this.programService.getHelpCenterAll("Felicitacion",r,t).pipe(C(l=>l.map(m=>{let u=m.payload.doc.id,b=m.payload.doc.data();return x({id:u},b)}))).subscribe(l=>{l.length>0&&(this.mfData=l,this.mfData.forEach(m=>{l.routeId&&this.getRouteNameById(m.routeId,m.customerId)}))})):this.sendMessage("error","Los criterios son requeridos para la busqueda")}else if(o=="2"){let r=this.dateFilterFormI.get("selectedOption").value,t=this.dateFilterFormI.get("status").value;r&&t?this.programService.getHelpCenterAll("Incidente",r,t).pipe(C(l=>l.map(m=>{let u=m.payload.doc.id,b=m.payload.doc.data();return x({id:u},b)}))).subscribe(l=>{l.length>0?(this.incidenteData=l,this.incidenteData.forEach(m=>{l.routeId&&this.getRouteNameById(m.routeId,m.customerId)})):this.sendMessage("info","No existen registros con estos criterios")}):this.sendMessage("error","Los criterios son requeridos para la busqueda")}else{let r=this.dateFilterFormO.get("selectedOption").value,t=this.dateFilterFormO.get("status").value;r&&t?this.programService.getHelpCenterAll("Objeto Perdido",r,t).pipe(C(l=>l.map(m=>{let u=m.payload.doc.id,b=m.payload.doc.data();return x({id:u},b)}))).subscribe(l=>{l.length>0?(this.opData=l,this.opData.forEach(m=>{l.routeId&&this.getRouteNameById(m.routeId,m.customerId)})):this.sendMessage("info","No existen registros con estos criterios")}):this.sendMessage("error","Los criterios son requeridos para la busqueda")}}getCustomersList(){this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1?this.afs.collection("customers",r=>r.where("customerId","==",this.user.customerId).orderBy("name")).snapshotChanges().pipe(T(this.stopSubscription$),C(r=>r.map(t=>{let l=t.payload.doc.id,m=t.payload.doc.data();return x({id:l},m)})),R(r=>(this.customersList=r,r))).subscribe():this.afs.collection("customers",r=>r.orderBy("name")).snapshotChanges().pipe(T(this.stopSubscription$),C(r=>r.map(t=>{let l=t.payload.doc.id,m=t.payload.doc.data();return x({id:l},m)})),R(r=>(this.customersList=r,r))).subscribe()}getRouteNameById(o,r){return this.routeNames[o]?this.routeNames[o]:(this.routesService.getRoute(r,o).pipe(ue(1),C(t=>{let l=t.payload.data(),m=l?l.name:"Pendiente..";return this.routeNames[o]=m,m})).subscribe(),"Loading...")}sendMessage(o,r){this.messageService.create(o,r)}openProgramModal(o,r){this.isProgramModalVisible=!0,this.loadProgramData(o,r)}openSeguimientoModal(o,r,t){this.isSeguimientoVisible=!0,this.selectedUserToken=r,this.selectHelpCenterIdTicket=o,this.selectedUidUser=t,this.loadUserInfo(this.selectedUidUser)}handleOk(){if(!this.selectedStatus||!this.response)this.errorMessage="Por favor, complete todos los campos antes de enviar.";else if(this.errorMessage=null,!this.selectedUserToken||!this.selectHelpCenterIdTicket||!this.selectedUidUser||!this.selectedDataUser)this.errorMessage="Falta informaci\xF3n por cargar. Validar nuevamente.";else{let o=this.selectedUserToken||"";if(this.programService.updateTicketHelpCenter(this.selectHelpCenterIdTicket,this.selectedStatus),o){let r={createdAt:new Date,from:"FyXKSXsUbYNtAbWL7zZ66o2f1M92",fromName:"El Ticket generado tiene un status de :"+this.selectedStatus,msg:this.response,requestId:"suhB7YFAh6PYXCRuJhfD",token:o,uid:this.selectedUidUser,email:this.selectedDataUser.email,title:"Apps And Informa General",body:this.response},t={timestamp:new Date,title:"El Ticket generado tiene un status de :"+this.selectedStatus,email:this.selectedDataUser.email,body:this.response,token:o,uid:this.selectedUidUser};this.dashboardService.setChatMessage(r),this.dashboardService.setMessage(t,this.selectedUidUser),this.isSeguimientoVisible=!1,this.response=""}else console.log("Null token :"+this.selectedUidUser+"// "+this.modalDataUser.customerName)}}closeProgramModal(){this.isProgramModalVisible=!1,this.isSeguimientoVisible=!1,this.isUserModalVisible=!1,this.selectedUserToken="",this.selectHelpCenterIdTicket="",this.selectedUidUser=""}loadProgramData(o,r){this.programService.getProgrambyCustomer(o,r).subscribe(t=>{if(t.payload){let l=t.payload.data(),m=l.startAt?l.startAt.toDate():new Date,u=l.endAt?l.endAt.toDate():new Date,b=this.datePipe.transform(m,"dd-MM-yyyy HH:mm"),w=this.datePipe.transform(u,"dd-MM-yyyy HH:mm");this.modalData={customerName:l.customerName,driver:l.driver,startAt:b,round:l.round,endAt:w,vehicleName:l.vehicleName}}else console.error("No data found")},t=>{console.error("Error fetching data",t)})}loadUserInfoPanel(o){this.isUserModalVisible=!0,this.loadUserInfo(o)}loadUserInfo(o){this.userService.getUserInfo(o).subscribe(r=>{if(r.payload){let t=r.payload.data();this.selectedDataUser=t,this.modalDataUser={customerName:t.customerName,displayName:t.displayName,email:t.email,phoneNumber:t.phoneNumber,token:t.token}}else console.error("No data found")},r=>{console.error("Error fetching data",r)})}};p.\u0275fac=function(r){return new(r||p)(L(Y),L(ye),L(Ue),L(J))},p.\u0275cmp=B({type:p,selectors:[["app-center"]],decls:128,vars:29,consts:[["incidente",""],["basicTable3",""],["modalContent",""],["modalPassFooter",""],["modalContent2",""],["modalPassFooter2",""],["modalContent1",""],["modalPassFooter1",""],["basicTable1M",""],["basicTable1",""],[2,"margin","buttom 15px","margin-right","15px","margin-left","15px"],[1,"site-page-header-ghost-wrapper"],[2,"background-color","#f9fbfd",3,"nzGhost"],[2,"margin-left","350px"],[1,"body"],["nzTitle","Mejoras y Felicitaciones"],[2,"margin-bottom","10px",3,"formGroup"],["for","selectedDate",2,"width","150px"],["formControlName","selectedOption","nzPlaceHolder","Selecciona un cliente",2,"width","300px",3,"ngModelChange","ngModel"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["for","type",2,"width","150px","margin-top","10px"],["formControlName","status","nzAllowClear","","nzPlaceHolder","Selecciona un tipo de status",2,"width","350px"],["nzValue","Abierto","nzLabel","Abierto"],["nzValue","En Proceso","nzLabel","En Proceso"],["nzValue","Cerrado","nzLabel","Cerrado"],["nzValue","Cancelado","nzLabel","Cancelado"],["nz-button","","nzType","primary",2,"margin-left","5px","margin-top","10px","margin-bottom","10px",3,"click"],["nzTitle","Mejoras","ngSkipHydration","",3,"nzData","nzLoading","nzLoadingDelay",4,"ngIf"],["nzTitle","Felicitaciones","ngSkipHydration","",3,"nzData","nzLoading","nzLoadingDelay",4,"ngIf"],["nzTitle","Incidente"],["formControlName","status","nzAllowClear","","nzPlaceHolder","Selecciona un tipo de status",2,"width","250px"],["nzTitle","Incidentes",3,"nzData","nzLoading","nzLoadingDelay"],[4,"ngFor","ngForOf"],["nzTitle","Objetos Perdidos"],["nzTitle","Objetos Perdidos",3,"nzData","nzLoading","nzLoadingDelay"],["nzTitle","Informaci\xF3n del Usuario",3,"nzVisibleChange","nzOnCancel","nzVisible","nzContent","nzFooter"],["nzTitle","Informaci\xF3n del Programa",3,"nzVisibleChange","nzOnCancel","nzVisible","nzContent","nzFooter"],["nzTitle","Seguimiento a Ticket",3,"nzVisibleChange","nzOnOk","nzOnCancel","nzVisible","nzContent","nzFooter"],["nzCustomContent","",3,"nzLabel","nzValue"],["nzTitle","Mejoras","ngSkipHydration","",3,"nzData","nzLoading","nzLoadingDelay"],[3,"click"],["target","_blank",3,"href",4,"ngIf"],["target","_blank",3,"href"],["nzTitle","Felicitaciones","ngSkipHydration","",3,"nzData","nzLoading","nzLoadingDelay"],[2,"display","flex","flex-direction","column","align-items","flex-start"],["nz-button","",3,"click"],["nzAllowClear","","nzPlaceHolder","Seleccione un estado",2,"width","100%","margin-bottom","15px",3,"ngModelChange","ngModel"],["rows","4","nz-input","","placeholder","Redactar Respuesta",2,"width","100%",3,"ngModelChange","ngModel"],["style","color: red; margin-top: 10px;",4,"ngIf"],[2,"color","red","margin-top","10px"]],template:function(r,t){if(r&1){let l=F();i(0,"div",10)(1,"div",11)(2,"nz-page-header",12)(3,"nz-page-header-title",13),a(4,"Centro de Atenci\xF3n"),e(),i(5,"nz-page-header-subtitle"),a(6," Informaci\xF3n "),e()()(),i(7,"div",14)(8,"nz-tabset")(9,"nz-tab",15)(10,"div",16)(11,"div")(12,"label",17),a(13," Selecciona un Cliente: "),e(),i(14,"nz-select",18),O("ngModelChange",function(u){return g(l),M(t.selectedOption,u)||(t.selectedOption=u),_(u)}),v(15,Zi,2,3,"nz-option",19),e()(),i(16,"div")(17,"label",20),a(18," Status: "),e(),i(19,"nz-select",21),S(20,"nz-option",22)(21,"nz-option",23)(22,"nz-option",24)(23,"nz-option",25),e()()(),i(24,"div")(25,"a",26),z("click",function(){return g(l),_(t.onDateChange("1"))}),a(26,"Cargar"),e()(),i(27,"div"),v(28,nn,22,4,"nz-table",27),e(),i(29,"div"),v(30,on,22,4,"nz-table",28),e()(),i(31,"nz-tab",29)(32,"div",16)(33,"div")(34,"label",17),a(35," Selecciona un Cliente: "),e(),i(36,"nz-select",18),O("ngModelChange",function(u){return g(l),M(t.selectedOption,u)||(t.selectedOption=u),_(u)}),v(37,sn,2,3,"nz-option",19),e()(),i(38,"div")(39,"label",20),a(40," Status: "),e(),i(41,"nz-select",30),S(42,"nz-option",22)(43,"nz-option",23)(44,"nz-option",24)(45,"nz-option",25),e()()(),i(46,"div")(47,"a",26),z("click",function(){return g(l),_(t.onDateChange("2"))}),a(48,"Cargar"),e()(),i(49,"div")(50,"nz-table",31,0)(52,"thead")(53,"tr")(54,"th"),a(55,"Status"),e(),i(56,"th"),a(57,"Fecha"),e(),i(58,"th"),a(59,"Descripci\xF3n"),e(),i(60,"th"),a(61,"Ruta"),e(),i(62,"th"),a(63,"Tipo"),e(),i(64,"th"),a(65,"Usuario"),e(),i(66,"th"),a(67,"Referencia"),e(),i(68,"th"),a(69,"..."),e()()(),i(70,"tbody"),v(71,dn,19,7,"tr",32),e()()()(),i(72,"nz-tab",33)(73,"div",16)(74,"div")(75,"label",17),a(76," Selecciona un Cliente: "),e(),i(77,"nz-select",18),O("ngModelChange",function(u){return g(l),M(t.selectedOption,u)||(t.selectedOption=u),_(u)}),v(78,mn,2,3,"nz-option",19),e()(),i(79,"div")(80,"label",20),a(81," Status: "),e(),i(82,"nz-select",30),S(83,"nz-option",22)(84,"nz-option",23)(85,"nz-option",24)(86,"nz-option",25),e()()(),i(87,"div")(88,"a",26),z("click",function(){return g(l),_(t.onDateChange("3"))}),a(89,"Cargar"),e()(),i(90,"div")(91,"nz-table",34,1)(93,"thead")(94,"tr")(95,"th"),a(96,"Status"),e(),i(97,"th"),a(98,"Fecha"),e(),i(99,"th"),a(100,"Descripci\xF3n"),e(),i(101,"th"),a(102,"Ruta"),e(),i(103,"th"),a(104,"Tipo"),e(),i(105,"th"),a(106,"Usuario"),e(),i(107,"th"),a(108,"Referencia"),e(),i(109,"th"),a(110,"..."),e()()(),i(111,"tbody"),v(112,pn,19,7,"tr",32),e()()()()()()(),i(113,"nz-modal",35),O("nzVisibleChange",function(u){return g(l),M(t.isUserModalVisible,u)||(t.isUserModalVisible=u),_(u)}),z("nzOnCancel",function(){return g(l),_(t.closeProgramModal())}),v(114,un,17,4,"ng-template",null,2,k)(116,hn,2,0,"ng-template",null,3,k),e(),i(118,"nz-modal",36),O("nzVisibleChange",function(u){return g(l),M(t.isProgramModalVisible,u)||(t.isProgramModalVisible=u),_(u)}),z("nzOnCancel",function(){return g(l),_(t.closeProgramModal())}),v(119,fn,25,6,"ng-template",null,4,k)(121,gn,2,0,"ng-template",null,5,k),e(),i(123,"nz-modal",37),O("nzVisibleChange",function(u){return g(l),M(t.isSeguimientoVisible,u)||(t.isSeguimientoVisible=u),_(u)}),z("nzOnOk",function(){return g(l),_(t.handleOk())})("nzOnCancel",function(){return g(l),_(t.closeProgramModal())}),v(124,zn,9,3,"ng-template",null,6,k)(126,vn,4,0,"ng-template",null,7,k),e()}if(r&2){let l=I(51),m=I(92),u=I(115),b=I(117),w=I(120),P=I(122),D=I(125),Ne=I(127);s(2),c("nzGhost",!1),s(8),c("formGroup",t.dateFilterForm),s(4),N("ngModel",t.selectedOption),s(),c("ngForOf",t.customersList),s(13),c("ngIf",t.mfDataM),s(2),c("ngIf",t.mfData),s(2),c("formGroup",t.dateFilterFormI),s(4),N("ngModel",t.selectedOption),s(),c("ngForOf",t.customersList),s(13),c("nzData",t.incidenteData)("nzLoading",t.loadingincidenteData)("nzLoadingDelay",500),s(21),c("ngForOf",l.data),s(2),c("formGroup",t.dateFilterFormO),s(4),N("ngModel",t.selectedOption),s(),c("ngForOf",t.customersList),s(13),c("nzData",t.opData)("nzLoading",t.loadingopData)("nzLoadingDelay",500),s(21),c("ngForOf",m.data),s(),N("nzVisible",t.isUserModalVisible),c("nzContent",u)("nzFooter",b),s(5),N("nzVisible",t.isProgramModalVisible),c("nzContent",w)("nzFooter",P),s(5),N("nzVisible",t.isSeguimientoVisible),c("nzContent",D)("nzFooter",Ne)}},dependencies:[j,$,Ve,de,oe,se,ce,le,me,we,ge,Q,fe,ie,ee,te,ne,re,q,H,W,G,X,qe,ve,ze]});let d=p;return d})();function Sn(d,p){if(d&1&&(i(0,"nz-option",22),a(1),e()),d&2){let n=p.$implicit;c("nzLabel",n.name)("nzValue",n.name),s(),f(" ",n.name,"")}}function Cn(d,p){if(d&1&&(i(0,"a",25),a(1,"Ver Comprobante"),e()),d&2){let n=h().$implicit;c("href",n.image,U)}}function xn(d,p){if(d&1){let n=F();i(0,"tr")(1,"td"),a(2),e(),i(3,"td"),a(4),e(),i(5,"td"),a(6),e(),i(7,"td"),a(8),e(),i(9,"td"),a(10),e(),i(11,"td"),v(12,Cn,2,1,"a",23),e(),i(13,"td")(14,"a",24),z("click",function(){let r=g(n).$implicit,t=h();return _(t.openSeguimientoModal(r.uid,r.userFullData.token,r.userFullData.id,r))}),a(15,"Seguimiento"),e()()()}if(d&2){let n=p.$implicit;s(2),f(" ",n.status," "),s(2),V(n.date),s(2),f(" ",n.displayName," "),s(2),f(" ",n.route.description," "),s(2),f(" ",n.typeRefund.name," "),s(2),c("ngIf",n.image)}}function bn(d,p){if(d&1&&(i(0,"div",33),a(1),e()),d&2){let n=h(2);s(),f(" ",n.errorMessage," ")}}function yn(d,p){if(d&1){let n=F();i(0,"div",26)(1,"nz-card",27)(2,"div")(3,"strong"),a(4,"Cliente:"),e(),a(5),e(),i(6,"div")(7,"strong"),a(8,"Nombre:"),e(),a(9),e(),i(10,"div")(11,"strong"),a(12,"Email:"),e(),a(13),e(),i(14,"div")(15,"strong"),a(16,"Telefono:"),e(),a(17),e(),i(18,"div")(19,"strong"),a(20,"Telefono Alterno:"),e(),a(21),e(),i(22,"div")(23,"strong"),a(24,"Matricula:"),e(),a(25),e(),i(26,"div")(27,"strong"),a(28,"Ruta:"),e(),a(29),e(),i(30,"div")(31,"strong"),a(32,"Turno:"),e(),a(33),e()(),i(34,"nz-card",28)(35,"div")(36,"strong"),a(37,"Banco:"),e(),a(38),e(),i(39,"div")(40,"strong"),a(41,"Tarjeta o Clabe:"),e(),a(42),e(),i(43,"div")(44,"strong"),a(45,"Beneficiario:"),e(),a(46),e()(),i(47,"nz-card",29)(48,"nz-select",30),O("ngModelChange",function(r){g(n);let t=h();return M(t.selectedStatus,r)||(t.selectedStatus=r),_(r)}),S(49,"nz-option",14)(50,"nz-option",15)(51,"nz-option",16)(52,"nz-option",17),e(),i(53,"textarea",31),O("ngModelChange",function(r){g(n);let t=h();return M(t.response,r)||(t.response=r),_(r)}),a(54," "),e(),v(55,bn,2,1,"div",32),e()()}if(d&2){let n=h();s(5),f(" ",n.modalDataUser.customerName,""),s(4),f(" ",n.modalDataUser.displayName,""),s(4),f(" ",n.modalDataUser.email,""),s(4),f(" ",n.modalDataUser.phone,""),s(4),f(" ",n.modalDataUser.phoneAlternative,""),s(4),f(" ",n.modalDataUser.matricula,""),s(4),f(" ",n.modalDataUser.name,""),s(4),f(" ",n.modalDataUser.turn,""),s(5),f(" ",n.modalDataUser.bankCode,""),s(4),f(" ",n.modalDataUser.bankCode,""),s(4),f(" ",n.modalDataUser.benefit,""),s(2),N("ngModel",n.selectedStatus),s(5),N("ngModel",n.response),s(2),c("ngIf",n.errorMessage)}}function En(d,p){if(d&1){let n=F();i(0,"button",34),z("click",function(){g(n);let r=h();return _(r.closeProgramModal())}),a(1,"Cerrar"),e(),i(2,"button",34),z("click",function(){g(n);let r=h();return _(r.handleOk())}),a(3,"Enviar"),e()}}var Xr=(()=>{let p=class p{constructor(o,r,t){this.afs=o,this.messageService=r,this.fb=t,this.programService=E(Pe),this.authService=E(K),this.rolService=E(Te),this.routesService=E(ae),this.accountsService=E(Z),this.dashboardService=E(De),this.userService=E(_e),this.mfDataM=[],this.infoSegment=[],this.stopSubscription$=new A,this.infoLoad=[],this.customersList=[],this.selectedStatus=null,this.response=null,this.errorMessage=null,this.loadingData=!1,this.isSeguimientoVisible=!1,this.selectedDataUser=[],this.modalDataUser={},this.authService.user.subscribe(l=>{this.user=l,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&(this.rolService.getRol(this.user.rolId).valueChanges().subscribe(m=>{this.infoLoad=m,this.userlevelAccess=this.infoLoad.optionAccessLavel}),this.accountsService.getSegmentLevel(this.user.idSegment).pipe(T(this.stopSubscription$),C(m=>{let u=m.payload.id,b=m.payload.data();return x({id:u},b)}),R(m=>(this.infoSegment=m,m))).subscribe())}),this.dateFilterForm=this.fb.group({selectedOption:[null],status:[]}),this.getCustomersList()}ngOnDestroy(){this.stopSubscription$.next(void 0),this.stopSubscription$.complete()}ngOnInit(){}getCustomersList(){this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1?this.afs.collection("customers",r=>r.where("customerId","==",this.user.customerId).orderBy("name")).snapshotChanges().pipe(T(this.stopSubscription$),C(r=>r.map(t=>{let l=t.payload.doc.id,m=t.payload.doc.data();return x({id:l},m)})),R(r=>(this.customersList=r,r))).subscribe():this.afs.collection("customers",r=>r.orderBy("name")).snapshotChanges().pipe(T(this.stopSubscription$),C(r=>r.map(t=>{let l=t.payload.doc.id,m=t.payload.doc.data();return x({id:l},m)})),R(r=>(this.customersList=r,r))).subscribe()}sendMessage(o,r){this.messageService.create(o,r)}handleOk(){if(!this.selectedStatus||!this.response)this.errorMessage="Por favor, complete todos los campos antes de enviar.";else if(this.errorMessage=null,console.log(this.selectedDataUser),!this.selectedDataUser.token||!this.selectedDataUser.idDoc||!this.selectedDataUser.userUid||!this.selectedDataUser)this.errorMessage="Falta informaci\xF3n por cargar. Validar nuevamente.";else{let o=this.selectedDataUser.token||"";if(this.programService.updateTicketRefund(this.selectedDataUser.idDoc,this.selectedStatus),o){let r={createdAt:new Date,from:"FyXKSXsUbYNtAbWL7zZ66o2f1M92",fromName:"El Ticket generado tiene un status de :"+this.selectedStatus,msg:this.response,requestId:"suhB7YFAh6PYXCRuJhfD",token:o,uid:this.selectedDataUser.userUid,email:this.selectedDataUser.email,title:"Apps And Informa General",body:this.response},t={timestamp:new Date,title:"El Ticket generado tiene un status de :"+this.selectedStatus,email:this.selectedDataUser.email,body:this.response,token:o,uid:this.selectedDataUser.userUid};this.dashboardService.setChatMessage(r),this.dashboardService.setMessage(t,this.selectedDataUser.userUid),this.isSeguimientoVisible=!1,this.response=""}else console.log("Null token :"+this.selectedDataUser.userUid+"// "+this.modalDataUser.customerName)}}openSeguimientoModal(o,r,t,l){console.log(o+" / "+t+" /// "+r),this.isSeguimientoVisible=!0,l.userFullData.token==null&&(this.errorMessage="El usuario no cuenta con un token v\xE1lido para poder dar seguimiento."),this.modalDataUser={customerName:l.customer,displayName:l.displayName,benefit:l.benefit,bankCode:l.bankCode,phone:l.phone,matricula:l.matricula,phoneAlternative:l.phoneAlternative,email:l.email,token:l.userFullData.token,turn:l.turn,name:l.route.name,idDoc:l.idDoc,userUid:l.uid},this.selectedDataUser=this.modalDataUser,console.log(this.selectedDataUser)}onDateChange(){if(!(this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1)){let o=this.dateFilterForm.get("selectedOption").value,r=this.dateFilterForm.get("status").value;console.log(o),console.log(r),o&&r?this.programService.getRefund(o,r).pipe(C(t=>t.map(l=>{let m=l.payload.doc.id,u=l.payload.doc.data();return x({id:m},u)}))).subscribe(t=>{t.length>0&&(this.mfDataM=t)}):this.sendMessage("error","Los criterios son requeridos para la busqueda")}}closeProgramModal(){this.isSeguimientoVisible=!1,this.modalDataUser={}}};p.\u0275fac=function(r){return new(r||p)(L(Y),L(ye),L(J))},p.\u0275cmp=B({type:p,selectors:[["app-refaund"]],decls:51,vars:11,consts:[["basicTable1M",""],["modalContent1",""],["modalPassFooter1",""],[2,"margin","buttom 15px","margin-right","15px","margin-left","15px"],[1,"site-page-header-ghost-wrapper"],[2,"background-color","#f9fbfd",3,"nzGhost"],[2,"margin-left","350px"],[1,"body"],[2,"margin-bottom","10px",3,"formGroup"],["for","selectedOption",2,"width","150px"],["formControlName","selectedOption","nzPlaceHolder","Selecciona un cliente",2,"width","300px",3,"ngModelChange","ngModel"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["for","type",2,"width","150px","margin-top","10px"],["formControlName","status","nzAllowClear","","nzPlaceHolder","Selecciona un tipo de status",2,"width","350px"],["nzValue","Abierto","nzLabel","Abierto"],["nzValue","En Proceso","nzLabel","En Proceso"],["nzValue","Cerrado","nzLabel","Cerrado"],["nzValue","Cancelado","nzLabel","Cancelado"],["nz-button","","nzType","primary",2,"margin-left","5px","margin-top","10px","margin-bottom","10px",3,"click"],["nzTitle","Reembolso","ngSkipHydration","",3,"nzData","nzLoading","nzLoadingDelay"],[4,"ngFor","ngForOf"],["nzTitle","Seguimiento a Ticket",3,"nzVisibleChange","nzOnOk","nzOnCancel","nzVisible","nzContent","nzFooter"],["nzCustomContent","",3,"nzLabel","nzValue"],["target","_blank",3,"href",4,"ngIf"],[3,"click"],["target","_blank",3,"href"],[2,"background","#ECECEC","padding","30px"],["nzTitle","Datos Usuario"],["nzTitle","Datos Bancarios"],["nzTitle","Seguimiento"],["nzAllowClear","","nzPlaceHolder","Seleccione un estado",2,"width","100%","margin-bottom","15px",3,"ngModelChange","ngModel"],["rows","4","nz-input","","placeholder","Redactar Respuesta",2,"width","100%",3,"ngModelChange","ngModel"],["style","color: red; margin-top: 10px;",4,"ngIf"],[2,"color","red","margin-top","10px"],["nz-button","",3,"click"]],template:function(r,t){if(r&1){let l=F();i(0,"div",3)(1,"div",4)(2,"nz-page-header",5)(3,"nz-page-header-title",6),a(4,"Reembolso"),e(),i(5,"nz-page-header-subtitle"),a(6," Proceso "),e()()(),i(7,"div",7)(8,"div",8)(9,"div")(10,"label",9),a(11," Selecciona un Cliente: "),e(),i(12,"nz-select",10),O("ngModelChange",function(u){return g(l),M(t.selectedOption,u)||(t.selectedOption=u),_(u)}),v(13,Sn,2,3,"nz-option",11),e()(),i(14,"div")(15,"label",12),a(16," Status: "),e(),i(17,"nz-select",13),S(18,"nz-option",14)(19,"nz-option",15)(20,"nz-option",16)(21,"nz-option",17),e()()(),i(22,"div")(23,"a",18),z("click",function(){return g(l),_(t.onDateChange())}),a(24,"Cargar"),e()(),i(25,"div")(26,"nz-table",19,0)(28,"thead")(29,"tr")(30,"th"),a(31,"Status"),e(),i(32,"th"),a(33,"Fecha"),e(),i(34,"th"),a(35,"Usuario"),e(),i(36,"th"),a(37,"Ruta"),e(),i(38,"th"),a(39,"Tipo de Reembolso"),e(),i(40,"th"),a(41,"Referencia"),e(),i(42,"th"),a(43,"..."),e()()(),i(44,"tbody"),v(45,xn,16,6,"tr",20),e()()()()(),i(46,"nz-modal",21),O("nzVisibleChange",function(u){return g(l),M(t.isSeguimientoVisible,u)||(t.isSeguimientoVisible=u),_(u)}),z("nzOnOk",function(){return g(l),_(t.handleOk())})("nzOnCancel",function(){return g(l),_(t.closeProgramModal())}),v(47,yn,56,14,"ng-template",null,1,k)(49,En,4,0,"ng-template",null,2,k),e()}if(r&2){let l=I(27),m=I(48),u=I(50);s(2),c("nzGhost",!1),s(6),c("formGroup",t.dateFilterForm),s(4),N("ngModel",t.selectedOption),s(),c("ngForOf",t.customersList),s(13),c("nzData",t.mfDataM)("nzLoading",t.loadingData)("nzLoadingDelay",500),s(19),c("ngForOf",l.data),s(),N("nzVisible",t.isSeguimientoVisible),c("nzContent",m)("nzFooter",u)}},dependencies:[j,$,Ve,de,oe,se,ce,le,me,we,ge,Q,fe,xt,ie,ee,te,ne,re,q,H,W,G,X,qe]});let d=p;return d})();export{$n as a,rr as b,Cr as c,Mr as d,Xr as e};
