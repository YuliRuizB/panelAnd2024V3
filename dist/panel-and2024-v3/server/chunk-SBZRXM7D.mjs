import './polyfills.server.mjs';
import{e as xe,f as be,g as Re}from"./chunk-QFOWCHJN.mjs";import{s as Ne,t as Ie,u as Se}from"./chunk-RVB6A6NG.mjs";import{D as N,H as _e,K as we,a as pe,ca as Me,d as ge,h as Ce,pa as Te,qa as Ae,r as fe,ra as Fe}from"./chunk-ZAF6KNMV.mjs";import{A as ve,Da as ze,Va as De,Za as F,cb as ye,m as H,p as V}from"./chunk-LY2HI3A4.mjs";import{$ as S,$a as se,Db as M,Fb as T,G as ne,Gb as A,Ib as b,Ja as c,Jb as R,Ka as D,La as y,Nb as W,Ob as Q,Pb as G,Qb as ue,Rb as q,V as re,Xa as L,Ya as _,_ as ie,_a as d,aa as ae,ab as le,ca as v,d as ee,db as ce,ga as k,ha as B,hb as x,ia as oe,ja as z,kb as Y,lb as j,mb as h,nb as u,o as O,oa as U,ob as $,oc as me,pa as g,pb as de,q as te,qa as C,qb as he,sb as w,sc as J,va as p,vb as f,xb as s}from"./chunk-BDHSFJ32.mjs";import{a as X,j as Z}from"./chunk-H6KHSOBK.mjs";var tt=(()=>{class r{constructor(e,t){this.afs=e,this.aff=t}getDrivers(e){return this.afs.collection("drivers").doc(e).snapshotChanges()}getDriversByCustomergetDrivers(e){return this.afs.collection("drivers",n=>n.where("vendorId","==",e).where("active","==",!0)).snapshotChanges()}getDriversByCustomer(e){return this.afs.collection("drivers",n=>n.where("customerId","==",e).where("active","==",!0)).snapshotChanges()}getDriversbyCustomer(e,t){return this.afs.collection("drivers",i=>i.where("customerId","==",t).where("vendorId","==",e)).snapshotChanges()}getAllDrivers(){return this.afs.collection("drivers").snapshotChanges()}updateDriver(e,t){return this.afs.collection("drivers").doc(e).update(X({},t))}resetPassword(e,t){let n={uid:e,password:t};return this.aff.httpsCallable("onDriverResetPassword")(n).toPromise().then(a=>{})}toggleActiveDriver(e,t){let n=!t;return this.afs.collection("drivers").doc(e).update({active:n})}deleteDriver(e){return this.afs.collection("drivers").doc(e).delete()}createDriver(e){return Z(this,null,function*(){let t=this.afs.createId();return e.uid=t,this.afs.collection("drivers").doc(t).set(e).then(()=>t)})}getEvidenceDrivers(e){if(!(e instanceof Date&&!isNaN(e.getTime())))return console.error("Invalid date:",e),O([]);let t=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),0,0,0,0)),n=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),23,59,59,999));return this.afs.collection("driversEvidence",a=>a.where("dateTimeStamp",">=",t).where("dateTimeStamp","<=",n)).snapshotChanges()}getEvidenceDriversbyCustomer(e,t){if(!(e instanceof Date&&!isNaN(e.getTime())))return console.error("Invalid date:",e),O([]);let n=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),0,0,0,0)),i=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),23,59,59,999));return this.afs.collection("driversEvidence",m=>m.where("dateTimeStamp",">=",n).where("dateTimeStamp","<=",i).where("customerId","==",t)).snapshotChanges()}getEvidenceDriversperDriver(e,t){return this.afs.collection("driversEvidence",i=>i.where("date","==",e).where("uid","==",t)).snapshotChanges()}getEvidenceByProgram(e){return this.afs.collection("driversEvidence",n=>n.where("programId","==",e)).snapshotChanges()}getEvidenceByRoute(e){return this.afs.collection("driversEvidence",n=>n.where("routeId","==",e)).snapshotChanges()}static{this.\u0275fac=function(t){return new(t||r)(v(V),v(Me))}}static{this.\u0275prov=S({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var lt=(()=>{class r{constructor(e,t){this.afs=e,this.messageService=t}setProgram(e){let t=this.afs.collection("customers").doc(e.customerId).collection("routes").doc(e.routeId).collection("assignments").doc(e.assignmentId),n=this.afs.collection("drivers").doc(e.driverId),i=new Date(e.date),a=new Date(e.date),m=new Date(e.date);return t.get().pipe(ne(1),te(E=>{let o=E.data(),P=o.stopBeginHour.substring(0,5),Pe=o.stopEndHour.substring(0,5),I=P.split(":"),K=Pe.split(":");if(a.setHours(I[0],I[1],0,0),m.setHours(K[0],K[1],0,0),i.setHours(I[0],I[1],0,0),i.setMinutes(+i.getMinutes()-15,0,0),o.program=="S"){let Oe=new Date(o.time.toDate());i=ye(Oe,-15)}return{active:o.active,capacity:e.vehicleCapacity,count:0,customerId:e.customerId,customerName:e.customerName,driver:e.driverName,driverConfirmationAt:H.fromDate(i),driverConfirmedAt:null,driverId:e.driverId,endAt:H.fromDate(m),endedAt:null,geofenceBegin:o.stopBeginId,geofenceEnd:o.stopEndId,geopoint:null,hasEnded:!1,isConfirmed:!1,isLive:!1,isRejected:!1,isTaskIn:o.program=="M",isTaskOut:o.program!="M",isWithTrouble:!1,lastUpdatedAt:null,name:e.routeName,program:o.program,rating:0,rejectedReason:null,round:o.round,routeDescription:e.routeName,routeId:e.routeId,routeName:e.routeName,startAt:H.fromDate(a),started:!1,startedAt:null,troubleMessage:null,troubleType:null,type:o.type,time:o.time,vehicleId:e.vehicleId,vehicleName:e.vehicleName,startAtFormat:a}})).subscribe(E=>this.afs.collection("customers").doc(e.customerId).collection("program").add(E).then(()=>this.sendMessage("success","La Programaci\xF3n ha sido generada. Favor de Actualizar la tabla.")).catch(P=>this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal ... ${P}`)))}getProgramsByDay(e){let t=e,n=F(t,1);return this.afs.collectionGroup("program",a=>a.where("startAt",">=",t).where("startAt","<=",n).where("active","==",!0).orderBy("startAt","asc")).snapshotChanges()}getProgramsByDayLive(e){let t=e,n=F(t,1);return this.afs.collectionGroup("live",a=>a.where("startAt",">=",t).where("startAt","<=",n).where("active","==",!0).orderBy("startAt","asc")).snapshotChanges()}getProgramsByDaybyCustomer(e,t){let n=e,i=F(n,1);return this.afs.collectionGroup("program",m=>m.where("startAt",">=",n).where("startAt","<=",i).where("active","==",!0).where("customerId","==",t).orderBy("startAt","asc")).snapshotChanges()}getProgramsByDaybyCustomerLive(e,t){let n=e,i=F(n,1);return this.afs.collectionGroup("live",m=>m.where("startAt",">=",n).where("startAt","<=",i).where("active","==",!0).where("customerId","==",t).orderBy("startAt","asc")).snapshotChanges()}getProgrambyCustomer(e,t){return this.afs.collection("customers").doc(t).collection("program").doc(e).snapshotChanges()}getRoutesbyCustomer(e){return this.afs.collectionGroup("routes",n=>n.where("active","==",!0).where("customerId","==",e).orderBy("name","asc")).snapshotChanges()}getRoutes(){return this.afs.collectionGroup("routes",t=>t.where("active","==",!0).orderBy("name","asc")).snapshotChanges()}getHelpCenter(e,t,n){return this.afs.collection("helpCenter",a=>a.where("active","==","true").where("customerId","==",n).where("type","==",e).where("currentDate","==",t)).snapshotChanges()}getHelpCenterAll(e,t,n){return this.afs.collection("helpCenter",a=>a.where("active","==","true").where("type","==",e).where("status","==",n).where("customerId","==",t).orderBy("currentDate","asc")).snapshotChanges()}getRefund(e,t){return this.afs.collection("refund",i=>i.where("status","==",t).where("customer","==",e).orderBy("date","asc")).snapshotChanges()}editProgram(e,t){return this.afs.collection("customers").doc(t.value.customerId).collection("program").doc(t.value.id).update({driver:t.value.driver,driverId:t.value.driverId,vehicleId:t.value.vehicleId,vehicleName:t.value.vehicleName}).then(()=>this.messageService.success("La Programaci\xF3n ha sido modificada. Favor de Actualizar la tabla.")).catch(i=>this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal ... ${i}`))}updateProgram(e,t){return this.afs.collection("customers").doc(t).collection("program").doc(e).update({isLive:!1}).then(()=>this.messageService.success("La Programaci\xF3n ha sido modificada. Favor de Actualizar la tabla.")).catch(i=>this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal ... ${i}`))}updateLive(e,t){return this.afs.collection("customers").doc(t).collection("program").doc(e).update({isLive:!1}).then(()=>this.messageService.success("La Programaci\xF3n ha sido modificada. Favor de Actualizar la tabla.")).catch(i=>this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal ... ${i}`))}sendMessage(e,t){this.messageService.create(e,t)}updateTicketHelpCenter(e,t){return this.afs.collection("helpCenter").doc(e).update({status:t})}updateTicketRefund(e,t){return this.afs.collection("refund").doc(e).update({status:t})}static{this.\u0275fac=function(t){return new(t||r)(v(V),v(De))}}static{this.\u0275prov=S({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Ve=(r,l)=>l.value;function Be(r,l){if(r&1&&(de(0),b(1),he()),r&2){let e=s(2);c(),R(e.nzCustomHeader)}}function Ue(r,l){if(r&1&&_(0,Be,2,1,"ng-container",0),r&2){let e=s();d("nzStringTemplateOutlet",e.nzCustomHeader)}}function Le(r,l){if(r&1&&$(0,"nz-option",3),r&2){let e=l.$implicit;d("nzLabel",e.label)("nzValue",e.value)}}function Ye(r,l){if(r&1&&$(0,"nz-option",3),r&2){let e=l.$implicit;d("nzLabel",e.label)("nzValue",e.value)}}function je(r,l){if(r&1){let e=w();h(0,"nz-select",8),f("ngModelChange",function(n){g(e);let i=s(2);return C(i.monthChange.emit(n))}),Y(1,Ye,1,2,"nz-option",3,Ve),u()}if(r&2){let e=s(2);d("nzSize",e.size)("nzDropdownMatchSelectWidth",!1)("ngModel",e.activeMonth),c(),j(e.months)}}function $e(r,l){if(r&1){let e=w();h(0,"div",1)(1,"nz-select",2),f("ngModelChange",function(n){g(e);let i=s();return C(i.updateYear(n))}),Y(2,Le,1,2,"nz-option",3,Ve),u(),_(4,je,3,3,"nz-select",4),h(5,"nz-radio-group",5),G("ngModelChange",function(n){g(e);let i=s();return Q(i.mode,n)||(i.mode=n),C(n)}),f("ngModelChange",function(n){g(e);let i=s();return C(i.modeChange.emit(n))}),h(6,"label",6),b(7),u(),h(8,"label",7),b(9),u()()()}if(r&2){let e=s();c(),d("nzSize",e.size)("nzDropdownMatchSelectWidth",!1)("ngModel",e.activeYear),c(),j(e.years),c(2),x(4,e.mode==="month"?4:-1),c(),W("ngModel",e.mode),d("nzSize",e.size),c(2),R(e.monthTypeText),c(2),R(e.yearTypeText)}}function We(r,l){if(r&1){let e=w();h(0,"date-table",4),f("valueChange",function(n){g(e);let i=s();return C(i.onDateSelect(n))}),u()}if(r&2){let e=s();d("prefixCls",e.prefixCls)("value",e.activeDate)("activeDate",e.activeDate)("cellRender",e.dateCell)("fullCellRender",e.dateFullCell)("disabledDate",e.nzDisabledDate)}}function Qe(r,l){if(r&1){let e=w();h(0,"month-table",5),f("valueChange",function(n){g(e);let i=s();return C(i.onDateSelect(n))}),u()}if(r&2){let e=s();d("prefixCls",e.prefixCls)("value",e.activeDate)("activeDate",e.activeDate)("cellRender",e.monthCell)("fullCellRender",e.monthFullCell)}}var Ge=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275dir=z({type:r,selectors:[["","nzDateCell",""]],exportAs:["nzDateCell"],standalone:!0})}}return r})(),qe=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275dir=z({type:r,selectors:[["","nzMonthCell",""]],exportAs:["nzMonthCell"],standalone:!0})}}return r})(),Je=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275dir=z({type:r,selectors:[["","nzDateFullCell",""]],exportAs:["nzDateFullCell"],standalone:!0})}}return r})(),Ke=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275dir=z({type:r,selectors:[["","nzMonthFullCell",""]],exportAs:["nzMonthFullCell"],standalone:!0})}}return r})(),Ee=(()=>{class r{get activeYear(){return this.activeDate.getYear()}get activeMonth(){return this.activeDate.getMonth()}get size(){return this.fullscreen?"default":"small"}get yearTypeText(){return this.i18n.getLocale().Calendar.lang.year}get monthTypeText(){return this.i18n.getLocale().Calendar.lang.month}constructor(e,t){this.i18n=e,this.dateHelper=t,this.mode="month",this.fullscreen=!0,this.activeDate=new N,this.modeChange=new p,this.yearChange=new p,this.monthChange=new p,this.yearOffset=10,this.yearTotal=20,this.years=[],this.months=[]}ngOnInit(){this.setUpYears(),this.setUpMonths()}ngOnChanges(e){if(e.activeDate){let t=e.activeDate.previousValue,n=e.activeDate.currentValue;t?.getYear()!==n?.getYear()&&this.setUpYears()}}updateYear(e){this.yearChange.emit(e),this.setUpYears(e)}setUpYears(e){let t=(e||this.activeYear)-this.yearOffset,n=t+this.yearTotal;this.years=[];for(let i=t;i<n;i++)this.years.push({label:`${i}`,value:i})}setUpMonths(){this.months=[];for(let e=0;e<12;e++){let t=this.activeDate.setMonth(e),n=this.dateHelper.format(t.nativeDate,"MMM");this.months.push({label:n,value:e})}}static{this.\u0275fac=function(t){return new(t||r)(D(_e),D(we))}}static{this.\u0275cmp=B({type:r,selectors:[["nz-calendar-header"]],hostAttrs:[1,"ant-fullcalendar-header"],hostVars:2,hostBindings:function(t,n){t&2&&se("display","block")},inputs:{mode:"mode",fullscreen:[k.HasDecoratorInputTransform,"fullscreen","fullscreen",J],activeDate:"activeDate",nzCustomHeader:"nzCustomHeader"},outputs:{modeChange:"modeChange",yearChange:"yearChange",monthChange:"monthChange"},exportAs:["nzCalendarHeader"],standalone:!0,features:[L,U,q],decls:2,vars:1,consts:[[4,"nzStringTemplateOutlet"],[1,"ant-picker-calendar-header"],[1,"ant-picker-calendar-year-select",3,"ngModelChange","nzSize","nzDropdownMatchSelectWidth","ngModel"],[3,"nzLabel","nzValue"],[1,"ant-picker-calendar-month-select",3,"nzSize","nzDropdownMatchSelectWidth","ngModel"],[1,"ant-picker-calendar-mode-switch",3,"ngModelChange","ngModel","nzSize"],["nz-radio-button","","nzValue","month"],["nz-radio-button","","nzValue","year"],[1,"ant-picker-calendar-month-select",3,"ngModelChange","nzSize","nzDropdownMatchSelectWidth","ngModel"]],template:function(t,n){t&1&&_(0,Ue,1,1,"ng-container")(1,$e,10,8),t&2&&x(0,n.nzCustomHeader?0:1)},dependencies:[Fe,Te,Ae,fe,ge,Ce,Se,Ie,Ne,ve],encapsulation:2,changeDetection:0})}}return r})(),Xe=(()=>{class r{get dateCell(){return this.nzDateCell||this.nzDateCellChild}get dateFullCell(){return this.nzDateFullCell||this.nzDateFullCellChild}get monthCell(){return this.nzMonthCell||this.nzMonthCellChild}get monthFullCell(){return this.nzMonthFullCell||this.nzMonthFullCellChild}constructor(e,t){this.cdr=e,this.directionality=t,this.activeDate=new N,this.prefixCls="ant-picker-calendar",this.destroy$=new ee,this.dir="ltr",this.onChangeFn=()=>{},this.onTouchFn=()=>{},this.nzMode="month",this.nzModeChange=new p,this.nzPanelChange=new p,this.nzSelectChange=new p,this.nzValueChange=new p,this.nzFullscreen=!0}ngOnInit(){this.dir=this.directionality.value,this.directionality.change?.pipe(re(this.destroy$)).subscribe(()=>{this.dir=this.directionality.value})}onModeChange(e){this.nzModeChange.emit(e),this.nzPanelChange.emit({date:this.activeDate.nativeDate,mode:e})}onYearSelect(e){let t=this.activeDate.setYear(e);this.updateDate(t)}onMonthSelect(e){let t=this.activeDate.setMonth(e);this.updateDate(t)}onDateSelect(e){this.updateDate(e)}writeValue(e){this.updateDate(new N(e),!1),this.cdr.markForCheck()}registerOnChange(e){this.onChangeFn=e}registerOnTouched(e){this.onTouchFn=e}updateDate(e,t=!0){this.activeDate=e,t&&(this.onChangeFn(e.nativeDate),this.onTouchFn(),this.nzSelectChange.emit(e.nativeDate),this.nzValueChange.emit(e.nativeDate))}ngOnChanges(e){e.nzValue&&this.updateDate(new N(this.nzValue),!1)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(t){return new(t||r)(D(me),D(ze))}}static{this.\u0275cmp=B({type:r,selectors:[["nz-calendar"]],contentQueries:function(t,n,i){if(t&1&&(M(i,Ge,5,y),M(i,Je,5,y),M(i,qe,5,y),M(i,Ke,5,y)),t&2){let a;T(a=A())&&(n.nzDateCellChild=a.first),T(a=A())&&(n.nzDateFullCellChild=a.first),T(a=A())&&(n.nzMonthCellChild=a.first),T(a=A())&&(n.nzMonthFullCellChild=a.first)}},hostAttrs:[1,"ant-picker-calendar"],hostVars:6,hostBindings:function(t,n){t&2&&le("ant-picker-calendar-full",n.nzFullscreen)("ant-picker-calendar-mini",!n.nzFullscreen)("ant-picker-calendar-rtl",n.dir==="rtl")},inputs:{nzMode:"nzMode",nzValue:"nzValue",nzDisabledDate:"nzDisabledDate",nzDateCell:"nzDateCell",nzDateFullCell:"nzDateFullCell",nzMonthCell:"nzMonthCell",nzMonthFullCell:"nzMonthFullCell",nzCustomHeader:"nzCustomHeader",nzFullscreen:[k.HasDecoratorInputTransform,"nzFullscreen","nzFullscreen",J]},outputs:{nzModeChange:"nzModeChange",nzPanelChange:"nzPanelChange",nzSelectChange:"nzSelectChange",nzValueChange:"nzValueChange"},exportAs:["nzCalendar"],standalone:!0,features:[ue([{provide:pe,useExisting:ie(()=>r),multi:!0}]),L,U,q],decls:6,vars:8,consts:[[3,"modeChange","yearChange","monthChange","fullscreen","activeDate","nzCustomHeader","mode"],[1,"ant-picker-panel"],[1,"ant-picker-body"],[3,"prefixCls","value","activeDate","cellRender","fullCellRender","disabledDate"],[3,"valueChange","prefixCls","value","activeDate","cellRender","fullCellRender","disabledDate"],[3,"valueChange","prefixCls","value","activeDate","cellRender","fullCellRender"]],template:function(t,n){t&1&&(h(0,"nz-calendar-header",0),G("modeChange",function(a){return Q(n.nzMode,a)||(n.nzMode=a),a}),f("modeChange",function(a){return n.onModeChange(a)})("yearChange",function(a){return n.onYearSelect(a)})("monthChange",function(a){return n.onMonthSelect(a)}),u(),h(1,"div",1)(2,"div")(3,"div",2),_(4,We,1,6,"date-table",3)(5,Qe,1,5),u()()()),t&2&&(d("fullscreen",n.nzFullscreen)("activeDate",n.activeDate)("nzCustomHeader",n.nzCustomHeader),W("mode",n.nzMode),c(2),ce("ant-picker-",n.nzMode==="month"?"date":"month","-panel"),c(2),x(4,n.nzMode==="month"?4:5))},dependencies:[Ee,Re,be,xe],encapsulation:2,changeDetection:0})}}return r})(),Rt=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=oe({type:r})}static{this.\u0275inj=ae({imports:[Ee,Xe]})}}return r})();export{tt as a,lt as b,Xe as c,Rt as d};
