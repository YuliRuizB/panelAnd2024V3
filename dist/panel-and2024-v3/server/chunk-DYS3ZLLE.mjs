import './polyfills.server.mjs';
import{a as rt,b as Ge}from"./chunk-QEIGSPXD.mjs";import{a as jt,b as Ht,d as Zt}from"./chunk-BRIKIWIB.mjs";import{a as Xt,b as Wt}from"./chunk-6UXAIR6Y.mjs";import{a as Xe,b as $t}from"./chunk-QSTOZ7ZV.mjs";import{a as Ft,c as Nt,h as Gt}from"./chunk-PP4LAUQJ.mjs";import{a as Qt,c as Kt,d as Yt}from"./chunk-EQD3PZGU.mjs";import{a as qt,e as $e}from"./chunk-STMBW6RO.mjs";import{a as B}from"./chunk-D5DKPN6X.mjs";import{A as Ut,B as Lt,C as At,D as Bt,a as Ae,c as ye,d as xe,k as De,n as Be,o as Oe,w as It,x as Rt,y as kt,z as Mt}from"./chunk-7XFQ7WQY.mjs";import{Sc as qe}from"./chunk-U54QTU6P.mjs";import{a as wt,c as Vt,g as Pt,h as Et,j as Tt}from"./chunk-ULKZQOUE.mjs";import{a as Me,f as xt,h as ve}from"./chunk-NRCMYL2Y.mjs";import{a as Ct,b as vt}from"./chunk-G6GCGFEN.mjs";import{a as zt}from"./chunk-U2JW5KLK.mjs";import{a as Ue}from"./chunk-CYSNZOS6.mjs";import{$ as yt,N as he,O as fe,P as ke,Q as _e,Z as bt,_ as St,aa as Le,b as Re,ba as Dt,c as D,e as ne,f as ae,g as _t,h as gt,i as re,ia as be,ja as Se,k as oe,m as le,q as se,v as me,w as ue,x as pe}from"./chunk-KMWCCYID.mjs";import{Vb as ge,Wb as ze,Yb as Ce,ab as K,n as at,pa as ce,u as de,wb as q}from"./chunk-F3VCI4QE.mjs";import{$ as ct,A as dt,Ab as it,Bb as w,Cb as s,Db as v,Eb as b,Fb as T,Fc as ht,G as He,Gb as nt,Ha as Fe,Hb as F,Hc as Ie,Ia as o,Ib as N,Ja as A,Jb as I,L as we,Mb as mt,Nb as ut,Rb as E,Sb as Pe,T as j,Tb as M,Ua as C,V as G,Vb as P,Wa as d,X as Qe,Xa as Ye,ca as Ke,d as Z,da as k,ha as Q,hb as a,ib as r,jb as z,kb as Ze,lb as Je,nb as S,oa as h,pa as f,pd as ft,q as U,qb as g,sb as _,vb as Ve,wc as pt,xc as ie,yb as et,yc as Ne,zb as tt}from"./chunk-WNM5W7LL.mjs";import{a as Ot}from"./chunk-UYFIRDFP.mjs";import{a as O,b as lt,h as st,j as X}from"./chunk-H6KHSOBK.mjs";var J=st(yt()),Ee=st(yt());var yi=["download"],xi=["searchBar"],Di=l=>({open:l}),wi=()=>[];function Vi(l,p){l&1&&z(0,"i",61)}function Pi(l,p){if(l&1){let i=S();a(0,"tr",56),g("click",function(){let e=h(i).$implicit,t=_();return f(t.userSelected(e))}),a(1,"td")(2,"div",57)(3,"div"),z(4,"nz-avatar",58),r(),a(5,"div")(6,"h6",36),C(7,Vi,1,0,"i",59),s(8),r(),Ze(9),a(10,"p",36),s(11),z(12,"nz-badge",60),s(13),z(14,"br"),s(15),r(),Je(),r()()()()}if(l&2){let i=p.$implicit;o(4),d("nzSize",40)("nzSrc",i.photoURL),o(3),d("ngIf",i.disabled),o(),b(" ",i.displayName," "),o(3),b(" ",i.studentId," "),o(),d("nzStatus",i.emailVerified?"success":"error"),o(),b(" ",i.email," "),o(2),b(" ",i.customerName," ")}}function Ei(l,p){l&1&&z(0,"i",73)}function Ti(l,p){if(l&1){let i=S();a(0,"li",74),g("click",function(){h(i);let e=_(2);return f(e.setUserDisabled(!0))}),s(1,"Suspender Usuario "),r()}}function Fi(l,p){if(l&1){let i=S();a(0,"li",74),g("click",function(){h(i);let e=_(2);return f(e.setUserDisabled(!1))}),s(1,"Reactivar Usuario "),r()}}function Ni(l,p){if(l&1&&(a(0,"div",62),Ze(1),a(2,"div",63)(3,"a",64),z(4,"i",65),r(),a(5,"div"),z(6,"nz-avatar",66),r(),a(7,"div",67)(8,"h6",36),C(9,Ei,1,0,"i",68),s(10),r(),a(11,"p",36),z(12,"nz-badge",60),a(13,"span"),s(14),r()()()(),Je(),a(15,"div",36)(16,"a",69),z(17,"i",70),r(),a(18,"nz-dropdown-menu",null,25)(20,"ul",71),C(21,Ti,2,0,"li",72)(22,Fi,2,0,"li",72),r()()()()),l&2){let i=w(19),n=_();o(3),d("routerLink",mt(10,wi)),o(3),d("nzSrc",n.currentUserSelected.photoURL),o(3),d("ngIf",n.currentUserSelected.disabled),o(),b(" ",n.currentUserSelected.displayName," "),o(2),d("nzStatus",n.currentUserSelected.emailVerified?"success":"error"),o(2),b(" ",n.currentUserSelected.email," "),o(2),d("nzDropdownMenu",i)("nzTrigger","click"),o(5),d("ngIf",!n.currentUserSelected.disabled),o(),d("ngIf",n.currentUserSelected.disabled)}}function Ii(l,p){l&1&&(a(0,"nz-tag",106),s(1,"Cortes\xEDa "),r()),l&2&&d("nzColor","yellow")}function Ri(l,p){l&1&&(a(0,"nz-tag",106),s(1,"Pagado "),r()),l&2&&d("nzColor","cyan")}function ki(l,p){l&1&&(a(0,"nz-tag",106),s(1,"Pagado Parcial"),r()),l&2&&d("nzColor","red")}function Mi(l,p){l&1&&(a(0,"nz-tag",106),s(1,"Baja"),r()),l&2&&d("nzColor","magenta")}function Ui(l,p){if(l&1&&(a(0,"nz-tag",106),s(1),r()),l&2){let i=_().$implicit;d("nzColor","blue"),o(),v(i.payment)}}function Li(l,p){l&1&&(a(0,"nz-tag",106),s(1,"Activo"),r()),l&2&&d("nzColor","cyan")}function Ai(l,p){if(l&1&&(a(0,"span"),s(1),E(2,"currency"),r()),l&2){let i=_().$implicit;o(),v(Pe(2,1,i.amountPayment))}}function Bi(l,p){if(l&1){let i=S();a(0,"tr",56),g("click",function(){let e=h(i).$implicit,t=_(3);return f(t.boardingPassSelected(e))}),a(1,"td")(2,"nz-tag",106),s(3),r(),a(4,"span",107),s(5),E(6,"date"),r()(),a(7,"td"),s(8),r(),a(9,"td"),C(10,Ii,2,1,"nz-tag",108)(11,Ri,2,1,"nz-tag",108)(12,ki,2,1,"nz-tag",108)(13,Mi,2,1,"nz-tag",108)(14,Ui,2,2,"nz-tag",108)(15,Li,2,1,"nz-tag",108),r(),a(16,"td"),s(17),E(18,"currency"),r(),a(19,"td"),C(20,Ai,3,3,"span",109),r(),a(21,"td")(22,"a",110),z(23,"i",111),r(),a(24,"nz-dropdown-menu",null,25)(26,"ul",71)(27,"li",74),g("click",function(){let e=h(i).$implicit,t=_(3);return f(t.deletePurchase(e.id))}),s(28,"Eliminar Boleto"),r(),a(29,"li",74),g("click",function(){let e=h(i).$implicit,t=_(3);return f(t.activatePurchase(e.id,!1))}),s(30,"Suspender Boleto"),r(),a(31,"li",74),g("click",function(){let e=h(i).$implicit,t=_(3);return f(t.activatePurchase(e.id,!0))}),s(32,"Activar Boleto"),r(),a(33,"li",74),g("click",function(){let e=h(i).$implicit,t=_(3);return f(t.reassingBoardingPass(e.id,!0))}),s(34,"Reasignar Boleto"),r(),a(35,"li",74),g("click",function(){let e=h(i).$implicit,t=_(3);return f(t.bajaBoardingPass(e.id,!0))}),s(36,"Baja Boleto"),r()()()()()}if(l&2){let i=p.$implicit,n=w(25);o(2),d("nzColor","blue"),o(),v(i.name),o(2),b(" ",M(6,15,i.creation_date,"medium")," "),o(3),nt("",i.routeName," / ",i.stopName," / ",i.round,""),o(2),d("ngIf",i.status==="completed"&&!!i.is_courtesy),o(),d("ngIf",i.status==="completed"&&!i.is_courtesy),o(),d("ngIf",i.status!=="completed"),o(),d("ngIf",i.status!=="completed"&&i.baja===!0),o(),d("ngIf",i.status!=="completed"),o(),d("ngIf",i.active),o(2),b(" ",Pe(18,18,i.amount)," "),o(3),d("ngIf",i.payment=="Anticipo"),o(2),d("nzDropdownMenu",n)}}function Oi(l,p){if(l&1&&(a(0,"nz-table",105,1)(2,"thead")(3,"tr")(4,"th",103),s(5,"Pase"),r(),a(6,"th",103),s(7,"Ruta"),r(),a(8,"th",103),s(9,"Estatus "),r(),a(10,"th",103),s(11,"Precio"),r(),a(12,"th",103),s(13,"Abono"),r()()(),a(14,"tbody"),C(15,Bi,37,20,"tr",44),r()()),l&2){let i=w(1),n=_(2);d("nzData",n.latestPurchases)("nzPageSize",3)("nzLoading",n.loadingLatestPurchases)("nzLoadingDelay",500),o(15),d("ngForOf",i.data)}}function qi(l,p){l&1&&(a(0,"nz-tag",106),s(1,"OpenPay "),r()),l&2&&d("nzColor","blue")}function Gi(l,p){l&1&&(a(0,"nz-tag",106),s(1,"Pago Portal "),r()),l&2&&d("nzColor","blue")}function $i(l,p){if(l&1&&(a(0,"span"),s(1),E(2,"currency"),r()),l&2){let i=_().$implicit;o(),v(Pe(2,1,i.amountPayment))}}function Xi(l,p){if(l&1){let i=S();a(0,"tr")(1,"td")(2,"nz-tag",106),s(3),r(),a(4,"span",107),s(5),E(6,"date"),r()(),a(7,"td"),s(8),r(),a(9,"td"),C(10,qi,2,1,"nz-tag",108)(11,Gi,2,1,"nz-tag",108),a(12,"nz-tag",106),s(13),r()(),a(14,"td"),s(15),E(16,"currency"),r(),a(17,"td"),C(18,$i,3,3,"span",109),r(),a(19,"td")(20,"a",110),z(21,"i",111),r(),a(22,"nz-dropdown-menu",null,25)(24,"ul",71)(25,"li",74),g("click",function(){let e=h(i).$implicit,t=_(3);return f(t.generatePurchasePDF(e))}),s(26,"Generar Pdf"),r()()()()()}if(l&2){let i=p.$implicit,n=w(23);o(2),d("nzColor","blue"),o(),v(i.name),o(2),b(" ",M(6,13,i.creation_date,"medium")," "),o(3),nt("",i.routeName," / ",i.stopName," / ",i.round,""),o(2),d("ngIf",i.isOpenpay==="true"),o(),d("ngIf",i.authorization==="portalAuth"),o(),d("nzColor","green"),o(),b("",i.typePayment," "),o(2),b(" ",Pe(16,16,i.amount)," "),o(3),d("ngIf",i.payment=="Anticipo"),o(2),d("nzDropdownMenu",n)}}function Wi(l,p){if(l&1&&(a(0,"nz-table",105,28)(2,"thead")(3,"tr")(4,"th",103),s(5,"Pase"),r(),a(6,"th",103),s(7,"Ruta"),r(),a(8,"th",103),s(9,"Datos "),r(),a(10,"th",103),s(11,"Precio"),r(),a(12,"th",103),s(13,"Abono"),r()()(),a(14,"tbody"),C(15,Xi,27,18,"tr",104),r()()),l&2){let i=w(1),n=_(2);d("nzData",n.latestPurRequest)("nzPageSize",3)("nzLoading",n.loadinglatestPurRequest)("nzLoadingDelay",500),o(15),d("ngForOf",i.data)}}function ji(l,p){l&1&&(a(0,"nz-tag",106),s(1,"Activa"),r()),l&2&&d("nzColor","cyan")}function Hi(l,p){l&1&&(a(0,"nz-tag",106),s(1,"Inactiva"),r()),l&2&&d("nzColor","yellow")}function Qi(l,p){if(l&1&&(a(0,"span",107),s(1),E(2,"date"),r()),l&2){let i=_().$implicit;o(),b(" ",M(2,1,i.passValidation.lastUsed.toDate(),"medium")," ")}}function Ki(l,p){if(l&1){let i=S();a(0,"tr",56),g("click",function(){let e=h(i).$implicit,t=_(3);return f(t.boardingPassSelected(e))}),a(1,"td"),s(2),E(3,"date"),r(),a(4,"td"),s(5),E(6,"date"),r(),a(7,"td"),C(8,ji,2,1,"nz-tag",108)(9,Hi,2,1,"nz-tag",108),r(),a(10,"td"),C(11,Qi,3,4,"span",112),r(),a(12,"td")(13,"a",110),z(14,"i",111),r(),a(15,"nz-dropdown-menu",null,29)(17,"ul",71)(18,"li",74),g("click",function(){let e=h(i).$implicit,t=_(3);return f(t.deleteCredential(e.id))}),s(19,"Eliminar Credencial"),r(),a(20,"li",74),g("click",function(){let e=h(i).$implicit,t=_(3);return f(t.activateCredential(e.id,!1))}),s(21,"Suspender Credencial"),r(),a(22,"li",74),g("click",function(){let e=h(i).$implicit,t=_(3);return f(t.activateCredential(e.id,!0))}),s(23,"Activar Credencial"),r()()()()()}if(l&2){let i=p.$implicit,n=w(16);o(2),v(M(3,6,i.validFrom.toDate(),"mediumDate")),o(3),v(M(6,9,i.validTo.toDate(),"mediumDate")),o(3),d("ngIf",i.active),o(),d("ngIf",!i.active),o(2),d("ngIf",!!i.passValidation&&i.passValidation.lastUsed),o(2),d("nzDropdownMenu",n)}}function Yi(l,p){if(l&1&&(a(0,"nz-table",105,1)(2,"thead")(3,"tr")(4,"th",103),s(5,"V\xE1lida desde"),r(),a(6,"th",103),s(7,"V\xE1lida hasta"),r(),a(8,"th",103),s(9,"Estado"),r(),a(10,"th",103),s(11,"Ultima Actividad"),r()()(),a(12,"tbody"),C(13,Ki,24,12,"tr",44),r()()),l&2){let i=w(1),n=_(2);d("nzData",n.userCredentials)("nzPageSize",3)("nzLoading",n.loadingUserCredentials)("nzLoadingDelay",500),o(13),d("ngForOf",i.data)}}function Zi(l,p){if(l&1&&(a(0,"tr")(1,"td"),s(2),E(3,"date"),r(),a(4,"td"),s(5),r()()),l&2){let i=p.$implicit;o(2),v(M(3,2,i.createdAt.toDate(),"dd/MM/yyyy")),o(3),v(i.msg)}}function Ji(l,p){if(l&1){let i=S();a(0,"div"),z(1,"nz-divider",113),a(2,"textarea",114),I("ngModelChange",function(e){h(i);let t=_(2);return N(t.newMessage,e)||(t.newMessage=e),f(e)}),r()(),a(3,"button",77),g("click",function(){h(i);let e=_(2);return f(e.showModalMessageCenter())}),z(4,"i",78),s(5,"Enviar Mensaje"),r()}if(l&2){let i=_(2);o(2),F("ngModel",i.newMessage)}}function en(l,p){if(l&1){let i=S();a(0,"nz-tabset",75)(1,"nz-tab",76),g("nzClick",function(){h(i);let e=_();return f(e.nzClicOptionInformacion())}),a(2,"div")(3,"button",77),g("click",function(){h(i);let e=_();return f(e.showModalEditUser(e.currentUserSelected))}),z(4,"i",78),s(5,"Editar Usuario"),r()(),a(6,"div",79)(7,"nz-descriptions",80)(8,"nz-descriptions-item",81)(9,"div",82),s(10),r()(),a(11,"nz-descriptions-item",83),s(12),r(),a(13,"nz-descriptions-item",84),s(14),r(),a(15,"nz-descriptions-item",85),s(16),r(),a(17,"nz-descriptions-item",86),s(18),r(),a(19,"nz-descriptions-item",87),s(20),r(),a(21,"nz-descriptions-item",88),s(22),r(),a(23,"nz-descriptions-item",89),s(24),r(),s(25),a(26,"nz-descriptions-item",90),s(27),r(),a(28,"nz-descriptions-item",91),s(29),r(),a(30,"nz-descriptions-item",92),s(31),r(),a(32,"nz-descriptions-item",93),s(33),r(),a(34,"nz-descriptions-item",94),s(35),r(),a(36,"nz-descriptions-item",95),s(37),r()()()(),a(38,"nz-tab",96)(39,"button",77),g("click",function(){h(i);let e=_();return f(e.showModal())}),z(40,"i",78),s(41,"Nuevo Pase de Abordar"),r(),a(42,"button",97),g("click",function(){h(i);let e=_();return f(e.showModalProduct())}),z(43,"i",78),s(44,"Productos"),r(),C(45,Oi,16,5,"nz-table",98),r(),a(46,"nz-tab",99),C(47,Wi,16,5,"nz-table",98),r(),a(48,"nz-tab",100),g("nzClick",function(){h(i);let e=_();return f(e.nzClicOption())}),a(49,"div")(50,"button",77),g("click",function(){h(i);let e=_();return f(e.showModalCredential())}),z(51,"i",78),s(52,"Nueva credencial"),r()(),C(53,Yi,14,5,"nz-table",98),r(),a(54,"nz-tab",101),g("nzClick",function(){h(i);let e=_();return f(e.nzClicOption())}),a(55,"nz-table",102,26)(57,"thead")(58,"tr")(59,"th",103),s(60,"Fecha"),r(),a(61,"th",103),s(62,"Mensaje"),r()()(),a(63,"tbody"),C(64,Zi,6,5,"tr",104),r()(),C(65,Ji,6,1,"ng-template",null,27,P),r()()}if(l&2){let i=w(56),n=w(66),e=_();o(10),b(" ",e.currentUserSelected.firstName,""),o(2),v(e.currentUserSelected.lastName),o(2),v(e.currentUserSelected.email),o(2),v(e.currentUserSelected.emailVerified),o(2),v(e.currentUserSelected.displayName),o(2),v(e.currentUserSelected.customerName),o(2),b(" ",e.currentUserSelected.defaultRouteName,""),o(2),v(e.currentUserSelected.defaultStopName),o(),b(" ",e.currentUserSelected.turno," "),o(2),b(" ",e.currentUserSelected.turno==="1"?"Sencillo":e.currentUserSelected.turno==="2"?"Redondo":e.currentUserSelected.turno===""?"No definido":""," "),o(2),v(e.currentUserSelected.phoneNumber),o(2),v(e.currentUserSelected.studentId),o(2),v(e.currentUserSelected.userName),o(2),v(e.currentUserSelected.status),o(2),v(e.currentUserSelected.roundTrip),o(8),d("ngIf",e.latestPurchases),o(2),d("ngIf",e.latestPurRequest),o(6),d("ngIf",e.userCredentials),o(2),d("nzData",e.userChatMessageData)("nzPageSize",3)("nzFooter",n)("nzLoadingDelay",500),o(9),d("ngForOf",i.data)}}function tn(l,p){l&1&&s(0," Nuevo pase de abordar ")}function nn(l,p){if(l&1&&(a(0,"nz-option",142),z(1,"i",143),s(2),r()),l&2){let i=_().$implicit;d("nzLabel",i.name)("nzValue",i.productId),o(2),T(" ",i.name," $",i.price," ")}}function an(l,p){if(l&1&&(a(0,"div"),C(1,nn,3,4,"nz-option",141),r()),l&2){let i=p.$implicit;o(),d("ngIf",i.type=="Servicio")}}function rn(l,p){if(l&1&&(a(0,"nz-option",142),z(1,"i",144),s(2),r()),l&2){let i=p.$implicit;d("nzLabel",i.name)("nzValue",i.routeId),o(2),b(" ",i.name,"")}}function on(l,p){if(l&1&&(a(0,"nz-option",142),z(1,"i",145),s(2),z(3,"br"),s(4),r()),l&2){let i=p.$implicit;d("nzLabel",i.name)("nzValue",i.stopPointId),o(2),b(" ",i.name," "),o(2),b(" ",i.description," ")}}function ln(l,p){l&1&&(a(0,"div",129)(1,"nz-form-item")(2,"nz-form-label"),s(3,"Fecha Compromiso "),r(),z(4,"nz-date-picker",146),r()())}function sn(l,p){if(l&1){let i=S();a(0,"nz-form-item")(1,"nz-upload",147),g("nzChange",function(e){h(i);let t=_(2);return f(t.handleChange2(e))}),a(2,"p",148),z(3,"span",149),r(),a(4,"p",150),s(5,"Arrastra el documento a subir"),r(),a(6,"p",151),s(7," Soporte para un solo archivo. Prohibido subir datos corruptos o archivos maliciosos. "),r()()()}l&2&&(o(),d("nzMultiple",!1)("nzLimit",1)("nzSize",50)("nzFileType","image/png,image/jpeg,image/gif,image/bmp"))}function dn(l,p){if(l&1){let i=S();a(0,"form",115),g("ngSubmit",function(){h(i);let e=_();return f(e.submitForm())}),a(1,"nz-form-item")(2,"nz-form-label"),s(3,"Servicio"),r(),a(4,"nz-select",116),g("ngModelChange",function(e){h(i);let t=_();return f(t.onProductSelected(e,t.products))}),C(5,an,2,1,"div",104),r()(),a(6,"nz-form-item")(7,"nz-form-label"),s(8,"Ruta"),r(),a(9,"nz-select",117),g("ngModelChange",function(e){h(i);let t=_();return f(t.onRouteSelected(e,t.routes))}),C(10,rn,3,3,"nz-option",118),r()(),a(11,"nz-form-item")(12,"nz-form-label"),s(13,"Estaciones"),r(),a(14,"nz-select",119),g("ngModelChange",function(e){h(i);let t=_();return f(t.onStopPointSelected(e,t.stopPoints))}),C(15,on,5,4,"nz-option",118),r()(),a(16,"nz-form-item")(17,"nz-form-label"),s(18,"Turno"),r(),a(19,"nz-select",120),z(20,"nz-option",121)(21,"nz-option",122)(22,"nz-option",123),r()(),a(23,"nz-form-item")(24,"nz-form-label"),s(25,"Tipo de Pago"),r(),a(26,"nz-select",124),g("ngModelChange",function(e){h(i);let t=_();return f(t.changePayment(e))}),z(27,"nz-option",125)(28,"nz-option",126)(29,"nz-option",127),r()(),a(30,"nz-form-item")(31,"div",128)(32,"div",129)(33,"nz-form-label"),s(34,"Cantidad a pagar "),r(),a(35,"nz-input-number",130),g("ngModelChange",function(e){h(i);let t=_();return f(t.onAmountChange(e))}),r()(),C(36,ln,5,0,"div",131),r()(),a(37,"div",128)(38,"div",129)(39,"nz-form-item")(40,"nz-form-label"),s(41,"Total a pagar"),r(),a(42,"nz-input-number",132),g("ngModelChange",function(e){h(i);let t=_();return f(t.onAmountChange(e))}),r()()(),a(43,"div",129)(44,"nz-form-item")(45,"nz-form-label"),s(46,"\xBFEs cortes\xEDa?"),r(),a(47,"nz-switch",133),g("ngModelChange",function(e){h(i);let t=_();return f(t.onCourtesyChange(e))}),r()()()(),a(48,"nz-form-item")(49,"nz-form-label"),s(50,"Tipo de Referencia"),r(),a(51,"nz-select",134),g("ngModelChange",function(e){h(i);let t=_();return f(t.changePaymentType(e))}),z(52,"nz-option",135)(53,"nz-option",136)(54,"nz-option",137),r()(),C(55,sn,8,4,"nz-form-item",109),a(56,"nz-form-item")(57,"nz-form-control")(58,"label",138),s(59,"Activar pase"),r()()(),a(60,"div",128)(61,"div",129)(62,"nz-form-item")(63,"nz-form-label"),s(64,"V\xE1lido desde"),r(),z(65,"nz-date-picker",139),r()(),a(66,"div",129)(67,"nz-form-item")(68,"nz-form-label"),s(69,"V\xE1lido hasta"),r(),a(70,"nz-date-picker",140),g("ngModelChange",function(e){h(i);let t=_();return f(t.onChangeValidTo(e))}),r()()()()()}if(l&2){let i=_();d("formGroup",i.validateForm),o(5),d("ngForOf",i.products),o(5),d("ngForOf",i.routes),o(5),d("ngForOf",i.stopPoints),o(20),d("nzMin",50)("nzMax",5e3)("nzStep",1)("nzFormatter",i.formatterDollar)("nzParser",i.parserDollar),o(),d("ngIf",i.isAnticipo),o(6),d("disabled",!1)("nzMin",50)("nzMax",5e3)("nzStep",1)("nzFormatter",i.formatterDollar)("nzParser",i.parserDollar),o(13),d("ngIf",i.ifValidPayment),o(15),d("nzDisabledDate",i.disabledDate)}}function cn(l,p){if(l&1){let i=S();a(0,"button",97),g("click",function(){h(i);let e=_();return f(e.handleCancel())}),s(1,"Cancelar"),r(),a(2,"button",152),g("click",function(){h(i);let e=_();return f(e.submitForm())}),s(3,"Generar Pase de Abordar"),r()}if(l&2){let i=_();o(2),d("nzLoading",i.isConfirmLoading)}}function mn(l,p){l&1&&s(0," Productos ")}function un(l,p){if(l&1&&(a(0,"nz-option",142),z(1,"i",155),s(2),r()),l&2){let i=_().$implicit;d("nzLabel",i.name)("nzValue",i.productId),o(2),T(" ",i.name," $",i.price,"")}}function pn(l,p){if(l&1&&(a(0,"div"),C(1,un,3,4,"nz-option",141),r()),l&2){let i=p.$implicit;o(),d("ngIf",i.type=="Producto")}}function hn(l,p){if(l&1){let i=S();a(0,"form",115),g("ngSubmit",function(){h(i);let e=_();return f(e.submitForm())}),a(1,"nz-form-item")(2,"nz-form-label"),s(3,"Producto"),r(),a(4,"nz-select",116),g("ngModelChange",function(e){h(i);let t=_();return f(t.onProductSelected(e,t.products))}),C(5,pn,2,1,"div",104),r()(),a(6,"div",128)(7,"div",129)(8,"nz-form-item")(9,"nz-form-label"),s(10,"Cantidad a pagar"),r(),a(11,"nz-input-number",153),g("ngModelChange",function(e){h(i);let t=_();return f(t.onAmountChange(e))}),r()()(),a(12,"div",129)(13,"nz-form-item")(14,"nz-form-label"),s(15,"\xBFEs cortes\xEDa?"),r(),a(16,"nz-switch",133),g("ngModelChange",function(e){h(i);let t=_();return f(t.onCourtesyChange(e))}),r()()()(),a(17,"div",128)(18,"div",129)(19,"nz-form-item")(20,"nz-form-label"),s(21,"V\xE1lido desde"),r(),z(22,"nz-date-picker",139),r()(),a(23,"div",129)(24,"nz-form-item")(25,"nz-form-label"),s(26,"V\xE1lido hasta"),r(),z(27,"nz-date-picker",154),r()()()()}if(l&2){let i=_();d("formGroup",i.validateForm),o(5),d("ngForOf",i.products),o(6),d("nzMin",50)("nzMax",5e3)("nzStep",1)("nzFormatter",i.formatterDollar)("nzParser",i.parserDollar)}}function fn(l,p){if(l&1){let i=S();a(0,"button",97),g("click",function(){h(i);let e=_();return f(e.handleCancelProduct())}),s(1,"Cancelar"),r(),a(2,"button",152),g("click",function(){h(i);let e=_();return f(e.submitFormProduct())}),s(3,"Guardar"),r()}if(l&2){let i=_();o(2),d("nzLoading",i.isConfirmLoading)}}function _n(l,p){l&1&&s(0," Editar Usuario ")}function gn(l,p){if(l&1&&(a(0,"nz-option",142),z(1,"i",144),s(2),r()),l&2){let i=p.$implicit;d("nzLabel",i.name)("nzValue",i.uid),o(2),b(" ",i.name,"")}}function zn(l,p){if(l&1&&(a(0,"nz-option",142),z(1,"i",144),s(2),r()),l&2){let i=p.$implicit;d("nzLabel",i.name)("nzValue",i.routeId),o(2),b(" ",i.name,"")}}function Cn(l,p){if(l&1&&(a(0,"nz-option",142),z(1,"i",144),s(2),r()),l&2){let i=p.$implicit;d("nzLabel",i.name)("nzValue",i.id),o(2),b(" ",i.name," ")}}function vn(l,p){if(l&1){let i=S();a(0,"form",115),g("ngSubmit",function(){h(i);let e=_();return f(e.submitForm())}),a(1,"nz-form-item")(2,"nz-form-label",156),s(3,"Nombre"),r(),a(4,"nz-form-control",156),z(5,"input",157),r()(),a(6,"nz-form-item")(7,"nz-form-label",156),s(8,"Apellidos"),r(),a(9,"nz-form-control",156),z(10,"input",158),r()(),a(11,"nz-form-item")(12,"nz-form-label",156),s(13,"Display Name"),r(),a(14,"nz-form-control",156),z(15,"input",159),r()(),a(16,"nz-form-item")(17,"nz-form-label",156),s(18,"Usuario"),r(),a(19,"nz-form-control",156),z(20,"input",160),r()(),a(21,"nz-form-item")(22,"nz-form-label",156),s(23,"Tel\xE9fono"),r(),a(24,"nz-form-control",156),z(25,"input",161),r()(),a(26,"nz-form-item")(27,"nz-form-label",156),s(28,"Matricula"),r(),a(29,"nz-form-control",156),z(30,"input",162),r()(),a(31,"nz-form-item")(32,"nz-form-label",156),s(33,"Email"),r(),a(34,"nz-form-control",156),z(35,"input",163),r()(),a(36,"nz-form-item")(37,"nz-form-label",156),s(38,"Empresa"),r(),a(39,"nz-form-control",156)(40,"nz-select",164),g("ngModelChange",function(e){h(i);let t=_();return f(t.onCustomerSelected(e,t.customers))}),C(41,gn,3,3,"nz-option",118),r()()(),a(42,"nz-form-item")(43,"nz-form-label",156),s(44,"Ruta"),r(),a(45,"nz-form-control",156)(46,"nz-select",165),g("ngModelChange",function(e){h(i);let t=_();return f(t.onRouteEditUserSelected(e,t.userRoutes))}),C(47,zn,3,3,"nz-option",118),r()()(),a(48,"nz-form-item")(49,"nz-form-label",156),s(50,"Estaci\xF3n"),r(),a(51,"nz-form-control",156)(52,"nz-select",166),g("ngModelChange",function(e){h(i);let t=_();return f(t.onStopPointEditUserSelected(e,t.stopPointsList))}),C(53,Cn,3,3,"nz-option",118),r()()(),a(54,"nz-form-item")(55,"nz-form-label",156),s(56,"Turno"),r(),a(57,"nz-select",167),z(58,"nz-option",121)(59,"nz-option",122)(60,"nz-option",123),r()()()}if(l&2){let i=_();d("formGroup",i.validateEditForm),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(3),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(3),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(3),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(3),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(3),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(3),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(3),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(2),d("ngForOf",i.customers),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(2),d("ngForOf",i.userRoutes),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(2),d("ngForOf",i.stopPointsList),o(2),d("nzSm",6)("nzXs",24)}}function bn(l,p){if(l&1){let i=S();a(0,"button",97),g("click",function(){h(i);let e=_();return f(e.handleCancel())}),s(1,"Cancelar"),r(),a(2,"button",97),g("click",function(){h(i);let e=_();return f(e.submitEditForm())}),s(3,"Guardar"),r()}}function Sn(l,p){l&1&&z(0,"nz-badge",216)}function yn(l,p){l&1&&z(0,"nz-badge",217)}function xn(l,p){l&1&&z(0,"nz-badge",218)}function Dn(l,p){l&1&&z(0,"nz-badge",219)}function wn(l,p){l&1&&z(0,"nz-badge",218)}function Vn(l,p){if(l&1){let i=S();a(0,"a",222),g("nzOnConfirm",function(){h(i);let e=_(3);return f(e.onCanUpdatePayment())})("nzOnCancel",function(){h(i);let e=_(3);return f(e.handleCancel())}),a(1,"small"),s(2,"Editar"),r()()}}function Pn(l,p){if(l&1){let i=S();a(0,"nz-input-number",223),g("ngModelChange",function(e){h(i);let t=_(3);return f(t.onPaymentUpdated(e))}),r()}if(l&2){let i=_(3);d("ngModel",i.lastPurchase==null?null:i.lastPurchase.amount)("nzMin",1)("nzMax",1e4)("nzStep",1)("nzFormatter",i.formatterDollar)("nzParser",i.parserDollar)}}function En(l,p){if(l&1&&(a(0,"nz-descriptions-item",171),s(1),C(2,Vn,3,0,"a",220)(3,Pn,1,6,"nz-input-number",221),r()),l&2){let i=_(2);o(),T(" ",i.canUpdatePayment||i.lastPurchase==null?null:i.lastPurchase.currency," ",i.canUpdatePayment||i.lastPurchase==null?null:i.lastPurchase.amountPayment," "),o(),d("ngIf",!i.canUpdatePayment&&(i.lastPurchase==null?null:i.lastPurchase.status)!="completed"&&(i.lastPurchase==null?null:i.lastPurchase.baja)===!1),o(),d("ngIf",i.canUpdatePayment)}}function Tn(l,p){if(l&1&&(a(0,"nz-descriptions-item",171),s(1),r()),l&2){let i=_(2);o(),T(" ",i.canUpdatePayment||i.lastPurchase==null?null:i.lastPurchase.currency," ",i.canUpdatePayment||i.lastPurchase==null?null:i.lastPurchase.amount," ")}}function Fn(l,p){if(l&1&&(a(0,"div")(1,"a",224),s(2,"Ver Comprobante"),r()()),l&2){let i=_().$implicit;o(),Ve("href",i.fileURL,Fe)}}function Nn(l,p){if(l&1&&(a(0,"tr")(1,"td"),s(2),E(3,"date"),r(),a(4,"td"),s(5),r(),a(6,"td"),s(7),r(),a(8,"td"),s(9),r(),a(10,"td"),s(11),r(),a(12,"td"),C(13,Fn,3,1,"div",109),r()()),l&2){let i=p.$implicit;o(2),b(" ",M(3,6,i.creation_date,"medium"),""),o(3),v(i.name),o(2),v(i.payment),o(2),v(i.typePayment),o(2),b(" $ ",i.amountPayment,""),o(2),d("ngIf",i.typePayment=="Transferencia")}}function In(l,p){if(l&1&&z(0,"nz-avatar",225),l&2){let i=_(2);d("nzSrc",i.currentUserSelected.photoURL)}}function Rn(l,p){if(l&1){let i=S();a(0,"div",168)(1,"nz-tabset",75)(2,"nz-tab",169)(3,"div")(4,"nz-descriptions",80)(5,"nz-descriptions-item",170),s(6),r(),a(7,"nz-descriptions-item",171),C(8,Sn,1,0,"nz-badge",172)(9,yn,1,0,"nz-badge",173)(10,xn,1,0,"nz-badge",174),r(),a(11,"nz-descriptions-item",175),C(12,Dn,1,0,"nz-badge",176)(13,wn,1,0,"nz-badge",174),r(),a(14,"nz-descriptions-item",177),s(15),E(16,"date"),r(),a(17,"nz-descriptions-item",178),s(18),r(),a(19,"nz-descriptions-item",179),s(20),E(21,"date"),r(),a(22,"nz-descriptions-item",180),s(23),E(24,"date"),r(),a(25,"nz-descriptions-item",181),z(26,"i",182)(27,"i",183),r(),a(28,"nz-descriptions-item",184),s(29),r(),C(30,En,4,4,"nz-descriptions-item",185)(31,Tn,2,2,"nz-descriptions-item",185),a(32,"nz-descriptions-item",186),s(33),r(),a(34,"nz-descriptions-item",88),s(35),r(),a(36,"nz-descriptions-item",187),s(37),r(),a(38,"nz-descriptions-item",90),s(39),r(),a(40,"nz-descriptions-item",188),s(41),r(),a(42,"nz-descriptions-item",189),s(43),r(),a(44,"nz-descriptions-item",190),s(45),E(46,"date"),r(),a(47,"nz-descriptions-item",191),s(48),r(),a(49,"nz-descriptions-item",192),s(50),r()(),z(51,"br"),r()(),a(52,"nz-tab",193),g("nzClick",function(){h(i);let e=_();return f(e.nzClicOption())}),a(53,"nz-table",194,30)(55,"thead")(56,"tr")(57,"th",103),s(58,"Fecha"),r(),a(59,"th",103),s(60,"Nombre"),r(),a(61,"th",103),s(62,"Tipo de Referencia"),r(),a(63,"th",103),s(64,"Tipo de Pago"),r(),a(65,"th",103),s(66,"Monto"),r(),a(67,"th",103),s(68,"Comprobante"),r()()(),a(69,"tbody"),C(70,Nn,14,9,"tr",104),r()()(),a(71,"nz-tab",195),z(72,"app-shared-usage-history",196),r(),a(73,"nz-tab",197),z(74,"nz-qrcode",198)(75,"a",null,31),s(77),a(78,"button",199),g("click",function(){h(i);let e=_();return f(e.downloadImg())}),s(79,"Descargar"),r()(),a(80,"nz-tab",200)(81,"div",201)(82,"div",202)(83,"div",203)(84,"nz-card",200)(85,"button",97),g("click",function(){h(i);let e=_();return f(e.downloadPdf())}),s(86,"Imprimir"),r()()()(),a(87,"div",204)(88,"div",205)(89,"nz-card",206),z(90,"nz-card-meta",207),a(91,"div")(92,"div")(93,"B",208),s(94,"Credencial And 2024 "),r()(),a(95,"div")(96,"a",208),s(97),r(),s(98," / "),a(99,"a",208),s(100),r()(),a(101,"div",209)(102,"a",208),s(103),r()()(),a(104,"div",210),z(105,"nz-qrcode",198),r()(),C(106,In,1,1,"ng-template",null,32,P),r(),a(108,"div",203)(109,"nz-card",206)(110,"div",211)(111,"div",212)(112,"div",213),z(113,"nz-card",214),r()(),a(114,"div",212)(115,"div",213),z(116,"nz-card",214),r()(),a(117,"div",212)(118,"div",213),z(119,"nz-card",214),r()(),a(120,"div",212)(121,"div",213),z(122,"nz-card",214),r()(),a(123,"div",212)(124,"div",213),z(125,"nz-card",214),r()(),a(126,"div",212)(127,"div",213),z(128,"nz-card",214),r()()(),a(129,"div",211)(130,"a",215),s(131," Derechos reservados Apps And. Esta credencial es intransferible"),r()()()()()()()()()}if(l&2){let i,n=w(54),e=w(107),t=_();o(6),v(t.lastPurchase==null?null:t.lastPurchase.name),o(2),d("ngIf",t.lastPurchase.status=="completed"),o(),d("ngIf",t.lastPurchase.status=="partial"),o(),d("ngIf",t.lastPurchase.status=="in_progress"),o(2),d("ngIf",t.lastPurchase.active),o(),d("ngIf",!t.lastPurchase.active),o(2),b(" ",M(16,51,t.lastPurchase==null?null:t.lastPurchase.operation_date,"medium")," "),o(3),b("",t.lastPurchase!=null&&t.lastPurchase.is_courtesy?"Si":"No"," "),o(2),b(" ",t.lastPurchase!=null&&t.lastPurchase.validFrom?M(21,54,t.lastPurchase==null||t.lastPurchase.validFrom==null?null:t.lastPurchase.validFrom.toDate(),"medium"):"",""),o(3),b(" ",t.canUpdateValidTo?null:M(24,57,t.lastPurchase==null||t.lastPurchase.validTo==null?null:t.lastPurchase.validTo.toDate(),"medium")," "),o(6),T("",t.lastPurchase==null?null:t.lastPurchase.currency," ",t.lastPurchase==null?null:t.lastPurchase.price," "),o(),d("ngIf",(t.lastPurchase==null?null:t.lastPurchase.status)=="partial"),o(),d("ngIf",(t.lastPurchase==null?null:t.lastPurchase.status)!=="partial"),o(2),v(t.lastPurchase==null?null:t.lastPurchase.authorization),o(2),b("",t.lastPurchase==null?null:t.lastPurchase.routeName," "),o(2),T("",t.lastPurchase==null?null:t.lastPurchase.stopName," ",t.lastPurchase==null?null:t.lastPurchase.stopDescription,""),o(2),v(t.lastPurchase==null?null:t.lastPurchase.round),o(2),T(" ",t.lastPurchase==null?null:t.lastPurchase.currency," ",t.lastPurchase==null?null:t.lastPurchase.amountPayment," "),o(2),b(" ",t.lastPurchase==null?null:t.lastPurchase.payment," "),o(2),b(" ",M(46,60,t.lastPurchase==null?null:t.lastPurchase.promiseDate,"mediumDate")," "),o(3),b(" ",t.lastPurchase==null?null:t.lastPurchase.typePayment," "),o(2),b(" ",t.lastPurchase==null?null:t.lastPurchase.description," "),o(3),d("nzData",t.lastestPurchaseDetail)("nzPageSize",3)("nzLoadingDelay",500),o(17),d("ngForOf",n.data),o(2),d("userId",t.currentUserSelected.uid)("boardingPassId",(i=t.lastPurchase.id)!==null&&i!==void 0?i:""),o(5),T(" ",t.currentUserSelected.uid,"-",t.lastPurchase==null?null:t.lastPurchase.idBoardingPass," "),o(5),d("nzGutter",8),o(),d("nzSpan",8),o(4),d("nzGutter",8),o(),d("nzSpan",8),o(),d("nzBordered",!0),o(),Ve("nzTitle",t.currentUserSelected.displayName),d("nzAvatar",e),o(7),b("Ruta: ",t.currentUserSelected.defaultRouteName," "),o(3),b(" Turno :",t.currentUserSelected.defaultRound,""),o(3),b(" Matr\xEDcula: ",t.currentUserSelected.studentId,""),o(5),d("nzSpan",8),o(),d("nzBordered",!0),o(4),d("nzBordered",!0),o(3),d("nzBordered",!0),o(3),d("nzBordered",!0),o(3),d("nzBordered",!0),o(3),d("nzBordered",!0),o(3),d("nzBordered",!0)}}function kn(l,p){l&1&&s(0,` Comprobante de Pago
`)}function Mn(l,p){l&1&&z(0,"div")}function Un(l,p){if(l&1){let i=S();a(0,"button",97),g("click",function(){h(i);let e=_();return f(e.handleCancel())}),s(1,"Cancelar"),r(),a(2,"button",152),g("click",function(){h(i);let e=_();return f(e.submitForm())}),s(3,"Generar PDF"),r()}if(l&2){let i=_();o(2),d("nzLoading",i.isConfirmLoading)}}function Ln(l,p){l&1&&(a(0,"div",79),s(1," Nuevo pase de abordar "),r())}function An(l,p){if(l&1&&(a(0,"nz-option",237),z(1,"i",143),s(2),r()),l&2){let i=_().$implicit;d("nzLabel",i.name)("nzValue",i.productId),o(2),T(" ",i.name," $",i.price,"")}}function Bn(l,p){if(l&1&&(a(0,"div",36),C(1,An,3,4,"nz-option",236),r()),l&2){let i=p.$implicit;o(),d("ngIf",i.type=="Servicio")}}function On(l,p){if(l&1&&(a(0,"nz-option",237),z(1,"i",144),s(2),r()),l&2){let i=p.$implicit;d("nzLabel",i.name)("nzValue",i.routeId),o(2),b(" ",i.name,"")}}function qn(l,p){if(l&1&&(a(0,"nz-option",142),z(1,"i",145),s(2),z(3,"br"),s(4),r()),l&2){let i=p.$implicit;d("nzLabel",i.name)("nzValue",i.stopPointId),o(2),b(" ",i.name," "),o(2),b(" ",i.description,"")}}function Gn(l,p){if(l&1){let i=S();a(0,"div",36)(1,"form",231),g("ngSubmit",function(){h(i);let e=_(2);return f(e.submitForm())}),a(2,"nz-form-item")(3,"nz-form-label"),s(4,"Servicio"),r(),a(5,"nz-select",232),g("ngModelChange",function(e){h(i);let t=_(2);return f(t.onProductSelected(e,t.products))}),C(6,Bn,2,1,"div",233),r()(),a(7,"nz-form-item")(8,"nz-form-label"),s(9,"Ruta"),r(),a(10,"nz-select",234),g("ngModelChange",function(e){h(i);let t=_(2);return f(t.onRouteSelected(e,t.routes))}),C(11,On,3,3,"nz-option",235),r()(),a(12,"nz-form-item")(13,"nz-form-label"),s(14,"Estaci\xF3n"),r(),a(15,"nz-select",119),g("ngModelChange",function(e){h(i);let t=_(2);return f(t.onStopPointSelected(e,t.stopPoints))}),C(16,qn,5,4,"nz-option",118),r()(),a(17,"nz-form-item")(18,"nz-form-label"),s(19,"Turno"),r(),a(20,"nz-select",120),z(21,"nz-option",121)(22,"nz-option",122)(23,"nz-option",123),r()(),a(24,"div",128)(25,"div",129)(26,"nz-form-item")(27,"nz-form-label"),s(28,"Cantidad a pagar"),r(),a(29,"nz-input-number",153),g("ngModelChange",function(e){h(i);let t=_(2);return f(t.onAmountChange(e))}),r()()(),a(30,"div",129)(31,"nz-form-item")(32,"nz-form-label"),s(33,"\xBFEs cortes\xEDa?"),r(),a(34,"nz-switch",133),g("ngModelChange",function(e){h(i);let t=_(2);return f(t.onCourtesyChange(e))}),r()()()(),a(35,"nz-form-item")(36,"nz-form-control")(37,"label",138),s(38,"Activar pase"),r()()(),a(39,"div",128)(40,"div",129)(41,"nz-form-item")(42,"nz-form-label"),s(43,"V\xE1lido desde"),r(),z(44,"nz-date-picker",139),r()(),a(45,"div",129)(46,"nz-form-item")(47,"nz-form-label"),s(48,"V\xE1lido hasta"),r(),z(49,"nz-date-picker",154),r()()()()()}if(l&2){let i=_(2);o(),d("formGroup",i.validateForm),o(5),d("ngForOf",i.products),o(5),d("ngForOf",i.routes),o(5),d("ngForOf",i.stopPoints),o(13),d("nzMin",50)("nzMax",5e3)("nzStep",1)("nzFormatter",i.formatterDollar)("nzParser",i.parserDollar)}}function $n(l,p){if(l&1){let i=S();a(0,"tr")(1,"td",240),I("nzCheckedChange",function(e){let t=h(i).$implicit,u=_(3);return N(u.mapOfCheckedId[t.id],e)||(u.mapOfCheckedId[t.id]=e),f(e)}),g("nzCheckedChange",function(){h(i);let e=_(3);return f(e.refreshStatus())}),r(),a(2,"td"),s(3),r(),a(4,"td"),s(5),r(),a(6,"td"),s(7),r()()}if(l&2){let i=p.$implicit,n=_(3);o(),F("nzChecked",n.mapOfCheckedId[i.id]),o(2),v(i.studentId),o(2),v(i.displayName),o(2),v(i.email)}}function Xn(l,p){if(l&1){let i=S();a(0,"div")(1,"nz-table",238,33),g("nzCurrentPageDataChange",function(e){h(i);let t=_(2);return f(t.currentPageDataChange(e))}),a(3,"thead")(4,"tr")(5,"th",239),I("nzCheckedChange",function(e){h(i);let t=_(2);return N(t.isAllDisplayDataChecked,e)||(t.isAllDisplayDataChecked=e),f(e)}),g("nzCheckedChange",function(e){h(i);let t=_(2);return f(t.checkAllData(e))}),r(),a(6,"th",103),s(7,"Id"),r(),a(8,"th",103),s(9,"Nombre"),r(),a(10,"th",103),s(11,"Email / Tel\xE9fono"),r()()(),a(12,"tbody"),C(13,$n,8,4,"tr",104),r()()()}if(l&2){let i=w(2),n=_(2);o(),d("nzData",n.devicesList)("nzSize","middle"),o(4),d("nzSelections",n.listOfSelection),F("nzChecked",n.isAllDisplayDataChecked),d("nzIndeterminate",n.isIndeterminate),o(8),d("ngForOf",i.data)}}function Wn(l,p){if(l&1){let i=S();a(0,"nz-date-picker",244),g("ngModelChange",function(e){h(i);let t=_(3);return f(t.onValidToUpdated(e))}),r()}if(l&2){let i=_(3);d("ngModel",i.lastPurchase==null?null:i.lastPurchase.due_date)}}function jn(l,p){if(l&1){let i=S();a(0,"a",245),g("nzOnConfirm",function(){h(i);let e=_(3);return f(e.onCanUpdateValidTo())})("nzOnCancel",function(){h(i);let e=_(3);return f(e.handleCancel())}),a(1,"small"),s(2,"Editar"),r()()}}function Hn(l,p){if(l&1){let i=S();a(0,"a",246),g("nzOnConfirm",function(){h(i);let e=_(3);return f(e.onCanUpdatePayment())})("nzOnCancel",function(){h(i);let e=_(3);return f(e.handleCancel())}),a(1,"small"),s(2,"Editar"),r()()}}function Qn(l,p){if(l&1){let i=S();a(0,"nz-input-number",223),g("ngModelChange",function(e){h(i);let t=_(3);return f(t.onPaymentUpdated(e))}),r()}if(l&2){let i=_(3);d("ngModel",i.lastPurchase==null?null:i.lastPurchase.amount)("nzMin",1)("nzMax",12e3)("nzStep",1)("nzFormatter",i.formatterDollar)("nzParser",i.parserDollar)}}function Kn(l,p){if(l&1&&(a(0,"div")(1,"div")(2,"nz-descriptions",80)(3,"nz-descriptions-item",170),s(4),r(),a(5,"nz-descriptions-item",178),s(6),r(),a(7,"nz-descriptions-item",179),s(8),E(9,"date"),r(),a(10,"nz-descriptions-item",180),s(11),E(12,"date"),C(13,Wn,1,1,"nz-date-picker",241)(14,jn,3,0,"a",242),r(),a(15,"nz-descriptions-item",181),z(16,"i",182)(17,"i",183),r(),a(18,"nz-descriptions-item",184),s(19),r(),a(20,"nz-descriptions-item",171),s(21),C(22,Hn,3,0,"a",243)(23,Qn,1,6,"nz-input-number",221),r(),a(24,"nz-descriptions-item",186),s(25),r(),a(26,"nz-descriptions-item",88),s(27),r(),a(28,"nz-descriptions-item",187),s(29),r(),a(30,"nz-descriptions-item",90),s(31),r(),a(32,"nz-descriptions-item",192),s(33),r()(),z(34,"br"),r(),s(35),r()),l&2){let i=_(2);o(4),v(i.validateForm.controls.product_description.value),o(2),b("",i.validateForm.controls.is_courtesy.value?"Si":"No"," "),o(2),b(" ",M(9,19,i.lastPurchase==null||i.lastPurchase.validFrom==null?null:i.lastPurchase.validFrom.toDate(),i.lastPurchase!=null&&i.lastPurchase.validFrom?"medium":"")," "),o(3),b(" ",M(12,22,i.lastPurchase==null||i.lastPurchase.validTo==null?null:i.lastPurchase.validTo.toDate(),i.canUpdateValidTo?"mediumDate":"")," "),o(2),d("ngIf",i.canUpdateValidTo),o(),d("ngIf",!i.canUpdateValidTo&&(i.lastPurchase==null?null:i.lastPurchase.status)!="completed"),o(5),T("",i.lastPurchase==null?null:i.lastPurchase.currency," ",i.lastPurchase==null?null:i.lastPurchase.price," "),o(2),T(" ",i.canUpdatePayment||i.lastPurchase==null?null:i.lastPurchase.currency," ",i.canUpdatePayment||i.lastPurchase==null?null:i.lastPurchase.amount," "),o(),d("ngIf",!i.canUpdatePayment&&(i.lastPurchase==null?null:i.lastPurchase.status)!="completed"),o(),d("ngIf",i.canUpdatePayment),o(2),v(i.lastPurchase==null?null:i.lastPurchase.authorization),o(2),b("",i.lastPurchase==null?null:i.lastPurchase.routeName," "),o(2),T("",i.lastPurchase==null?null:i.lastPurchase.stopName," ",i.lastPurchase==null?null:i.lastPurchase.stopDescription,""),o(2),v(i.lastPurchase==null?null:i.lastPurchase.round),o(2),b(" ",i.lastPurchase==null?null:i.lastPurchase.description," "),o(2),b(" ",i.actualSelectedRows," ")}}function Yn(l,p){if(l&1&&(a(0,"div")(1,"nz-steps",226),z(2,"nz-step",227)(3,"nz-step",228)(4,"nz-step",229),r(),z(5,"br"),a(6,"div"),C(7,Gn,50,9,"div",230)(8,Xn,14,6,"div",109)(9,Kn,36,25,"div",109),r()()),l&2){let i=_();Ye("background-color","#f6f3ea")("color","#4F6F57"),o(),d("nzCurrent",i.current),o(5),Ye("background-color","#f6f3ea")("color","#4F6F57"),o(),d("ngIf",i.current==0),o(),d("ngIf",i.current==1),o(),d("ngIf",i.current==2)}}function Zn(l,p){if(l&1){let i=S();a(0,"button",251),g("click",function(){h(i);let e=_(2);return f(e.pre())}),a(1,"span"),s(2,"Anterior"),r()()}if(l&2){let i=_(2);d("disabled",i.isCreatingBoardingPasses)}}function Jn(l,p){if(l&1){let i=S();a(0,"button",251),g("click",function(){h(i);let e=_(2);return f(e.next())}),a(1,"span"),s(2,"Siguiente"),r()()}if(l&2){let i=_(2);d("disabled",i.isCreatingBoardingPasses)}}function ea(l,p){if(l&1){let i=S();a(0,"button",152),g("click",function(){h(i);let e=_(2);return f(e.createMultipleBoardingPasses())}),a(1,"span"),s(2,"Crear Pases"),r()()}if(l&2){let i=_(2);d("nzLoading",i.isCreatingBoardingPasses)}}function ta(l,p){if(l&1){let i=S();a(0,"button",97),g("click",function(){h(i);let e=_(2);return f(e.done())}),a(1,"span"),s(2,"Terminar"),r()()}}function ia(l,p){if(l&1&&(a(0,"div",247),C(1,Zn,3,1,"button",248)(2,Jn,3,1,"button",248)(3,ea,3,1,"button",249)(4,ta,3,0,"button",250),r()),l&2){let i=_();o(),d("ngIf",i.current>0&&!i.isDone),o(),d("ngIf",i.current<2),o(),d("ngIf",i.current===2&&!i.isDone),o(),d("ngIf",i.current===2&&i.isDone)}}function na(l,p){l&1&&s(0," Liquidaci\xF3n de Pase de abordar ")}function aa(l,p){if(l&1){let i=S();a(0,"nz-form-item")(1,"nz-upload",147),g("nzChange",function(e){h(i);let t=_(2);return f(t.handleChange2(e))}),a(2,"p",148),z(3,"span",149),r(),a(4,"p",150),s(5,"Arrastra el documento a subir"),r(),a(6,"p",151),s(7," Soporte para un solo archivo. Prohibido subir datos corruptos o archivos maliciosos. "),r()()()}l&2&&(o(),d("nzMultiple",!1)("nzLimit",1)("nzSize",50)("nzFileType","image/png,image/jpeg,image/gif,image/bmp"))}function ra(l,p){if(l&1){let i=S();a(0,"form",115),g("ngSubmit",function(){h(i);let e=_();return f(e.createLiquidacion())}),a(1,"nz-form-item")(2,"nz-form-label"),s(3,"Producto Seleccionado"),r(),z(4,"input",252),r(),a(5,"nz-form-item")(6,"nz-form-label"),s(7,"Costo Total del Producto"),r(),z(8,"nz-input-number",253),r(),a(9,"nz-form-item")(10,"nz-form-label"),s(11,"Total abonado"),r(),z(12,"nz-input-number",254),r(),a(13,"nz-form-item")(14,"nz-form-label"),s(15,"Cantidad a liquidar"),r(),z(16,"nz-input-number",255),r(),a(17,"nz-form-item")(18,"label",256),g("ngModelChange",function(){h(i);let e=_();return f(e.bajaCheck())}),a(19,"span"),s(20,"Baja"),r()()(),a(21,"nz-form-item")(22,"div",128)(23,"div",129)(24,"nz-form-item")(25,"nz-form-label"),s(26,"V\xE1lido desde"),r(),z(27,"nz-date-picker",139),r()(),a(28,"div",129)(29,"nz-form-item")(30,"nz-form-label"),s(31,"V\xE1lido hasta"),r(),z(32,"nz-date-picker",154),r()()()(),a(33,"nz-form-item")(34,"nz-form-label"),s(35,"Tipo de Referencia"),r(),a(36,"nz-select",134),g("ngModelChange",function(e){h(i);let t=_();return f(t.changeLiqPaymentType(e))}),z(37,"nz-option",135)(38,"nz-option",136)(39,"nz-option",137),r()(),C(40,aa,8,4,"nz-form-item",109),r()}if(l&2){let i=_();d("formGroup",i.validateLiqForm),o(8),d("disabled",!0),o(4),d("disabled",!0),o(4),d("disabled",!0),o(24),d("ngIf",i.ifValidLiqPayment)}}function oa(l,p){if(l&1){let i=S();a(0,"button",97),g("click",function(){h(i);let e=_();return f(e.createLiquidacion())}),a(1,"span"),s(2,"Submit"),r()(),a(3,"button",97),g("click",function(){h(i);let e=_();return f(e.handleCancel())}),a(4,"span"),s(5,"Cancel"),r()()}}function la(l,p){l&1&&s(0," Nuevas credenciales ")}function sa(l,p){if(l&1){let i=S();a(0,"div")(1,"form",115),g("ngSubmit",function(){h(i);let e=_(2);return f(e.createMultipleCredentials())}),a(2,"div",128)(3,"div",129)(4,"nz-form-item")(5,"nz-form-label"),s(6,"V\xE1lido desde"),r(),z(7,"nz-date-picker",139),r()(),a(8,"div",129)(9,"nz-form-item")(10,"nz-form-label"),s(11,"V\xE1lido hasta"),r(),z(12,"nz-date-picker",154),r()(),a(13,"div",129)(14,"nz-form-item")(15,"nz-form-control")(16,"label",138),s(17,"Activar credencial"),r()()()()()()()}if(l&2){let i=_(2);o(),d("formGroup",i.credentialForm)}}function da(l,p){if(l&1){let i=S();a(0,"tr")(1,"td",240),I("nzCheckedChange",function(e){let t=h(i).$implicit,u=_(3);return N(u.mapOfCredentialsCheckedId[t.uid],e)||(u.mapOfCredentialsCheckedId[t.uid]=e),f(e)}),g("nzCheckedChange",function(){h(i);let e=_(3);return f(e.refreshCredentialsStatus())}),r(),a(2,"td"),s(3),r(),a(4,"td"),s(5),r(),a(6,"td"),s(7),r(),a(8,"td"),s(9),r()()}if(l&2){let i=p.$implicit,n=_(3);o(),F("nzChecked",n.mapOfCredentialsCheckedId[i.uid]),o(2),v(i.customerName),o(2),v(i.studentId),o(2),v(i.displayName),o(2),v(i.email)}}function ca(l,p){if(l&1){let i=S();a(0,"div")(1,"nz-table",238,33),g("nzCurrentPageDataChange",function(e){h(i);let t=_(2);return f(t.currentCredentialsPageDataChange(e))}),a(3,"thead")(4,"tr")(5,"th",239),I("nzCheckedChange",function(e){h(i);let t=_(2);return N(t.isCredentialsAllDisplayDataChecked,e)||(t.isCredentialsAllDisplayDataChecked=e),f(e)}),g("nzCheckedChange",function(e){h(i);let t=_(2);return f(t.checkCredentialsAllData(e))}),r(),a(6,"th",103),s(7,"Empresa"),r(),a(8,"th",103),s(9,"Id"),r(),a(10,"th",103),s(11,"Nombre"),r(),a(12,"th",103),s(13,"Email / Tel\xE9fono"),r()()(),a(14,"tbody"),C(15,da,10,5,"tr",104),r()()()}if(l&2){let i=w(2),n=_(2);o(),d("nzData",n.usersByAccount)("nzSize","middle"),o(4),d("nzSelections",n.listOfCredentialsSelection),F("nzChecked",n.isCredentialsAllDisplayDataChecked),d("nzIndeterminate",n.isCredentialsIndeterminate),o(10),d("ngForOf",i.data)}}function ma(l,p){if(l&1&&(a(0,"div"),s(1),r()),l&2){let i=_(3);o(),b(" Se crear\xE1n ",i.actualSelectedRows," credenciales para los usuarios seleccionados. ")}}function ua(l,p){l&1&&(a(0,"div"),s(1," No has seleccionado ning\xFAn usuario para crear una credencial. "),r())}function pa(l,p){if(l&1&&(a(0,"div"),C(1,ma,2,1,"div",109)(2,ua,2,0,"div",109),r()),l&2){let i=_(2);o(),d("ngIf",i.actualSelectedRows>0),o(),d("ngIf",i.actualSelectedRows===0)}}function ha(l,p){if(l&1&&(a(0,"div")(1,"div"),s(2),r()()),l&2){let i=_(2);o(2),b(" Se crearon ",i.actualSelectedRows,". ")}}function fa(l,p){if(l&1&&(a(0,"nz-steps",226),z(1,"nz-step",257)(2,"nz-step",258)(3,"nz-step",229),r(),z(4,"br"),a(5,"div",259),C(6,sa,18,1,"div",109)(7,ca,16,6,"div",109)(8,pa,3,2,"div",109)(9,ha,3,1,"div",109),r()),l&2){let i=_();d("nzCurrent",i.current),o(6),d("ngIf",i.current==0),o(),d("ngIf",i.current==1),o(),d("ngIf",i.current==2),o(),d("ngIf",i.current==3)}}function _a(l,p){if(l&1){let i=S();a(0,"button",97),g("click",function(){h(i);let e=_(2);return f(e.pre())}),a(1,"span"),s(2,"Anterior"),r()()}}function ga(l,p){if(l&1){let i=S();a(0,"button",251),g("click",function(){h(i);let e=_(2);return f(e.next())}),a(1,"span"),s(2,"Siguiente"),r()()}if(l&2){let i=_(2);d("disabled",i.credentialForm.invalid)}}function za(l,p){if(l&1){let i=S();a(0,"button",261),g("click",function(){h(i);let e=_(2);return f(e.createMultipleCredentials())}),a(1,"span"),s(2,"Crear Credenciales"),r()()}if(l&2){let i=_(2);d("disabled",i.actualSelectedRows===0)("nzLoading",i.isCreatingCredentials)}}function Ca(l,p){if(l&1){let i=S();a(0,"button",97),g("click",function(){h(i);let e=_(2);return f(e.done())}),a(1,"span"),s(2,"Terminar"),r()()}}function va(l,p){if(l&1&&(a(0,"div",247),C(1,_a,3,0,"button",250)(2,ga,3,1,"button",248)(3,za,3,2,"button",260)(4,Ca,3,0,"button",250),r()),l&2){let i=_();o(),d("ngIf",i.current>0&&!i.isDone),o(),d("ngIf",i.current<2),o(),d("ngIf",i.current===2&&!i.isDone),o(),d("ngIf",i.current===3&&i.isDone)}}function ba(l,p){l&1&&s(0," Nueva credencial ")}function Sa(l,p){if(l&1){let i=S();a(0,"div",259)(1,"form",115),g("ngSubmit",function(){h(i);let e=_();return f(e.createCredential())}),a(2,"div",128)(3,"div",129)(4,"nz-form-item")(5,"nz-form-label"),s(6,"V\xE1lido desde"),r(),z(7,"nz-date-picker",139),r()(),a(8,"div",129)(9,"nz-form-item")(10,"nz-form-label"),s(11,"V\xE1lido hasta"),r(),z(12,"nz-date-picker",154),r()(),a(13,"div",129)(14,"nz-form-item")(15,"nz-form-control")(16,"label",138),s(17,"Activar credencial"),r()()()()()()()}if(l&2){let i=_();o(),d("formGroup",i.credentialForm)}}function ya(l,p){if(l&1){let i=S();a(0,"button",261),g("click",function(){h(i);let e=_();return f(e.createCredential())}),a(1,"span"),s(2,"Crear Credencial"),r()()}if(l&2){let i=_();d("disabled",i.credentialForm.invalid)("nzLoading",i.isCreatingCredentials)}}var vr=(()=>{let p=class p{constructor(n,e,t,u,c,m){this.afs=n,this.modalService=e,this.fb=t,this.aff=u,this.bucketStorage=c,this.msg=m,this.authService=k(me),this.userService=k(Ue),this.routesService=k(Le),this.dashboardService=k(Xt),this.productsService=k(Xe),this.customersService=k(St),this.size=40,this.rolService=k(Ae),this.hasBeenFiltered=!1,this.loadedDevicesList=[],this.newMessage="",this.loadingChatMessages=!1,this.current=0,this.isDone=!1,this.isCreatingBoardingPasses=!1,this.isCreatingCredentials=!1,this.listOfSelection=[{text:"Seleccionar todas las p\xE1ginas",onSelect:()=>{this.checkAllData(!0)}},{text:"Deseleccionar todas las p\xE1ginas",onSelect:()=>{this.checkAllData(!1),this.refreshStatus()}}],this.listOfCredentialsSelection=[{text:"Seleccionar todas las p\xE1ginas",onSelect:()=>{this.checkCredentialsAllData(!0)}},{text:"Deseleccionar todas las p\xE1ginas",onSelect:()=>{this.checkCredentialsAllData(!1),this.refreshCredentialsStatus()}}],this.isAllDisplayDataChecked=!1,this.isIndeterminate=!1,this.listOfDisplayData=[],this.mapOfCheckedId={},this.isCredentialsAllDisplayDataChecked=!1,this.isCredentialsIndeterminate=!1,this.listOfCredentialsDisplayData=[],this.listOfCredentialsAllData=[],this.mapOfCredentialsCheckedId={},this.isContentOpen=!1,this.isUserSelected=!1,this.isLoadingUsers=!1,this.loadingLastPurchase=!1,this.isBoardingPassSelected=!1,this.isCredentialSelected=!1,this.isLoadingPayments=!1,this.hasBeenLoaded=!1,this.loadingUserCredentials=!1,this.loadingLatestPurchases=!1,this.loadinglatestPurRequest=!1,this.isVisible=!1,this.isProductVisible=!1,this.isEditUserVisible=!1,this.isModalCredentialVisible=!1,this.isConfirmLoading=!1,this.productSelectedValue="",this.checked=!1,this.routes=[],this.userRoutes=[],this.products=[],this.stopPoints=[],this.stopPointsList=[],this.usersByAccount=[],this.productsReference=[],this.newCustomerIdEditMode="",this.resetClientEditInfo=!1,this.newRouteIdEditeMode="",this.newStepIdEditeMode="",this.accountId$=new Z,this.routeId$=new Z,this.canUpdatePayment=!1,this.canUpdateValidTo=!1,this.elementType="url",this.customersList=[],this.stopSubscription$=new Z,this.isVisibleBulk=!1,this.isLoadingBulk=!1,this.isConfirmLoadingBulk=!1,this.isVisibleBulkCredentials=!1,this.isLoadingBulkCredentials=!1,this.isConfirmLoadingBulkCredentials=!1,this.isConfirmPagoLoading=!1,this.formatterPercent=x=>`${x} %`,this.parserPercent=x=>x.replace(" %",""),this.formatterDollar=x=>`$ ${x}`,this.parserDollar=x=>x.replace("$ ",""),this.selectedUsersForCredentials=[],this.ifValidPayment=!1,this.ifValidLiqPayment=!1,this.isValidDescriptionPaymentType=!1,this.paymentSelected="",this.isAnticipo=!1,this.fileListInfo=[],this.disabledDate=x=>!1,this.fileUrl="http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg",this.autosave=!0,this.uploading=!1,this.bucketPath="dashboard/",this.uploadvalue=0,this.infoLoad=[],this.purchaseActive=!1,this.isVisiblePurchasePay=!1,this.beforeUpload=x=>!1}ngOnInit(){this.accountId$.pipe(j(y=>this.afs.collection("customers").doc(y).collection("routes",V=>V.where("active","==",!0)).valueChanges({idField:"routeId"}))).subscribe(y=>{this.routes=y});let e=this.accountId$.pipe(j(y=>this.afs.collection("customers").doc(y).collection("products",V=>V.where("active","==",!0)).valueChanges({idField:"productId"}))),t=this.accountId$.pipe(j(y=>this.afs.collection("customers").doc(y).collection("products",V=>V.where("active","==",!0)).valueChanges({idField:"productId"}))),u=this.accountId$.pipe(j(y=>this.afs.collection("users",V=>V.where("customerId","==",y).orderBy("studentId")).valueChanges({idField:"uid"}))),c=this.routeId$.pipe(j(y=>this.afs.collection("customers").doc(this.currentSelectedCustomerId).collection("routes").doc(y).collection("stops",V=>V.orderBy("order","asc").where("active","==",!0)).valueChanges({idField:"stopPointId"}))),m=this.accountId$.pipe(j(y=>this.afs.collection("customers",V=>V.where("active","==",!0)).valueChanges({idField:"uid"})));t.subscribe(y=>{this.products=y}),c.subscribe(y=>{this.stopPoints=y}),u.subscribe(y=>{this.usersByAccount=y}),m.subscribe(y=>{this.customers=y}),this.getUsersList(),this.getCustomersList(),this.credentialForm=this.fb.group({active:[!0,[D.required]],validFrom:[new Date,[D.required]],validTo:[new Date,[D.required]]}),this.validateForm=this.fb.group({active:[!0,[D.required]],amount:[0,[D.required]],authorization:[""],category:["",[D.required]],conciliated:[!1,[D.required]],creation_date:[new Date().toISOString(),[D.required]],currency:["MXN",[D.required]],customer_id:["",[D.required]],customerId:[""],date_created:[new Date,[D.required]],due_date:[new Date,[D.required]],description:["",[D.required]],error_message:[""],fee:this.fb.group({amount:[0],currency:["MXN"],tax:[0]}),is_courtesy:[!1],method:["cash",[D.required]],name:["",[D.required]],operation_date:[new Date().toISOString(),[D.required]],operation_type:["in",[D.required]],order_id:[""],payment_method:this.fb.group({barcode_url:[""],reference:[""],type:["cash"]}),price:[0,[D.required]],product_description:["",[D.required]],product_id:["",[D.required]],round:["",[D.required]],routeId:["",[D.required]],routeName:["",[D.required]],status:["completed",[D.required]],stopDescription:["",[D.required]],stopId:["",[D.required]],stopName:["",[D.required]],transaction_type:["charge",[D.required]],validFrom:[new Date,[D.required]],validTo:[new Date,[D.required]],isTaskIn:[!1,[D.required]],isTaskOut:[!1,[D.required]],isOpenpay:[!1,[D.required]],paidApp:["web",[D.required]],realValidTo:[],payment:["",[D.required]],amountPayment:[0,[D.required]],typePayment:[""],promiseDate:[new Date],baja:[""],fileURL:[""]});let x=new Date;this.validateForm.controls.promiseDate.setValue(x),this.validateForm.controls.validTo.setValue(""),this.validateForm.controls.validFrom.setValue(x),this.validateEditForm=this.fb.group({firstName:[""],lastName:[""],displayName:[""],userName:["",[D.required]],studenId:["",[D.required]],email:["",[D.required]],customerName:["",[D.required]],defaultRoute:["",[D.required]],defaultRouteName:[""],defaultRound:[""],routeId:["",[D.required]],customerId:[""],phoneNumber:[""],defaultStopId:[""],defaultStopName:[""]}),this.validateLiqForm=this.fb.group({customerId:[""],amount:[""],productSelected:[""],alreadyPayment:[""],completeAmount:[""],validFrom:[""],validTo:[""],typePayment:[""],fileURL:[""]})}sendMessage(n,e){this.msg.create(n,e)}ngOnDestroy(){this.hasBeenLoaded=!1,this.loadedDevicesList=[],this.users&&this.users.unsubscribe(),this.routesSubscription&&this.routesSubscription.unsubscribe(),this.productsSubscription&&this.productsSubscription.unsubscribe(),this.stopSubscription$.next(void 0),this.stopSubscription$.complete(),this.customerSuscription&&this.customerSuscription.unsubscribe()}showModalCredential(){this.isModalCredentialVisible=!0}onBulkCredentialsSelected(n){this.accountId$.next(n),this.currentSelectedCustomerId=n,this.isVisibleBulkCredentials=!0}createCredential(){if(this.credentialForm.valid){let n=this.credentialForm.controls.validFrom.value||new Date,e=this.credentialForm.controls.validTo.value||new Date,t=this.credentialForm.controls.active.value||!1;this.userlevelAccess!="3"?this.currentUserSelected&&this.currentUserSelected.uid?(this.isCreatingCredentials=!0,this.customersService.createCredential(this.currentUserSelected.uid,this.currentUserSelected.studentId,n,e,t).then(u=>{this.isModalCredentialVisible=!1}),this.isCreatingCredentials=!1,this.isDone=!0):console.error("currentUserSelected or uid is null or undefined"):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}}activateCredential(n,e){this.userlevelAccess!="3"?this.currentUserSelected&&this.currentUserSelected.uid?(this.customersService.activateCredential(this.currentUserSelected.uid,n,e),this.currentUserSelected.paymentId=n):console.error("currentUserSelected or uid is null or undefined"):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}deleteCredential(n){this.userlevelAccess=="1"?this.currentUserSelected&&this.currentUserSelected.uid?(this.customersService.deleteCredential(this.currentUserSelected.uid,n),this.isBoardingPassSelected=!1):console.error("currentUserSelected or uid is null or undefined"):this.sendMessage("error","El usuario no tiene permisos para borrar datos, favor de contactar al administrador.")}getUserCredentials(n){this.loadingUserCredentials=!0,this.customersService.getUserCredentials(n).subscribe(e=>{this.userCredentials=e,this.loadingUserCredentials=!1},e=>{this.userCredentials=null,this.loadingUserCredentials=!1})}currentCredentialsPageDataChange(n){this.listOfCredentialsDisplayData=n,this.refreshCredentialsStatus()}refreshCredentialsStatus(){this.isCredentialsAllDisplayDataChecked=this.usersByAccount.every(n=>this.mapOfCredentialsCheckedId[n.uid]),this.isCredentialsIndeterminate=this.usersByAccount.some(n=>this.mapOfCredentialsCheckedId[n.uid])&&!this.usersByAccount}checkCredentialsAllData(n){this.usersByAccount.forEach(e=>this.mapOfCredentialsCheckedId[e.uid]=n)}checkCredentialsValidBoardingPass(n){this.usersByAccount.forEach(e=>{this.customersService.getLatestValidUserPurchases(e.uid).pipe(He(1),U(t=>t.map(u=>{let c=u.payload.doc.id,m=u.payload.doc.data();return O({id:c},m)})),Qe(t=>{this.mapOfCredentialsCheckedId[e.uid]=t.length>0})).subscribe()})}createMultipleCredentials(){this.current++;let n=this.credentialForm.controls.validFrom.value||new Date,e=this.credentialForm.controls.validTo.value||new Date,t=this.credentialForm.controls.active.value||!1;this.userlevelAccess!="3"?(this.isCreatingCredentials=!0,this.selectedUsersForCredentials.forEach(u=>{this.customersService.createCredential(u.uid,u.studentId,n,e,t).then(c=>{})}),this.isCreatingCredentials=!1,this.isDone=!0):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}showModalProduct(){this.isProductVisible=!0}onProductSelected(n,e){let u=J.filter(e,c=>c.productId==n)[0];this.validateForm.controls.name.setValue(u.name),this.validateForm.controls.description.setValue(u.description),this.validateForm.controls.product_description.setValue(u.description),this.validateForm.controls.amount.setValue(u.price),this.validateForm.controls.is_courtesy.setValue(!1),this.validateForm.controls.price.setValue(u.price),this.validateForm.controls.category.setValue(u.category),this.validateForm.controls.validFrom.setValue(u.validFrom.toDate()),this.validateForm.controls.validTo.setValue(u.validTo.toDate()),this.validateForm.controls.realValidTo.setValue(u.validTo.toDate().toISOString()),this.validateForm.controls.isTaskIn.setValue(u.isTaskIn),this.validateForm.controls.isTaskOut.setValue(u.isTaskOut)}getUsersList(){this.isLoadingUsers=!0,this.usersCollection=this.afs.collection("users",n=>n.orderBy("displayName")),this.users=this.usersCollection.snapshotChanges().pipe(U(n=>n.map(e=>{let t=e.payload.doc.id,u=e.payload.doc.data();return O({id:t},u)}))).subscribe(n=>{this.loadUsers(n)})}setUserDisabled(n){this.userlevelAccess!="3"?this.currentUserSelected&&this.currentUserSelected.uid?(this.customersService.setUserDisabled(this.currentUserSelected.uid,n),this.currentUserSelected.disabled=n):console.error("currentUserSelected or uid is null or undefined"):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}loadUsers(n){this.loadedDevicesList.length<=1&&(this.displayData=n,this.devicesList=n.slice().sort((e,t)=>e.displayName.localeCompare(t.displayName)),this.loadedDevicesList=this.devicesList)}userSelected(n){this.currentUserSelected=n,this.currentSelectedCustomerId=this.currentUserSelected.customerId,this.accountId$.next(this.currentUserSelected.customerId),this.isUserSelected=!0,this.isBoardingPassSelected=!1,this.getLatestPurchases(n.uid),this.getLastestPurchaseRequest(n.uid),this.getUserCredentials(n.uid),this.getUserChatMessages(n.uid),this.lastPurchase=void 0,this.productsReference=null}copyDataToUserCollection(){this.userlevelAccess!="3"?this.currentUserSelected&&this.currentUserSelected.uid?this.customersService.saveOldBoardingPassToUserCollection(this.currentUserSelected.paymentId):console.error("currentUserSelected or uid is null or undefined"):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}getUserChatMessages(n){this.loadingChatMessages=!0,this.dashboardService.getUserChatMessages(n,10).subscribe(e=>{this.userChatMessageData=e})}onBulkBoardingPassSelected(n){this.accountId$.next(n),this.currentSelectedCustomerId=n,this.isVisibleBulk=!0}onCourtesyChange(n){n&&this.validateForm.controls.amount.setValue(0)}onAmountChange(n){n>0&&this.validateForm.controls.is_courtesy.setValue(!1)}onCanUpdatePayment(){if(this.canUpdatePayment=!0,this.lastPurchase!==void 0){var n=Number(this.lastPurchase.amountPayment),e=Number(this.lastPurchase.amount);this.validateLiqForm.controls.productSelected.setValue(this.lastPurchase.name),this.validateLiqForm.controls.alreadyPayment.setValue(n),this.validateLiqForm.controls.amount.setValue(e),this.validateLiqForm.controls.completeAmount.setValue(e-n),this.validateLiqForm.controls.validFrom.setValue(this.lastPurchase.validFrom.toDate()),this.productSelectedValue=this.lastPurchase.name}else console.error("lastPurchase is undefined")}createLiquidacion(){let n=this.validateLiqForm.controls.validTo.value||new Date,e=this.validateLiqForm.controls.typePayment.value;if(this.lastPurchase!==void 0){let c=this.lastPurchase?String(this.lastPurchase.id):void 0;if(n=="")this.msg.error("Se requiere  seleccionar una fecha de terminaci\xF3n de pase de abordar.");else if(e=="")this.msg.error("Se requiere  seleccionar un tipo de referencia.");else if(this.currentUserSelected&&this.currentUserSelected.uid){var t,u=this.validateLiqForm.controls.fileURL.value||"";let m={authorization:"portalAuth",operation_type:"in",method:this.validateLiqForm.controls.payment.value,transaction_type:"charge",card:{type:"",brand:"",address:"",card_number:"",holder_name:"",expiration_year:"",expiration_month:"",allows_charges:"",allows_payouts:"",bank_name:"",bank_code:"",points_card:"",points_type:""},status:"completed",conciliated:!1,creation_date:new Date().toISOString(),operation_date:new Date().toISOString(),description:"Liquidaci\xF3n a traves del portal",error_message:"",order_id:"portalOrder",currency:"MXN",amount:this.validateLiqForm.controls.amountPayment.value,customer:{name:this.currentUserSelected.firstName,last_name:this.currentUserSelected.lastName,email:this.currentUserSelected.email,phone_number:this.currentUserSelected.phoneNumber,address:"",creation_date:"",external_id:"",clabe:""},customerId:this.currentUserSelected.customerId,active:!0,category:"permanente",date_created:new Date().toISOString(),product_description:"Liquidaci\xF3n a traves del portal",product_id:this.validateLiqForm.controls.product_id.value,name:this.validateLiqForm.controls.name.value,isTaskIn:"false",isTaskOut:"false",type:"Servicio",isOpenpay:!1,paidApp:"portal",price:this.lastPurchase.price,round:this.validateLiqForm.controls.round.value,routeId:this.validateLiqForm.controls.routeId.value,routeName:this.validateLiqForm.controls.routeName.value,stopDescription:"",stopId:this.validateLiqForm.controls.stopId.value,stopName:this.validateLiqForm.controls.stopDescription.value,validFrom:this.validateLiqForm.controls.validFrom.value,validTo:n,idBoardingPass:this.currentUserSelected.uid,idPurchasteRequest:"",is_courtesy:!1,typePayment:e};t={active:!0,amountPayment:this.validateLiqForm.controls.completeAmount.value,payment:"Liquidacion",status:this.validateForm.controls.status.value,customer_id:this.currentUserSelected.customerId,creation_date:this.validateForm.controls.creation_date.value,name:this.lastPurchase.name,price:this.lastPurchase.price,operation_date:this.validateForm.controls.operation_date.value,routeId:this.lastPurchase.routeId,routeName:this.lastPurchase.routeName,round:this.lastPurchase.round,stopName:this.validateForm.controls.stopDescription.value,stopId:this.validateForm.controls.stopId.value,typePayment:e,validFrom:this.validateForm.controls.validFrom.value,idBoardingPass:this.currentUserSelected.uid,idPurchasteRequest:"",baja:!1,validTo:n,type:"Servicio",fileURL:u},this.userlevelAccess!="3"?c!==void 0?this.customersService.saveBoardingPassDetailToUserPurchaseCollection(this.currentUserSelected.uid,c,m).then(x=>{if(this.msg.success("El registro se hizo con exito"),this.lastPurchase&&this.lastPurchase.realValidTo!==void 0){let y=new Date(this.lastPurchase.realValidTo);this.lastPurchase.validTo=at.fromDate(y),this.lastPurchase.status="completed",this.lastPurchase.active=!0,this.lastPurchase.typePayment=this.validateLiqForm.controls.typePayment.value,this.lastPurchase.status="completed",this.lastPurchase.price=this.validateLiqForm.controls.amount.value,this.lastPurchase.amountPayment=this.validateLiqForm.controls.amount.value,this.lastPurchase.payment="Liquidacion";let V=this.currentUserSelected.status;V=="preRegister"&&this.userService.updateUserPreRegister(this.currentUserSelected.uid,V),this.customersService.createPurchaseCloud(m,this.currentUserSelected,c),this.customersService.updateBoardingPassToUserPurchaseCollection(this.currentUserSelected.uid,this.lastPurchase).then(L=>{this.msg.success("Se actualizo el pase de abordar"),this.canUpdatePayment=!1}).catch(L=>{this.isConfirmLoading=!1}),console.log("333")}}).catch(x=>{console.log("error")}):console.error("lastPurchase id is undefined"):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}else console.error("currentUserSelected or uid is null or undefined")}else console.error("lastPurchase is undefined")}onPaymentUpdated(n){if(this.lastPurchase!==void 0){if(+this.lastPurchase.price===n){if(this.lastPurchase.status="completed",this.lastPurchase.amount=n,this.lastPurchase.active=!0,this.lastPurchase?.realValidTo!==void 0){let e=new Date(this.lastPurchase.realValidTo);this.lastPurchase.validTo=at.fromDate(e)}}else this.lastPurchase.amount=n;this.userlevelAccess!="3"?this.currentUserSelected&&this.currentUserSelected.uid?(this.customersService.updateBoardingPassToUserPurchaseCollection(this.currentUserSelected.uid,this.lastPurchase).then(e=>{this.isVisible=!1,this.isConfirmLoading=!1}).catch(e=>{this.isConfirmLoading=!1}),this.canUpdatePayment=!1):console.error("currentUserSelected or uid is null or undefined"):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}}getLastPurchase(n){this.loadingLastPurchase=!0,this.lastPurchase=void 0,this.customersService.getLastPurchase(n).valueChanges().subscribe(e=>{this.lastPurchase=e,this.productsReference=e,this.loadingLastPurchase=!1},e=>{this.loadingLastPurchase=!1,this.lastPurchase=void 0,this.productsReference=null})}activatePurchase(n,e){this.currentUserSelected&&this.currentUserSelected.uid?(this.customersService.activatePurchase(this.currentUserSelected.uid,n,e),this.currentUserSelected.paymentId=n):console.error("currentUserSelected or uid is null or undefined")}deletePurchase(n){this.currentUserSelected&&this.currentUserSelected.uid?(this.customersService.deletePurchase(this.currentUserSelected.uid,n),this.isBoardingPassSelected=!1,this.userService.updateUserPreRegister(this.currentUserSelected.uid,this.currentUserSelected.status)):console.error("currentUserSelected or uid is null or undefined")}getLatestPurchases(n){this.loadingLatestPurchases=!0,this.customersService.getLatestUserPurchases(n,10).pipe(U(e=>e.map(t=>{let u=t.payload.doc.id,c=t.payload.doc.data();return O({id:u},c)}))).subscribe(e=>{this.latestPurchases=e,this.loadingLatestPurchases=!1},e=>{this.latestPurchases=null,this.loadingLatestPurchases=!1})}getLastestPurchaseRequest(n){this.loadinglatestPurRequest=!0,this.customersService.getLatestUserPurchasesRequest(n,10).pipe(U(e=>e.map(t=>{let u=t.payload.doc.id,c=t.payload.doc.data();return O({id:u},c)}))).subscribe(e=>{this.latestPurRequest=e,this.loadinglatestPurRequest=!1},e=>{this.latestPurRequest=null,this.loadinglatestPurRequest=!1})}getLatestPurchaseDetail(n,e){this.customersService.getLatestUserPurchaseDetail(n,10,e).pipe(U(t=>t.map(u=>{let c=u.payload.doc.id,m=u.payload.doc.data();return O({id:c},m)}))).subscribe(t=>{this.lastestPurchaseDetail=t},t=>{this.lastestPurchaseDetail=null})}reassingBoardingPass(n,e){if(this.userlevelAccess!="3")if(this.currentUserSelected&&this.currentUserSelected.uid){if(this.lastPurchase!==void 0){let t=this.lastPurchase.id,u=this.currentUserSelected.uid;this.afs.collection("users").doc(this.currentUserSelected.id).collection("boardingPasses").doc(this.lastPurchase.id).set(this.lastPurchase).then(m=>{this.afs.collection("users").doc(u).collection("boardingPasses").doc(t).delete()})}}else console.error("currentUserSelected or uid is null or undefined");else this.sendMessage("error","El usuario no tiene permisos para borrar datos, favor de contactar al administrador.")}bajaBoardingPass(n,e){if(this.currentUserSelected&&this.currentUserSelected.uid){let t=this.afs.collection("users").doc(this.currentUserSelected.id).collection("boardingPasses").doc(n),u={baja:!0};t.update(u).then(c=>{}).catch(c=>{this.sendMessage("error: ",c)})}else console.error("currentUserSelected or uid is null or undefined")}boardingPassSelected(n){this.currentUserSelected&&(this.isBoardingPassSelected=!0,this.lastPurchase=n,this.productsReference=n)}createMultipleBoardingPasses(){this.isCreatingBoardingPasses=!0,setTimeout(()=>{this.isCreatingBoardingPasses=!1,this.isDone=!0},2e3)}showModal(){this.isVisible=!0}showModalEditUser(n){this.isEditUserVisible=!0,this.validateEditForm.controls.firstName.setValue(n.firstName),this.validateEditForm.controls.lastName.setValue(n.lastName),this.validateEditForm.controls.displayName.setValue(n.displayName),this.validateEditForm.controls.userName.setValue(n.userName),this.validateEditForm.controls.studenId.setValue(n.studentId),this.validateEditForm.controls.email.setValue(n.email),this.validateEditForm.controls.customerId.setValue(n.customerId),this.validateEditForm.controls.customerName.setValue(n.customerName),this.validateEditForm.controls.phoneNumber.setValue(n.phoneNumber),this.validateEditForm.controls.defaultRound.setValue(n.defaultRound),this.fillCustomerRouteEditUser(n.customerId),this.fillStopsEditUser(n.customerId,n.defaultRoute),this.validateEditForm.controls.routeId.setValue(n.defaultRoute),this.validateEditForm.controls.defaultRoute.setValue(n.defaultRoute),this.validateEditForm.controls.defaultRouteName.setValue(n.defaultRouteName),this.validateEditForm.controls.defaultStopId.setValue(n.defaultStopId),this.validateEditForm.controls.defaultStopName.setValue(n.defaultStopName)}fillCustomerRouteEditUser(n){this.routesService.getRoutes(n).pipe(G(this.stopSubscription$),U(e=>e.map(t=>{let u=t.payload.doc.id,c=t.payload.doc.data();return O({id:u},c)}))).subscribe(e=>{this.userRoutes=e})}fillStopsEditUser(n,e){this.routesService.getRouteStopPoints(n,e).pipe(G(this.stopSubscription$),U(t=>t.map(u=>{let c=u.payload.doc.id,m=u.payload.doc.data();return lt(O({},m),{id:c})}))).subscribe(t=>{this.stopPointsList=t})}showModalMessageCenter(){return X(this,null,function*(){if(this.currentUserSelected&&this.currentUserSelected.uid){let n={createdAt:new Date,from:"FyXKSXsUbYNtAbWL7zZ66o2f1M92",fromName:"Apps And Informa",msg:this.newMessage,requestId:"suhB7YFAh6PYXCRuJhfD",token:this.currentUserSelected.token,uid:this.currentUserSelected.uid,result:""},e={timestamp:new Date,title:"Apps And Informa General",from:"FyXKSXsUbYNtAbWL7zZ66o2f1M92",requestId:"suhB7YFAh6PYXCRuJhfD",body:this.newMessage,token:this.currentUserSelected.token,uid:this.currentUserSelected.uid};this.dashboardService.setMessage(e,this.currentUserSelected.uid),this.dashboardService.setChatMessage(n).then(()=>{this.newMessage=""})}else console.error("currentUserSelected or uid is null or undefined")})}onRouteEditUserSelected(n,e){if(n!=null&&n!=""){let u=J.filter(e,c=>c.routeId==n)[0];if(this.currentUserSelected&&this.currentUserSelected.uid){this.validateEditForm.controls.defaultRouteName.setValue(u.name);let c=this.currentUserSelected.customerId,m=this.currentUserSelected.defaultRoute;c!=this.newCustomerIdEditMode&&m!=u.routeId?(this.newRouteIdEditeMode=u.routeId,this.fillStopsEditUser(this.newCustomerIdEditMode,u.routeId)):this.newRouteIdEditeMode=m}else console.error("currentUserSelected or uid is null or undefined")}}onRouteSelected(n,e){this.routeId$.next(n);let u=J.filter(e,c=>c.routeId==n)[0];this.validateForm.controls.routeName.setValue(u.name)}onStopPointEditUserSelected(n,e){if(n!=null&&n!=""){let u=J.filter(e,c=>c.id==n)[0];this.validateEditForm.controls.defaultStopName.setValue(u.name),this.newCustomerIdEditMode!=""&&(this.resetClientEditInfo=!0)}}onStopPointSelected(n,e){let u=J.filter(e,c=>c.stopPointId==n)[0];this.validateForm.controls.stopName.setValue(u.name),this.validateForm.controls.stopDescription.setValue(u.description)}onCustomerSelected(n,e){if(this.resetClientEditInfo=!1,n!=null){let u=J.filter(e,c=>c.uid==n)[0];this.currentUserSelected&&this.currentUserSelected.uid?(this.validateEditForm.controls.customerName.setValue(u.name),this.currentUserSelected.customerId!=u.uid?(this.newCustomerIdEditMode=u.uid,this.fillCustomerRouteEditUser(u.uid)):this.newCustomerIdEditMode=""):console.error("currentUserSelected or uid is null or undefined")}}onCanUpdateValidTo(){this.canUpdateValidTo=!0}onValidToUpdated(n){this.canUpdateValidTo=!1}handleOk(){this.isConfirmLoading=!0,setTimeout(()=>{this.isVisible=!1,this.isConfirmLoading=!1},3e3)}handleCancel(){this.isVisible=!1,this.isVisibleBulk=!1,this.isVisibleBulkCredentials=!1,this.isModalCredentialVisible=!1,this.isEditUserVisible=!1,this.isVisiblePurchasePay=!1,this.canUpdatePayment=!1}handleCancelProduct(){this.isProductVisible=!1}refreshList(){this.hasBeenLoaded=!1,this.getUsersList()}getItems(n){this.initializeItems();let e=n;if(!e)return;let t=(0,Ee.toLower)(e);this.devicesList=dt(this.devicesList,u=>(0,Ee.some)(u,c=>(0,Ee.toLower)(c).includes(t)))}initializeItems(){this.devicesList=this.loadedDevicesList}showDeleteConfirm(){if(this.currentUserSelected&&this.currentUserSelected.uid){let n=this.currentUserSelected.uid;this.modalService.confirm({nzTitle:"\xBFEst\xE1 seguro de eliminar esta cuenta?",nzContent:'<b style="color: red;">Toda la informaci\xF3n relacionada a esta cuenta ser\xE1 eliminada permanentemente.</b>',nzOkText:"Eliminar",nzOnOk:()=>{this.customersService.deleteUser(n),this.currentUserSelected={uid:"",studentId:"",emailVerified:"",paymentId:"",turno:"",roundTrip:"",disabled:null,customerId:"",firstName:"",lastName:"",email:"",photoURL:"",phoneNumber:"",status:"",id:"",token:"",defaultRoute:"",displayName:"",userName:"",customerName:"",defaultRound:"",defaultRouteName:"",defaultStopName:"",defaultStopId:""},this.isUserSelected=!1},nzCancelText:"No",nzOnCancel:()=>console.log("Cancel")})}else console.error("currentUserSelected or uid is null or undefined")}getCustomersList(){this.afs.collection("customers",e=>e.orderBy("name")).snapshotChanges().pipe(G(this.stopSubscription$),U(e=>e.map(t=>{let u=t.payload.doc.id,c=t.payload.doc.data();return O({id:u},c)})),Qe(e=>(this.customersList=e,e))).subscribe()}currentPageDataChange(n){this.listOfDisplayData=n,this.refreshStatus()}refreshStatus(){this.isAllDisplayDataChecked=this.devicesList.every(n=>this.mapOfCheckedId[n.id]),this.isIndeterminate=this.devicesList.some(n=>this.mapOfCheckedId[n.id])&&!this.devicesList}checkAllData(n){this.devicesList.forEach(e=>this.mapOfCheckedId[e.id]=n)}submitForm(){if(this.validateSubmit()){var e,t;if(this.currentUserSelected&&this.currentUserSelected.uid){let x=this.currentUserSelected.uid;this.validateForm.controls.customer_id.setValue(this.currentUserSelected.customerId),this.validateForm.controls.customerId.setValue(this.currentUserSelected.customerId);let y=this.validateForm.controls.amount.value,V=this.validateForm.controls.payment.value;V=="Anticipo"&&(y=this.validateForm.controls.amountPayment.value);let L=this.validateForm.controls.price.value,W=this.validateForm.controls.validTo.value||new Date,Y=this.validateForm.controls.is_courtesy.value||!1;this.validateForm.controls.due_date.setValue(W.toISOString()),y!=L&&!Y&&this.validateForm.controls.status.setValue("partial");var u=this.validateForm.controls.promiseDate.value||"",c=this.validateForm.controls.creation_date.value.toString();let ee=this.validateForm.controls.typePayment.value;V=="Mensualidad"&&(u=this.validateForm.controls.validTo.value||new Date);for(let $ in this.validateForm.controls)this.validateForm.controls[$].markAsDirty(),this.validateForm.controls[$].updateValueAndValidity();if(this.validateForm.valid){this.isConfirmLoading=!0;var m=this.validateForm.controls.fileURL.value||"";let $={authorization:"portalAuth",operation_type:"in",method:this.validateForm.controls.payment.value,transaction_type:"charge",card:{type:"",brand:"",address:"",card_number:"",holder_name:"",expiration_year:"",expiration_month:"",allows_charges:"",allows_payouts:"",bank_name:"",bank_code:"",points_card:"",points_type:""},status:this.validateForm.controls.status.value,conciliated:!1,creation_date:c,operation_date:new Date().toISOString(),description:"Pago a traves de portal",error_message:"",order_id:"portalOrder",currency:"MXN",amount:this.validateForm.controls.amountPayment.value,customer:{name:this.currentUserSelected.firstName,last_name:this.currentUserSelected.lastName,email:this.currentUserSelected.email,phone_number:this.currentUserSelected.phoneNumber,address:"",creation_date:"",external_id:"",clabe:""},customerId:this.currentUserSelected.customerId,active:!0,category:"permanente",date_created:new Date().toISOString(),product_description:"Pago a traves de portal",product_id:this.validateForm.controls.product_id.value,name:this.validateForm.controls.name.value,isTaskIn:"false",isTaskOut:"false",type:"Servicio",isOpenpay:!1,paidApp:"portal",price:L,round:this.validateForm.controls.round.value,routeId:this.validateForm.controls.routeId.value,routeName:this.validateForm.controls.routeName.value,stopDescription:"",stopId:this.validateForm.controls.stopId.value,stopName:this.validateForm.controls.stopDescription.value,validFrom:this.validateForm.controls.validFrom.value,validTo:W,idBoardingPass:this.currentUserSelected.uid,idPurchasteRequest:"",is_courtesy:!1,typePayment:V};this.userlevelAccess!="3"?(e={active:!0,amountPayment:y,payment:V,status:this.validateForm.controls.status.value,customer_id:this.currentUserSelected.customerId,customerId:this.currentUserSelected.customerId,creation_date:c,name:this.validateForm.controls.name.value,price:L,operation_date:this.validateForm.controls.operation_date.value,routeId:this.validateForm.controls.routeId.value,routeName:this.validateForm.controls.routeName.value,round:this.validateForm.controls.round.value,stopName:this.validateForm.controls.stopDescription.value,stopId:this.validateForm.controls.stopId.value,typePayment:ee,validFrom:this.validateForm.controls.validFrom.value,validTo:W,idBoardingPass:this.currentUserSelected.uid,idPurchaseRequest:"",baja:!1,type:"Servicio",fileURL:m},this.customersService.saveBoardingPassToUserPurchaseCollection(this.currentUserSelected.uid,$).then(te=>{this.isVisible=!1,this.isConfirmLoading=!1,this.customersService.getLatestValidUserPurchasesAdvance(x,2,u,V,c).pipe(He(1),U(R=>R.map(H=>{let Te=H.payload.doc.data(),je=H.payload.doc.id;return O({id:je},Te)}))).subscribe(R=>{this.customersService.saveBoardingPassDetailToUserPurchaseCollection(x,R[0].id,$).then(H=>{this.sendUser=$,console.log(R[0].id),this.idBoardingPass=R[0].id,this.purchaseActive=!0,this.customersService.createPurchaseCloud(this.sendUser,this.currentUserSelected,this.idBoardingPass),console.log("salio")}).catch(H=>{console.log("error")})},R=>{console.log(R)})}).catch(te=>{this.isConfirmLoading=!1})):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}}else console.error("currentUserSelected or uid is null or undefined")}}submitReceipt(){}createPurchaseRequest(n,e){return X(this,null,function*(){let t=this.afs.createId(),u=this.afs.collection("users").doc(n).collection("purchaseRequests").doc(t).set(e).then(()=>(console.log("Purchase Request  successfully written!"),t)).catch(c=>(console.error("Error writing document: ",c),""))})}validateSubmit(){if(this.validateForm.controls.product_id.value=="")return this.msg.error("Es necesario seleccionar un producto, favor de validar."),!1;if(this.validateForm.controls.round.value=="")return this.msg.error("Es necesario seleccionar un turno, favor de validar."),!1;let t=this.validateForm.controls.payment.value;if(t=="")return this.msg.error("Es necesario seleccionar un Tipo de Pago, favor de validar."),!1;let u=this.validateForm.controls.promiseDate.value,c=this.validateForm.controls.validTo.value,m=this.validateForm.controls.validFrom.value;if(t=="Anticipo"&&u=="")return this.msg.error("Al seleccionar anticipo es necesario proporcionar una fecha compromiso, favor de validar."),!1;let x=this.validateForm.controls.amountPayment.value,y=this.validateForm.controls.amount.value;if(x=="0")return this.msg.error("Es necesario porporcionar una cantidad a pagar, favor de validar."),!1;if(y<x)return this.msg.error("La cantidad a pagar es mayor al total a pagar, favor de validar."),!1;if(t=="Mensualidad"&&y!=x)return this.msg.error("La cantidad a pagar debe ser igual al total a pagar ya se que selecciono el tipo de pago Mensualidad, favor de validar."),!1;let V=this.validateForm.controls.typePayment.value;return V==""?(this.msg.error("Es necesario seleccionar un tipo de Referencia, favor de validar."),!1):V=="Sistema"&&t=="Anticipo"?(this.msg.error("No puedes seleccionar el tipo de referencia Sistema,si estas generando un anticipo, favor de validar."),!1):V=="Transferencia"&&this.fileListInfo.name==null?(this.msg.error("Es necesario tener un comprobante anexado al pago, favor de agregar uno."),!1):!0}calculateDiff(n,e){let t=new Date(n),u=new Date(e);return Math.floor((u.getTime()-t.getTime())/1e3/60/60/24)}submitEditForm(){if(this.currentUserSelected&&this.currentUserSelected.uid){let n=this.validateEditForm.controls.customerId.value==null?"":this.validateEditForm.controls.customerId.value,e=this.validateEditForm.controls.customerName.value==null?"":this.validateEditForm.controls.customerName.value,t=this.validateEditForm.controls.defaultRound.value==null?"":this.validateEditForm.controls.defaultRound.value,u=this.validateEditForm.controls.defaultRoute.value==null?"":this.validateEditForm.controls.defaultRoute.value,c=this.validateEditForm.controls.defaultRouteName.value==null?"":this.validateEditForm.controls.defaultRouteName.value,m=this.validateEditForm.controls.displayName.value==null?"":this.validateEditForm.controls.displayName.value,x=this.validateEditForm.controls.email.value==null?"":this.validateEditForm.controls.email.value,y=this.validateEditForm.controls.firstName.value==null?"":this.validateEditForm.controls.firstName.value,V=this.validateEditForm.controls.lastName.value==null?"":this.validateEditForm.controls.lastName.value,L=this.validateEditForm.controls.phoneNumber.value==null?"":this.validateEditForm.controls.phoneNumber.value,W=this.validateEditForm.controls.studenId.value==null?"":this.validateEditForm.controls.studenId.value,Y=this.validateEditForm.controls.userName.value==null?"":this.validateEditForm.controls.userName.value,ee=this.validateEditForm.controls.defaultStopId.value==null?"":this.validateEditForm.controls.defaultStopId.value,$=this.validateEditForm.controls.defaultStopName.value==null?"":this.validateEditForm.controls.defaultStopName.value,te=this.currentUserSelected.uid,R=!0;this.newCustomerIdEditMode!=""&&!this.resetClientEditInfo&&(this.msg.error("Al cambiar de  Empresa es necesario asignar una ruta y estaci\xF3n acorde a la empresa."),R=!1),Y==""&&(this.msg.error("El Usuario es un valor requerido, favor de validar."),R=!1),W==""&&(this.msg.error("La Matr\xEDcula es un valor requerido, favor de validar, si no se tiene un valor poner 0"),R=!1),x==""&&(this.msg.error("El Email es un valor requerido, favor de validar."),R=!1),n==""&&(this.msg.error("La Empresa es un valor requerido, favor de validar"),R=!1),u==""&&(this.msg.error(" La ruta es un valor requerido, favor de validar"),R=!1);let H={uid:te,customerId:n,customerName:e,defaultRound:t,defaultRoute:u,defaultRouteName:c,displayName:m,email:x,firstName:y,lastName:V,phoneNumber:L,studentId:W,userName:Y,defaultStopId:ee,defaultStopName:$};R&&this.customersService.updateUser(te,H).then(Te=>{this.isEditUserVisible=!1,this.currentUserSelected.firstName=y,this.currentUserSelected.lastName=V,this.currentUserSelected.displayName=m,this.currentUserSelected.userName=Y,this.currentUserSelected.studentId=W,this.currentUserSelected.email=x,this.currentUserSelected.customerId=n,this.currentUserSelected.customerName=e,this.currentUserSelected.phoneNumber=L,this.currentUserSelected.defaultRound=t,this.currentUserSelected.defaultRoute=u,this.currentUserSelected.defaultRouteName=c,this.currentUserSelected.defaultStopName=$,this.currentUserSelected.defaultStopId=ee})}else console.error("currentUserSelected or uid is null or undefined")}submitFormProduct(){this.validateForm.controls.customer_id.setValue(this.currentUserSelected.customerId),this.validateForm.controls.customerId.setValue(this.currentUserSelected.customerId);let n=this.validateForm.controls.amount.value,e=this.validateForm.controls.price.value,t=this.validateForm.controls.validTo.value,u=this.validateForm.controls.is_courtesy.value||!1;this.validateForm.controls.due_date.setValue(t.toISOString()),n!=e&&!u&&this.validateForm.controls.status.setValue("partial");for(let c in this.validateForm.controls)this.validateForm.controls[c].markAsDirty(),this.validateForm.controls[c].updateValueAndValidity();this.validateForm.valid&&(this.isConfirmLoading=!0,this.userlevelAccess!="3"?this.customersService.saveBoardingPassToUserPurchaseCollection(this.currentUserSelected.uid,this.validateForm.value).then(c=>{this.isVisible=!1,this.isConfirmLoading=!1}).catch(c=>{this.isConfirmLoading=!1}):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador."))}pre(){this.current-=1}next(){if(this.current+=1,this.current===2){let n=[];this.usersByAccount.forEach(e=>{this.mapOfCredentialsCheckedId[e.uid]===!0&&n.push(e)}),this.actualSelectedRows=n.length,this.selectedUsersForCredentials=n}}done(){this.isVisibleBulk=!1,this.isVisibleBulkCredentials=!1,setTimeout(()=>{this.current=0,this.isDone=!0},500)}nzClicOption(){this.productsReference!==null&&this.getLatestPurchaseDetail(this.currentUserSelected.uid,this.productsReference.id)}nzClicOptionInformacion(){this.isBoardingPassSelected=!1}getBase64(n,e){let t=new FileReader;t.addEventListener("load",()=>{t.result!==null&&typeof t.result=="string"?e(t.result):console.error("Invalid result from FileReader")}),t.readAsDataURL(n)}handleChange2(n){if(n.file.status!=="uploading"){let t=n.file.status;this.fileListInfo=n.file,t==="done"?this.sendMessage("success",`${n.file.name} Archivo cargado satisfactoriamente.`):t==="error"&&this.sendMessage("error",`${n.file.name} archivo fallido, favor de validar.`),n.file.originFileObj&&this.getBase64(n.file.originFileObj,u=>{this.fileUrl=u;let c=this.bucketStorage.ref(this.bucketPath);this.task=this.bucketStorage.ref(this.bucketPath).putString(u,"data_url"),this.uploadPercent=this.task.percentageChanges(),this.uploadPercent.pipe(U(m=>Number((m/100).toFixed(2)))).subscribe(m=>{this.uploading=m!=0,this.uploadvalue=m}),this.task.snapshotChanges().pipe(we(()=>{this.uploading=!1,this.downloadURL=c.getDownloadURL(),this.downloadURL.subscribe(m=>X(this,null,function*(){this.updateAdvanceURL(m)}))})).subscribe()})}}changePayment(n){this.validateForm.controls.amountPayment.setValue(0),this.paymentSelected=n,n=="Mensualidad"?(this.isValidDescriptionPaymentType=!1,this.isAnticipo=!1,this.validateForm.controls.amountPayment.setValue(this.validateForm.controls.amount.value)):n=="Anticipo"?(this.isValidDescriptionPaymentType=!0,this.isAnticipo=!0,this.validateForm.controls.amountPayment.setValue(0)):(this.isAnticipo=!1,this.isValidDescriptionPaymentType=!0,this.validateForm.controls.amountPayment.setValue(0))}onChangeValidTo(n){let e=this.validateForm.controls.validFrom.value;if(this.paymentSelected=="Anticipo"){let t=this.credentialForm.controls.validTo.value||new Date}}changePaymentType(n){n=="Sistema"||n=="Efectivo"?this.ifValidPayment=!1:this.ifValidPayment=!0}changeLiqPaymentType(n){n=="Sistema"||n=="Efectivo"?this.ifValidLiqPayment=!1:this.ifValidLiqPayment=!0}updateAdvanceURL(n){return X(this,null,function*(){this.validateForm.controls.fileURL.patchValue(n)})}updateAdvanceLURL(n){return X(this,null,function*(){this.validateLiqForm.controls.fileURL.patchValue(n)})}downloadPdf(){try{var n=new rt;Ot(document.getElementById("credencial")).then(e=>{let t=e.toDataURL("image/png"),u=new rt("p","pt","a4");var c=u.internal.pageSize.getWidth(),m=e.height*c/e.width;u.addImage(t,"PNG",10,10,c,m),u.save("credencial.pdf")})}catch(e){console.error(e)}}generatePurchasePDF(n){this.isVisiblePurchasePay=!0,console.log("GenerarPDF")}bajaCheck(){}downloadImg(){let n=document.getElementById("download")?.querySelector("canvas");if(n){this.download.nativeElement.href=n.toDataURL("image/png"),this.download.nativeElement.download="ng-zorro-antd";let e=new MouseEvent("click");this.download.nativeElement.dispatchEvent(e)}}};p.\u0275fac=function(e){return new(e||p)(A(de),A(xt),A(se),A(bt),A(Ge),A(K))},p.\u0275cmp=Q({type:p,selectors:[["ng-component"]],viewQuery:function(e,t){if(e&1&&(et(yi,5),et(xi,5)),e&2){let u;tt(u=it())&&(t.download=u.first),tt(u=it())&&(t.searchbar=u.first)}},decls:83,vars:46,consts:[["searchBar",""],["basicTable",""],["modalTitle",""],["modalContent",""],["modalPassFooter",""],["modalTitleProduct",""],["modalContentProduct",""],["modalFooter",""],["modalUserTitle",""],["modalUserContent",""],["modalUserFooter",""],["modalTitlePay",""],["modalContentPay",""],["modalPassFooterPay",""],["modalContentBulk",""],["modalFooterBulk",""],["modalTitleLiq",""],["modalContentLiquidacion",""],["modalFooterLiquidacion",""],["modalTitleBulkCredentials",""],["modalContentBulkCredentials",""],["modalFooterBulkCredentials",""],["modalTitleUserCredential",""],["modalContentCredential",""],["modalFooterCredential",""],["chatSetting","nzDropdownMenu"],["basicChatData",""],["messageCenterFooterTemplate",""],["basicTablePurchase",""],["credentials","nzDropdownMenu"],["tableReference",""],["download",""],["avatarTemplate",""],["rowSelectionTable",""],[2,"margin","buttom 15px","background-color","white","color","#4F6F57"],[2,"background-color","white","color","#4F6F57",3,"nzGhost"],[2,"background-color","white","color","#4F6F57"],[1,"container-fluid","p-h-0",2,"background-color","white","color","#4F6F57"],[1,"chat","chat-app","row"],[1,"chat-list"],["nz-icon","","nzType","search",2,"background-color","white","color","#4F6F57"],["placeholder","Buscar",2,"background-color","white","color","#4F6F57",3,"keyup"],[1,"chat-user-list",2,"background-color","white","color","#4F6F57"],[3,"nzData","nzShowPagination","nzPageSize"],[3,"click",4,"ngFor","ngForOf"],[1,"chat-content",2,"background-color","white","color","#4F6F57",3,"ngClass"],[1,"conversation",2,"background-color","white","color","#4F6F57"],[1,"conversation-wrapper",2,"background-color","white","color","#4F6F57"],["class","conversation-header justify-content-between","style","background-color: white ;  color: #4F6F57;",4,"ngIf"],["style","width: 100% !important; overflow-y: scroll !important; height: 100% !important; ",4,"ngIf"],[3,"nzVisibleChange","nzOnCancel","nzVisible","nzTitle","nzContent","nzFooter"],[3,"nzVisibleChange","nzOnCancel","nzVisible","nzTitle","nzContent","nzFooter","nzWidth"],["class","footer",4,"ngIf"],[2,"background-color","white","color","#4F6F57",3,"nzVisibleChange","nzOnCancel","nzVisible","nzTitle","nzContent","nzFooter"],[2,"background-color","white !important","color","#4F6F57 !important"],[3,"nzVisibleChange","nzOnCancel","nzVisible","nzWidth","nzTitle","nzContent","nzFooter"],[3,"click"],[1,"media","align-items-center"],["nzShape","square","nzIcon","user",1,"shadow",2,"background-color","white","color","#4F6F57",3,"nzSize","nzSrc"],["nz-icon","","nzType","stop",4,"ngIf"],[3,"nzStatus"],["nz-icon","","nzType","stop"],[1,"conversation-header","justify-content-between",2,"background-color","white","color","#4F6F57"],[1,"media","align-items-center",2,"background-color","white","color","#4F6F57"],[1,"m-r-20","d-md-none","d-block","text-dark","font-size-18","m-t-5",3,"routerLink"],["nz-icon","","type","left-circle","theme","outline"],["nzShape","square","nzIcon","user",1,"shadow",2,"background-color","white","color","#4F6F57",3,"nzSrc"],[1,"p-l-15"],["nz-icon","","nzType","stop","nzTheme","twotone","nzTwotoneColor","#de4436",4,"ngIf"],["nz-dropdown","","nzPlacement","bottomRight",1,"text-dark","font-size-18",3,"nzDropdownMenu","nzTrigger"],["nz-icon","","type","more","theme","outline"],["nz-menu",""],["nz-menu-item","",3,"click",4,"ngIf"],["nz-icon","","nzType","stop","nzTheme","twotone","nzTwotoneColor","#de4436"],["nz-menu-item","",3,"click"],[2,"width","100% !important","overflow-y","scroll !important","height","100% !important"],["nzTitle","Informacion General",2,"color","#4F6F57",3,"nzClick"],["nz-button","",1,"m-r-10",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["nz-icon","","nzType","plus"],[2,"background-color","white  !important","color","#4F6F57 !important"],["nzBordered","","nzSize","small"],["nzTitle","Nombre"],[1,"custom-label-style"],["nzTitle","Apellidos"],["nzTitle","Email"],["nzTitle","Correo Valido"],["nzTitle","Display Name"],["nzTitle","Empresa"],["nzTitle","Ruta"],["nzTitle","Estaciones"],["nzTitle","Turno"],["nzTitle","Telefono"],["nzTitle","Matr\xEDcula"],["nzTitle","Usuario"],["nzTitle","Estatus"],["nzTitle","Tipo de Viaje"],["nzTitle","Pases de abordar",2,"color","#4F6F57"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],[3,"nzData","nzPageSize","nzLoading","nzLoadingDelay",4,"ngIf"],["nzTitle","Comprobante de Pago",2,"color","#4F6F57"],["nzTitle","Credenciales",2,"color","#4F6F57",3,"nzClick"],["nzTitle","Mensajes",2,"color","#4F6F57",3,"nzClick"],[3,"nzData","nzPageSize","nzFooter","nzLoadingDelay"],[2,"color","#4F6F57"],[4,"ngFor","ngForOf"],[3,"nzData","nzPageSize","nzLoading","nzLoadingDelay"],[3,"nzColor"],["nz-text","","nzType","secondary"],[3,"nzColor",4,"ngIf"],[4,"ngIf"],["nz-dropdown","",3,"nzDropdownMenu"],["nz-icon","","nzType","more","nzTheme","outline"],["nz-text","","nzType","secondary",4,"ngIf"],["nzPlain","","nzText","Mensaje"],["rows","4","nz-input","","placeholder","Mensaje",2,"background-color","white","color","#4F6F57",3,"ngModelChange","ngModel"],["nz-form","","nzLayout","horizontal",3,"ngSubmit","formGroup"],["formControlName","product_id","nzAllowClear","","nzPlaceHolder","Seleccionar producto / servicio",2,"width","320px",3,"ngModelChange"],["formControlName","routeId","nzAllowClear","","nzPlaceHolder","Selecciona la ruta",2,"width","320px",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["formControlName","stopId","nzAllowClear","","nzPlaceHolder","Selecciona la estaci\xF3n",2,"width","320px",3,"ngModelChange"],["formControlName","round","nzAllowClear","","nzPlaceHolder","Selecciona Turno",2,"width","200px"],["nzValue","D\xEDa","nzLabel","D\xEDa"],["nzValue","Tarde","nzLabel","Tarde"],["nzValue","Noche","nzLabel","Noche"],["formControlName","payment","nzAllowClear","","nzPlaceHolder","Selecciona un tipo de Pago",2,"width","200px",3,"ngModelChange"],["nzValue","Mensualidad","nzLabel","Mensualidad"],["nzValue","Anticipo","nzLabel","Anticipo"],["nzValue","Liquidacion","nzLabel","Liquidaci\xF3n"],[1,"row"],[1,"col-md-6"],["formControlName","amountPayment",3,"ngModelChange","nzMin","nzMax","nzStep","nzFormatter","nzParser"],["class","col-md-6",4,"ngIf"],["formControlName","amount",3,"ngModelChange","disabled","nzMin","nzMax","nzStep","nzFormatter","nzParser"],["formControlName","is_courtesy","nzCheckedChildren","Si","nzUnCheckedChildren","No",3,"ngModelChange"],["formControlName","typePayment","nzAllowClear","","nzPlaceHolder","Selecciona una Referencia",2,"width","200px",3,"ngModelChange"],["nzValue","Transferencia","nzLabel","Transferencia"],["nzValue","Efectivo","nzLabel","Efectivo"],["nzValue","Sistema","nzLabel","Pago por Sistema"],["nz-checkbox","","formControlName","active"],["formControlName","validFrom"],["formControlName","validTo",3,"ngModelChange","nzDisabledDate"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngIf"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon","","nzType","shopping"],["nz-icon","","nzType","fork"],["nz-icon","","nzType","flag"],["formControlName","promiseDate"],["nzName","comprobante","nzType","drag","nzAction","https://jsonplaceholder.typicode.com/posts/",3,"nzChange","nzMultiple","nzLimit","nzSize","nzFileType"],[1,"ant-upload-drag-icon"],["nz-icon","","nzType","inbox"],[1,"ant-upload-text"],[1,"ant-upload-hint"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click","nzLoading"],["formControlName","amount",3,"ngModelChange","nzMin","nzMax","nzStep","nzFormatter","nzParser"],["formControlName","validTo"],["nz-icon","","nzType","shop"],[3,"nzSm","nzXs"],["nz-input","","formControlName","firstName","id","firstName"],["nz-input","","formControlName","lastName","id","lastName"],["nz-input","","formControlName","displayName","id","displayName"],["nz-input","","formControlName","userName","id","userName"],["nz-input","","formControlName","phoneNumber","id","phoneNumber"],["nz-input","","formControlName","studenId","id","studenId"],["nz-input","","formControlName","email","id","email"],["formControlName","customerId","nzAllowClear","","nzPlaceHolder","Selecciona la empresa",3,"ngModelChange"],["formControlName","defaultRoute","nzAllowClear","","nzPlaceHolder","Selecciona la ruta",3,"ngModelChange"],["formControlName","defaultStopId","nzAllowClear","","nzPlaceHolder","Selecciona la estaci\xF3n",3,"ngModelChange"],["formControlName","defaultRound","nzAllowClear","","nzPlaceHolder","Selecciona Turno",2,"width","320px"],[1,"footer"],["nzTitle","Detalles"],["nzTitle","Producto"],["nzTitle","Pagado"],["nzStatus","success","nzText","Si",4,"ngIf"],["nzStatus","processing","nzText","Parcial",4,"ngIf"],["nzStatus","warning","nzText","No",4,"ngIf"],["nzTitle","Activo"],["nzStatus","processing","nzText","Si",4,"ngIf"],["nzTitle","Fecha de compra"],["nzTitle","Pase Cortes\xEDa"],["nzTitle","Valido desde"],["nzTitle","Valido hasta"],["nzTitle","Servicio"],["nz-icon","","nzType","up-circle","nzTheme","twotone","nzTwotoneColor","lastPurchase?.isTaskIn ? '#52c41a' : '#595959'"],["nz-icon","","nzType","down-circle","nzTheme","twotone","nzTwotoneColor","lastPurchase?.isTaskOut ? '#52c41a' : '#595959'"],["nzTitle","Precio"],["nzTitle","Pagado",4,"ngIf"],["nzTitle","Autorizaci\xF3n"],["nzTitle","Estaci\xF3n"],["nzTitle","Monto Abonado"],["nzTitle","Tipo de Referencia"],["nzTitle","Fecha Compromiso"],["nzTitle","Tipo de Pago"],["nzTitle","Informaci\xF3n de la compra"],["nzTitle","Referencias",3,"nzClick"],[3,"nzData","nzPageSize","nzLoadingDelay"],["nzTitle","Historial de Uso"],[3,"userId","boardingPassId"],["nzTitle","C\xF3digo QR"],["nzValue","currentUserSelected?.uid-lastPurchase?.idBoardingPass"],["nz-button","","nzType","primary",3,"click"],["nzTitle","Credencial"],[2,"background","#ECECEC","padding","30px"],["nz-row","",3,"nzGutter"],["nz-col","",3,"nzSpan"],["nz-row","","id","credencial","credencial","",3,"nzGutter"],["nz-col","",2,"margin-right","76px",3,"nzSpan"],[1,"rounded-margins",2,"width","400px","border-radius","20px","height","310px","background-color","#73C2FBFE",3,"nzBordered"],["nzDescription","",2,"color","black",3,"nzAvatar","nzTitle"],[2,"color","black"],[2,"margin-bottom","1px"],[2,"display","flex","justify-content","center","align-items","center"],[2,"display","flex","flex-wrap","wrap","height","100%"],[2,"width","33.33%","box-sizing","border-box","padding","5px","height","130px"],[2,"border","1px solid black","padding","5px","height","100%"],["nzTitle","",2,"background-image","url('../../../assets/images/logo/andlogoSL.png')","background-position","center","background-size","contain","height","100%",3,"nzBordered"],[2,"color","black","font-size","12px"],["nzStatus","success","nzText","Si"],["nzStatus","processing","nzText","Parcial"],["nzStatus","warning","nzText","No"],["nzStatus","processing","nzText","Si"],["nz-popconfirm","","nzPopconfirmTitle","\xBFEditar el pago?","nzCancelText","Cancelar","nzOkText","Si","nzPopconfirmPlacement","bottom","nzIcon","edit",3,"nzOnConfirm","nzOnCancel",4,"ngIf"],[3,"ngModel","nzMin","nzMax","nzStep","nzFormatter","nzParser","ngModelChange",4,"ngIf"],["nz-popconfirm","","nzPopconfirmTitle","\xBFEditar el pago?","nzCancelText","Cancelar","nzOkText","Si","nzPopconfirmPlacement","bottom","nzIcon","edit",3,"nzOnConfirm","nzOnCancel"],[3,"ngModelChange","ngModel","nzMin","nzMax","nzStep","nzFormatter","nzParser"],[3,"href"],[2,"background-color","white","color","#4F6F57",3,"nzSrc"],["nzSize","small",3,"nzCurrent"],["nzTitle","Pase","nzDescription","Crear el pase de abordar."],["nzTitle","Empresas","nzDescription","Seleccionar las empresas."],["nzTitle","Confirmar","nzDescription","Validar la creaci\xF3n."],["style","background-color: white ;  color: #4F6F57;",4,"ngIf"],["nz-form","","nzLayout","horizontal",2,"background-color","white","color","#4F6F57",3,"ngSubmit","formGroup"],["formControlName","product_id","nzAllowClear","","nzPlaceHolder","Seleccionar producto / servicio",2,"background-color","white","color","#4F6F57",3,"ngModelChange"],["style","background-color: white ;  color: #4F6F57;",4,"ngFor","ngForOf"],["formControlName","routeId","nzAllowClear","","nzPlaceHolder","Selecciona la ruta",2,"background-color","white","color","#4F6F57",3,"ngModelChange"],["nzCustomContent","","style","background-color: white ;  color: #4F6F57;",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzCustomContent","","style","background-color: white ;  color: #4F6F57;",3,"nzLabel","nzValue",4,"ngIf"],["nzCustomContent","",2,"background-color","white","color","#4F6F57",3,"nzLabel","nzValue"],["nzShowSizeChanger","",3,"nzCurrentPageDataChange","nzData","nzSize"],["nzShowCheckbox","","nzShowRowSelection","",3,"nzCheckedChange","nzSelections","nzChecked","nzIndeterminate"],["nzShowCheckbox","",3,"nzCheckedChange","nzChecked"],[3,"ngModel","ngModelChange",4,"ngIf"],["nz-popconfirm","","nzPopconfirmTitle","\xBFEst\xE1s seguro de modificar la vigencia?","nzCancelText","Cancelar","nzOkText","Si","nzPopconfirmPlacement","bottom","nzIcon","edit",3,"nzOnConfirm","nzOnCancel",4,"ngIf"],["nz-popconfirm","","nzPopconfirmTitle","\xBFVas a recibir dinero?","nzCancelText","Cancelar","nzOkText","Si","nzPopconfirmPlacement","bottom","nzIcon","edit",3,"nzOnConfirm","nzOnCancel",4,"ngIf"],[3,"ngModelChange","ngModel"],["nz-popconfirm","","nzPopconfirmTitle","\xBFEst\xE1s seguro de modificar la vigencia?","nzCancelText","Cancelar","nzOkText","Si","nzPopconfirmPlacement","bottom","nzIcon","edit",3,"nzOnConfirm","nzOnCancel"],["nz-popconfirm","","nzPopconfirmTitle","\xBFVas a recibir dinero?","nzCancelText","Cancelar","nzOkText","Si","nzPopconfirmPlacement","bottom","nzIcon","edit",3,"nzOnConfirm","nzOnCancel"],[1,"steps-action"],["nz-button","","style"," background-color: #4F6F57; color: #f6f3ea;",3,"disabled","click",4,"ngIf"],["nz-button","","style"," background-color: #4F6F57; color: #f6f3ea;",3,"nzLoading","click",4,"ngIf"],["nz-button","","style"," background-color: #4F6F57; color: #f6f3ea;",3,"click",4,"ngIf"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click","disabled"],["nz-input","","formControlName","productSelected"],["formControlName","amount",3,"disabled"],["formControlName","alreadyPayment",3,"disabled"],["formControlName","completeAmount",3,"disabled"],["nz-checkbox","","formControlName","baja",3,"ngModelChange"],["nzTitle","Credencial","nzDescription","Crear la credencial."],["nzTitle","Usuarios","nzDescription","Seleccionar los usuarios."],[1,"steps-content","overflow-auto"],["nz-button","","style"," background-color: #4F6F57; color: #f6f3ea;",3,"disabled","nzLoading","click",4,"ngIf"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click","disabled","nzLoading"]],template:function(e,t){if(e&1){let u=S();a(0,"div",34)(1,"div")(2,"nz-page-header",35)(3,"nz-page-header-title",36),s(4,"Empresas"),r(),a(5,"nz-page-header-subtitle",36),s(6,"Listado general "),r()()(),a(7,"div",37)(8,"div",38)(9,"div",39)(10,"div",36),z(11,"i",40),a(12,"input",41,0),g("keyup",function(){h(u);let m=w(13);return f(t.getItems(m.value))}),r()(),a(14,"div",42)(15,"nz-table",43,1)(17,"tbody"),C(18,Pi,16,8,"tr",44),r()()()(),a(19,"div",45)(20,"div",46)(21,"div",47),C(22,Ni,23,11,"div",48),a(23,"div"),C(24,en,67,23,"nz-tabset",49),a(25,"nz-modal",50),I("nzVisibleChange",function(m){return h(u),N(t.isVisible,m)||(t.isVisible=m),f(m)}),g("nzOnCancel",function(){return h(u),f(t.handleCancel())}),C(26,tn,1,0,"ng-template",null,2,P)(28,dn,71,18,"ng-template",null,3,P)(30,cn,4,1,"ng-template",null,4,P),r(),a(32,"nz-modal",50),I("nzVisibleChange",function(m){return h(u),N(t.isProductVisible,m)||(t.isProductVisible=m),f(m)}),g("nzOnCancel",function(){return h(u),f(t.handleCancelProduct())}),C(33,mn,1,0,"ng-template",null,5,P)(35,hn,28,7,"ng-template",null,6,P)(37,fn,4,1,"ng-template",null,7,P),r(),a(39,"nz-modal",51),I("nzVisibleChange",function(m){return h(u),N(t.isEditUserVisible,m)||(t.isEditUserVisible=m),f(m)}),g("nzOnCancel",function(){return h(u),f(t.handleCancel())}),C(40,_n,1,0,"ng-template",null,8,P)(42,vn,61,46,"ng-template",null,9,P)(44,bn,4,0,"ng-template",null,10,P),r()(),C(46,Rn,132,63,"div",52),r()()()()()(),a(47,"nz-modal",50),I("nzVisibleChange",function(m){return h(u),N(t.isVisiblePurchasePay,m)||(t.isVisiblePurchasePay=m),f(m)}),g("nzOnCancel",function(){return h(u),f(t.handleCancel())}),C(48,kn,1,0,"ng-template",null,11,P)(50,Mn,1,0,"ng-template",null,12,P)(52,Un,4,1,"ng-template",null,13,P),r(),a(54,"nz-modal",53),I("nzVisibleChange",function(m){return h(u),N(t.isVisibleBulk,m)||(t.isVisibleBulk=m),f(m)}),g("nzOnCancel",function(){return h(u),f(t.handleCancel())}),a(55,"div",54),C(56,Ln,2,0,"ng-template",null,2,P)(58,Yn,10,12,"ng-template",null,14,P)(60,ia,5,4,"ng-template",null,15,P),r()(),a(62,"nz-modal",50),I("nzVisibleChange",function(m){return h(u),N(t.canUpdatePayment,m)||(t.canUpdatePayment=m),f(m)}),g("nzOnCancel",function(){return h(u),f(t.handleCancel())}),C(63,na,1,0,"ng-template",null,16,P)(65,ra,41,5,"ng-template",null,17,P)(67,oa,6,0,"ng-template",null,18,P),r(),a(69,"nz-modal",55),I("nzVisibleChange",function(m){return h(u),N(t.isVisibleBulkCredentials,m)||(t.isVisibleBulkCredentials=m),f(m)}),g("nzOnCancel",function(){return h(u),f(t.handleCancel())}),C(70,la,1,0,"ng-template",null,19,P)(72,fa,10,5,"ng-template",null,20,P)(74,va,5,4,"ng-template",null,21,P),r(),a(76,"nz-modal",55),I("nzVisibleChange",function(m){return h(u),N(t.isModalCredentialVisible,m)||(t.isModalCredentialVisible=m),f(m)}),g("nzOnCancel",function(){return h(u),f(t.handleCancel())}),C(77,ba,1,0,"ng-template",null,22,P)(79,Sa,18,1,"ng-template",null,23,P)(81,ya,3,2,"ng-template",null,24,P),r()}if(e&2){let u=w(16),c=w(27),m=w(29),x=w(31),y=w(34),V=w(36),L=w(38),W=w(41),Y=w(43),ee=w(45),$=w(49),te=w(51),R=w(53),H=w(59),Te=w(61),je=w(64),pi=w(66),hi=w(68),fi=w(73),_i=w(75),gi=w(80),zi=w(82);o(2),d("nzGhost",!1),o(13),d("nzData",t.devicesList)("nzShowPagination",!1)("nzPageSize",10),o(3),d("ngForOf",u.data),o(),d("ngClass",ut(44,Di,t.isContentOpen)),o(3),d("ngIf",t.isUserSelected),o(2),d("ngIf",t.isUserSelected),o(),F("nzVisible",t.isVisible),d("nzTitle",c)("nzContent",m)("nzFooter",x),o(7),F("nzVisible",t.isProductVisible),d("nzTitle",y)("nzContent",V)("nzFooter",L),o(7),F("nzVisible",t.isEditUserVisible),d("nzTitle",W)("nzContent",Y)("nzFooter",ee)("nzWidth",600),o(7),d("ngIf",t.isBoardingPassSelected),o(),F("nzVisible",t.isVisiblePurchasePay),d("nzTitle",$)("nzContent",te)("nzFooter",R),o(7),F("nzVisible",t.isVisibleBulk),d("nzTitle","Emitir m\xFAltiples pases de abordar")("nzContent",H)("nzFooter",Te),o(8),F("nzVisible",t.canUpdatePayment),d("nzTitle",je)("nzContent",pi)("nzFooter",hi),o(7),F("nzVisible",t.isVisibleBulkCredentials),d("nzWidth",800)("nzTitle","Emitir m\xFAltiples credenciales")("nzContent",fi)("nzFooter",_i),o(7),F("nzVisible",t.isModalCredentialVisible),d("nzWidth",800)("nzTitle","Emitir credencial")("nzContent",gi)("nzFooter",zi)}},dependencies:[pt,ie,Ne,Nt,ce,pe,ue,fe,he,_e,ke,Me,Gt,Dt,Lt,It,kt,Rt,Bt,Ut,At,Mt,ve,zt,Wt,Ht,jt,Qt,qt,$e,Yt,Kt,Vt,wt,Pt,Et,Tt,Ce,ge,ze,Ct,vt,De,ye,xe,Ft,be,Se,ft,re,Re,ne,ae,oe,le,gt,Oe,Be,$t,Zt,Ie,ht],encapsulation:2});let l=p;return l})();var mi=(()=>{let p=class p{constructor(n,e){this.afs=n,this.messageService=e}getFiles(){return this.afs.collectionGroup("quality",e=>e.where("active","==",!0).orderBy("folder","desc")).valueChanges()}saveFileCollection(n){let e=this.afs.createId();return n.uid=e,console.log(e),this.afs.collection("quality").doc(e).set(n)}deletePurchase(n){this.filesCollection=this.afs.collection("quality").doc(n),this.filesCollection.delete().then(()=>{this.sendMessage("success","Se borro con \xE9xito el Archivo")}).catch(e=>{this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal cuando se intentaba borrar un archivo ... ${e}`)})}sendMessage(n,e){this.messageService.create(n,e)}};p.\u0275fac=function(e){return new(e||p)(Ke(de),Ke(K))},p.\u0275prov=ct({token:p,factory:p.\u0275fac,providedIn:"root"});let l=p;return l})();function Da(l,p){if(l&1&&z(0,"nz-option",25),l&2){let i=p.$implicit;d("nzValue",i)("nzLabel",i)}}function wa(l,p){l&1&&z(0,"input",26)}function Va(l,p){if(l&1){let i=S();a(0,"button",11),g("click",function(){h(i);let e=_();return f(e.newFolderSave())}),s(1,"\u2713"),r()}}function Pa(l,p){if(l&1&&(a(0,"div")(1,"a",27),s(2,"Ver Comprobante"),r()()),l&2){let i=_();o(),Ve("href",i.urlFile,Fe)}}function Ea(l,p){if(l&1){let i=S();a(0,"button",28),g("click",function(){h(i);let e=_();return f(e.handleOKEdit())}),s(1,"Aceptar"),r(),a(2,"button",11),g("click",function(){h(i);let e=_();return f(e.handleCancelEdit())}),s(3,"Cancelar"),r()}if(l&2){let i=_();d("nzLoading",i.isConfirmLoading)}}var ui=[{headerName:"--",width:90,enableRowGroup:!0,sortable:!0,resizable:!0,cellStyle:{color:"blue"},field:"editMode",pinned:"left",enableCellChangeFlash:!0,valueGetter:l=>l&&l.node?"Detalle":null},{headerName:"Folder",enableRowGroup:!0,field:"folder",filter:!0,sortable:!0,enableCellChangeFlash:!0},{headerName:"Nombre",enableRowGroup:!0,field:"fileName",sortable:!0,filter:!0}],Tr=(()=>{let p=class p{constructor(n,e,t){this.msg=n,this.bucketStorage=e,this.fb=t,this.rolService=k(Ae),this.authService=k(me),this.isConfirmLoading=!1,this.fileUrl="http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg",this.autosave=!0,this.uploading=!1,this.bucketPath="/quality1/quality/",this.view="Ver",this.isVerVisible=!1,this.isEditModalVisible=!1,this.urlFile="",this.uploadvalue=0,this.columnFleetDefsProgram=ui,this.columnDefs=ui,this.rowFolders=[],this.addNewFolder=!1,this.selectedRecord=[],this.rowGroupPanelShow="always",this.infoLoad=[],this.qualityService=k(mi),this.columnProgram={resizable:!0},console.log("Entro a reportsw"),this.authService.user.subscribe(u=>{this.user=u,this.user&&this.user.rolId!=null&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(c=>{this.infoLoad=c,this.userlevelAccess=this.infoLoad.optionAccessLavel})})}ngOnInit(){this.validateForm=this.fb.group({folder:[""],fileUrl:[""],fileName:[""],NewFolderName:[""]}),this.loadFiles()}sendMessage(n,e){this.msg.create(n,e)}loadFiles(){this.qualitySubscription=this.qualityService.getFiles().subscribe(n=>{if(this.rowData=n,n.length>=0){n.forEach(t=>{this.rowFolders.push(t.folder)});let e=Array.from(new Set(this.rowFolders));this.rowFolders=e}})}ngOnDestroy(){this.qualitySubscription.unsubscribe()}submitForm(){console.log("GuardarArchivo");var n,e=this.fileURL||"",t=this.validateForm.controls.folder.value||"",u=this.fileName||"No-Name",c=new Date;console.log(this.fileName),t==""&&this.msg.error("Se requiere seleccionar una carpeta para almacenenar."),e==""&&this.msg.error("Se requiere tener un archivo para subir."),n={active:!0,folder:t,fileUrl:e,fileName:u,creation_date:c,uid:""},this.userlevelAccess!="3"?this.qualityService.saveFileCollection(n).then(m=>{this.msg.success("Se subio el archivo con \xE9xito."),this.refreshTable()}).catch(m=>{this.msg.error("Se presento un error."+m)}):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}changeFolder(n){console.log("changeFolder")}newFolder(){this.addNewFolder=!0}handleChange(n){if(n.file.status!=="uploading"){let t=n.file.status;this.fileListInfo=n.file,t==="done"?this.sendMessage("success",`${n.file.name} Archivo cargado satisfactoriamente.`):t==="error"&&this.sendMessage("error",`${n.file.name} archivo fallido, favor de validar.`),n.file.originFileObj&&this.getBase64(n.file.originFileObj,u=>{this.fileUrl=u;let c=this.bucketStorage.ref(this.bucketPath);this.task=this.bucketStorage.ref(this.bucketPath).putString(u,"data_url"),this.uploadPercent=this.task.percentageChanges(),this.uploadPercent.pipe(U(m=>Number((m/100).toFixed(2)))).subscribe(m=>{this.uploading=m!=0,this.uploadvalue=m}),this.task.snapshotChanges().pipe(we(()=>{this.uploading=!1,this.downloadURL=c.getDownloadURL(),this.downloadURL.subscribe(m=>X(this,null,function*(){this.updateURL(m)}))})).subscribe()})}}updateURL(n){return X(this,null,function*(){this.fileURL=n})}getBase64(n,e){let t=new FileReader;t.addEventListener("load",()=>{t.result!==null&&typeof t.result=="string"?e(t.result):console.error("Invalid result from FileReader")}),t.readAsDataURL(n)}refreshTable(){this.loadFiles()}onSelectionChangedEdit(n){let e=this.gridApiDetail.getSelectedRows(),t=O({},e[0]);this.isEditModalVisible=!0,this.selectedRecord=t,this.urlFile=t.fileUrl,this.selectedUid=t.uid}onGridReady(n){console.log("onGridReady"+n),this.gridApiDetail=n.api,this.gridColumnApiDetail=n.columnApi}newFolderSave(){let n=this.validateForm.get("NewFolderName");n&&n.value!==null&&(this.rowFolders.push(n.value),this.addNewFolder=!1,this.validateForm.controls.NewFolderName.setValue(""))}handleOKEdit(){console.log("borrararchivo."+this.view),console.log(this.selectedRecord),this.isVerVisible?this.isVerVisible=!0:this.userlevelAccess=="1"?(this.qualityService.deletePurchase(this.selectedUid),this.refreshTable(),this.isEditModalVisible=!1):this.sendMessage("error","El usuario no tiene permisos para borrar datos, favor de contactar al administrador.")}changeOption(n){n==2?this.isVerVisible=!1:this.isVerVisible=!0}handleCancelEdit(){this.isEditModalVisible=!1}handleChangeUpload(n){console.log("pasa1 : "+n.file.status),n.file.status!=="uploading"&&(console.log(n.file,n.fileList),n.file.status==="done"?this.msg.success(`${n.file.name} file uploaded successfully`):n.file.status==="error"&&this.msg.error(`${n.file.name} file upload failed.`),n.file.originFileObj&&this.getBase64(n.file.originFileObj,e=>{this.fileUrl=e;let t=this.bucketStorage.ref(this.bucketPath+n.file.name);console.log(this.bucketPath),console.log("this.task"),this.task=this.bucketStorage.ref(this.bucketPath+n.file.name).putString(e,"data_url"),this.fileName=n.file.name;var u=this.bucketStorage.ref(this.bucketPath).child(n.file.name);this.uploadPercent=this.task.percentageChanges(),this.uploadPercent.pipe(U(c=>Number((c/100).toFixed(2)))).subscribe(c=>{this.uploading=c!=0,this.uploadvalue=c}),this.task.snapshotChanges().pipe(we(()=>{this.downloadURL=t.getDownloadURL(),this.downloadURL.subscribe(c=>X(this,null,function*(){this.updateURL(c)}))})).subscribe()}))}};p.\u0275fac=function(e){return new(e||p)(A(K),A(Ge),A(se))},p.\u0275cmp=Q({type:p,selectors:[["ng-component"]],decls:53,vars:15,consts:[["agGrid",""],["modalFooterEdit",""],[2,"margin","buttom 15px"],[1,"site-page-header-ghost-wrapper"],[3,"nzGhost"],["nz-form","","nzLayout","vertical",3,"formGroup"],[1,"body"],[1,"row"],[1,"col-md-4"],["formControlName","folder","nzAllowClear","","nzPlaceHolder","Selecciona una carpeta donde almacenar el documento.",2,"width","200px",3,"ngModelChange"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],[1,"col-md-8"],["style","width: 350px;","nz-input","","placeholder","Ingresa el nombre de la carpeta","formControlName","NewFolderName",4,"ngIf"],["nz-button","","style"," background-color: #4F6F57; color: #f6f3ea;",3,"click",4,"ngIf"],[1,"col-md-2"],["nzAction","https://corsproxy.io/?https://jsonplaceholder.typicode.com/posts/",3,"nzChange"],["nz-button",""],["nz-icon","","nzType","upload"],[1,"col-md-10"],[1,"col-md-12"],[1,"ag-theme-material",2,"width","100%","height","450px",3,"gridReady","selectionChanged","rowData","rowSelection","columnDefs","rowGroupPanelShow","defaultColDef","groupIncludeFooter","sideBar"],["nzTitle","Detalle Archivo","nzWidth","500px",3,"nzVisibleChange","nzOnCancel","nzVisible","nzFooter"],["nz-form",""],[4,"ngIf"],[3,"nzValue","nzLabel"],["nz-input","","placeholder","Ingresa el nombre de la carpeta","formControlName","NewFolderName",2,"width","350px"],[3,"href"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click","nzLoading"]],template:function(e,t){if(e&1){let u=S();a(0,"div",2)(1,"div",3)(2,"nz-page-header",4)(3,"nz-page-header-title"),s(4,"Calidad"),r(),a(5,"nz-page-header-subtitle"),s(6," Repositorio "),r()(),a(7,"form",5)(8,"div",6)(9,"div",7)(10,"div",8)(11,"nz-form-item")(12,"nz-form-label"),s(13,"Carpeta"),r(),a(14,"nz-select",9),g("ngModelChange",function(m){return h(u),f(t.changeFolder(m))}),C(15,Da,1,2,"nz-option",10),r(),a(16,"button",11),g("click",function(){return h(u),f(t.newFolder())}),s(17,"+"),r()()(),a(18,"div",12),C(19,wa,1,0,"input",13)(20,Va,2,0,"button",14),r()(),a(21,"div",7)(22,"div",15)(23,"nz-form-item")(24,"nz-upload",16),g("nzChange",function(m){return h(u),f(t.handleChangeUpload(m))}),a(25,"button",17),z(26,"span",18),s(27," Cargar Archivo "),r()()()(),a(28,"div",19)(29,"nz-form-item")(30,"button",11),g("click",function(){return h(u),f(t.submitForm())}),s(31,"Subir"),r()()()()(),a(32,"div",7)(33,"div",15)(34,"button",11),g("click",function(){return h(u),f(t.refreshTable())}),s(35,"Actualizar"),r()(),z(36,"div",19),r(),a(37,"div",7)(38,"div",20)(39,"ag-grid-angular",21,0),g("gridReady",function(m){return h(u),f(t.onGridReady(m))})("selectionChanged",function(m){return h(u),f(t.onSelectionChangedEdit(m))}),r()()()()(),a(41,"nz-modal",22),I("nzVisibleChange",function(m){return h(u),N(t.isEditModalVisible,m)||(t.isEditModalVisible=m),f(m)}),g("nzOnCancel",function(){return h(u),f(t.handleCancelEdit())}),a(42,"div")(43,"form",23)(44,"nz-form-item")(45,"button",11),g("click",function(){return h(u),f(t.changeOption(1))}),s(46,"Ver"),r(),a(47,"button",11),g("click",function(){return h(u),f(t.changeOption(2))}),s(48,"Borrar"),r()(),a(49,"nz-form-item"),C(50,Pa,3,1,"div",24),r()()(),C(51,Ea,4,1,"ng-template",null,1,P),r()()}if(e&2){let u=w(52);o(2),d("nzGhost",!1),o(5),d("formGroup",t.validateForm),o(8),d("ngForOf",t.rowFolders),o(4),d("ngIf",t.addNewFolder),o(),d("ngIf",t.addNewFolder),o(19),d("rowData",t.rowData)("rowSelection",t.rowSelectionEdit)("columnDefs",t.columnFleetDefsProgram)("rowGroupPanelShow",t.rowGroupPanelShow)("defaultColDef",t.columnProgram)("groupIncludeFooter",!0)("sideBar",!1),o(2),F("nzVisible",t.isEditModalVisible),d("nzFooter",u),o(9),d("ngIf",t.isVerVisible)}},dependencies:[ie,Ne,qe,ce,pe,ue,fe,he,_e,Me,ve,$e,Ce,ge,ze,De,ye,xe,be,Se,re,Re,ne,ae,oe,le,_t],styles:[".footer[_ngcontent-%COMP%]{height:100%!important;position:absolute;padding:0 25px;display:flex;justify-content:space-between}.body[_ngcontent-%COMP%]{overflow-y:auto;padding:15px 25px;position:relative;width:100%}"]});let l=p;return l})();function Ta(l,p){if(l&1&&(a(0,"div")(1,"nz-option",42),z(2,"i",43),s(3),r()()),l&2){let i=p.$implicit;o(),d("nzLabel",i.name)("nzValue",i.id),o(2),T(" ",i.name," $",i.price," ")}}function Fa(l,p){if(l&1&&(a(0,"div")(1,"nz-option",42),z(2,"i",43),s(3),r()()),l&2){let i=p.$implicit;o(),d("nzLabel",i.name)("nzValue",i.id),o(2),T(" ",i.name," $",i.price," ")}}function Na(l,p){if(l&1&&(a(0,"div")(1,"nz-option",42),z(2,"i",43),s(3),r()()),l&2){let i=p.$implicit;o(),d("nzLabel",i.name)("nzValue",i.id),o(2),b(" ",i.name," ")}}function Ia(l,p){if(l&1&&(a(0,"div")(1,"nz-option",42),z(2,"i",43),s(3),r()()),l&2){let i=p.$implicit;o(),d("nzLabel",i.name)("nzValue",i.id),o(2),T(" ",i.name," $",i.price," ")}}function Ra(l,p){if(l&1&&(a(0,"div")(1,"nz-option",42),z(2,"i",43),s(3),r()()),l&2){let i=p.$implicit;o(),d("nzLabel",i.name)("nzValue",i.id),o(2),T(" ",i.name," $",i.price," ")}}function ka(l,p){if(l&1&&(a(0,"div")(1,"nz-option",42),z(2,"i",43),s(3),r()()),l&2){let i=p.$implicit;o(),d("nzLabel",i.name)("nzValue",i.id),o(2),T(" ",i.name," $",i.price," ")}}function Ma(l,p){if(l&1&&(a(0,"div")(1,"nz-option",42),z(2,"i",43),s(3),r()()),l&2){let i=p.$implicit;o(),d("nzLabel",i.name)("nzValue",i.id),o(2),T(" ",i.name," $",i.price," ")}}function Ua(l,p){if(l&1&&(a(0,"div")(1,"nz-option",42),z(2,"i",43),s(3),r()()),l&2){let i=p.$implicit;o(),d("nzLabel",i.routeName)("nzValue",i.routeId),o(2),b(" ",i.routeName," ")}}function La(l,p){if(l&1){let i=S();a(0,"button",14),g("click",function(){h(i);let e=_();return f(e.handleOK())}),s(1,"Aceptar"),r()}}function Aa(l,p){if(l&1){let i=S();a(0,"button",14),g("click",function(){h(i);let e=_();return f(e.handleOK())}),s(1,"Aceptar"),r()}}var Xr=(()=>{let p=class p{constructor(n,e,t){this.fb=n,this.msg=e,this.afs=t,this.authService=k(me),this.usersService=k(Ue),this.routesService=k(Le),this.productsService=k(Xe),this.stopSubscription$=new Z,this.sumOfField=0,this.rowData=[],this.rowDataPay=[],this.rowDataPayTurn=[],this.rowDataPayCV=[],this.rowDataPayCVByR=[],this.TotalUsers=0,this.TotalMPP=0,this.TotalMPByRoute=0,this.usersList=[],this.usersListA=[],this.usersListCV=[],this.routesList=[],this.products=[],this.amountCV=0,this.priceCV=0,this.accountId$=new Z,this.shift=[],this.isModalVisible=!1,this.isModalVisibleCV=!1,this.sideBar="filters",console.log("Entro a reports"),this.validateForm=this.fb.group({id:[null]}),this.validateFormPase=this.fb.group({id:[null]}),this.validateFormTurn=this.fb.group({id:[null],turno:[""]}),this.validateFormAnticipos=this.fb.group({id:[null],turno:[""]}),this.validateFormCV=this.fb.group({id:[null]}),this.validateFormCVByRoute=this.fb.group({id:[null],routeId:[""]}),this.signupForm=this.fb.group({id:[],customerName:[""],defaultRound:[""],defaultRouteName:[""],displayName:[""],email:[""],firstName:[""],lastName:[""],phone:[""],studentId:[""]}),this.signupFormCV=this.fb.group({id:[],customerName:[""],defaultRound:[""],defaultRouteName:[""],displayName:[""],email:[""],firstName:[""],lastName:[""],phone:[""],studentId:[""]}),this.shift=[{id:"D\xEDa",name:"D\xEDa"},{id:"Tarde",name:"Tarde"},{id:"Noche",name:"Noche"}];let u=this.accountId$.pipe(j(c=>this.afs.collection("customers").doc(c).collection("products",m=>m.where("active","==",!0)).valueChanges({idField:"productId"})));this.columnDefs=[{headerName:"Empresa",field:"customerName",cellRenderer:"agGroupCellRenderer",sortable:!0},{headerName:"Ruta",sortable:!0,field:"routeName"},{headerName:"Usuarios Mete",field:"customerName",cellRenderer:c=>c.data.passes},{headerName:"Usuarios Saca",field:"customerName",cellRenderer:c=>c.data.passes},{headerName:"Activa",field:"permission",cellRenderer:c=>c.value?"Si":"No"}],this.columnDefsPagos=[{headerName:"Empresa",field:"customerName",cellRenderer:"agGroupCellRenderer",sortable:!0},{headerName:"Ruta",sortable:!0,field:"routeName"},{headerName:"Usuarios",aggFunc:"sum",filter:!0,sortable:!0,field:"customerName",cellRenderer:c=>c.data.passes.reduce(y=>y+1,0)},{headerName:"Monto",aggFunc:"sum",field:"customerName",cellRenderer:c=>c.data.passes.reduce((V,L)=>V+L.amount,0).toLocaleString("en-US",{style:"currency",currency:"USD"})},{headerName:"Activa",field:"permission",cellRenderer:c=>c.value?"Si":"No"}],this.columnProgram=[{headerName:"Inicia",field:"time",cellRenderer:"agGroupCellRenderer",sortable:!0},{headerName:"Empresa",sortable:!0,field:"customerName"},{headerName:"Ruta",sortable:!0,field:"routeName"},{headerName:"Programa / Turno",Field:"round"},{headerName:"PR",sortable:!0,field:"driver"},{headerName:"Veh\xEDculo",sortable:!0,field:"vehicleName"},{headerName:"Inici\xF3",sortable:!0,field:"startedAt"},{headerName:"Finaliz\xF3",sortable:!0,field:"endedAt"}],this.usersColumnDefs=[{headerName:"Empresa",field:"customerName",enableRowGroup:!0},{headerName:"Ruta",field:"routeName",enableRowGroup:!0},{headerName:"Turno",field:"round",enableRowGroup:!0},{headerName:"Estaci\xF3n",field:"stopName",enableRowGroup:!0},{headerName:"Pase de abordar",field:"name"},{headerName:"Mete",field:"isTaskIn",cellRenderer:c=>c.value?"Si":"No"},{headerName:"Saca",field:"isTaskOut",cellRenderer:c=>c.value?"Si":"No"},{headerName:"Pase Cortes\xEDa",field:"is_courtesy",cellRenderer:c=>c.value?"Si":"No"},{headerName:"V\xE1lido desde",field:"validFrom",cellRenderer:c=>{let m=c.value.toDate();return q(m,"MMMM dd yyyy",{locale:B})}},{headerName:"V\xE1lido hasta",field:"validTo",cellRenderer:c=>{let m=c.value.toDate();return q(m,"MMMM dd yyyy",{locale:B})}}],this.usersColumnDefsAnticipo=[{headerName:"Empresa",width:200,field:"customerName",enableRowGroup:!0},{headerName:"Ruta",width:200,field:"routeName",enableRowGroup:!0},{headerName:"Turno",width:100,field:"round",enableRowGroup:!0},{headerName:"Monto Anticipo",enableRowGroup:!0,field:"amountPayment",cellRenderer:c=>c.data.amountPayment.toLocaleString("en-US",{style:"currency",currency:"USD"})},{headerName:"Promesa  de Pago",field:"promiseDate",cellRenderer:c=>{let m=c.value.toDate();return q(m,"MMMM dd yyyy",{locale:B})}},{headerName:"D\xEDas vencidos",field:"promiseDate",cellRenderer:c=>{let x=c.value.toDate(),y=new Date,V=x.getTime()-y.getTime();return Math.floor(V/(1e3*60*60*24))+" d\xEDas"}},{headerName:"Pase de abordar",field:"name"},{headerName:"Mete / Saca / Cortes\xEDa",field:"isTaskIn",width:210,cellRenderer:c=>{let m=c.data.isTaskIn?"Si":"No",x=c.data.isTaskOut?"Si":"No",y=c.data.is_courtesy?"Si":"No";return` ${m} / ${x} / ${y}`}},{headerName:"V\xE1lido desde",field:"validFrom",cellRenderer:c=>{let m=c.value.toDate();return q(m,"MMMM dd yyyy",{locale:B})}},{headerName:"V\xE1lido hasta",field:"validTo",cellRenderer:c=>{let m=c.value.toDate();return q(m,"MMMM dd yyyy",{locale:B})}}],this.usersColumnDefsCV=[{headerName:"Empresa",width:200,field:"customerName",enableRowGroup:!0},{headerName:"Ruta",width:200,field:"routeName",enableRowGroup:!0},{headerName:"Turno",width:100,field:"round",enableRowGroup:!0},{headerName:"Monto Anticipo",enableRowGroup:!0,field:"amountPayment",cellRenderer:c=>c.data.amountPayment.toLocaleString("en-US",{style:"currency",currency:"USD"})},{headerName:"Pendiente de Pago",cellRenderer:c=>(c.data.amount-c.data.amountPayment).toLocaleString("en-US",{style:"currency",currency:"USD"})},{headerName:"Promesa  de Pago",field:"promiseDate",cellRenderer:c=>{let m=c.value.toDate();return q(m,"MMMM dd yyyy",{locale:B})}},{headerName:"D\xEDas vencidos",field:"promiseDate",cellRenderer:c=>{let x=c.value.toDate(),y=new Date,V=x.getTime()-y.getTime();return Math.floor(V/(1e3*60*60*24))+" d\xEDas"}},{headerName:"Pase de abordar",field:"name"},{headerName:"Mete / Saca / Cortes\xEDa",field:"isTaskIn",width:210,cellRenderer:c=>{let m=c.data.isTaskIn?"Si":"No",x=c.data.isTaskOut?"Si":"No",y=c.data.is_courtesy?"Si":"No";return` ${m} / ${x} / ${y}`}},{headerName:"V\xE1lido desde",field:"validFrom",cellRenderer:c=>{let m=c.value.toDate();return q(m,"MMMM dd yyyy",{locale:B})}},{headerName:"V\xE1lido hasta",field:"validTo",cellRenderer:c=>{let m=c.value.toDate();return q(m,"MMMM dd yyyy",{locale:B})}}],this.usersColumnDefsCVDetalle=[{headerName:"Nombre",width:300,field:"displayName"},{headerName:"Matricula",width:140,field:"studentId"},{headerName:"Telefono",width:140,field:"phone"},{headerName:"Correo",width:300,field:"email"},{headerName:"Monto Anticipo",field:"amountPayment",cellRenderer:c=>c.data.amountPayment.toLocaleString("en-US",{style:"currency",currency:"USD"})},{headerName:"Pendiente de Pago",cellRenderer:c=>(c.data.amount-c.data.amountPayment).toLocaleString("en-US",{style:"currency",currency:"USD"})},{headerName:"Promesa  de Pago",field:"promiseDate",cellRenderer:c=>{let m=c.value.toDate();return q(m,"MMMM dd yyyy",{locale:B})}},{headerName:"D\xEDas vencidos",field:"promiseDate",cellRenderer:c=>{let x=c.value.toDate(),y=new Date,V=x.getTime()-y.getTime();return Math.floor(V/(1e3*60*60*24))+" d\xEDas"}}],this.defaultColDef={flex:1,minWidth:100,filter:!0,sortable:!0,resizable:!0},this.detailCellRendererParams={detailGridOptions:{columnDefs:[{headerName:"Pase de abordar",field:"name"},{headerName:"Mete / Saca / Cortes\xEDa",field:"isTaskIn",width:210,cellRenderer:c=>{let m=c.data.isTaskIn?"Si":"No",x=c.data.isTaskOut?"Si":"No",y=c.data.is_courtesy?"Si":"No";return` ${m} / ${x} / ${y}`}},{headerName:"Estaci\xF3n",field:"stopName"},{headerName:"V\xE1lido desde",field:"validFrom",cellRenderer:c=>{let m=c.value.toDate();return q(m,"MMMM dd yyyy",{locale:B})}},{headerName:"V\xE1lido hasta",field:"validTo",cellRenderer:c=>{let m=c.value.toDate();return q(m,"MMMM dd yyyy",{locale:B})}}],defaultColDef:{flex:1}},getDetailRowData:function(c){c.successCallback(c.data.passes)}},this.detailCellRendererParamsPagos={detailGridOptions:{columnDefs:[{headerName:"Pase de abordar",field:"name",width:250},{headerName:"Mete / Saca / Cortes\xEDa",field:"isTaskIn",width:210,cellRenderer:c=>{let m=c.data.isTaskIn?"Si":"No",x=c.data.isTaskOut?"Si":"No",y=c.data.is_courtesy?"Si":"No";return` ${m} / ${x} / ${y}`}},{headerName:"Pago",width:140,field:"payment"},{headerName:"Tipo de Pago",width:145,field:"typePayment"},{headerName:"Monto",field:"amount",width:120},{headerName:"Status",field:"status",width:130,cellRenderer:c=>{let m=c.data.status;return m!=="completed"?"Pago Parcial":"Completo"}},{headerName:"V\xE1lido desde",field:"validFrom",width:130,cellRenderer:c=>{let m=c.value.toDate();return q(m,"MMMM dd yyyy",{locale:B})}},{headerName:"V\xE1lido hasta",field:"validTo",width:130,cellRenderer:c=>{let m=c.value.toDate();return q(m,"MMMM dd yyyy",{locale:B})}}],defaultColDef:{flex:1}},getDetailRowData:function(c){c.successCallback(c.data.passes)}},u.subscribe(c=>{})}ngOnInit(){this.authService.user.subscribe(n=>{this.user=n,this.getSubscriptionsByRoute(n.vendorId),this.cCollection=this.afs.collectionGroup("products",e=>e.where("active","==",!0)),this.productsListV=this.cCollection.snapshotChanges().pipe(U(e=>e.map(t=>{let u=t.payload.doc.id,c=t.payload.doc.data();return O({id:u},c)}))).subscribe(e=>{this.products=e})})}onFirstDataRendered(n){setTimeout(function(){},0)}onGridReady(n){this.gridApi=n.api,this.gridColumnApi=n.columnApi,this.rowData=this.routesList}onGridReadyD(n){this.gridApi=n.api,this.gridColumnApi=n.columnApi}ngOnDestroy(){this.stopSubscription$&&(this.stopSubscription$.next(void 0),this.stopSubscription$.complete()),this.productsSubscription&&this.productsSubscription.unsubscribe(),this.accountsSubscription&&this.accountsSubscription.unsubscribe()}getSubscriptionsByRoute(n){this.usersService.getBoardingPassesByRoute(n).pipe(G(this.stopSubscription$)).subscribe(e=>{this.rowData=e})}getSubscriptionsByTurn(n,e){this.usersService.getBoardingPassesByTurn(n,e).pipe(G(this.stopSubscription$)).subscribe(t=>{this.rowDataPayTurn=t,console.log(this.rowDataPayTurn),this.TotalUsers=this.sumAllPasses(this.rowDataPayTurn)})}sumAllPasses(n){let e=0;return n.forEach(t=>{if(t&&Array.isArray(t.passes)){let u=t.passes.length;e+=t.passes.length}}),e}sumAllCV(n){let e=0;return n.forEach(t=>{t&&Array.isArray(t.passes)&&t.passes.forEach(u=>{this.amountCV=u.amountPayment,this.priceCV=u.amount;let c=this.priceCV-this.amountCV;e+=c})}),e}sumAllCVByR(n){let e=0;return n.forEach(t=>{t&&Array.isArray(t.passes)&&t.passes.forEach(u=>{this.amountCV=u.amountPayment,this.priceCV=u.amount;let c=this.priceCV-this.amountCV;e+=c})}),e}getSubscriptions(n){this.usersService.getBoardingPassesByProduct(n).pipe(G(this.stopSubscription$)).subscribe(e=>{this.rowDataPay=e})}getSubscriptionsPase(n){this.usersService.getBoardingPassesByProduct(n).pipe(G(this.stopSubscription$)).subscribe(e=>{this.createNestedTableData(e)})}getSubscriptionsAnticipos(n){this.usersService.getBoardingPassesByAnticipos(n).pipe(G(this.stopSubscription$)).subscribe(e=>{this.createNestedTableDataA(e)})}getSubscriptionsCV(n){this.usersService.getBoardingPassesByCV(n).pipe(G(this.stopSubscription$)).subscribe(e=>{this.rowDataPayCV=e,this.TotalMPP=this.sumAllCV(this.rowDataPayCV),this.createNestedTableDataCV(e)})}getSubscriptionsCVByRoute(n){this.usersService.getBoardingPassBySingleRoute(n,this.routeIdSelected).pipe(G(this.stopSubscription$)).subscribe(e=>{console.log(e),this.rowDataPayCVByR=e,this.TotalMPByRoute=this.sumAllCVByR(this.rowDataPayCVByR),this.createNestedTableDataCVByRoute(e)})}createNestedTableDataA(n){this.usersListA=[];for(let e=0;e<n.length;++e){n[e].key=e,n[e].expand=!1,n[e].routeName=n[e].passes[0].routeName;for(let t=0;t<n[e].passes.length;++t)n[e].passes[t].key=e,n[e].passes[t].customerName=n[e].customerName,this.usersListA.push(n[e].passes[t])}}createNestedTableDataCV(n){this.usersListCV=[];for(let e=0;e<n.length;++e){n[e].key=e,n[e].expand=!1,n[e].routeName=n[e].passes[0].routeName;for(let t=0;t<n[e].passes.length;++t)n[e].passes[t].key=e,n[e].passes[t].customerName=n[e].customerName,this.usersListCV.push(n[e].passes[t])}}createNestedTableDataCVByRoute(n){this.usersListCVByR=[];for(let e=0;e<n.length;++e){n[e].key=e,n[e].expand=!1,n[e].routeName=n[e].passes[0].routeName;for(let t=0;t<n[e].passes.length;++t)n[e].passes[t].key=e,n[e].passes[t].customerName=n[e].customerName,this.usersListCVByR.push(n[e].passes[t])}if(this.usersListCVByR.length>0){this.usersListCVByRDetalle=[],console.log(this.usersListCVByR);for(let e of this.usersListCVByR)this.usersService.getUserInfo(e.uid).subscribe(t=>{let u={displayName:t.payload.data().displayName,studentId:t.payload.data().studentId,phone:t.payload.data().phone,email:t.payload.data().email,amountPayment:e.amountPayment,amount:e.amount,promiseDate:e.promiseDate};this.usersListCVByRDetalle.some(m=>m.studentId===t.payload.data().studentId)||this.usersListCVByRDetalle.push(u)})}}createNestedTableData(n){this.routesList=[],this.usersList=[];for(let e=0;e<n.length;++e){n[e].key=e,n[e].expand=!1,n[e].routeName=n[e].passes[0].routeName;for(let t=0;t<n[e].passes.length;++t)n[e].passes[t].key=e,n[e].passes[t].customerName=n[e].customerName,this.usersList.push(n[e].passes[t])}this.routesList=n}onProductSelect(n){console.log("Selected Product ID:",n)}onProductSelectByRoute(n){this.routeIdSelected="",this.routes=[],this.routeSubscription=this.usersService.getBoardingPassRoute(n).pipe(G(this.stopSubscription$)).subscribe(e=>{this.routes=e,console.log(this.routes)})}onRouteSelectByRoute(n){this.routeIdSelected=n}submitForm(){this.rowDataPay=[];let n=this.validateForm.controls.id.value;this.getSubscriptions(n)}submitFormTurn(){this.rowDataPayTurn=[],this.TotalUsers=0;let n=this.validateFormTurn.controls.id.value,e=this.validateFormTurn.controls.turno.value;this.getSubscriptionsByTurn(n,e)}submitFormPase(){this.rowDataPay=[];let n=this.validateFormPase.controls.id.value;this.getSubscriptionsPase(n)}submitFormAnticipos(){this.usersListA=[];let n=this.validateFormAnticipos.controls.id.value;this.getSubscriptionsAnticipos(n)}submitFormCV(){this.usersListCV=[];let n=this.validateFormCV.controls.id.value;this.TotalMPP=0,this.getSubscriptionsCV(n)}submitFormCVByRoute(){let n=this.validateFormCVByRoute.controls.id.value;this.TotalMPByRoute=0,this.getSubscriptionsCVByRoute(n),this.usersListCVByRDetalle=[],this.FusersListCVByRDetalle=[]}onRowClicked(n){console.log("Row clicked:",n.data.uid),this.accountsSubscription=this.usersService.getUserInfo(n.data.uid).subscribe(e=>{this.signupForm.reset(),this.signupForm.controls.customerName.setValue(e.payload.data().customerName),this.signupForm.controls.defaultRound.setValue(e.payload.data().defaultRound),this.signupForm.controls.defaultRouteName.setValue(e.payload.data().defaultRouteName),this.signupForm.controls.displayName.setValue(e.payload.data().displayName),this.signupForm.controls.email.setValue(e.payload.data().email),this.signupForm.controls.firstName.setValue(e.payload.data().firstName),this.signupForm.controls.lastName.setValue(e.payload.data().lastName),this.signupForm.controls.phone.setValue(e.payload.data().phone),this.signupForm.controls.studentId.setValue(e.payload.data().studentId),this.isModalVisible=!0})}onRowClickedCV(n){console.log("Row clicked:",n.data.uid),this.accountsSubscription=this.usersService.getUserInfo(n.data.uid).subscribe(e=>{this.signupFormCV.reset(),this.signupFormCV.controls.customerName.setValue(e.payload.data().customerName),this.signupFormCV.controls.defaultRound.setValue(e.payload.data().defaultRound),this.signupFormCV.controls.defaultRouteName.setValue(e.payload.data().defaultRouteName),this.signupFormCV.controls.displayName.setValue(e.payload.data().displayName),this.signupFormCV.controls.email.setValue(e.payload.data().email),this.signupFormCV.controls.firstName.setValue(e.payload.data().firstName),this.signupFormCV.controls.lastName.setValue(e.payload.data().lastName),this.signupFormCV.controls.phone.setValue(e.payload.data().phone),this.signupFormCV.controls.studentId.setValue(e.payload.data().studentId),this.isModalVisibleCV=!0})}detalleCVbyR(){this.TotalMPByRoute==0?this.sendMessage("error","Se requiere seleccionar un producto y ruta para detallar."):this.FusersListCVByRDetalle=this.usersListCVByRDetalle}sendMessage(n,e){this.msg.create(n,e)}handleOK(){this.isModalVisible=!1,this.isModalVisibleCV=!1}handleCancel(){this.isModalVisible=!1,this.isModalVisibleCV=!1}};p.\u0275fac=function(e){return new(e||p)(A(se),A(K),A(de))},p.\u0275cmp=Q({type:p,selectors:[["ng-component"]],decls:196,vars:178,consts:[["agGrid",""],["agGrid1",""],["agGrid2",""],["agGrid3",""],["modalFooter",""],[2,"margin","buttom 15px"],[1,"site-page-header-ghost-wrapper"],[3,"nzGhost"],[1,"body"],["nzTitle","Pagos Por Producto / Servicio"],[2,"margin-bottom","10px"],["nz-form","","nzLayout","horizontal",3,"ngSubmit","formGroup"],["formControlName","id","nzAllowClear","","nzPlaceHolder","Seleccionar producto / servicio",2,"width","650px",3,"ngModelChange"],[4,"ngFor","ngForOf"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["id","myGridPaymentByProduct",1,"ag-theme-material",2,"width","100%","height","500px",3,"firstDataRendered","gridReady","columnDefs","defaultColDef","masterDetail","detailCellRendererParams","rowData","sideBar"],["nzTitle","Pagos por ruta"],["id","myGridByRoute",1,"ag-theme-material",2,"width","100%","height","500px",3,"firstDataRendered","gridReady","columnDefs","defaultColDef","masterDetail","detailCellRendererParams","rowData","sideBar"],["nzTitle","Pagos por turno"],["id","turn"],["nz-form","","nzLayout","horizontal",1,"horizontal-form",3,"ngSubmit","formGroup"],[1,"form-row"],[1,"form-item"],["formControlName","turno","nzAllowClear","","nzPlaceHolder","Turno",2,"width","100px"],["id","myGridPassByTurn",1,"ag-theme-material",2,"width","100%","height","500px",3,"firstDataRendered","gridReady","columnDefs","defaultColDef","masterDetail","sideBar","detailCellRendererParams","rowData"],["nzTitle","Pases de abordar"],["id","mygridBoardingPass",1,"ag-theme-material",2,"width","100%","height","500px",3,"firstDataRendered","gridReady","columnDefs","defaultColDef","rowData","rowGroupPanelShow","suppressDragLeaveHidesColumns","suppressMakeColumnVisibleAfterUnGroup","enableRangeSelection","animateRows"],["nzTitle","Anticipos"],["id","myGridAnticipos",1,"ag-theme-material",2,"width","100%","height","500px",3,"firstDataRendered","gridReady","rowClicked","columnDefs","defaultColDef","rowData","rowGroupPanelShow","suppressDragLeaveHidesColumns","suppressMakeColumnVisibleAfterUnGroup","animateRows","rowSelection","suppressRowClickSelection"],["nzTitle","Cartera Vencida"],["nzTitle","Cartera General"],["id","myCarteraVencidaGrid",1,"ag-theme-material",2,"width","100%","height","500px",3,"firstDataRendered","gridReady","rowClicked","columnDefs","defaultColDef","rowData","rowGroupPanelShow","suppressDragLeaveHidesColumns","suppressMakeColumnVisibleAfterUnGroup","animateRows","rowSelection","suppressRowClickSelection"],["nzTitle","Cartera Vendia por Ruta"],["formControlName","routeId","nzAllowClear","","nzPlaceHolder","Seleccionar la ruta ",2,"width","450px",3,"ngModelChange"],["id","myCarteraVencidaByRGrid",1,"ag-theme-material",2,"width","100%","height","500px",3,"firstDataRendered","gridReady","rowClicked","columnDefs","defaultColDef","rowData","rowGroupPanelShow","suppressDragLeaveHidesColumns","suppressMakeColumnVisibleAfterUnGroup","animateRows","rowSelection","suppressRowClickSelection"],[2,"margin-top","10px","margin-bottom","10 px"],[2,"margin-top","10px"],["id","myCarteraVencidaByRDetalleGrid",1,"ag-theme-material",2,"width","100%","height","500px",3,"gridReady","columnDefs","defaultColDef","rowData","rowSelection","suppressRowClickSelection"],["nzTitle","Datos Pase de Abordar - Anticipo","nzWidth","500px",3,"nzVisibleChange","nzOnCancel","nzVisible","nzFooter"],["nz-form","",3,"formGroup"],[3,"nzSm","nzXs"],["nzTitle","Datos Pase de Abordar  - Cartera Vencida","nzWidth","500px",3,"nzVisibleChange","nzOnCancel","nzVisible","nzFooter"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon","","nzType","shopping"]],template:function(e,t){if(e&1){let u=S();a(0,"div",5)(1,"div",6)(2,"nz-page-header",7)(3,"nz-page-header-title"),s(4,"Reportes"),r(),z(5,"nz-page-header-subtitle"),r(),a(6,"div",8)(7,"nz-tabset")(8,"nz-tab",9)(9,"div",10)(10,"form",11),g("ngSubmit",function(){return h(u),f(t.submitForm())}),a(11,"nz-select",12),g("ngModelChange",function(m){return h(u),f(t.onProductSelect(m))}),C(12,Ta,4,4,"div",13),r(),a(13,"button",14),g("click",function(){return h(u),f(t.submitForm())}),s(14,"Aceptar"),r()()(),a(15,"div")(16,"ag-grid-angular",15,0),g("firstDataRendered",function(m){return h(u),f(t.onFirstDataRendered(m))})("gridReady",function(m){return h(u),f(t.onGridReady(m))}),r()()(),a(18,"nz-tab",16)(19,"ag-grid-angular",17,1),g("firstDataRendered",function(m){return h(u),f(t.onFirstDataRendered(m))})("gridReady",function(m){return h(u),f(t.onGridReady(m))}),r()(),a(21,"nz-tab",18)(22,"div",19)(23,"div",10)(24,"form",20),g("ngSubmit",function(){return h(u),f(t.submitFormTurn())}),a(25,"div",21)(26,"div",22)(27,"nz-select",12),g("ngModelChange",function(m){return h(u),f(t.onProductSelect(m))}),C(28,Fa,4,4,"div",13),r()(),a(29,"div",22)(30,"nz-select",23),C(31,Na,4,3,"div",13),r()(),a(32,"div",22)(33,"button",14),g("click",function(){return h(u),f(t.submitFormTurn())}),s(34,"Aceptar"),r()()()(),a(35,"div",21),s(36),r()(),a(37,"div")(38,"ag-grid-angular",24,1),g("firstDataRendered",function(m){return h(u),f(t.onFirstDataRendered(m))})("gridReady",function(m){return h(u),f(t.onGridReady(m))}),r()()()(),a(40,"nz-tab",25)(41,"div",10)(42,"form",11),g("ngSubmit",function(){return h(u),f(t.submitFormPase())}),a(43,"nz-select",12),g("ngModelChange",function(m){return h(u),f(t.onProductSelect(m))}),C(44,Ia,4,4,"div",13),r(),a(45,"button",14),g("click",function(){return h(u),f(t.submitForm())}),s(46,"Aceptar"),r()()(),a(47,"div")(48,"ag-grid-angular",26,2),g("firstDataRendered",function(m){return h(u),f(t.onFirstDataRendered(m))})("gridReady",function(m){return h(u),f(t.onGridReady(m))}),r()()(),a(50,"nz-tab",27)(51,"div",10)(52,"form",11),g("ngSubmit",function(){return h(u),f(t.submitFormAnticipos())}),a(53,"nz-select",12),g("ngModelChange",function(m){return h(u),f(t.onProductSelect(m))}),C(54,Ra,4,4,"div",13),r(),a(55,"button",14),g("click",function(){return h(u),f(t.submitFormAnticipos())}),s(56,"Aceptar"),r()()(),a(57,"div")(58,"ag-grid-angular",28,2),g("firstDataRendered",function(m){return h(u),f(t.onFirstDataRendered(m))})("gridReady",function(m){return h(u),f(t.onGridReady(m))})("rowClicked",function(m){return h(u),f(t.onRowClicked(m))}),r()()(),a(60,"nz-tab",29)(61,"nz-tabset")(62,"nz-tab",30)(63,"div",10)(64,"form",11),g("ngSubmit",function(){return h(u),f(t.submitFormCV())}),a(65,"nz-select",12),g("ngModelChange",function(m){return h(u),f(t.onProductSelect(m))}),C(66,ka,4,4,"div",13),r(),a(67,"button",14),g("click",function(){return h(u),f(t.submitFormCV())}),s(68,"Aceptar"),r()(),a(69,"div",21),s(70),E(71,"currency"),r()(),a(72,"div")(73,"ag-grid-angular",31,2),g("firstDataRendered",function(m){return h(u),f(t.onFirstDataRendered(m))})("gridReady",function(m){return h(u),f(t.onGridReady(m))})("rowClicked",function(m){return h(u),f(t.onRowClickedCV(m))}),r()()(),a(75,"nz-tab",32)(76,"div",10)(77,"form",11),g("ngSubmit",function(){return h(u),f(t.submitFormCVByRoute())}),a(78,"nz-select",12),g("ngModelChange",function(m){return h(u),f(t.onProductSelectByRoute(m))}),C(79,Ma,4,4,"div",13),r(),a(80,"nz-select",33),g("ngModelChange",function(m){return h(u),f(t.onRouteSelectByRoute(m))}),C(81,Ua,4,3,"div",13),r(),a(82,"button",14),g("click",function(){return h(u),f(t.submitFormCVByRoute())}),s(83,"Aceptar"),r()(),a(84,"div",21),s(85),E(86,"currency"),r()(),a(87,"div")(88,"ag-grid-angular",34,2),g("firstDataRendered",function(m){return h(u),f(t.onFirstDataRendered(m))})("gridReady",function(m){return h(u),f(t.onGridReady(m))})("rowClicked",function(m){return h(u),f(t.onRowClickedCV(m))}),r()(),a(90,"div",35)(91,"button",14),g("click",function(){return h(u),f(t.detalleCVbyR())}),s(92,"Mostrar Detalle"),r()(),a(93,"div",36)(94,"ag-grid-angular",37,3),g("gridReady",function(m){return h(u),f(t.onGridReadyD(m))}),r()()()()()()()(),a(96,"nz-modal",38),I("nzVisibleChange",function(m){return h(u),N(t.isModalVisible,m)||(t.isModalVisible=m),f(m)}),g("nzOnCancel",function(){return h(u),f(t.handleCancel())}),a(97,"div")(98,"form",39)(99,"nz-form-item")(100,"nz-form-label",40),s(101,"Empresa:"),r(),a(102,"nz-form-control",40),s(103),r()(),a(104,"nz-form-item")(105,"nz-form-label",40),s(106,"Turno:"),r(),a(107,"nz-form-control",40),s(108),r()(),a(109,"nz-form-item")(110,"nz-form-label",40),s(111,"Ruta:"),r(),a(112,"nz-form-control",40),s(113),r()(),a(114,"nz-form-item")(115,"nz-form-label",40),s(116,"Display:"),r(),a(117,"nz-form-control",40),s(118),r()(),a(119,"nz-form-item")(120,"nz-form-label",40),s(121,"Correo:"),r(),a(122,"nz-form-control",40),s(123),r()(),a(124,"nz-form-item")(125,"nz-form-label",40),s(126,"Nombre:"),r(),a(127,"nz-form-control",40),s(128),r()(),a(129,"nz-form-item")(130,"nz-form-label",40),s(131,"Apellidos:"),r(),a(132,"nz-form-control",40),s(133),r()(),a(134,"nz-form-item")(135,"nz-form-label",40),s(136,"Tel\xE9fono:"),r(),a(137,"nz-form-control",40),s(138),r()(),a(139,"nz-form-item")(140,"nz-form-label",40),s(141,"Matricula:"),r(),a(142,"nz-form-control",40),s(143),r()()()(),C(144,La,2,0,"ng-template",null,4,P),r(),a(146,"nz-modal",41),I("nzVisibleChange",function(m){return h(u),N(t.isModalVisibleCV,m)||(t.isModalVisibleCV=m),f(m)}),g("nzOnCancel",function(){return h(u),f(t.handleCancel())}),a(147,"div")(148,"form",39)(149,"nz-form-item")(150,"nz-form-label",40),s(151,"Empresa:"),r(),a(152,"nz-form-control",40),s(153),r()(),a(154,"nz-form-item")(155,"nz-form-label",40),s(156,"Turno:"),r(),a(157,"nz-form-control",40),s(158),r()(),a(159,"nz-form-item")(160,"nz-form-label",40),s(161,"Ruta:"),r(),a(162,"nz-form-control",40),s(163),r()(),a(164,"nz-form-item")(165,"nz-form-label",40),s(166,"Display:"),r(),a(167,"nz-form-control",40),s(168),r()(),a(169,"nz-form-item")(170,"nz-form-label",40),s(171,"Correo:"),r(),a(172,"nz-form-control",40),s(173),r()(),a(174,"nz-form-item")(175,"nz-form-label",40),s(176,"Nombre:"),r(),a(177,"nz-form-control",40),s(178),r()(),a(179,"nz-form-item")(180,"nz-form-label",40),s(181,"Apellidos:"),r(),a(182,"nz-form-control",40),s(183),r()(),a(184,"nz-form-item")(185,"nz-form-label",40),s(186,"Tel\xE9fono:"),r(),a(187,"nz-form-control",40),s(188),r()(),a(189,"nz-form-item")(190,"nz-form-label",40),s(191,"Matricula:"),r(),a(192,"nz-form-control",40),s(193),r()()()(),C(194,Aa,2,0,"ng-template",null,4,P),r()()}if(e&2){let u=w(145);o(2),d("nzGhost",!1),o(8),d("formGroup",t.validateForm),o(2),d("ngForOf",t.products),o(4),d("columnDefs",t.columnDefsPagos)("defaultColDef",t.defaultColDef)("masterDetail",!0)("detailCellRendererParams",t.detailCellRendererParamsPagos)("rowData",t.rowDataPay)("sideBar",t.sideBar),o(3),d("columnDefs",t.columnDefsPagos)("defaultColDef",t.defaultColDef)("masterDetail",!0)("detailCellRendererParams",t.detailCellRendererParamsPagos)("rowData",t.rowData)("sideBar",t.sideBar),o(5),d("formGroup",t.validateFormTurn),o(4),d("ngForOf",t.products),o(3),d("ngForOf",t.shift),o(5),b(" Usuarios totales: ",t.TotalUsers," "),o(2),d("columnDefs",t.columnDefsPagos)("defaultColDef",t.defaultColDef)("masterDetail",!0)("sideBar",t.sideBar)("detailCellRendererParams",t.detailCellRendererParamsPagos)("rowData",t.rowDataPayTurn),o(4),d("formGroup",t.validateFormPase),o(2),d("ngForOf",t.products),o(4),d("columnDefs",t.usersColumnDefs)("defaultColDef",t.defaultColDef)("rowData",t.usersList)("rowGroupPanelShow","always")("suppressDragLeaveHidesColumns",!0)("suppressMakeColumnVisibleAfterUnGroup",!0)("enableRangeSelection",!0)("animateRows",!0),o(4),d("formGroup",t.validateFormAnticipos),o(2),d("ngForOf",t.products),o(4),d("columnDefs",t.usersColumnDefsAnticipo)("defaultColDef",t.defaultColDef)("rowData",t.usersListA)("rowGroupPanelShow","always")("suppressDragLeaveHidesColumns",!0)("suppressMakeColumnVisibleAfterUnGroup",!0)("animateRows",!0)("rowSelection",t.rowSelection)("suppressRowClickSelection",!0),o(6),d("formGroup",t.validateFormCV),o(2),d("ngForOf",t.products),o(4),b(" Total monto pendiente pago: ",M(71,172,t.TotalMPP,"USD")," "),o(3),d("columnDefs",t.usersColumnDefsCV)("defaultColDef",t.defaultColDef)("rowData",t.usersListCV)("rowGroupPanelShow","always")("suppressDragLeaveHidesColumns",!0)("suppressMakeColumnVisibleAfterUnGroup",!0)("animateRows",!0)("rowSelection",t.rowSelection)("suppressRowClickSelection",!0),o(4),d("formGroup",t.validateFormCVByRoute),o(2),d("ngForOf",t.products),o(2),d("ngForOf",t.routes),o(4),b(" Total monto pendiente pago: ",M(86,175,t.TotalMPByRoute,"USD")," "),o(3),d("columnDefs",t.usersColumnDefsCV)("defaultColDef",t.defaultColDef)("rowData",t.usersListCVByR)("rowGroupPanelShow","always")("suppressDragLeaveHidesColumns",!0)("suppressMakeColumnVisibleAfterUnGroup",!0)("animateRows",!0)("rowSelection",t.rowSelection)("suppressRowClickSelection",!0),o(6),d("columnDefs",t.usersColumnDefsCVDetalle)("defaultColDef",t.defaultColDef)("rowData",t.FusersListCVByRDetalle)("rowSelection",t.rowSelection)("suppressRowClickSelection",!0),o(2),F("nzVisible",t.isModalVisible),d("nzFooter",u),o(2),d("formGroup",t.signupForm),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupForm.get("customerName").value),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupForm.get("defaultRound").value),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupForm.get("defaultRouteName").value),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupForm.get("displayName").value),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupForm.get("email").value),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupForm.get("firstName").value),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupForm.get("lastName").value),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupForm.get("phone").value),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupForm.get("studentId").value),o(3),F("nzVisible",t.isModalVisibleCV),d("nzFooter",u),o(2),d("formGroup",t.signupFormCV),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupFormCV.get("customerName").value),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupFormCV.get("defaultRound").value),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupFormCV.get("defaultRouteName").value),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupFormCV.get("displayName").value),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupFormCV.get("email").value),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupFormCV.get("firstName").value),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupFormCV.get("lastName").value),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupFormCV.get("phone").value),o(2),d("nzSm",6)("nzXs",24),o(2),d("nzSm",14)("nzXs",24),o(),v(t.signupFormCV.get("studentId").value)}},dependencies:[ie,qe,ce,pe,ue,fe,he,_e,ke,ve,Ce,ge,ze,De,ye,xe,be,Se,re,ne,ae,oe,le,Oe,Be,Ie],styles:[".footer[_ngcontent-%COMP%]{height:100%!important;position:absolute;padding:0 25px;display:flex;justify-content:space-between}.body[_ngcontent-%COMP%]{overflow-y:auto;padding:15px 25px;position:relative;width:100%}.horizontal-form[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.form-row[_ngcontent-%COMP%]{display:flex;flex-direction:row}.form-item[_ngcontent-%COMP%]{margin-right:10px}"]});let l=p;return l})();var Hr=(()=>{let p=class p{};p.\u0275fac=function(e){return new(e||p)},p.\u0275cmp=Q({type:p,selectors:[["ng-component"]],decls:0,vars:0,template:function(e,t){},encapsulation:2});let l=p;return l})();export{vr as a,Tr as b,Xr as c,Hr as d};
