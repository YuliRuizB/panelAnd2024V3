import{a as X}from"./chunk-53SP3MMI.js";import{a as W}from"./chunk-HIHLAMHX.js";import{a as J,b as K}from"./chunk-UG4UGUXC.js";import{a as R}from"./chunk-LES3IH4G.js";import{a as $}from"./chunk-N73LEDZ7.js";import{a as B,c as H,f as U,g as q,h as G,j as Z}from"./chunk-Z3V3S6TE.js";import{$ as E,Ca as h,Ea as p,Fb as T,P as y,Pd as j,Qe as F,R as D,Ra as e,Sa as t,Ta as o,Vb as A,Ve as O,Wb as L,We as P,Z as f,ab as v,c as x,hf as Q,ib as C,jb as b,kb as I,lb as S,m as u,mb as a,nb as _,ob as M,pb as N,sa as l,sf as V,ta as g,xa as w,ze as k}from"./chunk-Y43Y5JPN.js";import{a as z}from"./chunk-SIAVTO45.js";var te=["map"];function ie(m,r){m&1&&o(0,"i",16)}function ne(m,r){m&1&&o(0,"i",46)}function ae(m,r){m&1&&o(0,"i",46)}function oe(m,r){m&1&&o(0,"i",18)}function me(m,r){if(m&1&&(e(0,"div",42),h(1,ie,1,0,"i",43)(2,ne,1,0,"i",44)(3,ae,1,0,"i",44)(4,oe,1,0,"i",45),t()),m&2){let d=v().$implicit;l(),p("ngIf",d.type=="access"),l(),p("ngIf",d.type=="Attached file"),l(),p("ngIf",d.type=="Commented"),l(),p("ngIf",d.type=="duplicate")}}function re(m,r){if(m&1&&(e(0,"nz-timeline-item",37)(1,"div",38)(2,"h5",39),a(3),t(),e(4,"p",8)(5,"span",40),a(6),t(),e(7,"span",27),a(8),t()(),e(9,"span",41),o(10,"i",24),e(11,"span",27),a(12),t()()(),h(13,me,5,4,"ng-template",null,2,T),t()),m&2){let d=r.$implicit,i=S(14),n=v();p("nzDot",i),l(3),_(d.studentName),l(3),N("",d.vehicle," - ",d.route,""),l(2),M(" ",d.studentId,""),l(4),_(n.formatDate(d.created))}}var be=(()=>{let r=class r{constructor(i,n){this.logisticsService=i,this.zone=n,this.lat=37.75,this.lng=-122.41,this.loading=!1,this.authService=f(k),this.infoSegment=[],this.accountsService=f(U),this.stopSubscription$=new x,this.authService.user.subscribe(c=>{this.user=c,this.user!==null&&this.user!==void 0&&this.user.idSegment!==void 0&&this.accountsService.getSegmentLevel(this.user.idSegment).pipe(y(this.stopSubscription$),u(s=>{let Y=s.payload.id,ee=s.payload.data();return z({id:Y},ee)}),D(s=>(this.infoSegment=s,s))).subscribe()}),this.markers=[],this.startDate=Q(),this.endDate=F()}ngOnInit(){this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1?this.markers=this.logisticsService.getMarkersByCustomer(this.startDate,this.endDate,this.user.customerId):this.markers=this.logisticsService.getMarkers(this.startDate,this.endDate)}ngAfterViewInit(){}ngOnDestroy(){}initializeMap(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(i=>{this.lat=i.coords.latitude,this.lng=i.coords.longitude,this.map.flyTo({center:[this.lng,this.lat]})}),this.buildMap()}formatDate(i){return O(P(i.seconds),"HH:mm",{locale:W})}buildMap(){}flyTo(i){this.map.flyTo({center:i.geometry.coordinates})}loadMap(){}loadData(){this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1?this.logisticsService.getActivityLogByCustomer(this.startDate,this.endDate,this.user.customerId).pipe(u(i=>i.map(n=>{let c=n.payload.doc.data(),s=n.payload.doc.id;return c}))).subscribe(i=>{console.log(i),this.rowData=i,this.activityList=this.rowData.slice(0,5),this.chartData=this.rowData.map(n=>({country:n.vehicle,visits:n.studentId}))}):this.logisticsService.getActivityLog(this.startDate,this.endDate).pipe(u(i=>i.map(n=>{let c=n.payload.doc.data(),s=n.payload.doc.id;return c}))).subscribe(i=>{console.log(i),this.rowData=i,this.activityList=this.rowData.slice(0,5),this.chartData=this.rowData.map(n=>({country:n.vehicle,visits:n.studentId}))})}onGridReady(i){this.gridApi=i.api,this.gridColumnApi=i.columnApi}};r.\u0275fac=function(n){return new(n||r)(g(X),g(w))},r.\u0275cmp=E({type:r,selectors:[["app-main"]],viewQuery:function(n,c){if(n&1&&C(te,7),n&2){let s;b(s=I())&&(c.mapElement=s.first)}},decls:89,vars:4,consts:[["projectCompletionDropDown","nzDropdownMenu"],["map",""],["dotTemplate",""],[1,"page-header"],[1,"d-md-flex","align-items-md-center","justify-content-between"],[1,"media","m-v-10","align-items-center"],["nz-icon","user","nz-size","50","nz-src","assets/images/avatars/thumb-3.jpg",2,"background-color","white","color","#4F6F57"],[1,"media-body","m-l-15"],[1,"m-b-0"],[1,"text-gray"],[1,"d-md-flex","align-items-center","d-none"],[1,"media","align-items-center","m-r-40","m-v-5"],[1,"font-size-27"],["nz-icon","","theme","outline",1,"text-primary"],[1,"d-flex","align-items-center","m-l-10"],[1,"m-b-0","m-r-5"],["nz-icon","","theme","outline",1,"text-success"],[1,"media","align-items-center","m-v-5"],["nz-icon","","theme","outline",1,"text-danger"],[1,"row"],[1,"col-lg-9"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-0"],["nz-dropdown","",1,"text-dark","font-size-20",3,"nzTrigger","nzPlacement","nzDropdownMenu"],["nz-icon","","theme","outline"],["nz-menu",""],["nz-menu-item",""],[1,"m-l-5"],[1,"d-md-flex","justify-content-space","m-t-50"],["id","chartdiv",2,"width","100%","height","500px"],[1,"col-lg-3"],[1,"m-t-40"],[1,"overflow-y-auto","p-l-10","p-t-15"],[3,"nzDot",4,"ngFor","ngForOf"],[1,"col-lg-12"],[1,"m-t-30"],["id","map",1,"match-parent"],[3,"nzDot"],[1,"m-l-20"],[1,"m-b-5"],[1,"font-weight-semibold"],[1,"text-muted","font-size-13"],[1,"font-size-20","p-5"],["class","text-success","nz-icon","","theme","outline",4,"ngIf"],["class","text-info","nz-icon","","theme","outline",4,"ngIf"],["class","text-danger","nz-icon","","theme","outline",4,"ngIf"],["nz-icon","","theme","outline",1,"text-info"]],template:function(n,c){if(n&1&&(e(0,"div",3)(1,"div",4)(2,"div",5),o(3,"nz-avatar",6),e(4,"div",7)(5,"h4",8),a(6,"Seguimiento de actividades"),t(),e(7,"span",9),a(8,"Sistema de monitoreo"),t()()(),e(9,"div",10)(10,"div",11)(11,"div",12),o(12,"i",13),t(),e(13,"div",14)(14,"h2",15),a(15,"0"),t(),e(16,"span",9),a(17,"Veh\xEDculos"),t()()(),e(18,"div",11)(19,"div",12),o(20,"i",16),t(),e(21,"div",14)(22,"h2",15),a(23,"0"),t(),e(24,"span",9),a(25,"Acceso"),t()()(),e(26,"div",17)(27,"div",12),o(28,"i",18),t(),e(29,"div",14)(30,"h2",15),a(31,"0"),t(),e(32,"span",9),a(33,"Negados"),t()()()()()(),e(34,"div",19)(35,"div",20)(36,"nz-card")(37,"div",21)(38,"h5",22),a(39,"Diagrama de actividad "),t(),e(40,"div")(41,"a",23),o(42,"i",24),t(),e(43,"nz-dropdown-menu",null,0)(45,"ul",25)(46,"li",26),o(47,"i",24),e(48,"span",27),a(49,"Matutino"),t()(),e(50,"li",26),o(51,"i",24),e(52,"span",27),a(53,"Vespertino"),t()(),e(54,"li",26),o(55,"i",24),e(56,"span",27),a(57,"Ayer"),t()(),e(58,"li",26),o(59,"i",24),e(60,"span",27),a(61,"Anti\xE9r"),t()()()()()(),e(62,"div",28),o(63,"div",29),t()()(),e(64,"div",30)(65,"nz-card")(66,"div",21)(67,"h5",22),a(68,"Actividad"),t()(),e(69,"div",31)(70,"div",32)(71,"nz-timeline"),h(72,re,15,6,"nz-timeline-item",33),t()()()()()(),e(73,"div",19)(74,"div",34)(75,"nz-card")(76,"div",21)(77,"h5",22),a(78,"Informaci\xF3n detallada"),t()(),o(79,"div",35),t()()(),e(80,"div",19)(81,"div",34)(82,"nz-card")(83,"div",21)(84,"h5",22),a(85,"Mapa"),t()(),e(86,"div",35),o(87,"div",36,1),t()()()()),n&2){let s=S(44);l(41),p("nzTrigger","click")("nzPlacement","bottomRight")("nzDropdownMenu",s),l(31),p("ngForOf",c.activityList)}},dependencies:[A,L,j,R,H,B,q,G,Z,V,$,J,K],styles:[".match-parent[_ngcontent-%COMP%]{width:100%!important;height:600px!important;background-color:#f6f6f4}"]});let m=r;return m})();export{be as a};
