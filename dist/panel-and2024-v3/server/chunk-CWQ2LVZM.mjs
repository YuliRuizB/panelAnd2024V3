import './polyfills.server.mjs';
import{a as xe,c as d,e as ce,f as _}from"./chunk-H6KHSOBK.mjs";var G=_((Pi,le)=>{"use strict";var Xe=d("events").EventEmitter,Je=d("util").inherits;function g(e){if(typeof e=="string"&&(e=Buffer.from(e)),!Buffer.isBuffer(e))throw new TypeError("The needle has to be a String or a Buffer.");let i=e.length;if(i===0)throw new Error("The needle cannot be an empty String/Buffer.");if(i>256)throw new Error("The needle cannot have a length bigger than 256.");this.maxMatches=1/0,this.matches=0,this._occ=new Array(256).fill(i),this._lookbehind_size=0,this._needle=e,this._bufpos=0,this._lookbehind=Buffer.alloc(i);for(var t=0;t<i-1;++t)this._occ[e[t]]=i-1-t}Je(g,Xe);g.prototype.reset=function(){this._lookbehind_size=0,this.matches=0,this._bufpos=0};g.prototype.push=function(e,i){Buffer.isBuffer(e)||(e=Buffer.from(e,"binary"));let t=e.length;this._bufpos=i||0;let r;for(;r!==t&&this.matches<this.maxMatches;)r=this._sbmh_feed(e);return r};g.prototype._sbmh_feed=function(e){let i=e.length,t=this._needle,r=t.length,n=t[r-1],s=-this._lookbehind_size,h;if(s<0){for(;s<0&&s<=i-r;){if(h=this._sbmh_lookup_char(e,s+r-1),h===n&&this._sbmh_memcmp(e,s,r-1))return this._lookbehind_size=0,++this.matches,this.emit("info",!0),this._bufpos=s+r;s+=this._occ[h]}if(s<0)for(;s<0&&!this._sbmh_memcmp(e,s,i-s);)++s;if(s>=0)this.emit("info",!1,this._lookbehind,0,this._lookbehind_size),this._lookbehind_size=0;else{let f=this._lookbehind_size+s;return f>0&&this.emit("info",!1,this._lookbehind,0,f),this._lookbehind.copy(this._lookbehind,0,f,this._lookbehind_size-f),this._lookbehind_size-=f,e.copy(this._lookbehind,this._lookbehind_size),this._lookbehind_size+=i,this._bufpos=i,i}}if(s+=(s>=0)*this._bufpos,e.indexOf(t,s)!==-1)return s=e.indexOf(t,s),++this.matches,s>0?this.emit("info",!0,e,this._bufpos,s):this.emit("info",!0),this._bufpos=s+r;for(s=i-r;s<i&&(e[s]!==t[0]||Buffer.compare(e.subarray(s,s+i-s),t.subarray(0,i-s))!==0);)++s;return s<i&&(e.copy(this._lookbehind,0,s,s+(i-s)),this._lookbehind_size=i-s),s>0&&this.emit("info",!1,e,this._bufpos,s<i?s:i),this._bufpos=i,i};g.prototype._sbmh_lookup_char=function(e,i){return i<0?this._lookbehind[this._lookbehind_size+i]:e[i]};g.prototype._sbmh_memcmp=function(e,i,t){for(var r=0;r<t;++r)if(this._sbmh_lookup_char(e,i+r)!==this._needle[r])return!1;return!0};le.exports=g});var _e=_((Hi,de)=>{"use strict";var Qe=d("util").inherits,ue=d("stream").Readable;function X(e){ue.call(this,e)}Qe(X,ue);X.prototype._read=function(e){};de.exports=X});var R=_((vi,be)=>{"use strict";be.exports=function(i,t,r){if(!i||i[t]===void 0||i[t]===null)return r;if(typeof i[t]!="number"||isNaN(i[t]))throw new TypeError("Limit "+t+" is not a valid number");return i[t]}});var ge=_((zi,ye)=>{"use strict";var me=d("events").EventEmitter,Ze=d("util").inherits,pe=R(),ei=G(),ii=Buffer.from(`\r
\r
`),ti=/\r\n/g,si=/^([^:]+):[ \t]?([\x00-\xFF]+)?$/;function k(e){me.call(this),e=e||{};let i=this;this.nread=0,this.maxed=!1,this.npairs=0,this.maxHeaderPairs=pe(e,"maxHeaderPairs",2e3),this.maxHeaderSize=pe(e,"maxHeaderSize",80*1024),this.buffer="",this.header={},this.finished=!1,this.ss=new ei(ii),this.ss.on("info",function(t,r,n,s){r&&!i.maxed&&(i.nread+s-n>=i.maxHeaderSize?(s=i.maxHeaderSize-i.nread+n,i.nread=i.maxHeaderSize,i.maxed=!0):i.nread+=s-n,i.buffer+=r.toString("binary",n,s)),t&&i._finish()})}Ze(k,me);k.prototype.push=function(e){let i=this.ss.push(e);if(this.finished)return i};k.prototype.reset=function(){this.finished=!1,this.buffer="",this.header={},this.ss.reset()};k.prototype._finish=function(){this.buffer&&this._parseHeader(),this.ss.matches=this.ss.maxMatches;let e=this.header;this.header={},this.buffer="",this.finished=!0,this.nread=this.npairs=0,this.maxed=!1,this.emit("header",e)};k.prototype._parseHeader=function(){if(this.npairs===this.maxHeaderPairs)return;let e=this.buffer.split(ti),i=e.length,t,r;for(var n=0;n<i;++n){if(e[n].length===0)continue;if((e[n][0]==="	"||e[n][0]===" ")&&r){this.header[r][this.header[r].length-1]+=e[n];continue}let s=e[n].indexOf(":");if(s===-1||s===0)return;if(t=si.exec(e[n]),r=t[1].toLowerCase(),this.header[r]=this.header[r]||[],this.header[r].push(t[2]||""),++this.npairs===this.maxHeaderPairs)break}};ye.exports=k});var Q=_((qi,Be)=>{"use strict";var J=d("stream").Writable,ri=d("util").inherits,ni=G(),Ee=_e(),fi=ge(),hi=45,oi=Buffer.from("-"),ai=Buffer.from(`\r
`),xi=function(){};function b(e){if(!(this instanceof b))return new b(e);if(J.call(this,e),!e||!e.headerFirst&&typeof e.boundary!="string")throw new TypeError("Boundary required");typeof e.boundary=="string"?this.setBoundary(e.boundary):this._bparser=void 0,this._headerFirst=e.headerFirst,this._dashes=0,this._parts=0,this._finished=!1,this._realFinish=!1,this._isPreamble=!0,this._justMatched=!1,this._firstWrite=!0,this._inHeader=!0,this._part=void 0,this._cb=void 0,this._ignoreData=!1,this._partOpts={highWaterMark:e.partHwm},this._pause=!1;let i=this;this._hparser=new fi(e),this._hparser.on("header",function(t){i._inHeader=!1,i._part.emit("header",t)})}ri(b,J);b.prototype.emit=function(e){if(e==="finish"&&!this._realFinish){if(!this._finished){let i=this;process.nextTick(function(){if(i.emit("error",new Error("Unexpected end of multipart data")),i._part&&!i._ignoreData){let t=i._isPreamble?"Preamble":"Part";i._part.emit("error",new Error(t+" terminated early due to unexpected end of multipart data")),i._part.push(null),process.nextTick(function(){i._realFinish=!0,i.emit("finish"),i._realFinish=!1});return}i._realFinish=!0,i.emit("finish"),i._realFinish=!1})}}else J.prototype.emit.apply(this,arguments)};b.prototype._write=function(e,i,t){if(!this._hparser&&!this._bparser)return t();if(this._headerFirst&&this._isPreamble){this._part||(this._part=new Ee(this._partOpts),this.listenerCount("preamble")!==0?this.emit("preamble",this._part):this._ignore());let r=this._hparser.push(e);if(!this._inHeader&&r!==void 0&&r<e.length)e=e.slice(r);else return t()}this._firstWrite&&(this._bparser.push(ai),this._firstWrite=!1),this._bparser.push(e),this._pause?this._cb=t:t()};b.prototype.reset=function(){this._part=void 0,this._bparser=void 0,this._hparser=void 0};b.prototype.setBoundary=function(e){let i=this;this._bparser=new ni(`\r
--`+e),this._bparser.on("info",function(t,r,n,s){i._oninfo(t,r,n,s)})};b.prototype._ignore=function(){this._part&&!this._ignoreData&&(this._ignoreData=!0,this._part.on("error",xi),this._part.resume())};b.prototype._oninfo=function(e,i,t,r){let n,s=this,h=0,f,l=!0;if(!this._part&&this._justMatched&&i){for(;this._dashes<2&&t+h<r;)if(i[t+h]===hi)++h,++this._dashes;else{this._dashes&&(n=oi),this._dashes=0;break}if(this._dashes===2&&(t+h<r&&this.listenerCount("trailer")!==0&&this.emit("trailer",i.slice(t+h,r)),this.reset(),this._finished=!0,s._parts===0&&(s._realFinish=!0,s.emit("finish"),s._realFinish=!1)),this._dashes)return}this._justMatched&&(this._justMatched=!1),this._part||(this._part=new Ee(this._partOpts),this._part._read=function(B){s._unpause()},this._isPreamble&&this.listenerCount("preamble")!==0?this.emit("preamble",this._part):this._isPreamble!==!0&&this.listenerCount("part")!==0?this.emit("part",this._part):this._ignore(),this._isPreamble||(this._inHeader=!0)),i&&t<r&&!this._ignoreData&&(this._isPreamble||!this._inHeader?(n&&(l=this._part.push(n)),l=this._part.push(i.slice(t,r)),l||(this._pause=!0)):!this._isPreamble&&this._inHeader&&(n&&this._hparser.push(n),f=this._hparser.push(i.slice(t,r)),!this._inHeader&&f!==void 0&&f<r&&this._oninfo(!1,i,t+f,r))),e&&(this._hparser.reset(),this._isPreamble?this._isPreamble=!1:t!==r&&(++this._parts,this._part.on("end",function(){--s._parts===0&&(s._finished?(s._realFinish=!0,s.emit("finish"),s._realFinish=!1):s._unpause())})),this._part.push(null),this._part=void 0,this._ignoreData=!1,this._justMatched=!0,this._dashes=0)};b.prototype._unpause=function(){if(this._pause&&(this._pause=!1,this._cb)){let e=this._cb;this._cb=void 0,e()}};Be.exports=b});var N=_((Z,ke)=>{"use strict";var Ce=new TextDecoder("utf-8"),Fe=new Map([["utf-8",Ce],["utf8",Ce]]);function ci(e){let i;for(;;)switch(e){case"utf-8":case"utf8":return T.utf8;case"latin1":case"ascii":case"us-ascii":case"iso-8859-1":case"iso8859-1":case"iso88591":case"iso_8859-1":case"windows-1252":case"iso_8859-1:1987":case"cp1252":case"x-cp1252":return T.latin1;case"utf16le":case"utf-16le":case"ucs2":case"ucs-2":return T.utf16le;case"base64":return T.base64;default:if(i===void 0){i=!0,e=e.toLowerCase();continue}return T.other.bind(e)}}var T={utf8:(e,i)=>e.length===0?"":(typeof e=="string"&&(e=Buffer.from(e,i)),e.utf8Slice(0,e.length)),latin1:(e,i)=>e.length===0?"":typeof e=="string"?e:e.latin1Slice(0,e.length),utf16le:(e,i)=>e.length===0?"":(typeof e=="string"&&(e=Buffer.from(e,i)),e.ucs2Slice(0,e.length)),base64:(e,i)=>e.length===0?"":(typeof e=="string"&&(e=Buffer.from(e,i)),e.base64Slice(0,e.length)),other:(e,i)=>{if(e.length===0)return"";if(typeof e=="string"&&(e=Buffer.from(e,i)),Fe.has(Z.toString()))try{return Fe.get(Z).decode(e)}catch{}return typeof e=="string"?e:e.toString()}};function li(e,i,t){return e&&ci(t)(e,i)}ke.exports=li});var ie=_((Mi,Se)=>{"use strict";var W=N(),we=/%[a-fA-F0-9][a-fA-F0-9]/g,ui={"%00":"\0","%01":"","%02":"","%03":"","%04":"","%05":"","%06":"","%07":"\x07","%08":"\b","%09":"	","%0a":`
`,"%0A":`
`,"%0b":"\v","%0B":"\v","%0c":"\f","%0C":"\f","%0d":"\r","%0D":"\r","%0e":"","%0E":"","%0f":"","%0F":"","%10":"","%11":"","%12":"","%13":"","%14":"","%15":"","%16":"","%17":"","%18":"","%19":"","%1a":"","%1A":"","%1b":"\x1B","%1B":"\x1B","%1c":"","%1C":"","%1d":"","%1D":"","%1e":"","%1E":"","%1f":"","%1F":"","%20":" ","%21":"!","%22":'"',"%23":"#","%24":"$","%25":"%","%26":"&","%27":"'","%28":"(","%29":")","%2a":"*","%2A":"*","%2b":"+","%2B":"+","%2c":",","%2C":",","%2d":"-","%2D":"-","%2e":".","%2E":".","%2f":"/","%2F":"/","%30":"0","%31":"1","%32":"2","%33":"3","%34":"4","%35":"5","%36":"6","%37":"7","%38":"8","%39":"9","%3a":":","%3A":":","%3b":";","%3B":";","%3c":"<","%3C":"<","%3d":"=","%3D":"=","%3e":">","%3E":">","%3f":"?","%3F":"?","%40":"@","%41":"A","%42":"B","%43":"C","%44":"D","%45":"E","%46":"F","%47":"G","%48":"H","%49":"I","%4a":"J","%4A":"J","%4b":"K","%4B":"K","%4c":"L","%4C":"L","%4d":"M","%4D":"M","%4e":"N","%4E":"N","%4f":"O","%4F":"O","%50":"P","%51":"Q","%52":"R","%53":"S","%54":"T","%55":"U","%56":"V","%57":"W","%58":"X","%59":"Y","%5a":"Z","%5A":"Z","%5b":"[","%5B":"[","%5c":"\\","%5C":"\\","%5d":"]","%5D":"]","%5e":"^","%5E":"^","%5f":"_","%5F":"_","%60":"`","%61":"a","%62":"b","%63":"c","%64":"d","%65":"e","%66":"f","%67":"g","%68":"h","%69":"i","%6a":"j","%6A":"j","%6b":"k","%6B":"k","%6c":"l","%6C":"l","%6d":"m","%6D":"m","%6e":"n","%6E":"n","%6f":"o","%6F":"o","%70":"p","%71":"q","%72":"r","%73":"s","%74":"t","%75":"u","%76":"v","%77":"w","%78":"x","%79":"y","%7a":"z","%7A":"z","%7b":"{","%7B":"{","%7c":"|","%7C":"|","%7d":"}","%7D":"}","%7e":"~","%7E":"~","%7f":"\x7F","%7F":"\x7F","%80":"\x80","%81":"\x81","%82":"\x82","%83":"\x83","%84":"\x84","%85":"\x85","%86":"\x86","%87":"\x87","%88":"\x88","%89":"\x89","%8a":"\x8A","%8A":"\x8A","%8b":"\x8B","%8B":"\x8B","%8c":"\x8C","%8C":"\x8C","%8d":"\x8D","%8D":"\x8D","%8e":"\x8E","%8E":"\x8E","%8f":"\x8F","%8F":"\x8F","%90":"\x90","%91":"\x91","%92":"\x92","%93":"\x93","%94":"\x94","%95":"\x95","%96":"\x96","%97":"\x97","%98":"\x98","%99":"\x99","%9a":"\x9A","%9A":"\x9A","%9b":"\x9B","%9B":"\x9B","%9c":"\x9C","%9C":"\x9C","%9d":"\x9D","%9D":"\x9D","%9e":"\x9E","%9E":"\x9E","%9f":"\x9F","%9F":"\x9F","%a0":"\xA0","%A0":"\xA0","%a1":"\xA1","%A1":"\xA1","%a2":"\xA2","%A2":"\xA2","%a3":"\xA3","%A3":"\xA3","%a4":"\xA4","%A4":"\xA4","%a5":"\xA5","%A5":"\xA5","%a6":"\xA6","%A6":"\xA6","%a7":"\xA7","%A7":"\xA7","%a8":"\xA8","%A8":"\xA8","%a9":"\xA9","%A9":"\xA9","%aa":"\xAA","%Aa":"\xAA","%aA":"\xAA","%AA":"\xAA","%ab":"\xAB","%Ab":"\xAB","%aB":"\xAB","%AB":"\xAB","%ac":"\xAC","%Ac":"\xAC","%aC":"\xAC","%AC":"\xAC","%ad":"\xAD","%Ad":"\xAD","%aD":"\xAD","%AD":"\xAD","%ae":"\xAE","%Ae":"\xAE","%aE":"\xAE","%AE":"\xAE","%af":"\xAF","%Af":"\xAF","%aF":"\xAF","%AF":"\xAF","%b0":"\xB0","%B0":"\xB0","%b1":"\xB1","%B1":"\xB1","%b2":"\xB2","%B2":"\xB2","%b3":"\xB3","%B3":"\xB3","%b4":"\xB4","%B4":"\xB4","%b5":"\xB5","%B5":"\xB5","%b6":"\xB6","%B6":"\xB6","%b7":"\xB7","%B7":"\xB7","%b8":"\xB8","%B8":"\xB8","%b9":"\xB9","%B9":"\xB9","%ba":"\xBA","%Ba":"\xBA","%bA":"\xBA","%BA":"\xBA","%bb":"\xBB","%Bb":"\xBB","%bB":"\xBB","%BB":"\xBB","%bc":"\xBC","%Bc":"\xBC","%bC":"\xBC","%BC":"\xBC","%bd":"\xBD","%Bd":"\xBD","%bD":"\xBD","%BD":"\xBD","%be":"\xBE","%Be":"\xBE","%bE":"\xBE","%BE":"\xBE","%bf":"\xBF","%Bf":"\xBF","%bF":"\xBF","%BF":"\xBF","%c0":"\xC0","%C0":"\xC0","%c1":"\xC1","%C1":"\xC1","%c2":"\xC2","%C2":"\xC2","%c3":"\xC3","%C3":"\xC3","%c4":"\xC4","%C4":"\xC4","%c5":"\xC5","%C5":"\xC5","%c6":"\xC6","%C6":"\xC6","%c7":"\xC7","%C7":"\xC7","%c8":"\xC8","%C8":"\xC8","%c9":"\xC9","%C9":"\xC9","%ca":"\xCA","%Ca":"\xCA","%cA":"\xCA","%CA":"\xCA","%cb":"\xCB","%Cb":"\xCB","%cB":"\xCB","%CB":"\xCB","%cc":"\xCC","%Cc":"\xCC","%cC":"\xCC","%CC":"\xCC","%cd":"\xCD","%Cd":"\xCD","%cD":"\xCD","%CD":"\xCD","%ce":"\xCE","%Ce":"\xCE","%cE":"\xCE","%CE":"\xCE","%cf":"\xCF","%Cf":"\xCF","%cF":"\xCF","%CF":"\xCF","%d0":"\xD0","%D0":"\xD0","%d1":"\xD1","%D1":"\xD1","%d2":"\xD2","%D2":"\xD2","%d3":"\xD3","%D3":"\xD3","%d4":"\xD4","%D4":"\xD4","%d5":"\xD5","%D5":"\xD5","%d6":"\xD6","%D6":"\xD6","%d7":"\xD7","%D7":"\xD7","%d8":"\xD8","%D8":"\xD8","%d9":"\xD9","%D9":"\xD9","%da":"\xDA","%Da":"\xDA","%dA":"\xDA","%DA":"\xDA","%db":"\xDB","%Db":"\xDB","%dB":"\xDB","%DB":"\xDB","%dc":"\xDC","%Dc":"\xDC","%dC":"\xDC","%DC":"\xDC","%dd":"\xDD","%Dd":"\xDD","%dD":"\xDD","%DD":"\xDD","%de":"\xDE","%De":"\xDE","%dE":"\xDE","%DE":"\xDE","%df":"\xDF","%Df":"\xDF","%dF":"\xDF","%DF":"\xDF","%e0":"\xE0","%E0":"\xE0","%e1":"\xE1","%E1":"\xE1","%e2":"\xE2","%E2":"\xE2","%e3":"\xE3","%E3":"\xE3","%e4":"\xE4","%E4":"\xE4","%e5":"\xE5","%E5":"\xE5","%e6":"\xE6","%E6":"\xE6","%e7":"\xE7","%E7":"\xE7","%e8":"\xE8","%E8":"\xE8","%e9":"\xE9","%E9":"\xE9","%ea":"\xEA","%Ea":"\xEA","%eA":"\xEA","%EA":"\xEA","%eb":"\xEB","%Eb":"\xEB","%eB":"\xEB","%EB":"\xEB","%ec":"\xEC","%Ec":"\xEC","%eC":"\xEC","%EC":"\xEC","%ed":"\xED","%Ed":"\xED","%eD":"\xED","%ED":"\xED","%ee":"\xEE","%Ee":"\xEE","%eE":"\xEE","%EE":"\xEE","%ef":"\xEF","%Ef":"\xEF","%eF":"\xEF","%EF":"\xEF","%f0":"\xF0","%F0":"\xF0","%f1":"\xF1","%F1":"\xF1","%f2":"\xF2","%F2":"\xF2","%f3":"\xF3","%F3":"\xF3","%f4":"\xF4","%F4":"\xF4","%f5":"\xF5","%F5":"\xF5","%f6":"\xF6","%F6":"\xF6","%f7":"\xF7","%F7":"\xF7","%f8":"\xF8","%F8":"\xF8","%f9":"\xF9","%F9":"\xF9","%fa":"\xFA","%Fa":"\xFA","%fA":"\xFA","%FA":"\xFA","%fb":"\xFB","%Fb":"\xFB","%fB":"\xFB","%FB":"\xFB","%fc":"\xFC","%Fc":"\xFC","%fC":"\xFC","%FC":"\xFC","%fd":"\xFD","%Fd":"\xFD","%fD":"\xFD","%FD":"\xFD","%fe":"\xFE","%Fe":"\xFE","%fE":"\xFE","%FE":"\xFE","%ff":"\xFF","%Ff":"\xFF","%fF":"\xFF","%FF":"\xFF"};function De(e){return ui[e]}var O=0,Ae=1,ee=2,Le=3;function di(e){let i=[],t=O,r="",n=!1,s=!1,h=0,f="",l=e.length;for(var B=0;B<l;++B){let u=e[B];if(u==="\\"&&n)if(s)s=!1;else{s=!0;continue}else if(u==='"')if(s)s=!1;else{n?(n=!1,t=O):n=!0;continue}else if(s&&n&&(f+="\\"),s=!1,(t===ee||t===Le)&&u==="'"){t===ee?(t=Le,r=f.substring(1)):t=Ae,f="";continue}else if(t===O&&(u==="*"||u==="=")&&i.length){t=u==="*"?ee:Ae,i[h]=[f,void 0],f="";continue}else if(!n&&u===";"){t=O,r?(f.length&&(f=W(f.replace(we,De),"binary",r)),r=""):f.length&&(f=W(f,"binary","utf8")),i[h]===void 0?i[h]=f:i[h][1]=f,f="",++h;continue}else if(!n&&(u===" "||u==="	"))continue;f+=u}return r&&f.length?f=W(f.replace(we,De),"binary",r):f&&(f=W(f,"binary","utf8")),i[h]===void 0?f&&(i[h]=f):i[h][1]=f,i}Se.exports=di});var Pe=_((Ri,Te)=>{"use strict";Te.exports=function(i){if(typeof i!="string")return"";for(var t=i.length-1;t>=0;--t)switch(i.charCodeAt(t)){case 47:case 92:return i=i.slice(t+1),i===".."||i==="."?"":i}return i===".."||i==="."?"":i}});var qe=_((Ni,ze)=>{"use strict";var{Readable:ve}=d("stream"),{inherits:_i}=d("util"),bi=Q(),He=ie(),pi=N(),mi=Pe(),E=R(),yi=/^boundary$/i,gi=/^form-data$/i,Ei=/^charset$/i,Bi=/^filename$/i,Ci=/^name$/i;j.detect=/^multipart\/form-data/i;function j(e,i){let t,r,n=this,s,h=i.limits,f=i.isPartAFile||((C,a,x)=>a==="application/octet-stream"||x!==void 0),l=i.parsedConType||[],B=i.defCharset||"utf8",u=i.preservePath,fe={highWaterMark:i.fileHwm};for(t=0,r=l.length;t<r;++t)if(Array.isArray(l[t])&&yi.test(l[t][0])){s=l[t][1];break}function K(){A===0&&$&&!e._done&&($=!1,n.end())}if(typeof s!="string")throw new Error("Multipart: Boundary not found");let he=E(h,"fieldSize",1*1024*1024),U=E(h,"fileSize",1/0),Ie=E(h,"files",1/0),Ke=E(h,"fields",1/0),Ue=E(h,"parts",1/0),$e=E(h,"headerPairs",2e3),Ve=E(h,"headerSize",80*1024),oe=0,ae=0,A=0,H,v,$=!1;this._needDrain=!1,this._pause=!1,this._cb=void 0,this._nparts=0,this._boy=e;let Ye={boundary:s,maxHeaderPairs:$e,maxHeaderSize:Ve,partHwm:fe.highWaterMark,highWaterMark:i.highWaterMark};this.parser=new bi(Ye),this.parser.on("drain",function(){if(n._needDrain=!1,n._cb&&!n._pause){let C=n._cb;n._cb=void 0,C()}}).on("part",function C(a){if(++n._nparts>Ue)return n.parser.removeListener("part",C),n.parser.on("part",w),e.hitPartsLimit=!0,e.emit("partsLimit"),w(a);if(v){let x=v;x.emit("end"),x.removeAllListeners("end")}a.on("header",function(x){let F,z,c,q,M,L,S=0;if(x["content-type"]&&(c=He(x["content-type"][0]),c[0])){for(F=c[0].toLowerCase(),t=0,r=c.length;t<r;++t)if(Ei.test(c[t][0])){q=c[t][1].toLowerCase();break}}if(F===void 0&&(F="text/plain"),q===void 0&&(q=B),x["content-disposition"]){if(c=He(x["content-disposition"][0]),!gi.test(c[0]))return w(a);for(t=0,r=c.length;t<r;++t)Ci.test(c[t][0])?z=c[t][1]:Bi.test(c[t][0])&&(L=c[t][1],u||(L=mi(L)))}else return w(a);x["content-transfer-encoding"]?M=x["content-transfer-encoding"][0].toLowerCase():M="7bit";let V,Y;if(f(z,F,L)){if(oe===Ie)return e.hitFilesLimit||(e.hitFilesLimit=!0,e.emit("filesLimit")),w(a);if(++oe,e.listenerCount("file")===0){n.parser._ignore();return}++A;let o=new te(fe);H=o,o.on("end",function(){if(--A,n._pause=!1,K(),n._cb&&!n._needDrain){let p=n._cb;n._cb=void 0,p()}}),o._read=function(p){if(n._pause&&(n._pause=!1,n._cb&&!n._needDrain)){let m=n._cb;n._cb=void 0,m()}},e.emit("file",z,o,L,M,F),V=function(p){if((S+=p.length)>U){let m=U-S+p.length;m>0&&o.push(p.slice(0,m)),o.truncated=!0,o.bytesRead=U,a.removeAllListeners("data"),o.emit("limit");return}else o.push(p)||(n._pause=!0);o.bytesRead=S},Y=function(){H=void 0,o.push(null)}}else{if(ae===Ke)return e.hitFieldsLimit||(e.hitFieldsLimit=!0,e.emit("fieldsLimit")),w(a);++ae,++A;let o="",p=!1;v=a,V=function(m){if((S+=m.length)>he){let Ge=he-(S-m.length);o+=m.toString("binary",0,Ge),p=!0,a.removeAllListeners("data")}else o+=m.toString("binary")},Y=function(){v=void 0,o.length&&(o=pi(o,"binary",q)),e.emit("field",z,o,!1,p,M,F),--A,K()}}a._readableState.sync=!1,a.on("data",V),a.on("end",Y)}).on("error",function(x){H&&H.emit("error",x)})}).on("error",function(C){e.emit("error",C)}).on("finish",function(){$=!0,K()})}j.prototype.write=function(e,i){let t=this.parser.write(e);t&&!this._pause?i():(this._needDrain=!t,this._cb=i)};j.prototype.end=function(){let e=this;e.parser.writable?e.parser.end():e._boy._done||process.nextTick(function(){e._boy._done=!0,e._boy.emit("finish")})};function w(e){e.resume()}function te(e){ve.call(this,e),this.bytesRead=0,this.truncated=!1}_i(te,ve);te.prototype._read=function(e){};ze.exports=j});var Re=_((Wi,Me)=>{"use strict";var Fi=/\+/g,ki=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function se(){this.buffer=void 0}se.prototype.write=function(e){e=e.replace(Fi," ");let i="",t=0,r=0,n=e.length;for(;t<n;++t)this.buffer!==void 0?ki[e.charCodeAt(t)]?(this.buffer+=e[t],++r,this.buffer.length===2&&(i+=String.fromCharCode(parseInt(this.buffer,16)),this.buffer=void 0)):(i+="%"+this.buffer,this.buffer=void 0,--t):e[t]==="%"&&(t>r&&(i+=e.substring(r,t),r=t),this.buffer="",++r);return r<n&&this.buffer===void 0&&(i+=e.substring(r)),i};se.prototype.reset=function(){this.buffer=void 0};Me.exports=se});var We=_((Oi,Ne)=>{"use strict";var wi=Re(),D=N(),re=R(),Di=/^charset$/i;I.detect=/^application\/x-www-form-urlencoded/i;function I(e,i){let t=i.limits,r=i.parsedConType;this.boy=e,this.fieldSizeLimit=re(t,"fieldSize",1*1024*1024),this.fieldNameSizeLimit=re(t,"fieldNameSize",100),this.fieldsLimit=re(t,"fields",1/0);let n;for(var s=0,h=r.length;s<h;++s)if(Array.isArray(r[s])&&Di.test(r[s][0])){n=r[s][1].toLowerCase();break}n===void 0&&(n=i.defCharset||"utf8"),this.decoder=new wi,this.charset=n,this._fields=0,this._state="key",this._checkingBytes=!0,this._bytesKey=0,this._bytesVal=0,this._key="",this._val="",this._keyTrunc=!1,this._valTrunc=!1,this._hitLimit=!1}I.prototype.write=function(e,i){if(this._fields===this.fieldsLimit)return this.boy.hitFieldsLimit||(this.boy.hitFieldsLimit=!0,this.boy.emit("fieldsLimit")),i();let t,r,n,s=0,h=e.length;for(;s<h;)if(this._state==="key"){for(t=r=void 0,n=s;n<h;++n){if(this._checkingBytes||++s,e[n]===61){t=n;break}else if(e[n]===38){r=n;break}if(this._checkingBytes&&this._bytesKey===this.fieldNameSizeLimit){this._hitLimit=!0;break}else this._checkingBytes&&++this._bytesKey}if(t!==void 0)t>s&&(this._key+=this.decoder.write(e.toString("binary",s,t))),this._state="val",this._hitLimit=!1,this._checkingBytes=!0,this._val="",this._bytesVal=0,this._valTrunc=!1,this.decoder.reset(),s=t+1;else if(r!==void 0){++this._fields;let f,l=this._keyTrunc;if(r>s?f=this._key+=this.decoder.write(e.toString("binary",s,r)):f=this._key,this._hitLimit=!1,this._checkingBytes=!0,this._key="",this._bytesKey=0,this._keyTrunc=!1,this.decoder.reset(),f.length&&this.boy.emit("field",D(f,"binary",this.charset),"",l,!1),s=r+1,this._fields===this.fieldsLimit)return i()}else this._hitLimit?(n>s&&(this._key+=this.decoder.write(e.toString("binary",s,n))),s=n,(this._bytesKey=this._key.length)===this.fieldNameSizeLimit&&(this._checkingBytes=!1,this._keyTrunc=!0)):(s<h&&(this._key+=this.decoder.write(e.toString("binary",s))),s=h)}else{for(r=void 0,n=s;n<h;++n){if(this._checkingBytes||++s,e[n]===38){r=n;break}if(this._checkingBytes&&this._bytesVal===this.fieldSizeLimit){this._hitLimit=!0;break}else this._checkingBytes&&++this._bytesVal}if(r!==void 0){if(++this._fields,r>s&&(this._val+=this.decoder.write(e.toString("binary",s,r))),this.boy.emit("field",D(this._key,"binary",this.charset),D(this._val,"binary",this.charset),this._keyTrunc,this._valTrunc),this._state="key",this._hitLimit=!1,this._checkingBytes=!0,this._key="",this._bytesKey=0,this._keyTrunc=!1,this.decoder.reset(),s=r+1,this._fields===this.fieldsLimit)return i()}else this._hitLimit?(n>s&&(this._val+=this.decoder.write(e.toString("binary",s,n))),s=n,(this._val===""&&this.fieldSizeLimit===0||(this._bytesVal=this._val.length)===this.fieldSizeLimit)&&(this._checkingBytes=!1,this._valTrunc=!0)):(s<h&&(this._val+=this.decoder.write(e.toString("binary",s))),s=h)}i()};I.prototype.end=function(){this.boy._done||(this._state==="key"&&this._key.length>0?this.boy.emit("field",D(this._key,"binary",this.charset),"",this._keyTrunc,!1):this._state==="val"&&this.boy.emit("field",D(this._key,"binary",this.charset),D(this._val,"binary",this.charset),this._keyTrunc,this._valTrunc),this.boy._done=!0,this.boy.emit("finish"))};Ne.exports=I});var Ti=_((ji,P)=>{"use strict";var ne=d("stream").Writable,{inherits:Ai}=d("util"),Li=Q(),Oe=qe(),je=We(),Si=ie();function y(e){if(!(this instanceof y))return new y(e);if(typeof e!="object")throw new TypeError("Busboy expected an options-Object.");if(typeof e.headers!="object")throw new TypeError("Busboy expected an options-Object with headers-attribute.");if(typeof e.headers["content-type"]!="string")throw new TypeError("Missing Content-Type-header.");let r=e,{headers:i}=r,t=ce(r,["headers"]);this.opts=xe({autoDestroy:!1},t),ne.call(this,this.opts),this._done=!1,this._parser=this.getParserByHeaders(i),this._finished=!1}Ai(y,ne);y.prototype.emit=function(e){if(e==="finish"){if(this._done){if(this._finished)return}else{this._parser?.end();return}this._finished=!0}ne.prototype.emit.apply(this,arguments)};y.prototype.getParserByHeaders=function(e){let i=Si(e["content-type"]),t={defCharset:this.opts.defCharset,fileHwm:this.opts.fileHwm,headers:e,highWaterMark:this.opts.highWaterMark,isPartAFile:this.opts.isPartAFile,limits:this.opts.limits,parsedConType:i,preservePath:this.opts.preservePath};if(Oe.detect.test(i[0]))return new Oe(this,t);if(je.detect.test(i[0]))return new je(this,t);throw new Error("Unsupported Content-Type.")};y.prototype._write=function(e,i,t){this._parser.write(e,t)};P.exports=y;P.exports.default=y;P.exports.Busboy=y;P.exports.Dicer=Li});export{Ti as a};
