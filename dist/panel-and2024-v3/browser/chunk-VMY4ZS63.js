import{a as ti}from"./chunk-LNFN2S4L.js";import{a as vt}from"./chunk-NR4FHFAU.js";import{a as Ke}from"./chunk-DL2JTRHV.js";import{d as ni}from"./chunk-VMNDFVLP.js";import{c as Ze}from"./chunk-WOXUZFIP.js";import{a as qe}from"./chunk-U5FSPSXE.js";import{a as ri,b as ai}from"./chunk-4KJECQNL.js";import{a as Qe,c as ii,h as St,i as oi}from"./chunk-7DX4VOEH.js";import{B as Ge,C as Xe,D as Je,E as Ye,G as Ct,a as ie,c as He,d as Be,e as ht,g as Ee,h as Qt,k as de,m as Kt,n as ft,o as gt,s as Zt,t as ei,w as $e,z as We}from"./chunk-P4W5U2FV.js";import{$ as Gt,M as ge,P as J,Q as Y,R as Q,S as K,_ as ce,aa as Xt,b as se,c as f,d as M,da as ut,e as j,ea as Ti,fa as zt,g as it,h as dt,ha as fe,i as H,ja as Ce,k as B,la as Yt,m as $,pa as pe,q as A,qa as ue,sa as _t,t as G,u as X}from"./chunk-QRDPTFUJ.js";import{a as Jt,c as pt,d as _e}from"./chunk-DN7PPQ6G.js";import{a as ve,c as Se,d as Ue,f as je,g as be,h as xe,j as ye}from"./chunk-BOTI6TUZ.js";import{$b as k,Ab as Me,Ae as Wt,Af as ee,Be as W,Cb as jt,Cf as te,Ea as v,Eb as Ae,G as Te,Ga as m,Gb as Oe,He as nt,Ib as V,Ka as O,O as L,Pc as le,Q as Fe,Qd as me,U as ke,Ua as i,Va as o,Wa as c,X as Ve,Xa as Rt,Y as b,Ya as qt,_ as D,_a as C,ac as ae,bb as g,bc as Re,c as re,db as d,ec as ct,ga as z,gb as Ne,ha as h,l as Ot,m as w,ob as y,pb as s,qb as I,ra as Ie,rb as F,sa as l,sb as Ut,ta as x,ub as R,uc as Ht,vb as q,wb as U,xc as Bt,yc as $t,ye as N,zb as Pe,zf as Z}from"./chunk-WHASPTUY.js";import{a as T,b as he,f as wi,h as oe}from"./chunk-SIAVTO45.js";var si=(()=>{class r{constructor(e){this.afs=e}getSummarized(){return this.afs.collection("summarized").valueChanges()}setAccounts(){}static{this.\u0275fac=function(t){return new(t||r)(Ve(le))}}static{this.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Vi=(r,u,e)=>[r,u,e],Ii=()=>({size:"large"}),Ni=r=>["/accounts/edit",r,0],Pi=r=>["/accounts/edit",r,1],li=r=>["/accounts/edit",r,2],Di=r=>["/accounts/edit",r,3];function Li(r,u){r&1&&c(0,"nz-empty")}function ki(r,u){if(r&1&&c(0,"nz-avatar",28),r&2){let e=d().$implicit;m("nzSrc",e.imageUrl)}}function Mi(r,u){if(r&1){let e=C();i(0,"i",31),g("click",function(){z(e);let n=d(2).$implicit,a=d();return h(a.toggleAccountActive(n.id,!0))}),o()}r&2&&m("nzType","check-circle")("nzTheme","twotone")("nzTwotoneColor","#52c41a")}function Ai(r,u){if(r&1){let e=C();i(0,"i",32),g("click",function(){z(e);let n=d(2).$implicit,a=d();return h(a.toggleAccountActive(n.id,!1))}),o()}r&2&&m("nzType","pause-circle")("nzTheme","twotone")("nzTwotoneColor","#de4436")}function Oi(r,u){if(r&1&&v(0,Mi,1,3,"i",29)(1,Ai,1,3,"i",30),r&2){let e=d().$implicit;m("ngIf",e.active),l(),m("ngIf",!e.active)}}function Ri(r,u){if(r&1&&c(0,"i",33),r&2){let e=d().$implicit;m("routerLink",Me(1,Ni,e.id))}}function qi(r,u){if(r&1){let e=C();i(0,"a",34),c(1,"i",35),o(),i(2,"nz-dropdown-menu",null,5)(4,"ul",36)(5,"li",37),c(6,"i",38),s(7," Usuarios "),o(),i(8,"li",37),c(9,"i",39),s(10," Productos "),o(),i(11,"li",37),c(12,"i",39),s(13," Promociones "),o(),i(14,"li",37),c(15,"i",40),s(16," Operaci\xF3n y horarios "),o(),c(17,"li",41),i(18,"li",42),g("click",function(){z(e);let n=d().$implicit,a=d();return h(a.deleteAccountModal(n))}),c(19,"i",43),s(20," Eliminar "),o()()()}if(r&2){let e=y(3),t=d().$implicit;m("nzDropdownMenu",e),l(5),m("routerLink",Me(5,Pi,t.id)),l(3),m("routerLink",Me(7,li,t.id)),l(3),m("routerLink",Me(9,li,t.id)),l(3),m("routerLink",Me(11,Di,t.id))}}function Ui(r,u){if(r&1&&(i(0,"div",24)(1,"nz-card",25)(2,"nz-skeleton",26),c(3,"nz-card-meta",27),o()(),v(4,ki,1,1,"ng-template",null,1,V)(6,Oi,2,2,"ng-template",null,2,V)(8,Ri,1,3,"ng-template",null,3,V)(10,qi,21,13,"ng-template",null,4,V),o()),r&2){let e=u.$implicit,t=y(5),n=y(7),a=y(9),p=y(11),_=d();l(),m("nzActions",jt(6,Vi,n,a,p)),l(),m("nzActive",!0)("nzLoading",_.loading)("nzAvatar",Pe(10,Ii)),l(),m("nzAvatar",t)("nzTitle",e.name)}}function ji(r,u){if(r&1&&(i(0,"nz-option",61),c(1,"i",62),s(2),o()),r&2){let e=u.$implicit;m("nzLabel",e.name)("nzValue",e.uid),l(2),F(" ",e.name,"")}}function Hi(r,u){if(r&1){let e=C();i(0,"form",44),g("ngSubmit",function(){z(e);let n=d();return h(n.submitForm())}),i(1,"nz-form-item")(2,"nz-form-label",45),s(3,"Nombre"),o(),i(4,"nz-form-control",46),c(5,"input",47),o()(),i(6,"nz-form-item")(7,"nz-form-label",48)(8,"span"),s(9," Giro "),o()(),i(10,"nz-form-control",49)(11,"nz-select",50),g("ngModelChange",function(n){z(e);let a=d();return h(a.onJobTypeSelected(n))}),v(12,ji,3,3,"nz-option",51),o()()(),i(13,"nz-form-item")(14,"nz-form-label",52),s(15,"Consecutivo"),o(),i(16,"nz-form-control",53)(17,"input",54),g("[nzDisabled]",function(){z(e);let n=d();return h(n.isDisabled)}),o()()(),i(18,"nz-form-item")(19,"nz-form-label",55),s(20,"Tel\xE9fono"),o(),i(21,"nz-form-control",56),c(22,"input",57),o()(),i(23,"nz-form-item")(24,"nz-form-label",58),s(25,"Sitio web"),o(),i(26,"nz-form-control",59),c(27,"input",60),o()()()}if(r&2){let e=d();m("formGroup",e.validateForm),l(2),m("nzSm",6)("nzXs",24),l(2),m("nzSm",14)("nzXs",24),l(3),m("nzSm",6)("nzXs",24),l(3),m("nzSm",14)("nzXs",24),l(2),m("ngForOf",e.jobType),l(2),m("nzSm",6)("nzXs",24),l(2),m("nzSm",14)("nzXs",24),l(3),m("nzSm",6)("nzXs",24),l(2),m("nzSm",14)("nzXs",24),l(3),m("nzSm",6)("nzXs",24),l(2),m("nzSm",14)("nzXs",24)}}var Eo=(()=>{class r{constructor(e,t,n){this.messageService=e,this.modalService=t,this.fb=n,this.rolService=b(ie),this.summarizedService=b(si),this.authService=b(W),this.accountsService=b(je),this.selectedRecord=!1,this.accountsList=[],this.summarized=[],this.loading=!0,this.isVisibleAdd=!1,this.isDeleteVisible=!1,this.isOkLoading=!1,this.infoLoad=[],this.infoSegment=[],this.stopSubscription$=new re,this.isDisabled=!0,this.currentConsecutive="",this.currentJobType=""}ngOnInit(){this.userSubscription=this.authService.getUser().subscribe(e=>{this.user=e,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&(this.rolService.getRol(this.user.rolId).valueChanges().subscribe(t=>{this.infoLoad=t,this.userlevelAccess=this.infoLoad.optionAccessLavel}),this.accountsService.getSegmentLevel(this.user.idSegment).pipe(L(this.stopSubscription$),w(t=>{let n=t.payload.id,a=t.payload.data();return T({id:n},a)}),Fe(t=>(this.infoSegment=t,this.getSubscriptions(),t))).subscribe())}),this.validateForm=this.fb.group({name:[null,[f.minLength(5),f.maxLength(40),f.required]],address:[null,[f.required]],phoneNumber:[null,[f.required]],website:[null,[f.required]],active:[!1],canShowDevices:[!0],showFromHour:[5],jobTypeID:[null,[f.required]],custConsecutive:[null,[f.required]],showToHour:[20]})}ngOnDestroy(){this.accountsSubscription&&this.accountsSubscription.unsubscribe(),this.userSubscription&&this.userSubscription.unsubscribe(),this.stopSubscription$&&this.stopSubscription$.unsubscribe()}submitForm(){this.isOkLoading=!0;for(let e in this.validateForm.controls)this.validateForm.controls[e].markAsDirty(),this.validateForm.controls[e].updateValueAndValidity();this.userlevelAccess!="3"?this.accountsService.setAccount(this.validateForm.value,this.currentConsecutive).then(t=>{this.currentJobType.length>0&&this.accountsService.updateJobType(this.currentJobType,this.currentConsecutive).then(()=>{},n=>{this.sendMessage("error",n)}).catch(n=>this.sendMessage("error",n)),this.isVisibleAdd=!1,this.isOkLoading=!1}).catch(t=>this.sendMessage("error",t)):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}toggleAccountActive(e,t){this.accountsService.toggleAccountActive(e,t)}deleteAccount(e){this.isOkLoading=!0,this.userlevelAccess=="1"?this.accountsService.deleteAccount(e.id).then(n=>{this.isOkLoading=!1}).catch(n=>this.sendMessage("error",n)):this.sendMessage("error","El usuario no tiene permisos para borrar datos, favor de contactar al administrador.")}getSubscriptions(){this.loading=!0,this.infoSegment!==void 0&&this.infoSegment.nivelNum==1?this.accountsSubscription=this.accountsService.getAccountsByCustomer(this.user.customerId).pipe(w(e=>{let t=e.payload.id,n=e.payload.data();return T({id:t},n)})).subscribe(e=>{this.accountsList=[e],this.loading=!1}):this.accountsSubscription=this.accountsService.getAccounts().pipe(w(e=>e.map(t=>{let n=t.payload.doc.id,a=t.payload.doc.data();return T({id:n},a)}))).subscribe(e=>{this.accountsList=e,this.loading=!1})}deleteAccountModal(e){this.modalService.warning({nzTitle:"\xBFEst\xE1 seguro?",nzContent:"Eliminar\xE1 toda la informaci\xF3n de "+e.name,nzCancelText:"Cancelar",nzOkText:"Eliminar",nzOkLoading:this.isOkLoading,nzOnOk:()=>{this.deleteAccount(e)}})}createBasicMessage(e){this.messageService.success(`Se encontraron ${e} registros.`,{nzDuration:3e3})}showModalAdd(){this.isVisibleAdd=!0,this.accountsSubscription=this.accountsService.getJobType().pipe(w(e=>e.map(t=>{let n=t.payload.doc.id,a=t.payload.doc.data();return T({id:n},a)}))).subscribe(e=>{this.jobType=e})}handleCancel(){this.isVisibleAdd=!1}sendMessage(e,t){this.messageService.create(e,t)}onJobTypeSelected(e){let t=this.jobType.filter(n=>n.uid===e);if(t.length>0){let n=t[0].consecutive;this.currentJobType=e,n=parseInt(n,10)+1,n=n.toString().padStart(4,"0"),this.validateForm.controls.custConsecutive.setValue(t[0].type+n),this.currentConsecutive=n}}static{this.\u0275fac=function(t){return new(t||r)(x(N),x(fe),x(A))}}static{this.\u0275cmp=D({type:r,selectors:[["app-dashboard"]],decls:29,vars:6,consts:[["modalContentAdd",""],["avatarTemplate",""],["actionSetting",""],["actionEdit",""],["actionEllipsis",""],["menu","nzDropdownMenu"],[2,"margin","buttom 15px"],[1,"site-page-header-ghost-wrapper"],[2,"background-color","#f9fbfd",3,"nzGhost"],[2,"margin-left","350px"],[1,"d-md-flex","align-items-center","d-none"],[1,"media","align-items-center","m-r-40","m-v-5"],[1,"font-size-27"],["nz-icon","","theme","outline",1,"text-primary"],["nz-icon","","theme","outline",1,"text-success"],[1,"media","align-items-center","m-v-5"],["nz-icon","","theme","outline",1,"text-danger"],[1,"media","align-items-center","m-v-5","m-l-10"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],[1,"body"],[4,"ngIf"],["nz-row","",3,"nzGutter"],["nz-col","","nzSpan","6",4,"ngFor","ngForOf"],["nzTitle","Nueva Empresa","nzCancelText","Cancelar","nzOkText","Crear","nzOkType","primary",3,"nzOnCancel","nzOnOk","nzVisible","nzContent"],["nz-col","","nzSpan","6"],[3,"nzActions"],[3,"nzActive","nzLoading","nzAvatar"],[3,"nzAvatar","nzTitle"],["nzSize","large",2,"vertical-align","middle",3,"ngStyle","nzSrc"],["nz-icon","","nzTooltipTitle","Activo","nzTooltipPlacement","topLeft","nz-tooltip","",3,"nzType","nzTheme","nzTwotoneColor","click",4,"ngIf"],["nz-icon","","nzTooltipTitle","Inactivo","nzTooltipPlacement","topLeft","nz-tooltip","",3,"nzType","nzTheme","nzTwotoneColor","click",4,"ngIf"],["nz-icon","","nzTooltipTitle","Activo","nzTooltipPlacement","topLeft","nz-tooltip","",3,"click","nzType","nzTheme","nzTwotoneColor"],["nz-icon","","nzTooltipTitle","Inactivo","nzTooltipPlacement","topLeft","nz-tooltip","",3,"click","nzType","nzTheme","nzTwotoneColor"],["nz-icon","","nzType","edit","routerLinkActive","router-link-active","nzTooltipTitle","Editar","nzTooltipPlacement","topLeft","nz-tooltip","",3,"routerLink"],["nz-dropdown","","nzPlacement","bottomRight",3,"nzDropdownMenu"],["nz-icon","","nzType","ellipsis","nzTooltipTitle","M\xE1s informaci\xF3n","nzTooltipPlacement","topLeft","nz-tooltip",""],["nz-menu","","nzSelectable",""],["nz-menu-item","","routerLinkActive","router-link-active",3,"routerLink"],["nz-icon","","nzType","user"],["nz-icon","","nzType","shopping"],["nz-icon","","nzType","clock-circle"],["nz-menu-divider",""],["nz-menu-item","",3,"click"],["nz-icon","","nzTheme","twotone","nzTwotoneColor","#de4436","nzType","delete"],["nz-form","",3,"ngSubmit","formGroup"],["nzRequired","","nzFor","name",3,"nzSm","nzXs"],["nzErrorTip","Debe contener entre 5 y 30 caracteres.",3,"nzSm","nzXs"],["nz-input","","formControlName","name","id","name"],["nzFor","address","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Ingrese el Giro",3,"nzSm","nzXs"],["formControlName","jobTypeID","nzAllowClear","","nzPlaceHolder","Selecciona el Giro de la Empresa",2,"width","320px",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzRequired","","nzFor","custConsecutive",3,"nzSm","nzXs"],["nzErrorTip","Consecutivo es necesario para crear la empresa.",3,"nzSm","nzXs"],["nz-input","","formControlName","custConsecutive","id","custConsecutive",3,"[nzDisabled]"],["nzRequired","","nzFor","phoneNumber",3,"nzSm","nzXs"],["nzErrorTip","Ingrese el tel\xE9fono de contacto con la empresa.",3,"nzSm","nzXs"],["nz-input","","formControlName","phoneNumber","id","phoneNumber"],["nzFor","website","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Ingrese el sitio web!",3,"nzSm","nzXs"],["nz-input","","id","website","formControlName","website","placeholder","website"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon",""]],template:function(t,n){if(t&1){let a=C();i(0,"div",6)(1,"div",7)(2,"nz-page-header",8)(3,"nz-page-header-title",9),s(4,"CRM"),o(),i(5,"nz-page-header-subtitle"),s(6,"Informaci\xF3n Comercial "),o(),i(7,"nz-page-header-extra")(8,"div",10)(9,"div",11)(10,"div",12),c(11,"i",13),o()(),i(12,"div",11)(13,"div",12),c(14,"i",14),o()(),i(15,"div",15)(16,"div",12),c(17,"i",16),o()(),i(18,"div",17)(19,"button",18),g("click",function(){return z(a),h(n.showModalAdd())}),s(20,"Nueva Empresa"),o()()()(),c(21,"nz-page-header-footer"),o()(),i(22,"div",19),v(23,Li,1,0,"nz-empty",20),i(24,"div",21),v(25,Ui,12,11,"div",22),o()()(),i(26,"nz-modal",23),g("nzOnCancel",function(){return z(a),h(n.handleCancel())})("nzOnOk",function(){return z(a),h(n.submitForm())}),o(),v(27,Hi,28,22,"ng-template",null,0,V)}if(t&2){let a=y(28);l(2),m("nzGhost",!1),l(21),m("ngIf",n.accountsList.length===0),l(),m("nzGutter",8),l(),m("ngForOf",n.accountsList),l(),m("nzVisible",n.isVisibleAdd)("nzContent",a)}},dependencies:[k,ae,Re,me,X,G,Y,J,K,Q,ce,Ce,qe,Yt,Se,ve,Ue,be,xe,ye,ge,te,Z,ee,_e,pt,de,He,Be,Ee,Qt,pe,ue,Bt,$t,H,se,M,j,B,$,Jt]})}}return r})();function $i(r,u){if(r&1&&c(0,"nz-option",12),r&2){let e=u.$implicit;m("nzValue",e)("nzLabel",e)}}function Wi(r,u){if(r&1&&c(0,"nz-option",12),r&2){let e=u.$implicit;m("nzValue",e)("nzLabel",e)}}function Gi(r,u){if(r&1&&(i(0,"form",6)(1,"nz-form-item")(2,"nz-form-label"),s(3,"Nombre de la Operaci\xF3n"),o(),i(4,"nz-form-control"),c(5,"input",7),o()(),i(6,"nz-form-item")(7,"nz-form-label"),s(8,"Descripci\xF3n"),o(),i(9,"nz-form-control"),c(10,"textarea",8),o()(),i(11,"nz-form-item")(12,"nz-form-label"),s(13,"Horarios Entradas (Opcional)"),o(),i(14,"nz-form-control")(15,"nz-select",9),v(16,$i,1,2,"nz-option",10),o()()(),i(17,"nz-form-item")(18,"nz-form-label"),s(19,"Horarios Salidas (Opcional)"),o(),i(20,"nz-form-control")(21,"nz-select",11),v(22,Wi,1,2,"nz-option",10),o()()()()),r&2){let e=d();m("formGroup",e.objectForm),l(16),m("ngForOf",e.timeOptions),l(6),m("ngForOf",e.timeOptions)}}function Xi(r,u){if(r&1&&(i(0,"nz-tab",13),c(1,"app-shared-stoppoints-list",14),o()),r&2){let e=u.$implicit,t=d();m("nzTitle",t.getTabTitle(e)),l(),m("accountId",t.accountId)("routeId",e.id)}}var ci=(()=>{class r{constructor(e,t,n,a){this.afs=e,this.modalService=t,this.messageService=n,this.fb=a,this.accountId="",this.routesService=b(_t),this.tabs=[],this.nzTabPosition="top",this.selectedIndex=0,this.routesList=[],this.stopPointsList=[],this.stopSubscription$=new re,this.customersService=b(ut),this.timeOptions=[]}ngOnInit(){this.createForm(),this.getSubscriptions(),this.generateTimeOptions()}ngOnDestroy(){this.sub.unsubscribe()}generateTimeOptions(){for(let n=7;n<=21;n++){let a=n%12||12,p=n<12?"AM":"PM",_=`${a.toString().padStart(2,"0")}:${n%60===30?"30":"00"} ${p}`;this.timeOptions.push(_)}}createForm(){this.objectForm=this.fb.group({active:[!1,[f.required]],description:["",[f.required]],imageUrl:[""],kmzUrl:[""],name:["",[f.minLength(5),f.maxLength(20),f.required]],routeId:[""],customerId:["",[f.required]],customerName:[""],initialStart:[[]],initialEnd:[[]]})}resetForm(){this.objectForm.reset({active:!1,description:"",imageUrl:"",kmzUrl:"",name:"",routeId:"",customerId:"",customerName:"",initialStart:[],initialEnd:[]})}addNewRoute(e){var t,n;let a=this.modalService.create({nzTitle:"Nueva Operaci\xF3n",nzContent:e,nzFooter:[{label:"Crear Operaci\xF3n ",type:"primary",onClick:()=>this.modalService.confirm({nzTitle:"\xBFEst\xE1 la informaci\xF3n completa?",nzOnOk:()=>{if(this.objectForm.get("customerId").setValue(this.accountId),this.objectForm.valid){let p=this.objectForm.value,_=p.initialStart&&p.initialStart.length>0?p.initialStart.map(P=>({value:P})):null,S=p.initialEnd&&p.initialEnd.length>0?p.initialEnd.map(P=>({value:P})):[],E=T(T({},p),_?{initialStart:_}:{}),ne=this.afs.createId(),Dt=this.routesService.setRoute2(ne,this.accountId,this.objectForm.value).then(()=>{}).catch(P=>this.sendMessage("error",P));this.routesService.getInternalCustomer(this.accountId).pipe(L(this.stopSubscription$),w(P=>P.map(Le=>{let tt=Le.payload.doc.id,Lt=Le.payload.doc.data();return he(T({},Lt),{id:tt})}))).subscribe(P=>{let Le=this.objectForm.controls.name.value,tt=new Date,kt=new Date(tt.getFullYear()+3,tt.getMonth(),tt.getDate()).toISOString();var yi="";let Ft={authorization:"portalAuth",operation_type:"in",method:"Liquidacion",transaction_type:"charge",card:{type:"",brand:"",address:"",card_number:"",holder_name:"",expiration_year:"",expiration_month:"",allows_charges:"",allows_payouts:"",bank_name:"",bank_code:"",points_card:"",points_type:""},status:"completed",conciliated:!1,creation_date:new Date().toISOString(),operation_date:new Date().toISOString(),description:"Pago a traves de portal",error_message:"",order_id:"portalOrder",currency:"MXN",amount:0,customer:{name:"",last_name:"",email:"",phone_number:"",address:"",creation_date:"",external_id:"",clabe:""},product:{product_id:"",amountTrips:0,frequencies:0,rangeWeeks:{},weeks:0,name:""},customerId:this.accountId,active:!0,category:"permanente",date_created:new Date().toISOString(),product_description:"Pago a traves de portal proceso interno al crear una ruta",product_id:"",name:Le,isTaskIn:"false",isTaskOut:"false",type:"Servicio",isOpenpay:!1,paidApp:"portal",price:0,round:"",routeId:ne,routeName:Le,stopDescription:"",stopId:"",stopName:"Internal",validFrom:new Date().toISOString(),validTo:kt,idBoardingPass:P[0].id,idPurchasteRequest:"",is_courtesy:!1,typePayment:"Liquidacion"};t={active:!0,amountPayment:0,payment:"Liquidacion",status:"completed",customer_id:this.accountId,customerId:this.accountId,creation_date:new Date().toISOString(),name:"internal",price:0,operation_date:new Date().toISOString(),routeId:ne,routeName:Le,round:"",stopName:"internal",stopId:"",typePayment:"Liquidacion",validFrom:new Date().toISOString(),validTo:kt,idBoardingPass:P[0].uid,idPurchaseRequest:"",baja:!1,type:"Servicio",fileURL:yi},this.customersService.saveBoardingPassToUserPurchaseCollection(P[0].id,Ft).then(Mt=>{this.customersService.saveBoardingPassDetailToUserPurchaseCollection(P[0].id,ne,Ft).then(At=>{let Ei=P[0];this.customersService.createPurchaseCloud(Ft,Ei,P[0].id)}).catch(At=>{this.sendMessage("error",At)})}).catch(Mt=>{this.sendMessage("error",Mt)}),this.modalService.closeAll()})}}})}],nzWidth:500})}getSubscriptions(){this.sub=this.routesService.getRoutes(this.accountId).pipe(w(e=>e.map(t=>{let n=t.payload.doc.id,a=t.payload.doc.data();return he(T({},a),{id:n})}))).subscribe(e=>{this.routesList=e,e.forEach(t=>{this.tabs.push({name:t.name,content:`Content of tab ${t.name}`})})})}getTabTitle(e){return`${e.name}`}sendMessage(e,t){this.messageService.create(e,t)}static{this.\u0275fac=function(t){return new(t||r)(x(le),x(fe),x(N),x(A))}}static{this.\u0275cmp=D({type:r,selectors:[["app-shared-routes-list"]],inputs:{accountId:"accountId"},decls:9,vars:4,consts:[["newProjectContent",""],[1,"site-page-header-ghost-wrapper"],[2,"background-color","#f9fbfd",3,"nzGhost"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],[3,"nzSelectedIndexChange","nzTabPosition","nzSelectedIndex"],[3,"nzTitle",4,"ngFor","ngForOf"],["nz-form","","nzLayout","vertical",3,"formGroup"],["type","text","formControlName","name","nz-input","","placeholder","Escriba el nombre de la Operaci\xF3n"],["formControlName","description","nz-input",""],["formControlName","initialStart","nzMode","multiple"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["formControlName","initialEnd","nzMode","multiple"],[3,"nzValue","nzLabel"],[3,"nzTitle"],[3,"accountId","routeId"]],template:function(t,n){if(t&1){let a=C();i(0,"div",1)(1,"nz-page-header",2)(2,"nz-page-header-extra")(3,"button",3),g("click",function(){z(a);let _=y(6);return h(n.addNewRoute(_))}),s(4,"Agregar Operaci\xF3n"),o()()()(),v(5,Gi,23,3,"ng-template",null,0,V),i(7,"nz-tabset",4),U("nzSelectedIndexChange",function(_){return z(a),q(n.selectedIndex,_)||(n.selectedIndex=_),h(_)}),v(8,Xi,2,3,"nz-tab",5),o()}t&2&&(l(),m("nzGhost",!1),l(6),m("nzTabPosition",n.nzTabPosition),R("nzSelectedIndex",n.selectedIndex),l(),m("ngForOf",n.routesList))},dependencies:[k,X,G,Y,J,K,Q,ce,te,Z,ee,de,Ee,pe,ue,H,se,M,j,B,$,gt,ft,ti]})}}return r})();var Tt=wi(Ti());function Yi(r,u){if(r&1&&(i(0,"nz-tag",10),s(1,"Dom"),o()),r&2){let e=d().$implicit;m("nzColor",e.isSunday?"geekblue":"")}}function Qi(r,u){if(r&1&&(i(0,"nz-tag",10),s(1,"Lun"),o()),r&2){let e=d().$implicit;m("nzColor",e.isMonday?"geekblue":"")}}function Ki(r,u){if(r&1&&(i(0,"nz-tag",10),s(1,"Mar"),o()),r&2){let e=d().$implicit;m("nzColor",e.isTuesday?"geekblue":"")}}function Zi(r,u){if(r&1&&(i(0,"nz-tag",10),s(1,"Mi\xE9"),o()),r&2){let e=d().$implicit;m("nzColor",e.isWednesday?"geekblue":"")}}function en(r,u){if(r&1&&(i(0,"nz-tag",10),s(1,"Jue"),o()),r&2){let e=d().$implicit;m("nzColor",e.isThursday?"geekblue":"")}}function tn(r,u){if(r&1&&(i(0,"nz-tag",10),s(1,"Vie"),o()),r&2){let e=d().$implicit;m("nzColor",e.isFriday?"geekblue":"")}}function nn(r,u){if(r&1&&(i(0,"nz-tag",10),s(1,"S\xE1b"),o()),r&2){let e=d().$implicit;m("nzColor",e.isSaturday?"geekblue":"")}}function on(r,u){r&1&&c(0,"i",24)}function rn(r,u){if(r&1){let e=C();i(0,"li",19),g("click",function(){z(e);let n=d().$implicit,a=d(2);return h(a.toggleActive(n))}),c(1,"i",25),s(2," Activar "),o()}}function an(r,u){if(r&1){let e=C();i(0,"li",19),g("click",function(){z(e);let n=d().$implicit,a=d(2);return h(a.toggleActive(n))}),c(1,"i",26),s(2," Desactivar "),o()}}function sn(r,u){if(r&1){let e=C();i(0,"tr")(1,"td"),s(2),o(),i(3,"td"),s(4),o(),i(5,"td")(6,"nz-tag",10),s(7),o()(),i(8,"td"),v(9,Yi,2,1,"nz-tag",11)(10,Qi,2,1,"nz-tag",11)(11,Ki,2,1,"nz-tag",11)(12,Zi,2,1,"nz-tag",11)(13,en,2,1,"nz-tag",11)(14,tn,2,1,"nz-tag",11)(15,nn,2,1,"nz-tag",11),o(),i(16,"td"),s(17),o(),i(18,"td"),s(19),Ae(20,"date"),o(),i(21,"td")(22,"nz-tag",10),v(23,on,1,0,"i",12),i(24,"span"),s(25),o()()(),i(26,"td")(27,"nz-tag",13),s(28),o(),s(29),o(),i(30,"td")(31,"nz-tag",14),s(32),o(),s(33),o(),i(34,"td"),s(35),o(),i(36,"td")(37,"a",15),c(38,"i",16),o(),i(39,"nz-dropdown-menu",null,2)(41,"ul",17),v(42,rn,3,0,"li",18)(43,an,3,0,"li",18),i(44,"li",19),g("click",function(){let n=z(e).$implicit,a=d(2);return h(a.showModalEdit(n))}),c(45,"i",20),s(46," Editar "),o(),c(47,"li",21),i(48,"li",22),g("nzOnConfirm",function(){let n=z(e).$implicit,a=d(2);return h(a.showModalDelete(n))})("nzOnCancel",function(){z(e);let n=d(2);return h(n.handleCancel())}),c(49,"i",23),s(50," Eliminar "),o()()()()()}if(r&2){let e=u.$implicit,t=y(40),n=d(2);l(),O(e.active?"text-dark":"text-muted font-italic"),l(),I(e.vendorName),l(),O(e.active?"text-dark":"text-muted font-italic"),l(),I(n.getRouteName(e.routeId)),l(),O(e.active?"text-dark":"text-muted font-italic"),l(),m("nzColor",e.program=="M"?"green":"red"),l(),I(e.program=="M"?"Mete":"Saca"),l(),O(e.active?"text-dark":"text-muted font-italic"),l(),m("ngIf",e.isSunday),l(),m("ngIf",e.isMonday),l(),m("ngIf",e.isTuesday),l(),m("ngIf",e.isWednesday),l(),m("ngIf",e.isThursday),l(),m("ngIf",e.isFriday),l(),m("ngIf",e.isSaturday),l(),O(e.active?"text-dark":"text-muted font-italic"),l(),I(e.round),l(),O(e.active?"text-dark":"text-muted font-italic"),l(),F("",Oe(20,46,e.time.toDate(),"HH:mm")," "),l(2),O(e.active?"text-dark":"text-muted font-italic"),l(),m("nzColor",e.acRequired?"blue":""),l(),m("ngIf",e.acRequired),l(2),I(e.acRequired?"":"No"),l(),O(e.active?"text-dark":"text-muted font-italic"),l(2),I(e.stopBeginHour),l(),F(" ",e.stopBeginName,""),l(),O(e.active?"text-dark":"text-muted font-italic"),l(2),I(e.stopEndHour),l(),F(" ",e.stopEndName,""),l(),O(e.active?"text-dark":"text-muted font-italic"),l(),I(e.type),l(),O(e.active?"text-dark":"text-muted font-italic"),l(),m("nzDropdownMenu",t),l(5),m("ngIf",!e.active),l(),m("ngIf",e.active)}}function ln(r,u){if(r&1){let e=C();i(0,"nz-table",8,1),U("nzPageSizeChange",function(n){z(e);let a=d();return q(a.pageSize,n)||(a.pageSize=n),h(n)}),i(2,"thead")(3,"tr")(4,"th"),s(5,"Asignado A"),o(),i(6,"th"),s(7,"Operaci\xF3n"),o(),i(8,"th"),s(9,"Tarea"),o(),i(10,"th"),s(11,"D\xEDas"),o(),i(12,"th"),s(13,"Turno"),o(),i(14,"th"),s(15,"Hora"),o(),i(16,"th"),s(17,"AC"),o(),i(18,"th"),s(19,"Inicio"),o(),i(20,"th"),s(21,"Fin"),o(),i(22,"th"),s(23,"Tipo"),o(),c(24,"th"),o()(),i(25,"tbody"),v(26,sn,51,49,"tr",9),o()()}if(r&2){let e=y(1),t=d();m("nzData",t.programsList)("nzLoading",t.loading),R("nzPageSize",t.pageSize),l(26),m("ngForOf",e.data)}}function mn(r,u){if(r&1&&(i(0,"nz-option",50),c(1,"i",51),s(2),c(3,"br"),s(4),o()),r&2){let e=u.$implicit;m("nzLabel",e.name)("nzValue",e.id),l(2),F(" ",e.name," "),l(2),F(" ",e.description,"")}}function cn(r,u){if(r&1&&(i(0,"nz-option",50),c(1,"i",51),s(2),c(3,"br"),s(4),o()),r&2){let e=u.$implicit;m("nzLabel",e.name)("nzValue",e.id),l(2),F(" ",e.name," "),l(2),F(" ",e.description,"")}}function dn(r,u){if(r&1&&(i(0,"nz-option",50),c(1,"i",51),s(2),c(3,"br"),s(4),o()),r&2){let e=u.$implicit;m("nzLabel",e.name)("nzValue",e.id),l(2),F(" ",e.name," "),l(2),F(" ",e.description,"")}}function pn(r,u){if(r&1&&(i(0,"nz-option",50),c(1,"i",51),s(2),c(3,"br"),s(4),o()),r&2){let e=u.$implicit;m("nzLabel",e.name)("nzValue",e.id),l(2),F(" ",e.name," "),l(2),F(" ",e.description,"")}}function un(r,u){if(r&1){let e=C();i(0,"form",27),g("ngSubmit",function(){z(e);let n=d();return h(n.createProgram())}),i(1,"nz-form-item")(2,"nz-form-label"),s(3,"Divisi\xF3n"),o(),i(4,"nz-form-control")(5,"nz-select",28),g("ngModelChange",function(n){z(e);let a=d();return h(a.onVendorSelected(n,"vendorName"))}),v(6,mn,5,4,"nz-option",29),o()()(),i(7,"div",30)(8,"div",31)(9,"nz-form-item")(10,"nz-form-label"),s(11,"Tipo de asignaci\xF3n"),o(),i(12,"nz-form-control")(13,"nz-select",32),c(14,"nz-option",33),o()()()(),i(15,"div",31)(16,"nz-form-item")(17,"nz-form-label"),s(18,"Operaci\xF3n"),o(),i(19,"nz-form-control")(20,"nz-select",34),g("ngModelChange",function(n){z(e);let a=d();return h(a.onRouteSelected(n))}),v(21,cn,5,4,"nz-option",29),o()()()()(),i(22,"div",30)(23,"div",31)(24,"nz-form-item")(25,"nz-form-label"),s(26,"Turno"),o(),i(27,"nz-form-control")(28,"nz-select",35),c(29,"nz-option",36)(30,"nz-option",37)(31,"nz-option",38),o()()()(),i(32,"div",31)(33,"nz-form-item")(34,"nz-form-label"),s(35,"Tarea"),o(),i(36,"nz-form-control")(37,"nz-select",39),c(38,"nz-option",40)(39,"nz-option",41),o()()()()(),i(40,"div",30)(41,"div",42)(42,"nz-form-item")(43,"nz-form-label"),s(44,"Hora Compromiso"),o(),i(45,"nz-form-control"),c(46,"nz-time-picker",43),o()()(),i(47,"div",42)(48,"nz-form-item")(49,"nz-form-label"),s(50,"Hora Inicio"),o(),i(51,"nz-form-control"),c(52,"nz-time-picker",44),o()()(),i(53,"div",42)(54,"nz-form-item")(55,"nz-form-label"),s(56,"Hora fin"),o(),i(57,"nz-form-control"),c(58,"nz-time-picker",45),o()()()(),i(59,"nz-form-item")(60,"nz-form-label",46),s(61,"D\xEDas"),o(),i(62,"nz-form-control")(63,"nz-tag",47),g("nzCheckedChange",function(n){z(e);let a=d();return h(a.checkChange("isSunday",n))}),s(64,"Dom"),o(),i(65,"nz-tag",47),g("nzCheckedChange",function(n){z(e);let a=d();return h(a.checkChange("isMonday",n))}),s(66,"Lun"),o(),i(67,"nz-tag",47),g("nzCheckedChange",function(n){z(e);let a=d();return h(a.checkChange("isTuesday",n))}),s(68,"Mar"),o(),i(69,"nz-tag",47),g("nzCheckedChange",function(n){z(e);let a=d();return h(a.checkChange("isWednesday",n))}),s(70,"Mi\xE9"),o(),i(71,"nz-tag",47),g("nzCheckedChange",function(n){z(e);let a=d();return h(a.checkChange("isThursday",n))}),s(72,"Jue"),o(),i(73,"nz-tag",47),g("nzCheckedChange",function(n){z(e);let a=d();return h(a.checkChange("isFriday",n))}),s(74,"Vie"),o(),i(75,"nz-tag",47),g("nzCheckedChange",function(n){z(e);let a=d();return h(a.checkChange("isSaturday",n))}),s(76,"S\xE1b"),o()()(),i(77,"div",30)(78,"div",31)(79,"nz-form-item")(80,"nz-form-label"),s(81,"Inicia en"),o(),i(82,"nz-form-control")(83,"nz-select",48),g("ngModelChange",function(n){z(e);let a=d();return h(a.onStopPointSelected(n,"stopBeginName","stopBeginHourT"))}),v(84,dn,5,4,"nz-option",29),o()()()(),i(85,"div",31)(86,"nz-form-item")(87,"nz-form-label"),s(88,"Termina en"),o(),i(89,"nz-form-control")(90,"nz-select",49),g("ngModelChange",function(n){z(e);let a=d();return h(a.onStopPointSelected(n,"stopEndName","stopEndHourT"))}),v(91,pn,5,4,"nz-option",29),o()()()()()()}if(r&2){let e=d();m("formGroup",e.programForm),l(6),m("ngForOf",e.vendorsList),l(15),m("ngForOf",e.routesList),l(42),m("nzChecked",e.programForm.controls.isSunday.value),l(2),m("nzChecked",e.programForm.controls.isMonday.value),l(2),m("nzChecked",e.programForm.controls.isTuesday.value),l(2),m("nzChecked",e.programForm.controls.isWednesday.value),l(2),m("nzChecked",e.programForm.controls.isThursday.value),l(2),m("nzChecked",e.programForm.controls.isFriday.value),l(2),m("nzChecked",e.programForm.controls.isSaturday.value),l(9),m("ngForOf",e.stopPointsList),l(7),m("ngForOf",e.stopPointsList)}}var ui=(()=>{class r{constructor(e,t,n){this.notification=e,this.messageService=t,this.fb=n,this.rolService=b(ie),this.authService=b(W),this.vendorsService=b(vt),this.routesService=b(_t),this.loading=!0,this.pageSize=10,this.stopSubscription$=new re,this.programsList=[],this.routesList=[],this.stopPointsList=[],this.vendorsList=[],this.isCreateVisible=!1,this.isEditMode=!1,this.infoLoad=[],this.authService.user.subscribe(a=>{this.user=a,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(p=>{this.infoLoad=p,this.userlevelAccess=this.infoLoad.optionAccessLavel})}),this.createForm()}ngOnInit(){this.getSubscriptions()}ngOnDestroy(){this.stopSubscription$.next(void 0),this.stopSubscription$.complete()}getSubscriptions(){this.routesService.getRoutes(this.accountId).pipe(L(this.stopSubscription$),w(e=>e.map(t=>{let n=t.payload.doc.id,a=t.payload.doc.data();return T({id:n},a)}))).subscribe(e=>{this.routesList=e,this.loading=!1}),this.routesService.getCustomerVendorAssignments(this.accountId).pipe(L(this.stopSubscription$),w(e=>e.map(t=>{let n=t.payload.doc.id,a=t.payload.doc.data();return he(T({},a),{id:n})}))).subscribe(e=>{this.programsList=e,this.loading=!1}),this.vendorsService.getVendors().pipe(L(this.stopSubscription$),w(e=>e.map(t=>{let n=t.payload.doc.id,a=t.payload.doc.data();return he(T({},a),{id:n})}))).subscribe(e=>{this.vendorsList=e,this.loading=!1})}getRouteName(e){let t="";if(this.routesList.length>0){let n=Tt.filter(this.routesList,a=>a.id==e);n.length>0&&(t=n[0].name)}return t}createForm(){this.programForm=this.fb.group({active:[!1,[f.required]],acRequired:[!1,[f.required]],isSunday:[!1,[f.required]],isMonday:[!0,[f.required]],isTuesday:[!0,[f.required]],isWednesday:[!0,[f.required]],isThursday:[!0,[f.required]],isFriday:[!0,[f.required]],isSaturday:[!1,[f.required]],program:["",[f.required]],round:["",[f.required]],stopBeginId:["",[f.required]],stopBeginName:["",[f.required]],stopBeginHour:["",[f.required]],stopBeginHourT:[""],stopEndId:["",[f.required]],stopEndName:["",[f.required]],stopEndHour:["",[f.required]],stopEndHourT:[""],time:[new Date,[f.required]],type:[this.assigmentType,[f.required]],customerName:["",[f.required]],customerId:[this.accountId,[f.required]],vendorName:["",[f.required]],vendorId:["",[f.required]],routeId:["",[f.required]]})}patchForm(e){let t=e.stopBeginHour.split(":"),n=e.stopEndHour.split(":");this.programForm.patchValue({active:e.active,acRequired:e.acRequired,isSunday:e.isSunday,isMonday:e.isMonday,isTuesday:e.isTuesday,isWednesday:e.isWednesday,isThursday:e.isThursday,isFriday:e.isFriday,isSaturday:e.isSaturday,program:e.program,round:e.round,stopBeginId:e.stopBeginId,stopBeginName:e.stopBeginName,stopBeginHour:e.stopBeginHour,stopBeginHourT:e.stopBeginHour,stopEndId:e.stopEndId,stopEndName:e.stopEndName,stopEndHour:e.stopEndHour,stopEndHourT:e.stopEndHour,time:e.time,type:e.type,customerName:e.customerName,customerId:this.accountId,vendorName:e.vendorName,vendorId:e.vendorId,routeId:e.routeId})}toggleActive(e){this.routesService.toggleRouteAssignment(this.accountId,e.routeId,e.id,e).then(()=>{this.isCreateVisible=!1,this.isEditMode=!1}).catch(t=>this.sendMessage("error",t))}showCreateModal(){this.programForm.reset(),this.isCreateVisible=!0,this.currentSelectedId="",this.currentSelected=null}sendMessage(e,t){this.messageService.create(e,t)}showModalDelete(e){this.userlevelAccess=="1"?this.routesService.deleteRouteAssignments(this.accountId,e.routeId,e.id).then(()=>{this.isCreateVisible=!1,this.isEditMode=!1}).catch(t=>this.sendMessage("error",t)):this.sendMessage("error","El usuario no tiene permisos para borrar datos, favor de contactar al administrador.")}showModalEdit(e){this.currentSelectedId=e.id,this.currentSelected=e,this.patchForm(e),setTimeout(()=>{this.isCreateVisible=!0},100),this.isEditMode=!0}handleCancel(){this.isCreateVisible=!1,this.isEditMode=!1,this.currentSelectedId=""}createProgram(){this.programForm!==null&&this.programForm!==void 0&&this.programForm.get("customerId").setValue(this.accountId);let e=new Date(this.programForm.controls.stopBeginHourT.value),t=new Date(this.programForm.controls.stopEndHourT.value),n=[e.getHours(),String(e.getMinutes()).padStart(2,"0")].join(":"),a=[t.getHours(),String(t.getMinutes()).padStart(2,"0")].join(":");this.programForm.controls.stopBeginHour.setValue(n),this.programForm.controls.stopEndHour.setValue(a);let p=this.programForm.get("stopBeginHour"),_=this.programForm.get("stopEndHour");if(p==""||_==""){this.notification.create("error","Problema con la informaci\xF3n","No est\xE1n definidos los tiempos entre estaci\xF3n de esta operaci\xF3n para el turno seleccionado");return}if(this.isEditMode)if(this.userlevelAccess!="3"){let S=this.programForm.get("routeId");if(S){this.routesService.updateRouteAssignment(this.accountId,S,this.currentSelectedId,this.programForm.value).then(()=>{this.isCreateVisible=!1,this.isEditMode=!1,this.currentSelectedId=""}).catch(E=>this.sendMessage("error",E));return}}else{this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.");return}else if(this.userlevelAccess!="3"){let S=this.programForm.get("routeId");if(S){this.routesService.setRouteAssignments(this.accountId,S.value,this.programForm.value).then(()=>{this.isCreateVisible=!1,this.isEditMode=!1}).catch(E=>this.sendMessage("error",E));return}}else{this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.");return}}checkChange(e,t){this.programForm.controls[e].setValue(t)}onRouteSelected(e){this.routesService.getRouteStopPoints(this.accountId,e).pipe(L(this.stopSubscription$),w(t=>t.map(n=>{let a=n.payload.doc.id,p=n.payload.doc.data();return he(T({},p),{id:a})}))).subscribe(t=>{this.stopPointsList=t,this.loading=!1})}onStopPointSelected(e,t,n){let a=this.programForm.controls.time.value,p=this.programForm.controls.program.value,_=t,S="";if(p=="M"?_=="stopBeginName"?S="stopBeginHourT":S="stopEndHourT":_=="stopEndName"?S="stopBeginHourT":S="stopEndHourT",e){let ne=Tt.filter(this.stopPointsList,P=>P.id==e)[0],Dt=this.programForm.controls.round.value;switch(this.programForm.controls[t].setValue(ne.name),Dt){case"D\xEDa":this.programForm.controls[S].setValue(nt(a,ne.round1MinutesSinceStart));break;case"Tarde":this.programForm.controls[S].setValue(nt(a,ne.round2MinutesSinceStart));break;case"Noche":this.programForm.controls[S].setValue(nt(a,ne.round3MinutesSinceStart));break;default:this.programForm.controls[S].setValue(nt(a,ne.round1MinutesSinceStart));break}}}onVendorSelected(e,t){if(e){let a=Tt.filter(this.vendorsList,p=>p.id==e)[0];this.programForm.controls[t].setValue(a.name)}}static{this.\u0275fac=function(t){return new(t||r)(x(Wt),x(N),x(A))}}static{this.\u0275cmp=D({type:r,selectors:[["app-shared-customer-vendor-assignments"]],inputs:{accountId:"accountId"},decls:9,vars:4,consts:[["modalContentAdd",""],["programsListTable",""],["menu","nzDropdownMenu"],[1,"site-page-header-ghost-wrapper"],[2,"background-color","#f9fbfd",3,"nzGhost"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["nzShowSizeChanger","",3,"nzData","nzLoading","nzPageSize","nzPageSizeChange",4,"ngIf"],["nzTitle","Agregar asignaci\xF3n","nzWidth","600","nzOkText","Generar",3,"nzOnCancel","nzOnOk","nzVisible","nzContent"],["nzShowSizeChanger","",3,"nzPageSizeChange","nzData","nzLoading","nzPageSize"],[4,"ngFor","ngForOf"],[3,"nzColor"],[3,"nzColor",4,"ngIf"],["nz-icon","","nzType","deployment-unit",4,"ngIf"],["nzColor","green"],["nzColor","orange"],["nz-dropdown","","nzPlacement","bottomRight",3,"nzDropdownMenu"],["nz-icon","","nzType","ellipsis","nzTooltipTitle","M\xE1s informaci\xF3n","nzTooltipPlacement","topLeft","nz-tooltip",""],["nz-menu",""],["nz-menu-item","",3,"click",4,"ngIf"],["nz-menu-item","",3,"click"],["nz-icon","","nzType","edit"],["nz-menu-divider",""],["nz-menu-item","","nz-popconfirm","","nzPopconfirmTitle","\xBFEst\xE1s seguro de eliminar esta asignaci\xF3n?","nzPopconfirmPlacement","topRight",3,"nzOnConfirm","nzOnCancel"],["nz-icon","","nzTheme","twotone","nzTwotoneColor","#de4436","nzType","delete"],["nz-icon","","nzType","deployment-unit"],["nz-icon","","nzType","check-circle"],["nz-icon","","nzType","pause-circle"],["nz-form","",3,"ngSubmit","formGroup"],["formControlName","vendorId","nzAllowClear","","nzPlaceHolder","Selecciona la estaci\xF3n",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],[1,"row"],[1,"col-md-6","col-sm-12"],["formControlName","type"],["nzValue","Permanente","nzLabel","Permanente"],["formControlName","routeId",3,"ngModelChange"],["formControlName","round"],["nzValue","D\xEDa","nzLabel","D\xEDa"],["nzValue","Tarde","nzLabel","Tarde"],["nzValue","Noche","nzLabel","Noche"],["formControlName","program"],["nzValue","M","nzLabel","Mete"],["nzValue","S","nzLabel","Saca"],[1,"col-md-4","col-sm-12"],["name","time","formControlName","time","nzFormat","HH:mm"],["name","stopBeginHourT","formControlName","stopBeginHourT","nzFormat","HH:mm"],["name","stopEndHourT","formControlName","stopEndHourT","nzFormat","HH:mm"],["nzFor","days"],["nzMode","checkable",3,"nzCheckedChange","nzChecked"],["formControlName","stopBeginId","nzAllowClear","","nzPlaceHolder","Selecciona la estaci\xF3n",3,"ngModelChange"],["formControlName","stopEndId","nzAllowClear","","nzPlaceHolder","Selecciona la estaci\xF3n",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon","","nzType","flag"]],template:function(t,n){if(t&1){let a=C();i(0,"div",3)(1,"nz-page-header",4)(2,"nz-page-header-extra")(3,"button",5),g("click",function(){return z(a),h(n.showCreateModal())}),s(4,"Agregar asignaci\xF3n"),o()()()(),v(5,ln,27,4,"nz-table",6),i(6,"nz-modal",7),g("nzOnCancel",function(){return z(a),h(n.handleCancel())})("nzOnOk",function(){return z(a),h(n.createProgram())}),o(),v(7,un,92,12,"ng-template",null,0,V)}if(t&2){let a=y(8);l(),m("nzGhost",!1),l(4),m("ngIf",n.routesList.length>0),l(),m("nzVisible",n.isCreateVisible)("nzContent",a)}},dependencies:[k,ae,me,X,G,Y,J,K,Q,Xe,$e,We,Ye,Ge,Je,Ce,Se,ve,Ue,be,xe,ye,ge,te,Z,ee,de,Ee,Qe,pe,ue,H,M,j,B,$,ii,ni,ct]})}}return r})();var zi=(()=>{class r{constructor(e,t){this.afs=e,this.messageService=t,this.promotion=this.afs.collection("customer")}getPromotionsList(e){return this.afs.collection("customers").doc(e).collection("promotions",n=>n.orderBy("date_created","asc")).snapshotChanges()}savePromotion(e,t){let n=this.afs.createId(),a=this.afs.collection("customers").doc(t).collection("promotions").doc(n),p=this.afs.firestore.batch();return p.set(a.ref,e),p.commit()}editPromotion(e,t,n,a,p,_){return this.afs.collection("customers").doc(t).collection("promotions").doc(e).update({name:n,description:a,validFrom:p,validTo:p}).then(()=>{this.sendMessage("success","\xA1Listo! la promoci\xF3n fue actualizada")}).catch(E=>{this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal ... ${E}`)})}deactivePromotion(e,t,n){return this.afs.collection("customers").doc(n).collection("promotions").doc(e).update({active:t}).then(()=>{this.sendMessage("success","\xA1Listo! la promoci\xF3n fue desactivada")}).catch(p=>{this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal ... ${p}`)})}deletePromotion(e,t){this.afs.collection("customers").doc(e).collection("promotions").doc(t).delete().then(()=>this.sendMessage("success","La Promocion a sido eliminada.")).catch(a=>this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal ... ${a}`))}sendMessage(e,t){this.messageService.create(e,t)}static{this.\u0275fac=function(t){return new(t||r)(Ve(le),Ve(N))}}static{this.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var fn=()=>({width:"100%"});function gn(r,u){r&1&&(i(0,"nz-tag",20),s(1,"Activo"),o()),r&2&&m("nzColor","cyan")}function _n(r,u){r&1&&(i(0,"nz-tag",20),s(1,"Suspendido"),o()),r&2&&m("nzColor","red")}function vn(r,u){if(r&1){let e=C();i(0,"li",27),g("click",function(){z(e);let n=d().$implicit,a=d(2);return h(a.diactivePromotion(!1,n.id))}),s(1,"Suspender Promoci\xF3n "),o()}}function Sn(r,u){if(r&1){let e=C();i(0,"li",27),g("click",function(){z(e);let n=d().$implicit,a=d(2);return h(a.diactivePromotion(!0,n.id))}),s(1,"Reactivar Promoci\xF3n "),o()}}function Cn(r,u){if(r&1){let e=C();i(0,"tr",18),g("click",function(){let n=z(e).$implicit,a=d(2);return h(a.promotionSelected(n))}),i(1,"td"),v(2,gn,2,1,"nz-tag",19)(3,_n,2,1,"nz-tag",19),o(),i(4,"td")(5,"nz-tag",20),s(6),o()(),i(7,"td")(8,"nz-tag",20),s(9),o()(),i(10,"td")(11,"span",21),s(12),Ae(13,"date"),o()(),i(14,"td")(15,"span",21),s(16),Ae(17,"date"),o()(),i(18,"td")(19,"span",21),s(20),Ae(21,"date"),o()(),i(22,"td")(23,"a",22),s(24,"Ver Imagen"),o()(),i(25,"td")(26,"a",23),c(27,"i",24),o(),i(28,"nz-dropdown-menu",null,4)(30,"ul",25),v(31,vn,2,0,"li",26)(32,Sn,2,0,"li",26),i(33,"li",27),g("click",function(){let n=z(e).$implicit,a=d(2);return h(a.editPromotion(n.id,n.name,n.description,n.validFrom.toDate(),n.validTo.toDate()))}),s(34,"Editar Promoci\xF3n"),o(),i(35,"li",27),g("click",function(){let n=z(e).$implicit,a=d(2);return h(a.deletePromotiom(n.id))}),s(36,"Borrar Promoci\xF3m"),o()()()()()}if(r&2){let e=u.$implicit,t=y(29);l(2),m("ngIf",e.active),l(),m("ngIf",!e.active),l(2),m("nzColor","blue"),l(),I(e.name),l(2),m("nzColor","blue"),l(),I(e.description),l(3),F(" ",e.validFrom?Oe(13,13,e.validFrom.toDate(),"mediumDate"):""," "),l(4),F(" ",e.validTo?Oe(17,16,e.validTo.toDate(),"mediumDate"):""," "),l(4),F(" ",e.date_created?Oe(21,19,e.date_created.toDate(),"mediumDate"):""," "),l(3),Ne("href",e.imageUrl,Ie),l(3),m("nzDropdownMenu",t),l(5),m("ngIf",e.active),l(),m("ngIf",!e.active)}}function bn(r,u){if(r&1&&(i(0,"nz-table",16,3)(2,"thead")(3,"tr")(4,"th"),s(5,"Activo"),o(),i(6,"th"),s(7,"Nombre"),o(),i(8,"th"),s(9,"Descripci\xF3n"),o(),i(10,"th"),s(11,"Desde "),o(),i(12,"th"),s(13,"Hasta"),o(),i(14,"th"),s(15,"Fecha Creaci\xF3n"),o(),i(16,"th"),s(17,"Imagen"),o(),c(18,"th"),o()(),i(19,"tbody"),v(20,Cn,37,22,"tr",17),o()()),r&2){let e=y(1),t=d();m("nzData",t.promotionsList)("nzPageSize",t.pageSize3)("nzLoading",t.loadingLatestPurchases)("nzLoadingDelay",500),l(20),m("ngForOf",e.data)}}function xn(r,u){if(r&1&&c(0,"img",41),r&2){let e=d(2);m("src",e.previewImage,Ie)("ngStyle",Pe(2,fn))}}function yn(r,u){if(r&1){let e=C();i(0,"form",28),g("ngSubmit",function(){z(e);let n=d();return h(n.createPromotion())}),i(1,"div",29)(2,"div",30)(3,"nz-form-item")(4,"nz-form-label"),s(5,"Nombre"),o(),i(6,"nz-form-control"),c(7,"input",31),o()()(),i(8,"div",30)(9,"nz-form-item")(10,"nz-form-label"),s(11,"Descripci\xF3n"),o(),i(12,"nz-form-control"),c(13,"input",32),o()()(),i(14,"div",33)(15,"nz-form-item")(16,"nz-form-label"),s(17,"Fecha Inicio"),o(),i(18,"nz-form-control"),c(19,"nz-date-picker",34),o()()(),i(20,"div",33)(21,"nz-form-item")(22,"nz-form-label"),s(23,"Fecha Fin"),o(),i(24,"nz-form-control"),c(25,"nz-date-picker",35),o()()(),i(26,"div",33)(27,"nz-form-item")(28,"nz-form-label"),s(29,"Fecha de Creaci\xF3n"),o(),i(30,"nz-form-control"),c(31,"nz-date-picker",36),o()()(),i(32,"div",30)(33,"nz-form-item")(34,"nz-form-label"),s(35,"Adjuntar Promoci\xF3n"),o(),i(36,"nz-form-control")(37,"nz-upload",37),U("nzFileListChange",function(n){z(e);let a=d();return q(a.fileList,n)||(a.fileList=n),h(n)}),g("nzChange",function(n){z(e);let a=d();return h(a.handleChange2(n))}),c(38,"i",38),i(39,"div",39),s(40,"Cargar"),o()(),i(41,"nz-modal",40),g("nzOnCancel",function(){z(e);let n=d();return h(n.previewVisible=!1)}),o()(),v(42,xn,1,3,"ng-template",null,1,V),o()()()()}if(r&2){let e=y(43),t=d();m("formGroup",t.programForm),l(37),R("nzFileList",t.fileList),m("nzShowButton",!0)("nzShowUploadList",t.showUploadList)("nzPreview",t.handlePreview),l(4),m("nzVisible",t.previewVisible)("nzContent",e)("nzFooter",null)}}function En(r,u){if(r&1){let e=C();i(0,"form",28),g("ngSubmit",function(){z(e);let n=d();return h(n.editSavePromotion())}),i(1,"div",29)(2,"div",30)(3,"nz-form-item")(4,"nz-form-label"),s(5,"Nombre"),o(),i(6,"nz-form-control"),c(7,"input",31),o()()(),i(8,"div",30)(9,"nz-form-item")(10,"nz-form-label"),s(11,"Descripci\xF3n"),o(),i(12,"nz-form-control"),c(13,"input",32),o()()(),i(14,"div",33)(15,"nz-form-item")(16,"nz-form-label"),s(17,"Fecha Inicio"),o(),i(18,"nz-form-control"),c(19,"nz-date-picker",34),o()()(),i(20,"div",33)(21,"nz-form-item")(22,"nz-form-label"),s(23,"Fecha Fin"),o(),i(24,"nz-form-control"),c(25,"nz-date-picker",35),o()()()()()}if(r&2){let e=d();m("formGroup",e.programEditForm)}}var gi=(()=>{class r{constructor(e,t,n){this.bucketStorage=e,this.messageService=t,this.fb=n,this.accountId="",this.pageSize3=3,this.loadingLatestPurchases=!1,this.rolService=b(ie),this.promotionsService=b(zi),this.authService=b(W),this.view="cardView",this.infoLoad=[],this.isCreateVisible=!1,this.isEditMode=!1,this.fileListInfo=[],this.fileUrl="http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg",this.autosave=!0,this.uploading=!1,this.bucketPath="promotions/",this.uploadvalue=0,this.pageSize=10,this.usersList=[],this.rowGroupPanelShow=[],this.promotionsList=[],this.promotionsListLoaded=[],this.showUploadList={showPreviewIcon:!0,showRemoveIcon:!0,hidePreviewIconInNonImage:!0},this.previewImage="",this.previewVisible=!1,this.isEditVisible=!1,this.handlePreview=a=>{this.previewImage=a.url||a.thumbUrl,this.previewVisible=!0},this.authService.user.subscribe(a=>{this.user=a,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(p=>{this.infoLoad=p,this.userlevelAccess=this.infoLoad.optionAccessLavel})}),this.programEditForm=this.fb.group({imageUrl:[""],active:[""],uid:[""],name:["",[f.required]],description:["",[f.required]],category:[],validFrom:[new Date],validTo:[new Date],date_created:[]}),this.createForm()}editPromotion(e,t,n,a,p){this.programEditForm.controls.uid.setValue(e),this.programEditForm.controls.name.setValue(t),this.programEditForm.controls.description.setValue(n),this.programEditForm.controls.validFrom.setValue(a),this.programEditForm.controls.validTo.setValue(p),this.isEditVisible=!0}deletePromotiom(e){this.promotionsService.deletePromotion(this.accountId,e)}diactivePromotion(e,t){this.promotionsService.deactivePromotion(t,e,this.accountId)}promotionSelected(e){}createForm(){this.programForm=this.fb.group({imageUrl:[""],active:[""],name:["",[f.required]],description:["",[f.required]],category:[],validFrom:[],validTo:[],date_created:[]})}toggleActive(){}ngOnInit(){this.sub=this.promotionsService.getPromotionsList(this.accountId).pipe(w(e=>e.map(t=>{let n=t.payload.doc.id,a=t.payload.doc.data();return T({id:n},a)}))).subscribe(e=>{this.promotionsList=e,this.promotionsListLoaded=e})}showCreateModal(){this.programForm.reset(),this.isCreateVisible=!0,this.currentSelectedId="",this.currentSelected=null}showModalDelete(e){}sendMessage(e,t){this.messageService.create(e,t)}handleCancel(){this.isCreateVisible=!1,this.isEditMode=!1,this.currentSelectedId="",this.isEditVisible=!1}createPromotion(){if(this.programForm.valid){var e;e={active:!0,name:this.programForm.controls.name.value,description:this.programForm.controls.description.value,validFrom:this.programForm.controls.validFrom.value,validTo:this.programForm.controls.validTo.value,imageUrl:this.programForm.controls.imageUrl.value||"",customerId:this.user.customerId,category:"",date_created:this.programForm.controls.date_created.value},this.userlevelAccess!="3"?this.promotionsService.savePromotion(e,this.accountId).then(()=>{this.messageService.success("Se agreg\xF3 la promoci\xF3n con \xE9xito.",{nzPauseOnHover:!0,nzDuration:3e3}),this.isCreateVisible=!1}):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}}handleChange2(e){if(e.file.status!=="uploading"){let n=e.file.status;this.fileListInfo=e.fileList,e.file.originFileObj&&this.getBase64(e.file.originFileObj,a=>{this.fileUrl=a;let p=e.file.name,_=`${this.bucketPath}/${p}`,S=this.bucketStorage.ref(_);this.task=this.bucketStorage.ref(_).putString(a,"data_url"),this.uploadPercent=this.task.percentageChanges(),this.uploadPercent.pipe(w(E=>Number((E/100).toFixed(2)))).subscribe(E=>{this.uploading=E!=0,this.uploadvalue=E}),this.task.snapshotChanges().pipe(Te(()=>{this.uploading=!1,this.downloadURL=S.getDownloadURL(),this.downloadURL.subscribe(E=>oe(this,null,function*(){this.updateAdvanceURL(E),E.length>0?this.sendMessage("success",`${e.file.name} Archivo cargado satisfactoriamente.`):n==="error"&&this.sendMessage("error",`${e.file.name} archivo fallido, favor de validar.`)}))})).subscribe()})}}getBase64(e,t){let n=new FileReader;n.readAsDataURL(e),n.onload=()=>t(n.result),n.onerror=a=>this.sendMessage("error",a.toString())}updateAdvanceURL(e){return oe(this,null,function*(){this.programForm.controls.imageUrl.patchValue(e)})}onGridReady(e){this.gridApi=e.api,this.gridColumnApi=e.columnApi}setPaginationPageSize(e=10){this.pageSize=e,this.gridApi.paginationSetPageSize(Number(e))}editSavePromotion(){this.programEditForm.valid?(this.promotionsService.editPromotion(this.programEditForm.controls.uid.value,this.accountId,this.programEditForm.controls.name.value,this.programEditForm.controls.description.value,this.programEditForm.controls.validFrom.value,this.programEditForm.controls.validTo.value).then(()=>{this.messageService.success("Todo sali\xF3 bien.",{nzPauseOnHover:!0,nzDuration:3e3})}),this.isEditVisible=!1):this.sendMessage("error","Datos invalidos favor de validar")}getItems(e){let t=e;if(!t){this.promotionsList=this.promotionsListLoaded.slice();return}let n=t.toLowerCase();this.promotionsList=this.promotionsListLoaded.filter(a=>Object.values(a).some(p=>String(p).toLowerCase().includes(n)))}static{this.\u0275fac=function(t){return new(t||r)(x(Ke),x(N),x(A))}}static{this.\u0275cmp=D({type:r,selectors:[["app-promotions"]],inputs:{accountId:"accountId"},decls:25,vars:6,consts:[["searchBar",""],["modalContent",""],["modalContentEdit",""],["basicTable",""],["chatSetting","nzDropdownMenu"],[1,"site-page-header",2,"background-color","#f9fbfd"],[1,"site-page-header-ghost-wrapper"],[3,"nzGhost"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["nz-row",""],[1,"content"],["nz-icon","","nzTheme","outline",1,"search-icon"],["placeholder","Buscar",3,"keyup"],[3,"nzData","nzPageSize","nzLoading","nzLoadingDelay",4,"ngIf"],["nzTitle","Agregar Promoci\xF3n",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible","nzContent"],["nzTitle","Editar Promoci\xF3n",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible","nzContent"],[3,"nzData","nzPageSize","nzLoading","nzLoadingDelay"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[3,"nzColor",4,"ngIf"],[3,"nzColor"],["nz-text","","nzType","secondary"],["target","_blank",3,"href"],["nz-dropdown","",3,"nzDropdownMenu"],["nz-icon","","nzType","more","nzTheme","outline"],["nz-menu",""],["nz-menu-item","",3,"click",4,"ngIf"],["nz-menu-item","",3,"click"],["nz-form","","nzLayout","vertical",3,"ngSubmit","formGroup"],[1,"row"],[1,"col-md-12","col-sm-12"],["nz-input","","formControlName","name","id","descriptioA"],["nz-input","","formControlName","description","id","descriptioA"],[1,"col-md-7","col-sm-12"],["formControlName","validFrom"],["formControlName","validTo"],["formControlName","date_created"],["zAction","/api/posts/","nzListType","picture-card",3,"nzFileListChange","nzChange","nzFileList","nzShowButton","nzShowUploadList","nzPreview"],["nz-icon",""],[1,"ant-upload-text"],[3,"nzOnCancel","nzVisible","nzContent","nzFooter"],[3,"src","ngStyle"]],template:function(t,n){if(t&1){let a=C();i(0,"nz-page-header",5)(1,"nz-page-header-title"),s(2,"Promociones"),o(),i(3,"nz-page-header-subtitle"),s(4,"Promociones de esta empresa"),o(),i(5,"nz-page-header-extra")(6,"div",6)(7,"nz-page-header",7)(8,"nz-page-header-extra")(9,"button",8),g("click",function(){return z(a),h(n.showCreateModal())}),s(10,"Agregar Promocion"),o()()()()(),i(11,"nz-page-header-content")(12,"div",9)(13,"div",10),c(14,"i",11),i(15,"input",12,0),g("keyup",function(){z(a);let _=y(16);return h(n.getItems(_.value))}),o()()()()(),c(17,"br"),v(18,bn,21,5,"nz-table",13),i(19,"nz-modal",14),U("nzVisibleChange",function(_){return z(a),q(n.isCreateVisible,_)||(n.isCreateVisible=_),h(_)}),g("nzOnCancel",function(){return z(a),h(n.handleCancel())})("nzOnOk",function(){return z(a),h(n.createPromotion())}),o(),v(20,yn,44,8,"ng-template",null,1,V),i(22,"nz-modal",15),U("nzVisibleChange",function(_){return z(a),q(n.isEditVisible,_)||(n.isEditVisible=_),h(_)}),g("nzOnCancel",function(){return z(a),h(n.handleCancel())})("nzOnOk",function(){return z(a),h(n.editSavePromotion())}),o(),v(23,En,26,1,"ng-template",null,2,V)}if(t&2){let a=y(21),p=y(24);l(7),m("nzGhost",!1),l(11),m("ngIf",n.promotionsList),l(),R("nzVisible",n.isCreateVisible),m("nzContent",a),l(3),R("nzVisible",n.isEditVisible),m("nzContent",p)}},dependencies:[k,ae,Re,me,X,G,Y,J,K,Q,ce,St,Xe,$e,We,Ye,Ge,Je,Ce,Ze,Se,ve,be,xe,ye,te,Z,ee,de,He,Be,ht,Ee,Qe,H,se,M,j,B,$,ct]})}}return r})();var _i=()=>({width:"100%"});function Fn(r,u){r&1&&c(0,"span",27)}function Vn(r,u){if(r&1&&c(0,"img",61),r&2){let e=d(2);m("src",e.previewImage,Ie)("ngStyle",Pe(2,_i))}}function In(r,u){r&1&&(i(0,"div",62),s(1," El precio es requerido. "),o())}function Nn(r,u){r&1&&(i(0,"div",62),s(1," El precio debe ser mayor a 0. "),o())}function Pn(r,u){if(r&1&&(i(0,"div",62),v(1,In,2,0,"div",55)(2,Nn,2,0,"div",55),o()),r&2){let e=d(2);l(),m("ngIf",e.isPriceRequired()),l(),m("ngIf",e.isPriceMin())}}function Dn(r,u){if(r&1){let e=C();i(0,"form",28),g("ngSubmit",function(){z(e);let n=d();return h(n.submitForm("A"))}),i(1,"div",12)(2,"div",29)(3,"nz-form-item")(4,"nz-form-label",30),s(5,"Nombre"),o(),i(6,"nz-form-control"),c(7,"input",31),o()()(),i(8,"div",32)(9,"nz-form-item")(10,"nz-form-label"),s(11,"Activo"),o(),i(12,"nz-form-control"),c(13,"nz-switch",33),o()()()(),i(14,"div",12)(15,"div",29)(16,"nz-form-item")(17,"nz-form-label"),s(18,"Descripci\xF3n"),o(),i(19,"nz-form-control"),c(20,"textarea",34),o()()(),i(21,"div",32)(22,"nz-form-item")(23,"nz-form-label"),s(24,"Adjuntar Imagen"),o(),i(25,"nz-form-control")(26,"nz-upload",35),U("nzFileListChange",function(n){z(e);let a=d();return q(a.fileList,n)||(a.fileList=n),h(n)}),g("nzChange",function(n){z(e);let a=d();return h(a.handleChange(n))}),i(27,"div",36),s(28,"Cargar"),o()()(),v(29,Vn,1,3,"ng-template",null,4,V),o()()(),i(31,"div",12)(32,"div",11)(33,"nz-form-item")(34,"nz-form-label"),s(35,"Categor\xEDa"),o(),i(36,"nz-form-control")(37,"nz-select",37),c(38,"nz-option",38)(39,"nz-option",39)(40,"nz-option",40)(41,"nz-option",41)(42,"nz-option",42)(43,"nz-option",43)(44,"nz-option",44)(45,"nz-option",45)(46,"nz-option",46)(47,"nz-option",47)(48,"nz-option",48),o()()()(),i(49,"div",11)(50,"nz-form-item")(51,"nz-form-label"),s(52,"Validez"),o(),i(53,"nz-form-control")(54,"nz-range-picker",49),g("nzOnCalendarChange",function(n){z(e);let a=d();return h(a.mapDateValues(n))}),o()()()()(),i(55,"div",12)(56,"div",50)(57,"nz-form-item")(58,"nz-form-label"),s(59,"Mete"),o(),i(60,"nz-form-control"),c(61,"nz-switch",51),o()()(),i(62,"div",50)(63,"nz-form-item")(64,"nz-form-label"),s(65,"Saca"),o(),i(66,"nz-form-control"),c(67,"nz-switch",52),o()()(),i(68,"div",53)(69,"nz-form-label"),s(70,"Precio"),o(),i(71,"nz-form-control"),c(72,"nz-input-number",54),v(73,Pn,3,2,"div",55),o()(),i(74,"div",50)(75,"nz-form-item")(76,"nz-form-label"),s(77,"Calculado"),o(),i(78,"nz-form-control"),c(79,"nz-switch",56),o()()(),i(80,"div",53)(81,"div")(82,"nz-form-label"),s(83,"Asientos"),o(),c(84,"nz-input-number",57),o()()(),i(85,"div",12)(86,"div",11)(87,"nz-form-item")(88,"nz-form-label"),s(89,"Frecuencias (Opcional)"),o(),i(90,"nz-select",58),c(91,"nz-option",59)(92,"nz-option",59)(93,"nz-option",59)(94,"nz-option",59)(95,"nz-option",59),o()()(),i(96,"div",11)(97,"nz-form-item")(98,"nz-form-label"),s(99,"Tipo de Producto (Opcional)"),o(),i(100,"nz-select",60),c(101,"nz-option",59)(102,"nz-option",59),o()()()()()}if(r&2){let e=d();m("formGroup",e.validateForm),l(26),R("nzFileList",e.fileList),m("nzShowButton",!0)("nzShowUploadList",e.showUploadList)("nzPreview",e.handlePreview),l(46),m("nzMin",0)("nzMax",12e4)("nzStep",1),l(),m("ngIf",e.isPriceInvalid()),l(11),m("nzMin",0)("nzMax",200)("nzStep",1),l(7),m("nzValue",1)("nzLabel",1),l(),m("nzValue",2)("nzLabel",2),l(),m("nzValue",3)("nzLabel",3),l(),m("nzValue",4)("nzLabel",4),l(),m("nzValue",5)("nzLabel",5),l(6),m("nzValue",e.camioneta)("nzLabel",e.camioneta),l(),m("nzValue",e.camion)("nzLabel",e.camion)}}function Ln(r,u){if(r&1&&c(0,"img",61),r&2){let e=d(2);m("src",e.previewImage,Ie)("ngStyle",Pe(2,_i))}}function kn(r,u){r&1&&(i(0,"div",62),s(1," El precio es requerido. "),o())}function Mn(r,u){r&1&&(i(0,"div",62),s(1," El precio debe ser mayor a 0. "),o())}function An(r,u){if(r&1&&(i(0,"div",62),v(1,kn,2,0,"div",55)(2,Mn,2,0,"div",55),o()),r&2){let e=d(2);l(),m("ngIf",e.isPriceRequired()),l(),m("ngIf",e.isPriceMin())}}function On(r,u){if(r&1){let e=C();i(0,"form",28),g("ngSubmit",function(){z(e);let n=d();return h(n.submitForm("A"))}),i(1,"div",12)(2,"div",29)(3,"nz-form-item")(4,"nz-form-label",30),s(5,"Nombre"),o(),i(6,"nz-form-control"),c(7,"input",63),o()()()(),i(8,"div",12)(9,"div",29)(10,"nz-form-item")(11,"nz-form-label"),s(12,"Descripci\xF3n"),o(),i(13,"nz-form-control"),c(14,"textarea",34),o()()(),i(15,"div",32)(16,"nz-form-item")(17,"nz-form-label"),s(18,"Adjuntar Imagen"),o(),i(19,"nz-form-control")(20,"nz-upload",64),U("nzFileListChange",function(n){z(e);let a=d();return q(a.fileListE,n)||(a.fileListE=n),h(n)}),g("nzChange",function(n){z(e);let a=d();return h(a.handleChange2(n))}),i(21,"div",36),s(22,"Cargar"),o()(),i(23,"nz-modal",65),g("nzOnCancel",function(){z(e);let n=d();return h(n.previewVisibleE=!1)}),o()(),v(24,Ln,1,3,"ng-template",null,4,V),o()()(),i(26,"div",12)(27,"div",11)(28,"nz-form-item")(29,"nz-form-label"),s(30,"Categor\xEDa"),o(),i(31,"nz-form-control")(32,"nz-form-control")(33,"nz-select",66),c(34,"nz-option",38)(35,"nz-option",39)(36,"nz-option",40)(37,"nz-option",41)(38,"nz-option",42)(39,"nz-option",43)(40,"nz-option",44)(41,"nz-option",45)(42,"nz-option",46)(43,"nz-option",47)(44,"nz-option",48),o()()()()(),i(45,"div",11)(46,"nz-form-item")(47,"nz-form-label"),s(48,"Validez"),o(),i(49,"nz-form-control")(50,"nz-range-picker",67),g("nzOnCalendarChange",function(n){z(e);let a=d();return h(a.mapDateValues(n))}),o()()()()(),i(51,"div",12)(52,"div",50)(53,"nz-form-item")(54,"nz-form-label"),s(55,"Mete"),o(),c(56,"nz-switch",68),o()(),i(57,"div",50)(58,"nz-form-item")(59,"nz-form-label"),s(60,"Saca"),o(),c(61,"nz-switch",69),o()(),i(62,"div",53)(63,"nz-form-label"),s(64,"Precio"),o(),c(65,"nz-input-number",54),v(66,An,3,2,"div",55),o(),i(67,"div",50)(68,"nz-form-item")(69,"nz-form-label"),s(70,"Calculado"),o(),c(71,"nz-switch",56),o()(),i(72,"div",53)(73,"div")(74,"nz-form-label"),s(75,"Asientos"),o(),c(76,"nz-input-number",57),o()()(),i(77,"div",12)(78,"div",11)(79,"nz-form-item")(80,"nz-form-label"),s(81,"Frecuencias (Opcional)"),o(),i(82,"nz-select",58),c(83,"nz-option",59)(84,"nz-option",59)(85,"nz-option",59)(86,"nz-option",59)(87,"nz-option",59),o()()(),i(88,"div",11)(89,"nz-form-item")(90,"nz-form-label"),s(91,"Tipo de Producto (Opcional)"),o(),i(92,"nz-select",60),c(93,"nz-option",59)(94,"nz-option",59),o()()()()()}if(r&2){let e=y(25),t=d();m("formGroup",t.validateFormE),l(20),R("nzFileList",t.fileListE),m("nzShowButton",!0)("nzShowUploadList",t.showUploadList)("nzPreview",t.handlePreviewE),l(3),m("nzVisible",t.previewVisibleE)("nzContent",e)("nzFooter",null),l(10),m("disabled",!0),l(17),m("disabled",!0),l(6),m("disabled",!0),l(5),m("disabled",!0),l(4),m("nzMin",0)("nzMax",12e4)("nzStep",1),l(),m("ngIf",t.isPriceInvalid()),l(10),m("nzMin",0)("nzMax",200)("nzStep",1),l(7),m("nzValue",1)("nzLabel",1),l(),m("nzValue",2)("nzLabel",2),l(),m("nzValue",3)("nzLabel",3),l(),m("nzValue",4)("nzLabel",4),l(),m("nzValue",5)("nzLabel",5),l(6),m("nzValue",t.camioneta)("nzLabel",t.camioneta),l(),m("nzValue",t.camion)("nzLabel",t.camion)}}function Rn(r,u){if(r&1){let e=C();i(0,"li",77),g("click",function(){z(e);let n=d().$implicit,a=d(2);return h(a.toggleActivateProduct(n))}),i(1,"a"),c(2,"i",85),i(3,"span",79),s(4,"Detener venta"),o()()()}}function qn(r,u){if(r&1){let e=C();i(0,"li",77),g("click",function(){z(e);let n=d().$implicit,a=d(2);return h(a.toggleActivateProduct(n))}),i(1,"a"),c(2,"i",86),i(3,"span",79),s(4,"Activar venta"),o()()()}}function Un(r,u){r&1&&(i(0,"nz-tag",83),s(1,"Venta Activa"),o()),r&2&&m("nzColor","green")}function jn(r,u){r&1&&(i(0,"nz-tag",83),s(1,"Venta Detenida"),o()),r&2&&m("nzColor","red")}function Hn(r,u){if(r&1&&c(0,"img",87),r&2){let e=d().$implicit;Ne("src",e.imageUrl,Ie)}}function Bn(r,u){if(r&1){let e=C();i(0,"div",53)(1,"nz-card",71),c(2,"nz-card-meta",72),i(3,"div")(4,"a",73),c(5,"i",74),o(),i(6,"nz-dropdown-menu",null,5)(8,"ul",75),v(9,Rn,5,0,"li",76)(10,qn,5,0,"li",76),i(11,"li",77),g("click",function(){let n=z(e).$implicit,a=d(2),p=y(25);return h(a.editProduct(n,p))}),i(12,"a"),c(13,"i",78),i(14,"span",79),s(15,"Editar"),o()()(),c(16,"li",80),i(17,"li",77),g("click",function(){let n=z(e).$implicit,a=d(2);return h(a.deleteProduct(n))}),i(18,"a"),c(19,"i",81),i(20,"span",79),s(21,"Eliminar "),o()()()()()(),i(22,"div",82)(23,"div")(24,"nz-tag",83),s(25),o(),v(26,Un,2,1,"nz-tag",84)(27,jn,2,1,"nz-tag",84),o()(),v(28,Hn,1,1,"ng-template",null,6,V),o()()}if(r&2){let e=u.$implicit,t=y(7),n=y(29);l(),m("nzCover",n),l(),Ne("nzTitle",e.name),Ne("nzDescription",e.description),l(2),m("nzDropdownMenu",t),l(5),m("ngIf",e.active),l(),m("ngIf",!e.active),l(14),m("nzColor","blue"),l(),I(e.type),l(),m("ngIf",e.active),l(),m("ngIf",!e.active)}}function $n(r,u){if(r&1&&(i(0,"div",12),v(1,Bn,30,10,"div",70),o()),r&2){let e=d();l(),m("ngForOf",e.productsList)}}function Wn(r,u){r&1&&(i(0,"nz-tag",83),s(1,"Activo"),o()),r&2&&m("nzColor","green")}function Gn(r,u){if(r&1){let e=C();i(0,"li",77),g("click",function(){z(e);let n=d().$implicit,a=d(2);return h(a.toggleActivateProduct(n))}),i(1,"a"),c(2,"i",85),i(3,"span",79),s(4,"Detener venta"),o()()()}}function Xn(r,u){if(r&1){let e=C();i(0,"li",77),g("click",function(){z(e);let n=d().$implicit,a=d(2);return h(a.toggleActivateProduct(n))}),i(1,"a"),c(2,"i",86),i(3,"span",79),s(4,"Activar venta"),o()()()}}function Jn(r,u){if(r&1){let e=C();i(0,"tr")(1,"td")(2,"div",91),c(3,"nz-avatar",92),i(4,"div",79)(5,"h5",93),s(6),o()()()(),i(7,"td"),s(8),o(),i(9,"td"),s(10),o(),i(11,"td")(12,"nz-tag",83),s(13),o()(),i(14,"td",89),v(15,Wn,2,1,"nz-tag",84),o(),i(16,"td",94)(17,"div")(18,"a",73),c(19,"i",74),o(),i(20,"nz-dropdown-menu",null,8)(22,"ul",75),v(23,Gn,5,0,"li",76)(24,Xn,5,0,"li",76),i(25,"li",95)(26,"a"),c(27,"i",78),i(28,"span",79),s(29,"Editar"),o()()(),c(30,"li",80),i(31,"li",77),g("click",function(){let n=z(e).$implicit,a=d(2);return h(a.deleteProduct(n))}),i(32,"a"),c(33,"i",81),i(34,"span",79),s(35,"Eliminar "),o()()()()()()()()}if(r&2){let e=u.$implicit,t=y(21);l(3),Ne("nzSrc",e.imageUrl),l(3),I(e.name),l(2),I(e.category),l(2),I(e.description),l(2),m("nzColor","blue"),l(),I(e.type),l(2),m("ngIf",e.active),l(3),m("nzDropdownMenu",t),l(5),m("ngIf",e.active),l(),m("ngIf",!e.active)}}function Yn(r,u){if(r&1&&(i(0,"nz-card")(1,"nz-table",88,7)(3,"thead")(4,"tr")(5,"th"),s(6,"Nombre"),o(),i(7,"th"),s(8,"Categor\xEDa"),o(),i(9,"th"),s(10,"Descripci\xF3n"),o(),i(11,"th"),s(12,"Tipo"),o(),i(13,"th",89),s(14,"Status"),o(),c(15,"th"),o()(),i(16,"tbody"),v(17,Jn,36,10,"tr",90),o()()()),r&2){let e=y(2),t=d();l(),m("nzData",t.productsList),l(16),m("ngForOf",e.data)}}var vi=(()=>{class r{constructor(e,t,n,a,p,_){this.modal=e,this.bucketStorage=t,this.afs=n,this.modalService=a,this.messageService=p,this.fb=_,this.accountId="",this.rolService=b(ie),this.productsService=b(ri),this.usersService=b(ut),this.view="cardView",this.productsList=[],this.productsListLoaded=[],this.infoLoad=[],this.userService=b(zt),this.authService=b(W),this.fileListInfo=[],this.fileList=[],this.fileListE=[],this.fileUrl="http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg",this.autosave=!0,this.uploading=!1,this.bucketPath="products1/products",this.uploadvalue=0,this.showUploadList={showPreviewIcon:!0,showRemoveIcon:!0,hidePreviewIconInNonImage:!0},this.previewImage="",this.previewImageE="",this.camioneta="Camioneta",this.camion="Cami\xF3n",this.previewVisible=!1,this.previewVisibleE=!1,this.weekControls=[],this.weekControlsE=[],this.handlePreview=S=>{this.previewImage=S.url||S.thumbUrl,this.previewVisible=!0},this.handlePreviewE=S=>{this.previewImageE=S.url||S.thumbUrl,this.previewVisibleE=!0},this.authService.user.subscribe(S=>{this.user=S,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(E=>{this.infoLoad=E,this.userlevelAccess=this.infoLoad.optionAccessLavel})})}ngOnInit(){this.createForm(),this.getSubscriptions(),this.validateForm.get("weeks").valueChanges.subscribe(e=>{this.onFrequencyChange(e)})}ngOnDestroy(){}createForm(){this.validateForm=this.fb.group({active:[!1,[f.required]],category:[null,[f.required]],date_created:[new Date,[f.required]],description:[null,[f.required]],isTaskIn:[!0,[f.required]],isTaskOut:[!0,[f.required]],name:[null,[f.required]],price:[null,[f.required,f.min(1)]],timesSold:[0,[f.required]],type:["Servicio"],rangeDatePicker:[null],validFrom:[new Date,[f.required]],validTo:[new Date,[f.required]],imageUrl:[""],frequencies:[""],transportType:[""],weeks:[""],disable:[!1],rangeWeeks:this.fb.group({}),amountTrips:[0],id:[],sits:[0],isCalculate:[!1],customerId:[""]}),this.validateFormE=this.fb.group({active:[!1,[f.required]],category:[null],date_created:[new Date],description:[null,[f.required]],isTaskIn:[!0],isTaskOut:[!0],name:[null,[f.required]],price:[null,[f.required,f.min(1)]],timesSold:[0],type:["Servicio"],rangeDatePicker:[null],validFrom:[new Date],validTo:[new Date],imageUrl:[""],frequencies:[""],transportType:[""],weeks:[""],disable:[!1],rangeWeeks:this.fb.group({}),amountTrips:[0],sits:[0],id:[],isCalculate:[],customerId:[""]})}get price(){return this.validateForm.get("price")}isPriceInvalid(){let e=this.price;return!!(e&&e.invalid&&(e.dirty||e.touched))}isPriceRequired(){let e=this.price;return!!(e&&e.errors?.required)}isPriceMin(){let e=this.price;return!!(e&&e.errors?.min)}resetForm(){this.fileList=[],this.fileListE=[],this.validateForm.reset({active:!1,date_created:new Date,isTaskIn:!0,isTaskOut:!0,price:0,timesSold:0,validFrom:new Date,validTo:new Date,frequencies:"",transportType:"",weeks:"",imageUrl:"",amountTrips:0,sits:0,customerId:""}),this.validateFormE.reset({active:!1,date_created:new Date,isTaskIn:!0,isTaskOut:!0,price:0,timesSold:0,validFrom:new Date,validTo:new Date,frequencies:"",transportType:"",imageUrl:"",weeks:"",amountTrips:0,sits:0,customerId:""})}mapDateValues(e){e.length>1&&(this.validateForm.controls.validFrom.patchValue(new Date(e[0])),this.validateForm.controls.validTo.patchValue(new Date(e[1])))}sendMessage(e,t){this.messageService.create(e,t)}submitForm(e){var t=0;if(this.userlevelAccess!="3")if(e=="A")if(this.validateForm.valid){let n=this.validateForm.controls.frequencies.value||0;n>0&&(t=Number(n)*80),this.validateForm.controls.amountTrips.setValue(t),this.validateForm.controls.type.setValue("Servicio"),this.validateForm.controls.disable.setValue(!1),this.validateForm.controls.customerId.setValue(this.accountId),this.productsService.setProduct(this.accountId,this.validateForm.value).then(()=>{this.resetForm(),this.modalService.closeAll(),this.messageService.success("Todo sali\xF3 bien.",{nzPauseOnHover:!0,nzDuration:3e3})})}else this.sendMessage("error","Hay valores requeridos para crear el producto, favor de validar.");else if(this.validateFormE.valid){let n=this.validateFormE.controls.id.value,a=this.validateFormE.controls.frequencies.value||0;a>0&&(t=Number(a)*80),this.validateFormE.controls.amountTrips.setValue(t),this.validateFormE.controls.type.setValue("Servicio"),this.validateFormE.controls.disable.setValue(!1),this.validateFormE.controls.customerId.setValue(this.accountId),this.productsService.updateProduct(this.accountId,this.validateFormE.controls.id.value,this.validateFormE.value).then(()=>{this.resetForm(),this.modalService.closeAll(),this.messageService.success("Todo sali\xF3 bien.",{nzPauseOnHover:!0,nzDuration:3e3})})}else this.sendMessage("error","Hay valores requeridos para crear el producto, favor de validar.")}toggleActivateProduct(e){e.active?this.showDeactivateConfirm(e):this.processtoDeactivateProduct(this.accountId,e.id,e.active)}showDeactivateConfirm(e){this.modal.confirm({nzTitle:"Estas Seguro de detener la venta? ",nzContent:`<b style="color: red;">${e.name}</b> ser\xE1 desacrivado. </b>  Una ves realizado todos los pases asociados se desactivaran`,nzOkText:"Yes",nzOkType:"primary",nzOnOk:()=>this.processtoDeactivateProduct(this.accountId,e.id,e.active),nzCancelText:"No"})}processtoDeactivateProduct(e,t,n){this.productsService.toggleProductActive(e,t,n),this.productsService.toggleBoardingPass(t,n),this.productsService.togglePurchaseRequests(t,n)}getSubscriptions(){this.sub=this.usersService.getAccountProducts(this.accountId).pipe(w(e=>e.map(t=>{let n=t.payload.doc.id,a=t.payload.doc.data();return he(T({},a),{id:n})}))).subscribe(e=>{this.productsList=e,this.productsListLoaded=e})}deleteProduct(e){this.userlevelAccess=="1"?this.productsService.deleteProduct(this.accountId,e.id).then(()=>{this.messageService.success(`El ${e.type} ${e.name} ha sido eliminado.`,{nzPauseOnHover:!0,nzDuration:3e3}),this.productsService.toggleBoardingPass(e.id,!1),this.productsService.togglePurchaseRequests(e.id,!1)}):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}initializeRangeDatePicker(e,t){let n=this.convertTimestampToDate(e),a=this.convertTimestampToDate(t);return[n,a]}convertTimestampToDate(e){return new Date(e.seconds*1e3)}editProduct(e,t){this.resetForm();let n=this.initializeRangeDatePicker(e.validFrom,e.validTo)??null;if(this.validateFormE.patchValue({active:e.active||!1,category:e.category||null,date_created:e.date_created||new Date,description:e.description||null,isTaskIn:e.isTaskIn||!0,isTaskOut:e.isTaskOut||!0,name:e.name||null,price:e.price||0,timesSold:e.timesSold||0,type:e.type||null,rangeDatePicker:n,validFrom:e.validFrom||new Date,validTo:e.validTo||new Date,imageUrl:e.imageUrl||"",frequencies:e.frequencies||null,transportType:e.transportType||"",amountTrips:e.amountTrips||0,weeks:e.weeks||0,rangeWeeks:e.rangeWeeks||{},id:e.id,isCalculate:e.isCalculate||!1,sits:e.sits||0,customerId:e.customerId||""}),e.rangeWeeks!=null){let p=this.validateFormE.get("rangeWeeks");for(let[_,S]of Object.entries(e.rangeWeeks))p.addControl(_,this.fb.control(S))}this.validateFormE.get("category")?.disable(),this.validateFormE.get("date_created")?.disable(),this.validateFormE.get("timesSold")?.disable(),this.validateFormE.get("type")?.disable(),this.validateFormE.get("validFrom")?.disable(),this.validateFormE.get("validTo")?.disable(),this.validateFormE.get("isTaskIn")?.disable(),this.validateFormE.get("isTaskOut")?.disable();let a=this.modalService.create({nzTitle:"Editar Producto / Servicio",nzContent:t,nzFooter:[{label:"Guardar Cambios",type:"primary",onClick:()=>this.modalService.confirm({nzTitle:"\xBFEstas seguro de los cambios?",nzOnOk:()=>{this.submitForm("E")}})}],nzWidth:800})}showNewModal(e){this.resetForm();let t=this.modalService.create({nzTitle:"Nuevo Servicio",nzContent:e,nzFooter:[{label:"Crear",type:"primary",onClick:()=>this.modalService.confirm({nzTitle:"\xBFEst\xE1 seguro?",nzOnOk:()=>{this.submitForm("A")}})}],nzWidth:800})}handleChange(e){let t=e.file.status;t!=="uploading"&&(this.fileList=e.fileList,e.file.originFileObj&&this.getBase64(e.file.originFileObj,n=>{let a=e.file.name,p=`${this.bucketPath}/${a}`,_=this.bucketStorage.ref(p);this.task=this.bucketStorage.ref(p).putString(n,"data_url"),this.uploadPercent=this.task.percentageChanges(),this.uploadPercent.pipe(w(S=>Number((S/100).toFixed(2)))).subscribe(S=>{this.uploading=S!=0,this.uploadvalue=S}),this.task.snapshotChanges().pipe(Te(()=>{this.uploading=!1,this.downloadURL=_.getDownloadURL(),this.downloadURL.subscribe(S=>oe(this,null,function*(){this.updateAdvanceURL(S,"A"),S.length>0?this.sendMessage("success",`${e.file.name} Archivo cargado satisfactoriamente.`):t==="error"&&this.sendMessage("error",`${e.file.name} archivo fallido, favor de validar.`)}))})).subscribe()}))}handleChange2(e){if(e.file.status!=="uploading"){let n=e.file.status;this.fileListE=e.fileList,e.file.originFileObj&&this.getBase64(e.file.originFileObj,a=>{this.fileUrl=a;let p=e.file.name,_=`${this.bucketPath}/${p}`,S=this.bucketStorage.ref(_);this.task=this.bucketStorage.ref(_).putString(a,"data_url"),this.uploadPercent=this.task.percentageChanges(),this.uploadPercent.pipe(w(E=>Number((E/100).toFixed(2)))).subscribe(E=>{this.uploading=E!=0,this.uploadvalue=E}),this.task.snapshotChanges().pipe(Te(()=>{this.uploading=!1,this.downloadURL=S.getDownloadURL(),this.downloadURL.subscribe(E=>oe(this,null,function*(){this.updateAdvanceURL(E,"E"),E.length>0?this.sendMessage("success",`${e.file.name} Archivo cargado satisfactoriamente.`):n==="error"&&this.sendMessage("error",`${e.file.name} archivo fallido, favor de validar.`)}))})).subscribe()})}}getBase64(e,t){let n=new FileReader;n.readAsDataURL(e),n.onload=()=>t(n.result),n.onerror=a=>this.sendMessage("error",a.toString())}updateAdvanceURL(e,t){return oe(this,null,function*(){t=="A"?this.validateForm.controls.imageUrl.patchValue(e):this.validateFormE.controls.imageUrl.patchValue(e)})}onFrequencyChange(e){this.weekControls=[];let t=this.fb.group({});for(let n=0;n<e;n++){let a=new it(null);a.valueChanges.subscribe(p=>this.getWeek(p,n)),this.weekControls.push(a),t.addControl(`week${n+1}`,new it(null))}this.validateForm.setControl("rangeWeeks",t)}onFrequencyChangeE(e){this.weekControlsE=[];let t=this.fb.group({});for(let n=0;n<e;n++){let a=new it(null);a.valueChanges.subscribe(p=>this.getWeekE(p,n)),this.weekControlsE.push(a),t.addControl(`week${n+1}`,new it(null))}this.validateFormE.setControl("rangeWeeks",t)}getWeekNumber(e){let t=new Date(e.getFullYear(),0,1),n=(e.getDay()+6)%7;return t.setDate(t.getDate()+4-(t.getDay()||7)),Math.ceil(((e.getTime()-t.getTime())/864e5+1)/7).toString().padStart(2,"0")}getWeek(e,t){if(e){let n=e.getFullYear(),a=this.getWeekNumber(e),p=this.getStartOfWeek(new Date(e)),_=this.getEndOfWeek(new Date(e)),S={week:`${n}-${a}`,startDay:p.toISOString().split("T")[0],endDay:_.toISOString().split("T")[0]};this.validateForm.get("rangeWeeks").controls[`week${t+1}`].setValue(S)}}getWeekE(e,t){if(e){let n=e.getFullYear(),a=this.getWeekNumber(e),p=this.getStartOfWeek(new Date(e)),_=this.getEndOfWeek(new Date(e)),S={week:`${n}-${a}`,startDay:p.toISOString().split("T")[0],endDay:_.toISOString().split("T")[0]};this.validateFormE.get("rangeWeeks").controls[`week${t+1}`].setValue(S)}}getStartOfWeek(e){let t=new Date(e);t.setDate(t.getDate()+7);let n=t.getDay(),a=t.getDate()-n+(n===0?-6:1);return t.setDate(a),new Date(t.setHours(0,0,0,0))}getEndOfWeek(e){let t=this.getStartOfWeek(e);return t.setUTCDate(t.getUTCDate()+4),new Date(t.setUTCHours(23,59,59,999))}getItems(e){let t=e;if(!t){this.productsList=this.productsListLoaded.slice();return}let n=t.toLowerCase();this.productsList=this.productsListLoaded.filter(a=>a.description.toLowerCase().includes(n))}static{this.\u0275fac=function(t){return new(t||r)(x(fe),x(Ke),x(le),x(fe),x(N),x(A))}}static{this.\u0275cmp=D({type:r,selectors:[["app-shared-products-list"]],inputs:{accountId:"accountId"},decls:30,vars:4,consts:[["searchBar",""],["suffixIconSearch",""],["newContent",""],["editContent",""],["modalContent",""],["projectListSetting","nzDropdownMenu"],["coverTemplate",""],["listViewTable",""],["projectListSetting2","nzDropdownMenu"],[1,"page-header"],[1,"row","align-items-md-center"],[1,"col-md-6"],[1,"row"],[2,"margin-left","10px","width","280px"],[3,"nzSuffix"],["type","text","nz-input","","placeholder","Selecciona unn producto",3,"keyup"],[1,"text-md-right","m-v-10"],[1,"m-r-10",3,"ngModelChange","ngModel"],["nz-radio-button","","nzValue","cardView","nzTitle","Vista de tarjeta","nzPlacement","bottom","nz-tooltip",""],["nz-icon","","nzType","appstore","theme","outline",1,"font-size-16"],["nz-radio-button","","nzValue","listView","nzTitle","Vista de lista","nzPlacement","bottom","nz-tooltip",""],["nz-icon","","nzType","ordered-list","theme","outline",1,"font-size-16"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["nz-icon","","nzType","plus"],[1,"container-fluid"],["class","row",4,"ngIf"],[4,"ngIf"],["nz-icon","","nzType","search"],["nz-form","","nzLayout","vertical",3,"ngSubmit","formGroup"],[1,"col-md-8"],["nzRequired","true"],["type","text","formControlName","name","nz-input","","placeholder","Escriba el nombre del producto / servicio"],[1,"col-md-4"],["formControlName","active"],["nz-input","","formControlName","description"],["nzAction","https://www.mocky.io/v2/5cc8019d300000980a055e76","nzListType","picture-card",3,"nzFileListChange","nzChange","nzFileList","nzShowButton","nzShowUploadList","nzPreview"],[1,"ant-upload-text"],["nzPlaceHolder","Selecciona una opci\xF3n","formControlName","category",1,"w-100"],["nzLabel","Servicio de Transporte Ordinario","nzValue","permanente"],["nzLabel","Servicio Especial","nzValue","especial"],["nzLabel","Producto","nzValue","producto"],["nzLabel","Comedor","nzValue","comedor"],["nzLabel","Seguridad","nzValue","seguridad"],["nzLabel","Monitoreo","nzValue","monitoreo"],["nzLabel","Limpieza","nzValue","limpieza"],["nzLabel","Construcci\xF3n","nzValue","construccion"],["nzLabel","Bienes Raices","nzValue","bienesRaices"],["nzLabel","Mantenimiento","nzValue","mantenimiento"],["nzLabel","Otros","nzValue","otros"],["formControlName","rangeDatePicker",3,"nzOnCalendarChange"],[1,"col-md-2"],["formControlName","isTaskIn"],["formControlName","isTaskOut"],[1,"col-md-3"],["formControlName","price",3,"nzMin","nzMax","nzStep"],["class","error-message",4,"ngIf"],["formControlName","isCalculate"],["formControlName","sits",3,"nzMin","nzMax","nzStep"],["formControlName","frequencies"],[3,"nzValue","nzLabel"],["formControlName","transportType"],[3,"src","ngStyle"],[1,"error-message"],["type","text","formControlName","name","nz-input","","placeholder","Escriba el nombre del servicio"],["nzAction","/api/posts/","nzListType","picture-card",3,"nzFileListChange","nzChange","nzFileList","nzShowButton","nzShowUploadList","nzPreview"],[3,"nzOnCancel","nzVisible","nzContent","nzFooter"],["nzPlaceHolder","Selecciona una opci\xF3n","formControlName","category",1,"w-100",3,"disabled"],["formControlName","rangeDatePicker",3,"nzOnCalendarChange","disabled"],["formControlName","isTaskIn",3,"disabled"],["formControlName","isTaskOut",3,"disabled"],["class","col-md-3",4,"ngFor","ngForOf"],["nzHoverable","",2,"width","240px",3,"nzCover"],[3,"nzTitle","nzDescription"],["nz-dropdown","","nzPlacement","bottomRight","nzTrigger","click",1,"text-gray","font-size-18",3,"nzDropdownMenu"],["nz-icon","","nzType","ellipsis","theme","outline"],["nz-menu","","nzSelectable",""],["nz-menu-item","",3,"click",4,"ngIf"],["nz-menu-item","",3,"click"],["nz-icon","","nzType","edit","theme","outline"],[1,"m-l-10"],["nz-menu-divider",""],["nz-icon","","nzType","delete","theme","outline"],[1,"d-flex","justify-content-between","align-items-center"],[1,"m-b-0",3,"nzColor"],["class","m-b-0",3,"nzColor",4,"ngIf"],["nz-icon","","nzType","pause-circle","theme","outline"],["nz-icon","","nzType","check-circle","theme","outline"],["alt","",3,"src"],[3,"nzData"],[1,"text-center"],[4,"ngFor","ngForOf"],[1,"media","align-items-center"],["nzShape","square",3,"nzSrc"],[1,"m-b-0"],[1,"text-right"],["nz-menu-item",""]],template:function(t,n){if(t&1){let a=C();i(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"div",13)(5,"nz-form-control")(6,"nz-input-group",14)(7,"input",15,0),g("keyup",function(){z(a);let _=y(8);return h(n.getItems(_.value))}),o()(),v(9,Fn,1,0,"ng-template",null,1,V),o()()()(),i(11,"div",11)(12,"div",16)(13,"nz-radio-group",17),U("ngModelChange",function(_){return z(a),q(n.view,_)||(n.view=_),h(_)}),i(14,"label",18),c(15,"i",19),o(),i(16,"label",20),c(17,"i",21),o()(),i(18,"button",22),g("click",function(){z(a);let _=y(23);return h(n.showNewModal(_))}),c(19,"i",23),i(20,"span"),s(21,"Agregar nuevo"),o()(),v(22,Dn,103,26,"ng-template",null,2,V)(24,On,95,33,"ng-template",null,3,V),o()()()(),i(26,"div",24),v(27,$n,2,1,"div",25)(28,Yn,18,2,"nz-card",26),o(),c(29,"nz-modal")}if(t&2){let a=y(10);l(6),m("nzSuffix",a),l(7),R("ngModel",n.view),l(14),m("ngIf",n.view=="cardView"),l(),m("ngIf",n.view=="listView")}},dependencies:[k,ae,Re,me,X,G,Y,J,K,Q,ce,Xt,Gt,St,oi,ei,Zt,Xe,$e,We,Ye,Ge,Je,Ce,qe,Ct,Ze,Se,ve,Ue,be,xe,ye,ge,te,Z,ee,_e,pt,Qe,pe,ue,H,se,M,j,B,$,dt,ai],styles:[".error-message[_ngcontent-%COMP%]{color:red;font-size:.8em}"]})}}return r})();var Si=[{name:"Tienda de conveniencia",description:"Pago en tienda de conveniencia",icon:"pricetag",method:"store",userNavigation:"reference/list",active:!1},{name:"Tarjeta de cr\xE9dito/d\xE9bito",description:"Pago en l\xEDnea con tarjeta",icon:"card",method:"card",userNavigation:"card/purchase",active:!1}],Ci=(()=>{class r{constructor(e){this.afs=e}getAccountPaymentMethods(e){return this.afs.collection("customers").doc(e).collection("paymentMethods").snapshotChanges()}getPaymentMethods(){return Ot(Si)}createDefaultPaymentMethods(e){return Si.forEach(t=>{this.setAccountPaymentMethod(e,t)})}setAccountPaymentMethod(e,t){return this.afs.collection("customers").doc(e).collection("paymentMethods").add(t)}toggleActiveAccountPaymentMethod(e,t,n){return this.afs.collection("customers").doc(e).collection("paymentMethods").doc(t).update({active:n})}deleteAccountPaymentMethod(e,t){return this.afs.collection("customers").doc(e).collection("paymentMethods").doc(t).delete()}static{this.\u0275fac=function(t){return new(t||r)(Ve(le))}}static{this.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function Kn(r,u){if(r&1){let e=C();Rt(0),i(1,"div",4)(2,"label",5),s(3),o(),i(4,"nz-switch",6),g("ngModelChange",function(n){let a=z(e).$implicit,p=d();return h(p.onChange(n,a))}),o()(),qt()}if(r&2){let e=u.$implicit;l(3),F("",e.name,"\xA0"),l(),m("ngModel",e.active)}}var bi=(()=>{class r{constructor(e){this.messageService=e,this.loading=!1,this.rolService=b(ie),this.stopSubscription$=new re,this.paymentMethodsList=[],this.accountPaymentMethods=[],this.infoLoad=[],this.paymentMethodsService=b(Ci),this.authService=b(W),this.authService.user.subscribe(t=>{this.user=t,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(n=>{this.infoLoad=n,this.userlevelAccess=this.infoLoad.optionAccessLavel})})}ngOnInit(){this.getSubscriptions()}ngOnDestroy(){this.stopSubscription$.next(!1),this.stopSubscription$.complete()}sendMessage(e,t){this.messageService.create(e,t)}getSubscriptions(){this.paymentMethodsService.getAccountPaymentMethods(this.accountId).pipe(L(this.stopSubscription$),w(e=>e.map(t=>{let n=t.payload.doc.id,a=t.payload.doc.data();return T({id:n},a)})),Fe(e=>(this.accountPaymentMethods=e,e.length==0&&this.createDefaultPaymentMethods(),e))).subscribe(()=>{this.loading=!1})}createDefaultPaymentMethods(){this.userlevelAccess!="3"?this.paymentMethodsService.createDefaultPaymentMethods(this.accountId):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}onChange(e,t){this.paymentMethodsService.toggleActiveAccountPaymentMethod(this.accountId,t.id,e)}static{this.\u0275fac=function(t){return new(t||r)(x(N))}}static{this.\u0275cmp=D({type:r,selectors:[["app-shared-account-payment-methods"]],inputs:{accountId:"accountId"},decls:4,vars:2,consts:[[1,"container"],["nzType","inner","nzTitle","M\xE9todos de Pago (Aplican cuando el Usuario es responsable del Pago)",3,"nzLoading"],[1,"row"],[4,"ngFor","ngForOf"],[1,"col-md-6"],["nzFor","pm.name"],["nzCheckedChildren","Si","nzUnCheckedChildren","No",3,"ngModelChange","ngModel"]],template:function(t,n){t&1&&(i(0,"div",0)(1,"nz-card",1)(2,"div",2),v(3,Kn,5,2,"ng-container",3),o()()()),t&2&&(l(),m("nzLoading",n.loading),l(2),m("ngForOf",n.accountPaymentMethods))},dependencies:[k,Ct,_e,M,dt]})}}return r})();function eo(r,u){if(r&1&&(i(0,"h5",68),s(1),o()),r&2){let e=d(2);l(),I(e.record.name)}}function to(r,u){if(r&1&&(i(0,"nz-option",69),c(1,"i",70),s(2),o()),r&2){let e=u.$implicit;m("nzLabel",e.name)("nzValue",e.uid),l(2),F(" ",e.name,"")}}function io(r,u){if(r&1&&(i(0,"nz-option",69),c(1,"i",70),s(2),o()),r&2){let e=u.$implicit;m("nzLabel",e.displayName)("nzValue",e.uid),l(2),F(" ",e.displayName,"")}}function no(r,u){if(r&1){let e=C();i(0,"a",71),g("click",function(){z(e);let n=d(2);return h(n.onSubmit())}),s(1,"Actualizar"),o()}}function oo(r,u){if(r&1){let e=C();i(0,"div",2)(1,"form",3),g("ngSubmit",function(){z(e);let n=d();return h(n.onSubmit())}),i(2,"nz-card",4)(3,"div",5),c(4,"nz-avatar",6),i(5,"div",7),v(6,eo,2,1,"h5",8),i(7,"p",9),s(8),c(9,"br"),s(10),o()(),i(11,"nz-upload",10),g("nzChange",function(n){z(e);let a=d();return h(a.handleChange(n))}),i(12,"button",11)(13,"span"),s(14,"Cambiar im\xE1gen "),o()()()(),c(15,"hr",12),i(16,"div",13)(17,"div",14)(18,"nz-form-item")(19,"nz-form-label",15),s(20,"Nombre"),o(),i(21,"nz-form-control"),c(22,"input",16),o()()(),i(23,"div",14)(24,"nz-form-item")(25,"nz-form-label",17),s(26,"Raz\xF3n Social"),o(),i(27,"nz-form-control"),c(28,"input",18),o()()()(),i(29,"div",13)(30,"div",19)(31,"nz-form-item")(32,"nz-form-label",20),s(33,"RFC"),o(),i(34,"nz-form-control"),c(35,"input",21),o()()(),i(36,"div",19)(37,"nz-form-item")(38,"nz-form-label",20),s(39,"Giro"),o(),i(40,"nz-form-control")(41,"nz-select",22),g("ngModelChange",function(n){z(e);let a=d();return h(a.onJobTypeSelected(n))}),v(42,to,3,3,"nz-option",23),o()()()(),i(43,"div",19)(44,"nz-form-item")(45,"nz-form-label",20),s(46,"Consecutivo"),o(),i(47,"nz-form-control"),c(48,"input",24),o()()()(),i(49,"div",13)(50,"div",25)(51,"nz-form-item")(52,"nz-form-label",26),s(53,"Tel\xE9fono"),o(),i(54,"nz-form-control"),c(55,"input",27),o()()(),i(56,"div",25)(57,"nz-form-item")(58,"nz-form-label",28),s(59,"Sitio Web"),o(),i(60,"nz-form-control"),c(61,"input",29),o()()(),i(62,"div",25)(63,"nz-form-item")(64,"nz-form-label",30),s(65,"Persona Contacto"),o(),i(66,"nz-form-control"),c(67,"input",31),o()()(),i(68,"div",25)(69,"nz-form-item")(70,"nz-form-label",32),s(71,"Responsable"),o(),i(72,"nz-form-control")(73,"nz-select",33),v(74,io,3,3,"nz-option",23),o()()()()()(),v(75,no,2,0,"ng-template",null,0,V),i(77,"nz-card",34)(78,"div",13)(79,"div",35)(80,"nz-form-item")(81,"nz-form-label",36),s(82,"Calle"),o(),i(83,"nz-form-control"),c(84,"input",37),o()()(),i(85,"div",25)(86,"nz-form-item")(87,"nz-form-label",38),s(88,"N\xFAmero"),o(),i(89,"nz-form-control"),c(90,"input",39),o()()()(),i(91,"div",13)(92,"div",14)(93,"nz-form-item")(94,"nz-form-label",36),s(95,"Entre Calles"),o(),i(96,"nz-form-control"),c(97,"input",40),o()()(),i(98,"div",14)(99,"nz-form-item")(100,"nz-form-label",41),s(101,"Fracc / Colonia"),o(),i(102,"nz-form-control"),c(103,"input",42),o()()()(),i(104,"div",13)(105,"div",43)(106,"nz-form-item")(107,"nz-form-label",44),s(108,"C\xF3digo Postal"),o(),i(109,"nz-form-control"),c(110,"input",45),o()()(),i(111,"div",46)(112,"nz-form-item")(113,"nz-form-label",47),s(114,"Ciudad / Municipio"),o(),i(115,"nz-form-control"),c(116,"input",48),o()()(),i(117,"div",46)(118,"nz-form-item")(119,"nz-form-label",49),s(120,"Estado"),o(),i(121,"nz-form-control"),c(122,"input",50),o()()()()(),i(123,"nz-card",51)(124,"div",13)(125,"div",19)(126,"nz-form-item")(127,"nz-form-label",52)(128,"span"),s(129," Origen de los pagos "),c(130,"i",53),o()(),i(131,"nz-form-control",54)(132,"nz-select",55),c(133,"nz-option",56)(134,"nz-option",57),o()()()()(),i(135,"div",13)(136,"div",19)(137,"nz-form-item")(138,"nz-form-label",58)(139,"span"),s(140," Obligatorio subir en la estaci\xF3n definida "),c(141,"i",59),o()(),i(142,"nz-form-control",54)(143,"nz-select",60),c(144,"nz-option",61)(145,"nz-option",62),o()()()(),i(146,"div",19)(147,"nz-form-item")(148,"nz-form-label",63)(149,"span"),s(150," Obligatorio subir en el turno definido "),c(151,"i",64),o()(),i(152,"nz-form-control",54)(153,"nz-select",65),c(154,"nz-option",61)(155,"nz-option",62),o()()()(),i(156,"div",19)(157,"nz-form-item")(158,"nz-form-label",63)(159,"span"),s(160," Obligatorio subir en la operaci\xF3n definida "),c(161,"i",66),o()(),i(162,"nz-form-control",54)(163,"nz-select",67),c(164,"nz-option",61)(165,"nz-option",62),o()()()()()()()()}if(r&2){let e=y(76),t=d();l(),m("formGroup",t.objectForm),l(),m("nzExtra",e)("nzLoading",t.loading),l(2),m("nzSize",80)("nzSrc",t.record.imageUrl),l(2),m("ngIf",!!t.record),l(2),F(" ",t.record.address," "),l(2),Ut(" ",t.record.address2," ",t.record.address3," "),l(),m("nzShowUploadList",!1),l(31),m("ngForOf",t.jobType),l(32),m("ngForOf",t.usersList),l(57),m("nzSpan",12),l(11),m("nzSpan",12),l(10),m("nzSpan",12),l(10),m("nzSpan",12)}}var xi=(()=>{class r{constructor(e,t,n){this.messageService=e,this.bucketStorage=t,this.fb=n,this.stopSubscription$=new re,this.loading=!0,this.infoLoad=[],this.rolService=b(ie),this.authService=b(W),this.accountsService=b(je),this.userService=b(zt),this.infoSegment=[],this.avatarUrl="http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg",this.uploading=!1,this.bucketPath="customers/",this.uploadvalue=0,this.vendorService=b(vt),this.authService.user.subscribe(a=>{this.user=a,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&(this.rolService.getRol(this.user.rolId).valueChanges().subscribe(p=>{this.infoLoad=p,this.userlevelAccess=this.infoLoad.optionAccessLavel}),this.accountsSubscription=this.accountsService.getJobType().pipe(w(p=>p.map(_=>{let S=_.payload.doc.id,E=_.payload.doc.data();return T({id:S},E)}))).subscribe(p=>{this.jobType=p}),this.accountsSubscription=this.accountsService.getUsersByCustomer(this.accountId).pipe(w(p=>p.map(_=>{let S=_.payload.doc.id,E=_.payload.doc.data();return T({id:S},E)}))).subscribe(p=>{this.usersList=p}),this.accountsService.getSegmentLevel(this.user.idSegment).pipe(L(this.stopSubscription$),w(p=>{let _=p.payload.id,S=p.payload.data();return T({id:_},S)}),Fe(p=>(this.infoSegment=p,p))).subscribe())})}ngOnInit(){this.createForm(),this.getSubscription()}createForm(){this.objectForm=this.fb.group({active:[!1,[f.required]],imageUrl:[""],address:[""],paymentResponsible:[1,[f.required]],name:["",[f.required]],socialName:[""],rfc:[""],addressNumber:[""],address2:[""],address3:[""],zip:[""],city:[""],state:[""],forceStopPoints:[!0],forceRoute:[!0],forceRound:[!0],website:[""],phoneNumber:[""],jobTypeID:[""],custConsecutive:[""],primaryContact:[""],responsableUser:[""]})}patchForm(e){this.objectForm.patchValue({active:e.active||!1,imageUrl:e.imageUrl||"",address:e.address||"",addressNumber:e.addressNumber||"",name:e.name||"",paymentResponsible:e.paymentResponsible||1,socialName:e.socialName||"",rfc:e.rfc||"",address2:e.address2||"",address3:e.address3||"",zip:e.zip||"",city:e.city||"",state:e.state||"",forceStopPoints:e.forceStopPoints||!0,forceRoute:e.forceRoute||!0,forceRound:e.forceRound||!0,website:e.website||"",phoneNumber:e.phoneNumber||"",jobTypeID:e.jobTypeID||"",custConsecutive:e.custConsecutive||"",primaryContact:e.primaryContact||"",responsableUser:e.responsableUser||""})}ngOnDestroy(){this.stopSubscription$.next(!1),this.stopSubscription$.complete()}getSubscription(){this.accountsService.getAccount(this.accountId).pipe(L(this.stopSubscription$),w(e=>{let t=e.payload.id,n=e.payload.data();return T({id:t},n)}),Fe(e=>(this.patchForm(e),this.record=e,this.loading=!1,e))).subscribe()}getBase64(e,t){let n=new FileReader;n.addEventListener("load",()=>{n.result!==null&&typeof n.result=="string"?t(n.result):this.messageService.error("Invalid Form")}),n.readAsDataURL(e)}handleChange(e){e.file.originFileObj&&this.getBase64(e.file.originFileObj,t=>{this.avatarUrl=t;let n=e.file.name,a=`${this.bucketPath}/${n}`,p=this.bucketStorage.ref(a);this.task=this.bucketStorage.ref(a).putString(t,"data_url"),this.uploadPercent=this.task.percentageChanges(),this.uploadPercent.pipe(w(_=>Number((_/100).toFixed(2)))).subscribe(_=>{this.uploading=_!=0,this.uploadvalue=_}),this.task.snapshotChanges().pipe(Te(()=>{this.uploading=!1,this.downloadURL=p.getDownloadURL(),this.downloadURL.subscribe(_=>oe(this,null,function*(){this.updatePhotoURL(_)}))})).subscribe()})}updatePhotoURL(e){return oe(this,null,function*(){this.objectForm.controls.imageUrl.patchValue(e),this.userlevelAccess!="3"?this.accountsService.updateAvatarAccount(this.accountId,e):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")})}sendMessage(e,t){this.messageService.create(e,t)}onSubmit(){this.userlevelAccess!="3"?this.accountsService.updateAccount(this.accountId,this.objectForm.value).then(()=>{},e=>{this.sendMessage("error",e)}).catch(e=>this.sendMessage("error",e)):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}onJobTypeSelected(e){let t=this.jobType.filter(n=>n.uid===e);if(t.length>0){let n=t[0].consecutive;n=parseInt(n,10)+1,n=n.toString().padStart(4,"0"),this.objectForm.controls.custConsecutive.setValue(t[0].type+n)}}static{this.\u0275fac=function(t){return new(t||r)(x(N),x(Ke),x(A))}}static{this.\u0275cmp=D({type:r,selectors:[["app-shared-account-edit"]],inputs:{accountId:"accountId"},decls:1,vars:1,consts:[["basicTpl",""],["class","container",4,"ngIf"],[1,"container"],["nz-form","","nzLayout","vertical",3,"ngSubmit","formGroup"],["nzType","inner","nzTitle","Informaci\xF3n B\xE1sica",3,"nzExtra","nzLoading"],[1,"media","align-items-center"],["nzIcon","user","nzSize","large","nzSrc","",2,"background-color","white","color","#4F6F57",3,"nzSize","nzSrc"],[1,"m-l-20","m-r-20"],["class","m-b-5 font-size-18",4,"ngIf"],[1,"opacity-07","font-size-13","m-b-0"],["nzName","imageUrl",3,"nzChange","nzShowUploadList"],["nz-button","","nzGhost","",2,"background-color","#4F6F57","color","#f6f3ea"],[1,"m-v-25"],[1,"row"],[1,"col-md-6"],["nzFor","name"],["nz-input","","formControlName","name","type","text"],["nzFor","socialName"],["nz-input","","formControlName","socialName","type","text"],[1,"col-md-4"],["nzFor","rfc"],["nz-input","","formControlName","rfc","type","text"],["formControlName","jobTypeID","nzAllowClear","","nzPlaceHolder","Selecciona el Giro de la Empresa",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nz-input","","formControlName","custConsecutive","nzDisabled",""],[1,"col-md-3"],["nzFor","phoneNumber"],["nz-input","","formControlName","phoneNumber","placeholder","Tel\xE9fono"],["nzFor","website"],["nz-input","","formControlName","website","placeholder","website"],["nzFor","primaryContact"],["nz-input","","formControlName","primaryContact","placeholder","Contacto principal"],["nzFor","responsableUser"],["formControlName","responsableUser","nzAllowClear","","nzPlaceHolder","Selecciona Usuario Responsable"],["nzType","inner","nzTitle","Direcci\xF3n"],[1,"col-md-9"],["nzFor","address"],["nz-input","","formControlName","address","placeholder","Calle"],["nzFor","addressNumber"],["nz-input","","formControlName","addressNumber","placeholder","N\xFAmero"],["nz-input","","formControlName","address2","placeholder","Entre calles"],["nzFor","address3"],["nz-input","","formControlName","address3","placeholder","Fracc / Colonia"],[1,"col-md-2"],["nzFor","zip"],["nz-input","","formControlName","zip","placeholder","C\xF3digo Postal"],[1,"col-md-5"],["nzFor","city"],["nz-input","","formControlName","city","placeholder","Ciudad / Municipio"],["nzFor","state"],["nz-input","","formControlName","state","placeholder","Estado"],["nzType","inner","nzTitle","Par\xE1metros de Servicio"],["nzFor","paymentResponsible","nzRequired",""],["nz-icon","","nz-tooltip","","nzTooltipTitle","\xBFQui\xE9n es el responsable de emitir un pago por el servicio?","nzType","question-circle","nzTheme","outline"],[3,"nzSpan"],["name","select-error","formControlName","paymentResponsible"],["nzValue","0","nzLabel","Empresa"],["nzValue","1","nzLabel","Usuario"],["nzFor","forceStopPoints","nzRequired",""],["nz-icon","","nz-tooltip","","nzTooltipTitle","\xBFEs obligatorio que el usuario suba exclusivamente en la estaci\xF3n seleccionada?","nzType","question-circle","nzTheme","outline"],["name","select-error","formControlName","forceStopPoints"],["nzValue","true","nzLabel","Si"],["nzValue","false","nzLabel","No"],["nzFor","forceRound","nzRequired",""],["nz-icon","","nz-tooltip","","nzTooltipTitle","\xBFEs obligatorio que el usuario suba exclusivamente en el turno seleccionada?","nzType","question-circle","nzTheme","outline"],["name","select-error","formControlName","forceRound"],["nz-icon","","nz-tooltip","","nzTooltipTitle","\xBFEs obligatorio que el usuario suba exclusivamente en la operaci\xF3n seleccionada?","nzType","question-circle","nzTheme","outline"],["name","select-error","formControlName","forceRoute"],[1,"m-b-5","font-size-18"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon",""],[3,"click"]],template:function(t,n){t&1&&v(0,oo,166,16,"div",1),t&2&&m("ngIf",!!n.record)},dependencies:[k,ae,me,X,G,Y,J,K,Q,ce,qe,Ze,ge,te,Z,ee,_e,pe,ue,H,se,M,j,B,$]})}}return r})();function ao(r,u){if(r&1&&c(0,"app-shared-account-edit",9),r&2){let e=d();m("accountId",e.recordId)}}function so(r,u){if(r&1&&c(0,"app-shared-account-payment-methods",9),r&2){let e=d();m("accountId",e.recordId)}}function lo(r,u){if(r&1&&c(0,"app-shared-routes-list",9),r&2){let e=d();m("accountId",e.recordId)}}function mo(r,u){if(r&1&&c(0,"app-shared-customer-vendor-assignments",9),r&2){let e=d();m("accountId",e.recordId)}}function co(r,u){if(r&1&&c(0,"app-shared-products-list",9),r&2){let e=d();m("accountId",e.recordId)}}function po(r,u){if(r&1&&c(0,"app-promotions",9),r&2){let e=d();m("accountId",e.recordId)}}var Yr=(()=>{class r{constructor(e,t,n,a){this.fb=e,this.route=t,this.modalService=n,this.message=a,this.accountsService=b(je),this.selectedIndex=0,this.record=[],this.avatarUrl="http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg"}ngOnInit(){this.sub=this.route.params.subscribe(e=>{this.recordId=e.id,this.selectedIndex=e.index,this.getSubscriptions()}),this.changePWForm=this.fb.group({oldPassword:[null,[f.required]],newPassword:[null,[f.required]],confirmPassword:[null,[f.required]]})}ngOnDestroy(){this.sub.unsubscribe()}showConfirm(){this.modalService.confirm({nzTitle:"<i>Do you want to change your password?</i>",nzOnOk:()=>this.message.success("Password Change Successfully")})}getSubscriptions(){this.accountsService.getAccount(this.recordId).pipe(w(e=>{let t=e.payload.id,n=e.payload.data();return T({id:t},n)})).subscribe(e=>{this.record=e})}submitForm(){for(let e in this.changePWForm.controls)this.changePWForm.controls[e].markAsDirty(),this.changePWForm.controls[e].updateValueAndValidity();this.showConfirm()}getBase64(e,t){let n=new FileReader;n.addEventListener("load",()=>t(n.result)),n.readAsDataURL(e)}static{this.\u0275fac=function(t){return new(t||r)(x(A),x(Ht),x(fe),x(N))}}static{this.\u0275cmp=D({type:r,selectors:[["app-edit"]],decls:19,vars:2,consts:[["nzBackIcon","",1,"page-header",2,"background-color","#f9fbfd"],[1,"page-header-tab",3,"nzSelectedIndex"],["nzTitle","General"],["nz-tab",""],["nzTitle","M\xE9todos de Pago"],["nzTitle","Operaci\xF3n"],["nzTitle","Asignaciones"],["nzTitle","Productos"],["nzTitle","Promociones"],[3,"accountId"]],template:function(t,n){t&1&&(i(0,"nz-page-header",0)(1,"nz-page-header-title"),s(2),o(),i(3,"nz-page-header-subtitle"),s(4,"Detalles de la empresa"),o(),i(5,"nz-page-header-content")(6,"nz-tabset",1)(7,"nz-tab",2),v(8,ao,1,1,"ng-template",3),o(),i(9,"nz-tab",4),v(10,so,1,1,"ng-template",3),o(),i(11,"nz-tab",5),v(12,lo,1,1,"ng-template",3),o(),i(13,"nz-tab",6),v(14,mo,1,1,"ng-template",3),o(),i(15,"nz-tab",7),v(16,co,1,1,"ng-template",3),o(),i(17,"nz-tab",8),v(18,po,1,1,"ng-template",3),o()()()()),t&2&&(l(2),I(n.record.name),l(4),m("nzSelectedIndex",n.selectedIndex))},dependencies:[de,He,Be,ht,gt,ft,Kt,ci,ui,gi,vi,bi,xi]})}}return r})();export{Eo as a,Yr as b};
