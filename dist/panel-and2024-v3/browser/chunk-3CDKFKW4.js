import{a as Mt,b as At,c as Bi,d as vi}from"./chunk-4VL7SMIP.js";import{a as _i}from"./chunk-EMPQXP6V.js";import{a as pi}from"./chunk-F2CJ3RZP.js";import{a as ot}from"./chunk-OXWKYRCQ.js";import{a as at}from"./chunk-DQJBGMKA.js";import{d as hi}from"./chunk-QZBYGRQC.js";import{c as lt}from"./chunk-PZZTFZC3.js";import{a as Xe}from"./chunk-AEEHAD3U.js";import{a as fi,b as gi}from"./chunk-VI2PUDRP.js";import{a as rt,c as ui,h as st,i as zi}from"./chunk-4JKUL4PX.js";import{A as Ie,C as De,D as Ve,E as Pe,F as Le,H as Ft,a as ne,c as Ze,d as et,e as wt,g as ge,h as li,k as oe,m as mi,n as tt,o as it,s as ci,t as di,x as Ne}from"./chunk-GEWEUUNX.js";import{$ as oi,M as Ce,P as Z,Q as ee,R as te,S as ie,_ as fe,aa as ri,b as ue,c as v,d as M,da as Je,e as q,ea as ji,fa as Ye,g as ft,h as Ge,ha as ve,i as j,ja as Ee,k as B,la as si,m as H,pa as re,q as A,qa as ae,sa as nt,t as Q,u as K}from"./chunk-C6X62455.js";import{a as ai,c as Tt,d as be}from"./chunk-PMPBZHT3.js";import{a as xe,c as ye,d as Qe,f as Ke,g as Te,h as we,j as Fe}from"./chunk-IDUACQZO.js";import{$b as k,Bb as ei,Bc as ii,C as Kt,Cc as ni,Ce as D,Db as He,Df as W,Ea as S,Ee as Et,Ef as G,Fb as $e,Fe as $,G as Me,Ga as m,Gf as X,Ib as I,Ka as Y,Le as gt,M as Zt,O as L,Q as _e,Tc as he,U as je,Ua as t,Ud as ze,Va as o,Wa as c,X as Ae,Xa as ht,Y as C,Ya as zt,Ze as Lt,_ as V,_a as x,ac as pe,bb as g,c as J,db as p,dc as We,ga as z,gb as Re,gc as yt,ha as f,l as ut,m as T,nb as w,ob as s,pb as E,qb as N,r as Yt,ra as Oe,rb as xt,sa as l,sf as kt,ta as b,tb as O,ub as R,vb as U,y as Qt,yb as de,yc as ti,zb as Be}from"./chunk-KAPUTOGI.js";import{a as F,b as se,f as Jt,h as ce}from"./chunk-SIAVTO45.js";var Si=(()=>{class r{constructor(e){this.afs=e}getSummarized(){return this.afs.collection("summarized").valueChanges()}setAccounts(){}static{this.\u0275fac=function(i){return new(i||r)(Ae(he))}}static{this.\u0275prov=je({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var $i=(r,u,e)=>[r,u,e],Wi=()=>({size:"large"}),Gi=r=>["/accounts/edit",r,0],Xi=r=>["/accounts/edit",r,1],Ci=r=>["/accounts/edit",r,2],Ji=r=>["/accounts/edit",r,3];function Yi(r,u){r&1&&c(0,"nz-empty")}function Qi(r,u){if(r&1&&c(0,"nz-avatar",28),r&2){let e=p().$implicit;m("nzSrc",e.imageUrl)}}function Ki(r,u){if(r&1){let e=x();t(0,"i",31),g("click",function(){z(e);let n=p(2).$implicit,a=p();return f(a.toggleAccountActive(n.id,!0))}),o()}r&2&&m("nzType","check-circle")("nzTheme","twotone")("nzTwotoneColor","#52c41a")}function Zi(r,u){if(r&1){let e=x();t(0,"i",32),g("click",function(){z(e);let n=p(2).$implicit,a=p();return f(a.toggleAccountActive(n.id,!1))}),o()}r&2&&m("nzType","pause-circle")("nzTheme","twotone")("nzTwotoneColor","#de4436")}function en(r,u){if(r&1&&S(0,Ki,1,3,"i",29)(1,Zi,1,3,"i",30),r&2){let e=p().$implicit;m("ngIf",e.active),l(),m("ngIf",!e.active)}}function tn(r,u){if(r&1&&c(0,"i",33),r&2){let e=p().$implicit;m("routerLink",Be(1,Gi,e.id))}}function nn(r,u){if(r&1){let e=x();t(0,"a",34),c(1,"i",35),o(),t(2,"nz-dropdown-menu",null,5)(4,"ul",36)(5,"li",37),c(6,"i",38),s(7," Usuarios "),o(),t(8,"li",37),c(9,"i",39),s(10," Productos "),o(),t(11,"li",37),c(12,"i",39),s(13," Promociones "),o(),t(14,"li",37),c(15,"i",40),s(16," Operaci\xF3n y horarios "),o(),c(17,"li",41),t(18,"li",42),g("click",function(){z(e);let n=p().$implicit,a=p();return f(a.deleteAccountModal(n))}),c(19,"i",43),s(20," Eliminar "),o()()()}if(r&2){let e=w(3),i=p().$implicit;m("nzDropdownMenu",e),l(5),m("routerLink",Be(5,Xi,i.id)),l(3),m("routerLink",Be(7,Ci,i.id)),l(3),m("routerLink",Be(9,Ci,i.id)),l(3),m("routerLink",Be(11,Ji,i.id))}}function on(r,u){if(r&1&&(t(0,"div",24)(1,"nz-card",25)(2,"nz-skeleton",26),c(3,"nz-card-meta",27),o()(),S(4,Qi,1,1,"ng-template",null,1,I)(6,en,2,2,"ng-template",null,2,I)(8,tn,1,3,"ng-template",null,3,I)(10,nn,21,13,"ng-template",null,4,I),o()),r&2){let e=u.$implicit,i=w(5),n=w(7),a=w(9),d=w(11),_=p();l(),m("nzActions",ei(6,$i,n,a,d)),l(),m("nzActive",!0)("nzLoading",_.loading)("nzAvatar",de(10,Wi)),l(),m("nzAvatar",i)("nzTitle",e.name)}}function rn(r,u){if(r&1&&(t(0,"nz-option",61),c(1,"i",62),s(2),o()),r&2){let e=u.$implicit;m("nzLabel",e.name)("nzValue",e.uid),l(2),N(" ",e.name,"")}}function an(r,u){if(r&1){let e=x();t(0,"form",44),g("ngSubmit",function(){z(e);let n=p();return f(n.submitForm())}),t(1,"nz-form-item")(2,"nz-form-label",45),s(3,"Nombre"),o(),t(4,"nz-form-control",46),c(5,"input",47),o()(),t(6,"nz-form-item")(7,"nz-form-label",48)(8,"span"),s(9," Giro "),o()(),t(10,"nz-form-control",49)(11,"nz-select",50),g("ngModelChange",function(n){z(e);let a=p();return f(a.onJobTypeSelected(n))}),S(12,rn,3,3,"nz-option",51),o()()(),t(13,"nz-form-item")(14,"nz-form-label",52),s(15," Consecutivo "),o(),t(16,"nz-form-control",53),c(17,"input",54),o()(),t(18,"nz-form-item")(19,"nz-form-label",55),s(20,"Tel\xE9fono"),o(),t(21,"nz-form-control",56),c(22,"input",57),o()(),t(23,"nz-form-item")(24,"nz-form-label",58),s(25,"Sitio web"),o(),t(26,"nz-form-control",59),c(27,"input",60),o()()()}if(r&2){let e=p();m("formGroup",e.validateForm),l(2),m("nzSm",6)("nzXs",24),l(2),m("nzSm",14)("nzXs",24),l(3),m("nzSm",6)("nzXs",24),l(3),m("nzSm",14)("nzXs",24),l(2),m("ngForOf",e.jobType),l(2),m("nzSm",6)("nzXs",24),l(2),m("nzSm",14)("nzXs",24),l(),m("disabled",e.isDisabled),l(2),m("nzSm",6)("nzXs",24),l(2),m("nzSm",14)("nzXs",24),l(3),m("nzSm",6)("nzXs",24),l(2),m("nzSm",14)("nzXs",24)}}var Wo=(()=>{class r{constructor(e,i,n){this.messageService=e,this.modalService=i,this.fb=n,this.rolService=C(ne),this.summarizedService=C(Si),this.authService=C($),this.accountsService=C(Ke),this.selectedRecord=!1,this.accountsList=[],this.summarized=[],this.loading=!0,this.isVisibleAdd=!1,this.isDeleteVisible=!1,this.isOkLoading=!1,this.infoLoad=[],this.infoSegment=[],this.stopSubscription$=new J,this.isDisabled=!0,this.currentConsecutive="",this.currentJobType=""}ngOnInit(){this.userSubscription=this.authService.getUser().subscribe(e=>{this.user=e,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&(this.rolService.getRol(this.user.rolId).valueChanges().subscribe(i=>{this.infoLoad=i,this.userlevelAccess=this.infoLoad.optionAccessLavel}),this.accountsService.getSegmentLevel(this.user.idSegment).pipe(L(this.stopSubscription$),T(i=>{let n=i.payload.id,a=i.payload.data();return F({id:n},a)}),_e(i=>(this.infoSegment=i,this.getSubscriptions(),i))).subscribe())}),this.validateForm=this.fb.group({name:[null,[v.minLength(5),v.maxLength(40),v.required]],address:[null,[v.required]],phoneNumber:[null,[v.required]],website:[null,[v.required]],active:[!1],canShowDevices:[!0],showFromHour:[5],jobTypeID:[null,[v.required]],custConsecutive:[null,[v.required]],showToHour:[20]})}ngOnDestroy(){this.accountsSubscription&&this.accountsSubscription.unsubscribe(),this.userSubscription&&this.userSubscription.unsubscribe(),this.stopSubscription$&&this.stopSubscription$.unsubscribe()}submitForm(){this.isOkLoading=!0;for(let e in this.validateForm.controls)this.validateForm.controls[e].markAsDirty(),this.validateForm.controls[e].updateValueAndValidity();this.userlevelAccess!="3"?this.accountsService.setAccount(this.validateForm.value,this.currentConsecutive).then(i=>{this.currentJobType.length>0&&this.accountsService.updateJobType(this.currentJobType,this.currentConsecutive).then(()=>{},n=>{this.sendMessage("error",n)}).catch(n=>this.sendMessage("error",n)),this.isVisibleAdd=!1,this.isOkLoading=!1}).catch(i=>this.sendMessage("error",i)):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}toggleAccountActive(e,i){this.accountsService.toggleAccountActive(e,i)}deleteAccount(e){this.isOkLoading=!0,this.userlevelAccess=="1"?this.accountsService.deleteAccount(e.id).then(n=>{this.isOkLoading=!1}).catch(n=>this.sendMessage("error",n)):this.sendMessage("error","El usuario no tiene permisos para borrar datos, favor de contactar al administrador.")}getSubscriptions(){this.loading=!0,this.infoSegment!==void 0&&this.infoSegment.nivelNum==1?this.accountsSubscription=this.accountsService.getAccountsByCustomer(this.user.customerId).pipe(T(e=>{let i=e.payload.id,n=e.payload.data();return F({id:i},n)})).subscribe(e=>{this.accountsList=[e],this.loading=!1}):this.accountsSubscription=this.accountsService.getAccounts().pipe(T(e=>e.map(i=>{let n=i.payload.doc.id,a=i.payload.doc.data();return F({id:n},a)}))).subscribe(e=>{this.accountsList=e,this.loading=!1})}deleteAccountModal(e){this.modalService.warning({nzTitle:"\xBFEst\xE1 seguro?",nzContent:"Eliminar\xE1 toda la informaci\xF3n de "+e.name,nzCancelText:"Cancelar",nzOkText:"Eliminar",nzOkLoading:this.isOkLoading,nzOnOk:()=>{this.deleteAccount(e)}})}createBasicMessage(e){this.messageService.success(`Se encontraron ${e} registros.`,{nzDuration:3e3})}showModalAdd(){this.isVisibleAdd=!0,this.accountsSubscription=this.accountsService.getJobType().pipe(T(e=>e.map(i=>{let n=i.payload.doc.id,a=i.payload.doc.data();return F({id:n},a)}))).subscribe(e=>{this.jobType=e})}handleCancel(){this.isVisibleAdd=!1}sendMessage(e,i){this.messageService.create(e,i)}onJobTypeSelected(e){let i=this.jobType.filter(n=>n.uid===e);if(i.length>0){let n=i[0].consecutive;this.currentJobType=e,n=parseInt(n,10)+1,n=n.toString().padStart(4,"0"),this.validateForm.controls.custConsecutive.setValue(i[0].type+n),this.currentConsecutive=n}}static{this.\u0275fac=function(i){return new(i||r)(b(D),b(ve),b(A))}}static{this.\u0275cmp=V({type:r,selectors:[["app-dashboard"]],decls:29,vars:6,consts:[["modalContentAdd",""],["avatarTemplate",""],["actionSetting",""],["actionEdit",""],["actionEllipsis",""],["menu","nzDropdownMenu"],[2,"margin","buttom 15px"],[1,"site-page-header-ghost-wrapper"],[2,"background-color","#f9fbfd",3,"nzGhost"],[2,"margin-left","350px"],[1,"d-md-flex","align-items-center","d-none"],[1,"media","align-items-center","m-r-40","m-v-5"],[1,"font-size-27"],["nz-icon","","theme","outline",1,"text-primary"],["nz-icon","","theme","outline",1,"text-success"],[1,"media","align-items-center","m-v-5"],["nz-icon","","theme","outline",1,"text-danger"],[1,"media","align-items-center","m-v-5","m-l-10"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],[1,"body"],[4,"ngIf"],["nz-row","",3,"nzGutter"],["nz-col","","nzSpan","6",4,"ngFor","ngForOf"],["nzTitle","Nueva Empresa","nzCancelText","Cancelar","nzOkText","Crear","nzOkType","primary",3,"nzOnCancel","nzOnOk","nzVisible","nzContent"],["nz-col","","nzSpan","6"],[3,"nzActions"],[3,"nzActive","nzLoading","nzAvatar"],[3,"nzAvatar","nzTitle"],["nzSize","large",2,"vertical-align","middle",3,"ngStyle","nzSrc"],["nz-icon","","nzTooltipTitle","Activo","nzTooltipPlacement","topLeft","nz-tooltip","",3,"nzType","nzTheme","nzTwotoneColor","click",4,"ngIf"],["nz-icon","","nzTooltipTitle","Inactivo","nzTooltipPlacement","topLeft","nz-tooltip","",3,"nzType","nzTheme","nzTwotoneColor","click",4,"ngIf"],["nz-icon","","nzTooltipTitle","Activo","nzTooltipPlacement","topLeft","nz-tooltip","",3,"click","nzType","nzTheme","nzTwotoneColor"],["nz-icon","","nzTooltipTitle","Inactivo","nzTooltipPlacement","topLeft","nz-tooltip","",3,"click","nzType","nzTheme","nzTwotoneColor"],["nz-icon","","nzType","edit","routerLinkActive","router-link-active","nzTooltipTitle","Editar","nzTooltipPlacement","topLeft","nz-tooltip","",3,"routerLink"],["nz-dropdown","","nzPlacement","bottomRight",3,"nzDropdownMenu"],["nz-icon","","nzType","ellipsis","nzTooltipTitle","M\xE1s informaci\xF3n","nzTooltipPlacement","topLeft","nz-tooltip",""],["nz-menu","","nzSelectable",""],["nz-menu-item","","routerLinkActive","router-link-active",3,"routerLink"],["nz-icon","","nzType","user"],["nz-icon","","nzType","shopping"],["nz-icon","","nzType","clock-circle"],["nz-menu-divider",""],["nz-menu-item","",3,"click"],["nz-icon","","nzTheme","twotone","nzTwotoneColor","#de4436","nzType","delete"],["nz-form","",3,"ngSubmit","formGroup"],["nzRequired","","nzFor","name",3,"nzSm","nzXs"],["nzErrorTip","Debe contener entre 5 y 30 caracteres.",3,"nzSm","nzXs"],["nz-input","","formControlName","name","id","name"],["nzFor","address","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Ingrese el Giro",3,"nzSm","nzXs"],["formControlName","jobTypeID","nzAllowClear","","nzPlaceHolder","Selecciona el Giro de la Empresa",2,"width","320px",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzRequired","","nzFor","custConsecutive",3,"nzSm","nzXs"],["nzErrorTip","Consecutivo es necesario para crear la empresa.",3,"nzSm","nzXs"],["nz-input","","formControlName","custConsecutive","id","custConsecutive",3,"disabled"],["nzRequired","","nzFor","phoneNumber",3,"nzSm","nzXs"],["nzErrorTip","Ingrese el tel\xE9fono de contacto con la empresa.",3,"nzSm","nzXs"],["nz-input","","formControlName","phoneNumber","id","phoneNumber"],["nzFor","website","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Ingrese el sitio web!",3,"nzSm","nzXs"],["nz-input","","id","website","formControlName","website","placeholder","website"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon",""]],template:function(i,n){if(i&1){let a=x();t(0,"div",6)(1,"div",7)(2,"nz-page-header",8)(3,"nz-page-header-title",9),s(4,"CRM"),o(),t(5,"nz-page-header-subtitle"),s(6,"Informaci\xF3n Comercial "),o(),t(7,"nz-page-header-extra")(8,"div",10)(9,"div",11)(10,"div",12),c(11,"i",13),o()(),t(12,"div",11)(13,"div",12),c(14,"i",14),o()(),t(15,"div",15)(16,"div",12),c(17,"i",16),o()(),t(18,"div",17)(19,"button",18),g("click",function(){return z(a),f(n.showModalAdd())}),s(20,"Nueva Empresa"),o()()()(),c(21,"nz-page-header-footer"),o()(),t(22,"div",19),S(23,Yi,1,0,"nz-empty",20),t(24,"div",21),S(25,on,12,11,"div",22),o()()(),t(26,"nz-modal",23),g("nzOnCancel",function(){return z(a),f(n.handleCancel())})("nzOnOk",function(){return z(a),f(n.submitForm())}),o(),S(27,an,28,23,"ng-template",null,0,I)}if(i&2){let a=w(28);l(2),m("nzGhost",!1),l(21),m("ngIf",n.accountsList.length===0),l(),m("nzGutter",8),l(),m("ngForOf",n.accountsList),l(),m("nzVisible",n.isVisibleAdd)("nzContent",a)}},dependencies:[k,pe,We,ze,K,Q,ee,Z,ie,te,fe,Ee,Xe,si,ye,xe,Qe,Te,we,Fe,Ce,X,W,G,be,Tt,oe,Ze,et,ge,li,re,ae,ii,ni,j,ue,M,q,B,H,ai]})}}return r})();function sn(r,u){if(r&1&&c(0,"nz-option",12),r&2){let e=u.$implicit;m("nzValue",e)("nzLabel",e)}}function ln(r,u){if(r&1&&c(0,"nz-option",12),r&2){let e=u.$implicit;m("nzValue",e)("nzLabel",e)}}function mn(r,u){if(r&1&&(t(0,"form",6)(1,"nz-form-item")(2,"nz-form-label"),s(3,"Nombre de la Operaci\xF3n"),o(),t(4,"nz-form-control"),c(5,"input",7),o()(),t(6,"nz-form-item")(7,"nz-form-label"),s(8,"Descripci\xF3n"),o(),t(9,"nz-form-control"),c(10,"textarea",8),o()(),t(11,"nz-form-item")(12,"nz-form-label"),s(13,"Horarios Entradas (Opcional)"),o(),t(14,"nz-form-control")(15,"nz-select",9),S(16,sn,1,2,"nz-option",10),o()()(),t(17,"nz-form-item")(18,"nz-form-label"),s(19,"Horarios Salidas (Opcional)"),o(),t(20,"nz-form-control")(21,"nz-select",11),S(22,ln,1,2,"nz-option",10),o()()()()),r&2){let e=p();m("formGroup",e.objectForm),l(16),m("ngForOf",e.timeOptions),l(6),m("ngForOf",e.timeOptions)}}function cn(r,u){if(r&1&&(t(0,"nz-tab",13),c(1,"app-shared-stoppoints-list",14),o()),r&2){let e=u.$implicit,i=p();m("nzTitle",i.getTabTitle(e)),l(),m("userCanUpdate",!0)("accountId",i.accountId)("routeId",e.id)}}var yi=(()=>{class r{constructor(e,i,n,a){this.afs=e,this.modalService=i,this.messageService=n,this.fb=a,this.accountId="",this.routesService=C(nt),this.tabs=[],this.nzTabPosition="top",this.selectedIndex=0,this.routesList=[],this.stopPointsList=[],this.stopSubscription$=new J,this.customersService=C(Je),this.timeOptions=[]}ngOnInit(){this.createForm(),this.getSubscriptions(),this.generateTimeOptions()}ngOnDestroy(){this.sub.unsubscribe()}generateTimeOptions(){for(let n=7;n<=21;n++){let a=n%12||12,d=n<12?"AM":"PM",_=`${a.toString().padStart(2,"0")}:${n%60===30?"30":"00"} ${d}`;this.timeOptions.push(_)}}createForm(){this.objectForm=this.fb.group({active:[!1,[v.required]],description:["",[v.required]],imageUrl:[""],kmzUrl:[""],name:["",[v.minLength(5),v.maxLength(20),v.required]],routeId:[""],customerId:["",[v.required]],customerName:[""],initialStart:[[]],initialEnd:[[]]})}resetForm(){this.objectForm.reset({active:!1,description:"",imageUrl:"",kmzUrl:"",name:"",routeId:"",customerId:"",customerName:"",initialStart:[],initialEnd:[]})}addNewRoute(e){var i,n;let a=this.modalService.create({nzTitle:"Nueva Operaci\xF3n",nzContent:e,nzFooter:[{label:"Crear Operaci\xF3n ",type:"primary",onClick:()=>this.modalService.confirm({nzTitle:"\xBFEst\xE1 la informaci\xF3n completa?",nzOnOk:()=>{if(this.objectForm.get("customerId").setValue(this.accountId),this.objectForm.valid){let d=this.objectForm.value,_=d.initialStart&&d.initialStart.length>0?d.initialStart.map(P=>({value:P})):null,h=d.initialEnd&&d.initialEnd.length>0?d.initialEnd.map(P=>({value:P})):[],y=F(F({},d),_?{initialStart:_}:{}),me=this.afs.createId(),Ht=this.routesService.setRoute2(me,this.accountId,this.objectForm.value).then(()=>{}).catch(P=>this.sendMessage("error",P));this.routesService.getInternalCustomer(this.accountId).pipe(L(this.stopSubscription$),T(P=>P.map(qe=>{let pt=qe.payload.doc.id,$t=qe.payload.doc.data();return se(F({},$t),{id:pt})}))).subscribe(P=>{let qe=this.objectForm.controls.name.value,pt=new Date,Wt=new Date(pt.getFullYear()+3,pt.getMonth(),pt.getDate()).toISOString();var Ui="";let Pt={authorization:"portalAuth",operation_type:"in",method:"Liquidacion",transaction_type:"charge",card:{type:"",brand:"",address:"",card_number:"",holder_name:"",expiration_year:"",expiration_month:"",allows_charges:"",allows_payouts:"",bank_name:"",bank_code:"",points_card:"",points_type:""},status:"completed",conciliated:!1,creation_date:new Date().toISOString(),operation_date:new Date().toISOString(),description:"Pago a traves de portal",error_message:"",order_id:"portalOrder",currency:"MXN",amount:0,customer:{name:"",last_name:"",email:"",phone_number:"",address:"",creation_date:"",external_id:"",clabe:""},product:{product_id:"",amountTrips:0,frequencies:0,rangeWeeks:{},weeks:0,name:""},customerId:this.accountId,active:!0,category:"permanente",date_created:new Date().toISOString(),product_description:"Pago a traves de portal proceso interno al crear una ruta",product_id:"",name:qe,isTaskIn:"false",isTaskOut:"false",type:"Servicio",isOpenpay:!1,paidApp:"portal",price:0,round:"",routeId:me,routeName:qe,stopDescription:"",stopId:"",stopName:"Internal",validFrom:new Date().toISOString(),validTo:Wt,idBoardingPass:P[0].id,idPurchasteRequest:"",is_courtesy:!1,typePayment:"Liquidacion"};i={active:!0,amountPayment:0,payment:"Liquidacion",status:"completed",customer_id:this.accountId,customerId:this.accountId,creation_date:new Date().toISOString(),name:"internal",price:0,operation_date:new Date().toISOString(),routeId:me,routeName:qe,round:"",stopName:"internal",stopId:"",typePayment:"Liquidacion",validFrom:new Date().toISOString(),validTo:Wt,idBoardingPass:P[0].uid,idPurchaseRequest:"",baja:!1,type:"Servicio",fileURL:Ui},this.customersService.saveBoardingPassToUserPurchaseCollection(P[0].id,Pt).then(Gt=>{this.customersService.saveBoardingPassDetailToUserPurchaseCollection(P[0].id,me,Pt).then(Xt=>{let qi=P[0];this.customersService.createPurchaseCloud(Pt,qi,P[0].id)}).catch(Xt=>{this.sendMessage("error",Xt)})}).catch(Gt=>{this.sendMessage("error",Gt)}),this.modalService.closeAll()})}}})}],nzWidth:500})}getSubscriptions(){this.sub=this.routesService.getRoutes(this.accountId).pipe(T(e=>e.map(i=>{let n=i.payload.doc.id,a=i.payload.doc.data();return se(F({},a),{id:n})}))).subscribe(e=>{this.routesList=e,e.forEach(i=>{this.tabs.push({name:i.name,content:`Content of tab ${i.name}`})})})}getTabTitle(e){return`${e.name}`}sendMessage(e,i){this.messageService.create(e,i)}static{this.\u0275fac=function(i){return new(i||r)(b(he),b(ve),b(D),b(A))}}static{this.\u0275cmp=V({type:r,selectors:[["app-shared-routes-list"]],inputs:{accountId:"accountId"},decls:9,vars:4,consts:[["newProjectContent",""],[1,"site-page-header-ghost-wrapper"],[2,"background-color","#f9fbfd",3,"nzGhost"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],[3,"nzSelectedIndexChange","nzTabPosition","nzSelectedIndex"],[3,"nzTitle",4,"ngFor","ngForOf"],["nz-form","","nzLayout","vertical",3,"formGroup"],["type","text","formControlName","name","nz-input","","placeholder","Escriba el nombre de la Operaci\xF3n"],["formControlName","description","nz-input",""],["formControlName","initialStart","nzMode","multiple"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["formControlName","initialEnd","nzMode","multiple"],[3,"nzValue","nzLabel"],[3,"nzTitle"],[3,"userCanUpdate","accountId","routeId"]],template:function(i,n){if(i&1){let a=x();t(0,"div",1)(1,"nz-page-header",2)(2,"nz-page-header-extra")(3,"button",3),g("click",function(){z(a);let _=w(6);return f(n.addNewRoute(_))}),s(4,"Agregar Operaci\xF3n"),o()()()(),S(5,mn,23,3,"ng-template",null,0,I),t(7,"nz-tabset",4),U("nzSelectedIndexChange",function(_){return z(a),R(n.selectedIndex,_)||(n.selectedIndex=_),f(_)}),S(8,cn,2,4,"nz-tab",5),o()}i&2&&(l(),m("nzGhost",!1),l(6),m("nzTabPosition",n.nzTabPosition),O("nzSelectedIndex",n.selectedIndex),l(),m("ngForOf",n.routesList))},dependencies:[k,K,Q,ee,Z,ie,te,fe,X,W,G,oe,ge,re,ae,j,ue,M,q,B,H,it,tt,pi]})}}return r})();var Vt=Jt(ji());function un(r,u){if(r&1&&(t(0,"nz-tag",10),s(1,"Dom"),o()),r&2){let e=p().$implicit;m("nzColor",e.isSunday?"geekblue":"")}}function hn(r,u){if(r&1&&(t(0,"nz-tag",10),s(1,"Lun"),o()),r&2){let e=p().$implicit;m("nzColor",e.isMonday?"geekblue":"")}}function zn(r,u){if(r&1&&(t(0,"nz-tag",10),s(1,"Mar"),o()),r&2){let e=p().$implicit;m("nzColor",e.isTuesday?"geekblue":"")}}function fn(r,u){if(r&1&&(t(0,"nz-tag",10),s(1,"Mi\xE9"),o()),r&2){let e=p().$implicit;m("nzColor",e.isWednesday?"geekblue":"")}}function gn(r,u){if(r&1&&(t(0,"nz-tag",10),s(1,"Jue"),o()),r&2){let e=p().$implicit;m("nzColor",e.isThursday?"geekblue":"")}}function _n(r,u){if(r&1&&(t(0,"nz-tag",10),s(1,"Vie"),o()),r&2){let e=p().$implicit;m("nzColor",e.isFriday?"geekblue":"")}}function vn(r,u){if(r&1&&(t(0,"nz-tag",10),s(1,"S\xE1b"),o()),r&2){let e=p().$implicit;m("nzColor",e.isSaturday?"geekblue":"")}}function Sn(r,u){r&1&&c(0,"i",24)}function Cn(r,u){if(r&1){let e=x();t(0,"li",19),g("click",function(){z(e);let n=p().$implicit,a=p(2);return f(a.toggleActive(n))}),c(1,"i",25),s(2," Activar "),o()}}function bn(r,u){if(r&1){let e=x();t(0,"li",19),g("click",function(){z(e);let n=p().$implicit,a=p(2);return f(a.toggleActive(n))}),c(1,"i",26),s(2," Desactivar "),o()}}function xn(r,u){if(r&1){let e=x();t(0,"tr")(1,"td"),s(2),o(),t(3,"td"),s(4),o(),t(5,"td")(6,"nz-tag",10),s(7),o()(),t(8,"td"),S(9,un,2,1,"nz-tag",11)(10,hn,2,1,"nz-tag",11)(11,zn,2,1,"nz-tag",11)(12,fn,2,1,"nz-tag",11)(13,gn,2,1,"nz-tag",11)(14,_n,2,1,"nz-tag",11)(15,vn,2,1,"nz-tag",11),o(),t(16,"td"),s(17),o(),t(18,"td"),s(19),He(20,"date"),o(),t(21,"td")(22,"nz-tag",10),S(23,Sn,1,0,"i",12),t(24,"span"),s(25),o()()(),t(26,"td")(27,"nz-tag",13),s(28),o(),s(29),o(),t(30,"td")(31,"nz-tag",14),s(32),o(),s(33),o(),t(34,"td"),s(35),o(),t(36,"td")(37,"a",15),c(38,"i",16),o(),t(39,"nz-dropdown-menu",null,2)(41,"ul",17),S(42,Cn,3,0,"li",18)(43,bn,3,0,"li",18),t(44,"li",19),g("click",function(){let n=z(e).$implicit,a=p(2);return f(a.showModalEdit(n))}),c(45,"i",20),s(46," Editar "),o(),c(47,"li",21),t(48,"li",22),g("nzOnConfirm",function(){let n=z(e).$implicit,a=p(2);return f(a.showModalDelete(n))})("nzOnCancel",function(){z(e);let n=p(2);return f(n.handleCancel())}),c(49,"i",23),s(50," Eliminar "),o()()()()()}if(r&2){let e=u.$implicit,i=w(40),n=p(2);l(),Y(e.active?"text-dark":"text-muted font-italic"),l(),E(e.vendorName),l(),Y(e.active?"text-dark":"text-muted font-italic"),l(),E(n.getRouteName(e.routeId)),l(),Y(e.active?"text-dark":"text-muted font-italic"),l(),m("nzColor",e.program=="M"?"green":"red"),l(),E(e.program=="M"?"Mete":"Saca"),l(),Y(e.active?"text-dark":"text-muted font-italic"),l(),m("ngIf",e.isSunday),l(),m("ngIf",e.isMonday),l(),m("ngIf",e.isTuesday),l(),m("ngIf",e.isWednesday),l(),m("ngIf",e.isThursday),l(),m("ngIf",e.isFriday),l(),m("ngIf",e.isSaturday),l(),Y(e.active?"text-dark":"text-muted font-italic"),l(),E(e.round),l(),Y(e.active?"text-dark":"text-muted font-italic"),l(),N("",$e(20,46,e.time.toDate(),"HH:mm")," "),l(2),Y(e.active?"text-dark":"text-muted font-italic"),l(),m("nzColor",e.acRequired?"blue":""),l(),m("ngIf",e.acRequired),l(2),E(e.acRequired?"":"No"),l(),Y(e.active?"text-dark":"text-muted font-italic"),l(2),E(e.stopBeginHour),l(),N(" ",e.stopBeginName,""),l(),Y(e.active?"text-dark":"text-muted font-italic"),l(2),E(e.stopEndHour),l(),N(" ",e.stopEndName,""),l(),Y(e.active?"text-dark":"text-muted font-italic"),l(),E(e.type),l(),Y(e.active?"text-dark":"text-muted font-italic"),l(),m("nzDropdownMenu",i),l(5),m("ngIf",!e.active),l(),m("ngIf",e.active)}}function yn(r,u){if(r&1){let e=x();t(0,"nz-table",8,1),U("nzPageSizeChange",function(n){z(e);let a=p();return R(a.pageSize,n)||(a.pageSize=n),f(n)}),t(2,"thead")(3,"tr")(4,"th"),s(5,"Asignado A"),o(),t(6,"th"),s(7,"Operaci\xF3n"),o(),t(8,"th"),s(9,"Tarea"),o(),t(10,"th"),s(11,"D\xEDas"),o(),t(12,"th"),s(13,"Turno"),o(),t(14,"th"),s(15,"Hora"),o(),t(16,"th"),s(17,"AC"),o(),t(18,"th"),s(19,"Inicio"),o(),t(20,"th"),s(21,"Fin"),o(),t(22,"th"),s(23,"Tipo"),o(),c(24,"th"),o()(),t(25,"tbody"),S(26,xn,51,49,"tr",9),o()()}if(r&2){let e=w(1),i=p();m("nzData",i.programsList)("nzLoading",i.loading),O("nzPageSize",i.pageSize),l(26),m("ngForOf",e.data)}}function En(r,u){if(r&1&&(t(0,"nz-option",50),c(1,"i",51),s(2),c(3,"br"),s(4),o()),r&2){let e=u.$implicit;m("nzLabel",e.name)("nzValue",e.id),l(2),N(" ",e.name," "),l(2),N(" ",e.description,"")}}function Tn(r,u){if(r&1&&(t(0,"nz-option",50),c(1,"i",51),s(2),c(3,"br"),s(4),o()),r&2){let e=u.$implicit;m("nzLabel",e.name)("nzValue",e.id),l(2),N(" ",e.name," "),l(2),N(" ",e.description,"")}}function wn(r,u){if(r&1&&(t(0,"nz-option",50),c(1,"i",51),s(2),c(3,"br"),s(4),o()),r&2){let e=u.$implicit;m("nzLabel",e.name)("nzValue",e.id),l(2),N(" ",e.name," "),l(2),N(" ",e.description,"")}}function Fn(r,u){if(r&1&&(t(0,"nz-option",50),c(1,"i",51),s(2),c(3,"br"),s(4),o()),r&2){let e=u.$implicit;m("nzLabel",e.name)("nzValue",e.id),l(2),N(" ",e.name," "),l(2),N(" ",e.description,"")}}function Nn(r,u){if(r&1){let e=x();t(0,"form",27),g("ngSubmit",function(){z(e);let n=p();return f(n.createProgram())}),t(1,"nz-form-item")(2,"nz-form-label"),s(3,"Divisi\xF3n"),o(),t(4,"nz-form-control")(5,"nz-select",28),g("ngModelChange",function(n){z(e);let a=p();return f(a.onVendorSelected(n,"vendorName"))}),S(6,En,5,4,"nz-option",29),o()()(),t(7,"div",30)(8,"div",31)(9,"nz-form-item")(10,"nz-form-label"),s(11,"Tipo de asignaci\xF3n"),o(),t(12,"nz-form-control")(13,"nz-select",32),c(14,"nz-option",33),o()()()(),t(15,"div",31)(16,"nz-form-item")(17,"nz-form-label"),s(18,"Operaci\xF3n"),o(),t(19,"nz-form-control")(20,"nz-select",34),g("ngModelChange",function(n){z(e);let a=p();return f(a.onRouteSelected(n))}),S(21,Tn,5,4,"nz-option",29),o()()()()(),t(22,"div",30)(23,"div",31)(24,"nz-form-item")(25,"nz-form-label"),s(26,"Turno"),o(),t(27,"nz-form-control")(28,"nz-select",35),c(29,"nz-option",36)(30,"nz-option",37)(31,"nz-option",38),o()()()(),t(32,"div",31)(33,"nz-form-item")(34,"nz-form-label"),s(35,"Tarea"),o(),t(36,"nz-form-control")(37,"nz-select",39),c(38,"nz-option",40)(39,"nz-option",41),o()()()()(),t(40,"div",30)(41,"div",42)(42,"nz-form-item")(43,"nz-form-label"),s(44,"Hora Compromiso"),o(),t(45,"nz-form-control"),c(46,"nz-time-picker",43),o()()(),t(47,"div",42)(48,"nz-form-item")(49,"nz-form-label"),s(50,"Hora Inicio"),o(),t(51,"nz-form-control"),c(52,"nz-time-picker",44),o()()(),t(53,"div",42)(54,"nz-form-item")(55,"nz-form-label"),s(56,"Hora fin"),o(),t(57,"nz-form-control"),c(58,"nz-time-picker",45),o()()()(),t(59,"nz-form-item")(60,"nz-form-label",46),s(61,"D\xEDas"),o(),t(62,"nz-form-control")(63,"nz-tag",47),g("nzCheckedChange",function(n){z(e);let a=p();return f(a.checkChange("isSunday",n))}),s(64,"Dom"),o(),t(65,"nz-tag",47),g("nzCheckedChange",function(n){z(e);let a=p();return f(a.checkChange("isMonday",n))}),s(66,"Lun"),o(),t(67,"nz-tag",47),g("nzCheckedChange",function(n){z(e);let a=p();return f(a.checkChange("isTuesday",n))}),s(68,"Mar"),o(),t(69,"nz-tag",47),g("nzCheckedChange",function(n){z(e);let a=p();return f(a.checkChange("isWednesday",n))}),s(70,"Mi\xE9"),o(),t(71,"nz-tag",47),g("nzCheckedChange",function(n){z(e);let a=p();return f(a.checkChange("isThursday",n))}),s(72,"Jue"),o(),t(73,"nz-tag",47),g("nzCheckedChange",function(n){z(e);let a=p();return f(a.checkChange("isFriday",n))}),s(74,"Vie"),o(),t(75,"nz-tag",47),g("nzCheckedChange",function(n){z(e);let a=p();return f(a.checkChange("isSaturday",n))}),s(76,"S\xE1b"),o()()(),t(77,"div",30)(78,"div",31)(79,"nz-form-item")(80,"nz-form-label"),s(81,"Inicia en"),o(),t(82,"nz-form-control")(83,"nz-select",48),g("ngModelChange",function(n){z(e);let a=p();return f(a.onStopPointSelected(n,"stopBeginName","stopBeginHourT"))}),S(84,wn,5,4,"nz-option",29),o()()()(),t(85,"div",31)(86,"nz-form-item")(87,"nz-form-label"),s(88,"Termina en"),o(),t(89,"nz-form-control")(90,"nz-select",49),g("ngModelChange",function(n){z(e);let a=p();return f(a.onStopPointSelected(n,"stopEndName","stopEndHourT"))}),S(91,Fn,5,4,"nz-option",29),o()()()()()()}if(r&2){let e=p();m("formGroup",e.programForm),l(6),m("ngForOf",e.vendorsList),l(15),m("ngForOf",e.routesList),l(42),m("nzChecked",e.programForm.controls.isSunday.value),l(2),m("nzChecked",e.programForm.controls.isMonday.value),l(2),m("nzChecked",e.programForm.controls.isTuesday.value),l(2),m("nzChecked",e.programForm.controls.isWednesday.value),l(2),m("nzChecked",e.programForm.controls.isThursday.value),l(2),m("nzChecked",e.programForm.controls.isFriday.value),l(2),m("nzChecked",e.programForm.controls.isSaturday.value),l(9),m("ngForOf",e.stopPointsList),l(7),m("ngForOf",e.stopPointsList)}}var Ti=(()=>{class r{constructor(e,i,n){this.notification=e,this.messageService=i,this.fb=n,this.rolService=C(ne),this.authService=C($),this.vendorsService=C(ot),this.routesService=C(nt),this.loading=!0,this.pageSize=10,this.stopSubscription$=new J,this.programsList=[],this.routesList=[],this.stopPointsList=[],this.vendorsList=[],this.isCreateVisible=!1,this.isEditMode=!1,this.infoLoad=[],this.authService.user.subscribe(a=>{a&&(this.user=a,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(d=>{this.infoLoad=d,this.userlevelAccess=this.infoLoad.optionAccessLavel}))}),this.createForm()}ngOnInit(){this.getSubscriptions()}ngOnDestroy(){this.stopSubscription$.next(void 0),this.stopSubscription$.complete()}getSubscriptions(){this.routesService.getRoutes(this.accountId).pipe(L(this.stopSubscription$),T(e=>e.map(i=>{let n=i.payload.doc.id,a=i.payload.doc.data();return F({id:n},a)}))).subscribe(e=>{this.routesList=e,this.loading=!1}),this.routesService.getCustomerVendorAssignments(this.accountId).pipe(L(this.stopSubscription$),T(e=>e.map(i=>{let n=i.payload.doc.id,a=i.payload.doc.data();return se(F({},a),{id:n})}))).subscribe(e=>{this.programsList=e,this.loading=!1}),this.vendorsService.getVendors().pipe(L(this.stopSubscription$),T(e=>e.map(i=>{let n=i.payload.doc.id,a=i.payload.doc.data();return se(F({},a),{id:n})}))).subscribe(e=>{this.vendorsList=e,this.loading=!1})}getRouteName(e){let i="";if(this.routesList.length>0){let n=Vt.filter(this.routesList,a=>a.id==e);n.length>0&&(i=n[0].name)}return i}createForm(){this.programForm=this.fb.group({active:[!1,[v.required]],acRequired:[!1,[v.required]],isSunday:[!1,[v.required]],isMonday:[!0,[v.required]],isTuesday:[!0,[v.required]],isWednesday:[!0,[v.required]],isThursday:[!0,[v.required]],isFriday:[!0,[v.required]],isSaturday:[!1,[v.required]],program:["",[v.required]],round:["",[v.required]],stopBeginId:["",[v.required]],stopBeginName:["",[v.required]],stopBeginHour:["",[v.required]],stopBeginHourT:[""],stopEndId:["",[v.required]],stopEndName:["",[v.required]],stopEndHour:["",[v.required]],stopEndHourT:[""],time:[new Date,[v.required]],type:[this.assigmentType,[v.required]],customerName:["",[v.required]],customerId:[this.accountId,[v.required]],vendorName:["",[v.required]],vendorId:["",[v.required]],routeId:["",[v.required]]})}patchForm(e){let i=e.stopBeginHour.split(":"),n=e.stopEndHour.split(":");this.programForm.patchValue({active:e.active,acRequired:e.acRequired,isSunday:e.isSunday,isMonday:e.isMonday,isTuesday:e.isTuesday,isWednesday:e.isWednesday,isThursday:e.isThursday,isFriday:e.isFriday,isSaturday:e.isSaturday,program:e.program,round:e.round,stopBeginId:e.stopBeginId,stopBeginName:e.stopBeginName,stopBeginHour:e.stopBeginHour,stopBeginHourT:e.stopBeginHour,stopEndId:e.stopEndId,stopEndName:e.stopEndName,stopEndHour:e.stopEndHour,stopEndHourT:e.stopEndHour,time:e.time,type:e.type,customerName:e.customerName,customerId:this.accountId,vendorName:e.vendorName,vendorId:e.vendorId,routeId:e.routeId})}toggleActive(e){this.routesService.toggleRouteAssignment(this.accountId,e.routeId,e.id,e).then(()=>{this.isCreateVisible=!1,this.isEditMode=!1}).catch(i=>this.sendMessage("error",i))}showCreateModal(){this.programForm.reset(),this.isCreateVisible=!0,this.currentSelectedId="",this.currentSelected=null}sendMessage(e,i){this.messageService.create(e,i)}showModalDelete(e){this.userlevelAccess=="1"?this.routesService.deleteRouteAssignments(this.accountId,e.routeId,e.id).then(()=>{this.isCreateVisible=!1,this.isEditMode=!1}).catch(i=>this.sendMessage("error",i)):this.sendMessage("error","El usuario no tiene permisos para borrar datos, favor de contactar al administrador.")}showModalEdit(e){this.currentSelectedId=e.id,this.currentSelected=e,this.patchForm(e),setTimeout(()=>{this.isCreateVisible=!0},100),this.isEditMode=!0}handleCancel(){this.isCreateVisible=!1,this.isEditMode=!1,this.currentSelectedId=""}createProgram(){this.programForm!==null&&this.programForm!==void 0&&this.programForm.get("customerId").setValue(this.accountId);let e=new Date(this.programForm.controls.stopBeginHourT.value),i=new Date(this.programForm.controls.stopEndHourT.value),n=[e.getHours(),String(e.getMinutes()).padStart(2,"0")].join(":"),a=[i.getHours(),String(i.getMinutes()).padStart(2,"0")].join(":");this.programForm.controls.stopBeginHour.setValue(n),this.programForm.controls.stopEndHour.setValue(a);let d=this.programForm.get("stopBeginHour"),_=this.programForm.get("stopEndHour");if(d==""||_==""){this.notification.create("error","Problema con la informaci\xF3n","No est\xE1n definidos los tiempos entre estaci\xF3n de esta operaci\xF3n para el turno seleccionado");return}if(this.isEditMode)if(this.userlevelAccess!="3"){let h=this.programForm.get("routeId");if(h){this.routesService.updateRouteAssignment(this.accountId,h,this.currentSelectedId,this.programForm.value).then(()=>{this.isCreateVisible=!1,this.isEditMode=!1,this.currentSelectedId=""}).catch(y=>this.sendMessage("error",y));return}}else{this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.");return}else if(this.userlevelAccess!="3"){let h=this.programForm.get("routeId");if(h){this.routesService.setRouteAssignments(this.accountId,h.value,this.programForm.value).then(()=>{this.isCreateVisible=!1,this.isEditMode=!1}).catch(y=>this.sendMessage("error",y));return}}else{this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.");return}}checkChange(e,i){this.programForm.controls[e].setValue(i)}onRouteSelected(e){this.routesService.getRouteStopPoints(this.accountId,e).pipe(L(this.stopSubscription$),T(i=>i.map(n=>{let a=n.payload.doc.id,d=n.payload.doc.data();return se(F({},d),{id:a})}))).subscribe(i=>{this.stopPointsList=i,this.loading=!1})}onStopPointSelected(e,i,n){let a=this.programForm.controls.time.value,d=this.programForm.controls.program.value,_=i,h="";if(d=="M"?_=="stopBeginName"?h="stopBeginHourT":h="stopEndHourT":_=="stopEndName"?h="stopBeginHourT":h="stopEndHourT",e){let me=Vt.filter(this.stopPointsList,P=>P.id==e)[0],Ht=this.programForm.controls.round.value;switch(this.programForm.controls[i].setValue(me.name),Ht){case"D\xEDa":this.programForm.controls[h].setValue(gt(a,me.round1MinutesSinceStart));break;case"Tarde":this.programForm.controls[h].setValue(gt(a,me.round2MinutesSinceStart));break;case"Noche":this.programForm.controls[h].setValue(gt(a,me.round3MinutesSinceStart));break;default:this.programForm.controls[h].setValue(gt(a,me.round1MinutesSinceStart));break}}}onVendorSelected(e,i){if(e){let a=Vt.filter(this.vendorsList,d=>d.id==e)[0];this.programForm.controls[i].setValue(a.name)}}static{this.\u0275fac=function(i){return new(i||r)(b(Et),b(D),b(A))}}static{this.\u0275cmp=V({type:r,selectors:[["app-shared-customer-vendor-assignments"]],inputs:{accountId:"accountId"},decls:9,vars:4,consts:[["modalContentAdd",""],["programsListTable",""],["menu","nzDropdownMenu"],[1,"site-page-header-ghost-wrapper"],[2,"background-color","#f9fbfd",3,"nzGhost"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["nzShowSizeChanger","",3,"nzData","nzLoading","nzPageSize","nzPageSizeChange",4,"ngIf"],["nzTitle","Agregar asignaci\xF3n","nzWidth","600","nzOkText","Generar",3,"nzOnCancel","nzOnOk","nzVisible","nzContent"],["nzShowSizeChanger","",3,"nzPageSizeChange","nzData","nzLoading","nzPageSize"],[4,"ngFor","ngForOf"],[3,"nzColor"],[3,"nzColor",4,"ngIf"],["nz-icon","","nzType","deployment-unit",4,"ngIf"],["nzColor","green"],["nzColor","orange"],["nz-dropdown","","nzPlacement","bottomRight",3,"nzDropdownMenu"],["nz-icon","","nzType","ellipsis","nzTooltipTitle","M\xE1s informaci\xF3n","nzTooltipPlacement","topLeft","nz-tooltip",""],["nz-menu",""],["nz-menu-item","",3,"click",4,"ngIf"],["nz-menu-item","",3,"click"],["nz-icon","","nzType","edit"],["nz-menu-divider",""],["nz-menu-item","","nz-popconfirm","","nzPopconfirmTitle","\xBFEst\xE1s seguro de eliminar esta asignaci\xF3n?","nzPopconfirmPlacement","topRight",3,"nzOnConfirm","nzOnCancel"],["nz-icon","","nzTheme","twotone","nzTwotoneColor","#de4436","nzType","delete"],["nz-icon","","nzType","deployment-unit"],["nz-icon","","nzType","check-circle"],["nz-icon","","nzType","pause-circle"],["nz-form","",3,"ngSubmit","formGroup"],["formControlName","vendorId","nzAllowClear","","nzPlaceHolder","Selecciona la estaci\xF3n",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],[1,"row"],[1,"col-md-6","col-sm-12"],["formControlName","type"],["nzValue","Permanente","nzLabel","Permanente"],["formControlName","routeId",3,"ngModelChange"],["formControlName","round"],["nzValue","D\xEDa","nzLabel","D\xEDa"],["nzValue","Tarde","nzLabel","Tarde"],["nzValue","Noche","nzLabel","Noche"],["formControlName","program"],["nzValue","M","nzLabel","Mete"],["nzValue","S","nzLabel","Saca"],[1,"col-md-4","col-sm-12"],["name","time","formControlName","time","nzFormat","HH:mm"],["name","stopBeginHourT","formControlName","stopBeginHourT","nzFormat","HH:mm"],["name","stopEndHourT","formControlName","stopEndHourT","nzFormat","HH:mm"],["nzFor","days"],["nzMode","checkable",3,"nzCheckedChange","nzChecked"],["formControlName","stopBeginId","nzAllowClear","","nzPlaceHolder","Selecciona la estaci\xF3n",3,"ngModelChange"],["formControlName","stopEndId","nzAllowClear","","nzPlaceHolder","Selecciona la estaci\xF3n",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon","","nzType","flag"]],template:function(i,n){if(i&1){let a=x();t(0,"div",3)(1,"nz-page-header",4)(2,"nz-page-header-extra")(3,"button",5),g("click",function(){return z(a),f(n.showCreateModal())}),s(4,"Agregar asignaci\xF3n"),o()()()(),S(5,yn,27,4,"nz-table",6),t(6,"nz-modal",7),g("nzOnCancel",function(){return z(a),f(n.handleCancel())})("nzOnOk",function(){return z(a),f(n.createProgram())}),o(),S(7,Nn,92,12,"ng-template",null,0,I)}if(i&2){let a=w(8);l(),m("nzGhost",!1),l(4),m("ngIf",n.routesList.length>0),l(),m("nzVisible",n.isCreateVisible)("nzContent",a)}},dependencies:[k,pe,ze,K,Q,ee,Z,ie,te,Ve,Ne,Ie,Le,De,Pe,Ee,ye,xe,Qe,Te,we,Fe,Ce,X,W,G,oe,ge,rt,re,ae,j,M,q,B,H,ui,hi,yt]})}}return r})();var wi=(()=>{class r{constructor(e,i){this.afs=e,this.messageService=i,this.promotion=this.afs.collection("customer")}getPromotionsList(e){return this.afs.collection("customers").doc(e).collection("promotions",n=>n.orderBy("date_created","asc")).snapshotChanges()}savePromotion(e,i){let n=this.afs.createId(),a=this.afs.collection("customers").doc(i).collection("promotions").doc(n),d=this.afs.firestore.batch();return d.set(a.ref,e),d.commit()}editPromotion(e,i,n,a,d,_){return this.afs.collection("customers").doc(i).collection("promotions").doc(e).update({name:n,description:a,validFrom:d,validTo:d}).then(()=>{this.sendMessage("success","\xA1Listo! la promoci\xF3n fue actualizada")}).catch(y=>{this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal ... ${y}`)})}deactivePromotion(e,i,n){return this.afs.collection("customers").doc(n).collection("promotions").doc(e).update({active:i}).then(()=>{this.sendMessage("success","\xA1Listo! la promoci\xF3n fue desactivada")}).catch(d=>{this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal ... ${d}`)})}deletePromotion(e,i){this.afs.collection("customers").doc(e).collection("promotions").doc(i).delete().then(()=>this.sendMessage("success","La Promocion a sido eliminada.")).catch(a=>this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal ... ${a}`))}sendMessage(e,i){this.messageService.create(e,i)}static{this.\u0275fac=function(i){return new(i||r)(Ae(he),Ae(D))}}static{this.\u0275prov=je({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Dn=()=>({width:"100%"});function Vn(r,u){r&1&&(t(0,"nz-tag",20),s(1,"Activo"),o()),r&2&&m("nzColor","cyan")}function Pn(r,u){r&1&&(t(0,"nz-tag",20),s(1,"Suspendido"),o()),r&2&&m("nzColor","red")}function Ln(r,u){if(r&1){let e=x();t(0,"li",27),g("click",function(){z(e);let n=p().$implicit,a=p(2);return f(a.diactivePromotion(!1,n.id))}),s(1,"Suspender Promoci\xF3n "),o()}}function kn(r,u){if(r&1){let e=x();t(0,"li",27),g("click",function(){z(e);let n=p().$implicit,a=p(2);return f(a.diactivePromotion(!0,n.id))}),s(1,"Reactivar Promoci\xF3n "),o()}}function Mn(r,u){if(r&1){let e=x();t(0,"tr",18),g("click",function(){let n=z(e).$implicit,a=p(2);return f(a.promotionSelected(n))}),t(1,"td"),S(2,Vn,2,1,"nz-tag",19)(3,Pn,2,1,"nz-tag",19),o(),t(4,"td")(5,"nz-tag",20),s(6),o()(),t(7,"td")(8,"nz-tag",20),s(9),o()(),t(10,"td")(11,"span",21),s(12),He(13,"date"),o()(),t(14,"td")(15,"span",21),s(16),He(17,"date"),o()(),t(18,"td")(19,"span",21),s(20),He(21,"date"),o()(),t(22,"td")(23,"a",22),s(24,"Ver Imagen"),o()(),t(25,"td")(26,"a",23),c(27,"i",24),o(),t(28,"nz-dropdown-menu",null,4)(30,"ul",25),S(31,Ln,2,0,"li",26)(32,kn,2,0,"li",26),t(33,"li",27),g("click",function(){let n=z(e).$implicit,a=p(2);return f(a.editPromotion(n.id,n.name,n.description,n.validFrom.toDate(),n.validTo.toDate()))}),s(34,"Editar Promoci\xF3n"),o(),t(35,"li",27),g("click",function(){let n=z(e).$implicit,a=p(2);return f(a.deletePromotiom(n.id))}),s(36,"Borrar Promoci\xF3m"),o()()()()()}if(r&2){let e=u.$implicit,i=w(29);l(2),m("ngIf",e.active),l(),m("ngIf",!e.active),l(2),m("nzColor","blue"),l(),E(e.name),l(2),m("nzColor","blue"),l(),E(e.description),l(3),N(" ",e.validFrom?$e(13,13,e.validFrom.toDate(),"mediumDate"):""," "),l(4),N(" ",e.validTo?$e(17,16,e.validTo.toDate(),"mediumDate"):""," "),l(4),N(" ",e.date_created?$e(21,19,e.date_created.toDate(),"mediumDate"):""," "),l(3),Re("href",e.imageUrl,Oe),l(3),m("nzDropdownMenu",i),l(5),m("ngIf",e.active),l(),m("ngIf",!e.active)}}function An(r,u){if(r&1&&(t(0,"nz-table",16,3)(2,"thead")(3,"tr")(4,"th"),s(5,"Activo"),o(),t(6,"th"),s(7,"Nombre"),o(),t(8,"th"),s(9,"Descripci\xF3n"),o(),t(10,"th"),s(11,"Desde "),o(),t(12,"th"),s(13,"Hasta"),o(),t(14,"th"),s(15,"Fecha Creaci\xF3n"),o(),t(16,"th"),s(17,"Imagen"),o(),c(18,"th"),o()(),t(19,"tbody"),S(20,Mn,37,22,"tr",17),o()()),r&2){let e=w(1),i=p();m("nzData",i.promotionsList)("nzPageSize",i.pageSize3)("nzLoading",i.loadingLatestPurchases)("nzLoadingDelay",500),l(20),m("ngForOf",e.data)}}function On(r,u){if(r&1&&c(0,"img",41),r&2){let e=p(2);m("src",e.previewImage,Oe)("ngStyle",de(2,Dn))}}function Rn(r,u){if(r&1){let e=x();t(0,"form",28),g("ngSubmit",function(){z(e);let n=p();return f(n.createPromotion())}),t(1,"div",29)(2,"div",30)(3,"nz-form-item")(4,"nz-form-label"),s(5,"Nombre"),o(),t(6,"nz-form-control"),c(7,"input",31),o()()(),t(8,"div",30)(9,"nz-form-item")(10,"nz-form-label"),s(11,"Descripci\xF3n"),o(),t(12,"nz-form-control"),c(13,"input",32),o()()(),t(14,"div",33)(15,"nz-form-item")(16,"nz-form-label"),s(17,"Fecha Inicio"),o(),t(18,"nz-form-control"),c(19,"nz-date-picker",34),o()()(),t(20,"div",33)(21,"nz-form-item")(22,"nz-form-label"),s(23,"Fecha Fin"),o(),t(24,"nz-form-control"),c(25,"nz-date-picker",35),o()()(),t(26,"div",33)(27,"nz-form-item")(28,"nz-form-label"),s(29,"Fecha de Creaci\xF3n"),o(),t(30,"nz-form-control"),c(31,"nz-date-picker",36),o()()(),t(32,"div",30)(33,"nz-form-item")(34,"nz-form-label"),s(35,"Adjuntar Promoci\xF3n"),o(),t(36,"nz-form-control")(37,"nz-upload",37),U("nzFileListChange",function(n){z(e);let a=p();return R(a.fileList,n)||(a.fileList=n),f(n)}),g("nzChange",function(n){z(e);let a=p();return f(a.handleChange2(n))}),c(38,"i",38),t(39,"div",39),s(40,"Cargar"),o()(),t(41,"nz-modal",40),g("nzOnCancel",function(){z(e);let n=p();return f(n.previewVisible=!1)}),o()(),S(42,On,1,3,"ng-template",null,1,I),o()()()()}if(r&2){let e=w(43),i=p();m("formGroup",i.programForm),l(37),O("nzFileList",i.fileList),m("nzShowButton",!0)("nzShowUploadList",i.showUploadList)("nzPreview",i.handlePreview),l(4),m("nzVisible",i.previewVisible)("nzContent",e)("nzFooter",null)}}function Un(r,u){if(r&1){let e=x();t(0,"form",28),g("ngSubmit",function(){z(e);let n=p();return f(n.editSavePromotion())}),t(1,"div",29)(2,"div",30)(3,"nz-form-item")(4,"nz-form-label"),s(5,"Nombre"),o(),t(6,"nz-form-control"),c(7,"input",31),o()()(),t(8,"div",30)(9,"nz-form-item")(10,"nz-form-label"),s(11,"Descripci\xF3n"),o(),t(12,"nz-form-control"),c(13,"input",32),o()()(),t(14,"div",33)(15,"nz-form-item")(16,"nz-form-label"),s(17,"Fecha Inicio"),o(),t(18,"nz-form-control"),c(19,"nz-date-picker",34),o()()(),t(20,"div",33)(21,"nz-form-item")(22,"nz-form-label"),s(23,"Fecha Fin"),o(),t(24,"nz-form-control"),c(25,"nz-date-picker",35),o()()()()()}if(r&2){let e=p();m("formGroup",e.programEditForm)}}var Di=(()=>{class r{constructor(e,i,n){this.bucketStorage=e,this.messageService=i,this.fb=n,this.accountId="",this.pageSize3=3,this.loadingLatestPurchases=!1,this.rolService=C(ne),this.promotionsService=C(wi),this.authService=C($),this.view="cardView",this.infoLoad=[],this.isCreateVisible=!1,this.isEditMode=!1,this.fileListInfo=[],this.fileUrl="http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg",this.autosave=!0,this.uploading=!1,this.bucketPath="promotions/",this.uploadvalue=0,this.pageSize=10,this.usersList=[],this.rowGroupPanelShow=[],this.promotionsList=[],this.promotionsListLoaded=[],this.showUploadList={showPreviewIcon:!0,showRemoveIcon:!0,hidePreviewIconInNonImage:!0},this.previewImage="",this.previewVisible=!1,this.isEditVisible=!1,this.handlePreview=a=>{this.previewImage=a.url||a.thumbUrl,this.previewVisible=!0},this.authService.user.subscribe(a=>{a&&(this.user=a,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(d=>{this.infoLoad=d,this.userlevelAccess=this.infoLoad.optionAccessLavel}))}),this.programEditForm=this.fb.group({imageUrl:[""],active:[""],uid:[""],name:["",[v.required]],description:["",[v.required]],category:[],validFrom:[new Date],validTo:[new Date],date_created:[]}),this.createForm()}editPromotion(e,i,n,a,d){this.programEditForm.controls.uid.setValue(e),this.programEditForm.controls.name.setValue(i),this.programEditForm.controls.description.setValue(n),this.programEditForm.controls.validFrom.setValue(a),this.programEditForm.controls.validTo.setValue(d),this.isEditVisible=!0}deletePromotiom(e){this.promotionsService.deletePromotion(this.accountId,e)}diactivePromotion(e,i){this.promotionsService.deactivePromotion(i,e,this.accountId)}promotionSelected(e){}createForm(){this.programForm=this.fb.group({imageUrl:[""],active:[""],name:["",[v.required]],description:["",[v.required]],category:[],validFrom:[],validTo:[],date_created:[]})}toggleActive(){}ngOnInit(){this.sub=this.promotionsService.getPromotionsList(this.accountId).pipe(T(e=>e.map(i=>{let n=i.payload.doc.id,a=i.payload.doc.data();return F({id:n},a)}))).subscribe(e=>{this.promotionsList=e,this.promotionsListLoaded=e})}showCreateModal(){this.programForm.reset(),this.isCreateVisible=!0,this.currentSelectedId="",this.currentSelected=null}showModalDelete(e){}sendMessage(e,i){this.messageService.create(e,i)}handleCancel(){this.isCreateVisible=!1,this.isEditMode=!1,this.currentSelectedId="",this.isEditVisible=!1}createPromotion(){if(this.programForm.valid){var e;e={active:!0,name:this.programForm.controls.name.value,description:this.programForm.controls.description.value,validFrom:this.programForm.controls.validFrom.value,validTo:this.programForm.controls.validTo.value,imageUrl:this.programForm.controls.imageUrl.value||"",customerId:this.user.customerId,category:"",date_created:this.programForm.controls.date_created.value},this.userlevelAccess!="3"?this.promotionsService.savePromotion(e,this.accountId).then(()=>{this.messageService.success("Se agreg\xF3 la promoci\xF3n con \xE9xito.",{nzPauseOnHover:!0,nzDuration:3e3}),this.isCreateVisible=!1}):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}}handleChange2(e){if(e.file.status!=="uploading"){let n=e.file.status;this.fileListInfo=e.fileList,e.file.originFileObj&&this.getBase64(e.file.originFileObj,a=>{this.fileUrl=a;let d=e.file.name,_=`${this.bucketPath}/${d}`,h=this.bucketStorage.ref(_);this.task=this.bucketStorage.ref(_).putString(a,"data_url"),this.uploadPercent=this.task.percentageChanges(),this.uploadPercent.pipe(T(y=>Number((y/100).toFixed(2)))).subscribe(y=>{this.uploading=y!=0,this.uploadvalue=y}),this.task.snapshotChanges().pipe(Me(()=>{this.uploading=!1,this.downloadURL=h.getDownloadURL(),this.downloadURL.subscribe(y=>ce(this,null,function*(){this.updateAdvanceURL(y),y.length>0?this.sendMessage("success",`${e.file.name} Archivo cargado satisfactoriamente.`):n==="error"&&this.sendMessage("error",`${e.file.name} archivo fallido, favor de validar.`)}))})).subscribe()})}}getBase64(e,i){let n=new FileReader;n.readAsDataURL(e),n.onload=()=>i(n.result),n.onerror=a=>this.sendMessage("error",a.toString())}updateAdvanceURL(e){return ce(this,null,function*(){this.programForm.controls.imageUrl.patchValue(e)})}onGridReady(e){this.gridApi=e.api,this.gridColumnApi=e.columnApi}setPaginationPageSize(e=10){this.pageSize=e,this.gridApi.paginationSetPageSize(Number(e))}editSavePromotion(){this.programEditForm.valid?(this.promotionsService.editPromotion(this.programEditForm.controls.uid.value,this.accountId,this.programEditForm.controls.name.value,this.programEditForm.controls.description.value,this.programEditForm.controls.validFrom.value,this.programEditForm.controls.validTo.value).then(()=>{this.messageService.success("Todo sali\xF3 bien.",{nzPauseOnHover:!0,nzDuration:3e3})}),this.isEditVisible=!1):this.sendMessage("error","Datos invalidos favor de validar")}getItems(e){let i=e;if(!i){this.promotionsList=this.promotionsListLoaded.slice();return}let n=i.toLowerCase();this.promotionsList=this.promotionsListLoaded.filter(a=>Object.values(a).some(d=>String(d).toLowerCase().includes(n)))}static{this.\u0275fac=function(i){return new(i||r)(b(at),b(D),b(A))}}static{this.\u0275cmp=V({type:r,selectors:[["app-promotions"]],inputs:{accountId:"accountId"},decls:25,vars:6,consts:[["searchBar",""],["modalContent",""],["modalContentEdit",""],["basicTable",""],["chatSetting","nzDropdownMenu"],[1,"site-page-header",2,"background-color","#f9fbfd"],[1,"site-page-header-ghost-wrapper"],[3,"nzGhost"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["nz-row",""],[1,"content"],["nz-icon","","nzTheme","outline",1,"search-icon"],["placeholder","Buscar",3,"keyup"],[3,"nzData","nzPageSize","nzLoading","nzLoadingDelay",4,"ngIf"],["nzTitle","Agregar Promoci\xF3n",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible","nzContent"],["nzTitle","Editar Promoci\xF3n",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible","nzContent"],[3,"nzData","nzPageSize","nzLoading","nzLoadingDelay"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[3,"nzColor",4,"ngIf"],[3,"nzColor"],["nz-text","","nzType","secondary"],["target","_blank",3,"href"],["nz-dropdown","",3,"nzDropdownMenu"],["nz-icon","","nzType","more","nzTheme","outline"],["nz-menu",""],["nz-menu-item","",3,"click",4,"ngIf"],["nz-menu-item","",3,"click"],["nz-form","","nzLayout","vertical",3,"ngSubmit","formGroup"],[1,"row"],[1,"col-md-12","col-sm-12"],["nz-input","","formControlName","name","id","descriptioA"],["nz-input","","formControlName","description","id","descriptioA"],[1,"col-md-7","col-sm-12"],["formControlName","validFrom"],["formControlName","validTo"],["formControlName","date_created"],["zAction","/api/posts/","nzListType","picture-card",3,"nzFileListChange","nzChange","nzFileList","nzShowButton","nzShowUploadList","nzPreview"],["nz-icon",""],[1,"ant-upload-text"],[3,"nzOnCancel","nzVisible","nzContent","nzFooter"],[3,"src","ngStyle"]],template:function(i,n){if(i&1){let a=x();t(0,"nz-page-header",5)(1,"nz-page-header-title"),s(2,"Promociones"),o(),t(3,"nz-page-header-subtitle"),s(4,"Promociones de esta empresa"),o(),t(5,"nz-page-header-extra")(6,"div",6)(7,"nz-page-header",7)(8,"nz-page-header-extra")(9,"button",8),g("click",function(){return z(a),f(n.showCreateModal())}),s(10,"Agregar Promocion"),o()()()()(),t(11,"nz-page-header-content")(12,"div",9)(13,"div",10),c(14,"i",11),t(15,"input",12,0),g("keyup",function(){z(a);let _=w(16);return f(n.getItems(_.value))}),o()()()()(),c(17,"br"),S(18,An,21,5,"nz-table",13),t(19,"nz-modal",14),U("nzVisibleChange",function(_){return z(a),R(n.isCreateVisible,_)||(n.isCreateVisible=_),f(_)}),g("nzOnCancel",function(){return z(a),f(n.handleCancel())})("nzOnOk",function(){return z(a),f(n.createPromotion())}),o(),S(20,Rn,44,8,"ng-template",null,1,I),t(22,"nz-modal",15),U("nzVisibleChange",function(_){return z(a),R(n.isEditVisible,_)||(n.isEditVisible=_),f(_)}),g("nzOnCancel",function(){return z(a),f(n.handleCancel())})("nzOnOk",function(){return z(a),f(n.editSavePromotion())}),o(),S(23,Un,26,1,"ng-template",null,2,I)}if(i&2){let a=w(21),d=w(24);l(7),m("nzGhost",!1),l(11),m("ngIf",n.promotionsList),l(),O("nzVisible",n.isCreateVisible),m("nzContent",a),l(3),O("nzVisible",n.isEditVisible),m("nzContent",d)}},dependencies:[k,pe,We,ze,K,Q,ee,Z,ie,te,fe,st,Ve,Ne,Ie,Le,De,Pe,Ee,lt,ye,xe,Te,we,Fe,X,W,G,oe,Ze,et,wt,ge,rt,j,ue,M,q,B,H,yt]})}}return r})();var Vi=()=>({width:"100%"});function Bn(r,u){r&1&&c(0,"span",27)}function Hn(r,u){if(r&1&&c(0,"img",61),r&2){let e=p(2);m("src",e.previewImage,Oe)("ngStyle",de(2,Vi))}}function $n(r,u){r&1&&(t(0,"div",62),s(1," El precio es requerido. "),o())}function Wn(r,u){r&1&&(t(0,"div",62),s(1," El precio debe ser mayor a 0. "),o())}function Gn(r,u){if(r&1&&(t(0,"div",62),S(1,$n,2,0,"div",55)(2,Wn,2,0,"div",55),o()),r&2){let e=p(2);l(),m("ngIf",e.isPriceRequired()),l(),m("ngIf",e.isPriceMin())}}function Xn(r,u){if(r&1){let e=x();t(0,"form",28),g("ngSubmit",function(){z(e);let n=p();return f(n.submitForm("A"))}),t(1,"div",12)(2,"div",29)(3,"nz-form-item")(4,"nz-form-label",30),s(5,"Nombre"),o(),t(6,"nz-form-control"),c(7,"input",31),o()()(),t(8,"div",32)(9,"nz-form-item")(10,"nz-form-label"),s(11,"Activo"),o(),t(12,"nz-form-control"),c(13,"nz-switch",33),o()()()(),t(14,"div",12)(15,"div",29)(16,"nz-form-item")(17,"nz-form-label"),s(18,"Descripci\xF3n"),o(),t(19,"nz-form-control"),c(20,"textarea",34),o()()(),t(21,"div",32)(22,"nz-form-item")(23,"nz-form-label"),s(24,"Adjuntar Imagen"),o(),t(25,"nz-form-control")(26,"nz-upload",35),U("nzFileListChange",function(n){z(e);let a=p();return R(a.fileList,n)||(a.fileList=n),f(n)}),g("nzChange",function(n){z(e);let a=p();return f(a.handleChange(n))}),t(27,"div",36),s(28,"Cargar"),o()()(),S(29,Hn,1,3,"ng-template",null,4,I),o()()(),t(31,"div",12)(32,"div",11)(33,"nz-form-item")(34,"nz-form-label"),s(35,"Categor\xEDa"),o(),t(36,"nz-form-control")(37,"nz-select",37),c(38,"nz-option",38)(39,"nz-option",39)(40,"nz-option",40)(41,"nz-option",41)(42,"nz-option",42)(43,"nz-option",43)(44,"nz-option",44)(45,"nz-option",45)(46,"nz-option",46)(47,"nz-option",47)(48,"nz-option",48),o()()()(),t(49,"div",11)(50,"nz-form-item")(51,"nz-form-label"),s(52,"Validez"),o(),t(53,"nz-form-control")(54,"nz-range-picker",49),g("nzOnCalendarChange",function(n){z(e);let a=p();return f(a.mapDateValues(n))}),o()()()()(),t(55,"div",12)(56,"div",50)(57,"nz-form-item")(58,"nz-form-label"),s(59,"Mete"),o(),t(60,"nz-form-control"),c(61,"nz-switch",51),o()()(),t(62,"div",50)(63,"nz-form-item")(64,"nz-form-label"),s(65,"Saca"),o(),t(66,"nz-form-control"),c(67,"nz-switch",52),o()()(),t(68,"div",53)(69,"nz-form-label"),s(70,"Precio"),o(),t(71,"nz-form-control"),c(72,"nz-input-number",54),S(73,Gn,3,2,"div",55),o()(),t(74,"div",50)(75,"nz-form-item")(76,"nz-form-label"),s(77,"Calculado"),o(),t(78,"nz-form-control"),c(79,"nz-switch",56),o()()(),t(80,"div",53)(81,"div")(82,"nz-form-label"),s(83,"Asientos"),o(),c(84,"nz-input-number",57),o()()(),t(85,"div",12)(86,"div",11)(87,"nz-form-item")(88,"nz-form-label"),s(89,"Frecuencias (Opcional)"),o(),t(90,"nz-select",58),c(91,"nz-option",59)(92,"nz-option",59)(93,"nz-option",59)(94,"nz-option",59)(95,"nz-option",59),o()()(),t(96,"div",11)(97,"nz-form-item")(98,"nz-form-label"),s(99,"Tipo de Producto (Opcional)"),o(),t(100,"nz-select",60),c(101,"nz-option",59)(102,"nz-option",59),o()()()()()}if(r&2){let e=p();m("formGroup",e.validateForm),l(26),O("nzFileList",e.fileList),m("nzShowButton",!0)("nzShowUploadList",e.showUploadList)("nzPreview",e.handlePreview),l(46),m("nzMin",0)("nzMax",12e4)("nzStep",1),l(),m("ngIf",e.isPriceInvalid()),l(11),m("nzMin",0)("nzMax",200)("nzStep",1),l(7),m("nzValue",1)("nzLabel",1),l(),m("nzValue",2)("nzLabel",2),l(),m("nzValue",3)("nzLabel",3),l(),m("nzValue",4)("nzLabel",4),l(),m("nzValue",5)("nzLabel",5),l(6),m("nzValue",e.camioneta)("nzLabel",e.camioneta),l(),m("nzValue",e.camion)("nzLabel",e.camion)}}function Jn(r,u){if(r&1&&c(0,"img",61),r&2){let e=p(2);m("src",e.previewImage,Oe)("ngStyle",de(2,Vi))}}function Yn(r,u){r&1&&(t(0,"div",62),s(1," El precio es requerido. "),o())}function Qn(r,u){r&1&&(t(0,"div",62),s(1," El precio debe ser mayor a 0. "),o())}function Kn(r,u){if(r&1&&(t(0,"div",62),S(1,Yn,2,0,"div",55)(2,Qn,2,0,"div",55),o()),r&2){let e=p(2);l(),m("ngIf",e.isPriceRequired()),l(),m("ngIf",e.isPriceMin())}}function Zn(r,u){if(r&1){let e=x();t(0,"form",28),g("ngSubmit",function(){z(e);let n=p();return f(n.submitForm("A"))}),t(1,"div",12)(2,"div",29)(3,"nz-form-item")(4,"nz-form-label",30),s(5,"Nombre"),o(),t(6,"nz-form-control"),c(7,"input",63),o()()()(),t(8,"div",12)(9,"div",29)(10,"nz-form-item")(11,"nz-form-label"),s(12,"Descripci\xF3n"),o(),t(13,"nz-form-control"),c(14,"textarea",34),o()()(),t(15,"div",32)(16,"nz-form-item")(17,"nz-form-label"),s(18,"Adjuntar Imagen"),o(),t(19,"nz-form-control")(20,"nz-upload",64),U("nzFileListChange",function(n){z(e);let a=p();return R(a.fileListE,n)||(a.fileListE=n),f(n)}),g("nzChange",function(n){z(e);let a=p();return f(a.handleChange2(n))}),t(21,"div",36),s(22,"Cargar"),o()(),t(23,"nz-modal",65),g("nzOnCancel",function(){z(e);let n=p();return f(n.previewVisibleE=!1)}),o()(),S(24,Jn,1,3,"ng-template",null,4,I),o()()(),t(26,"div",12)(27,"div",11)(28,"nz-form-item")(29,"nz-form-label"),s(30,"Categor\xEDa"),o(),t(31,"nz-form-control")(32,"nz-form-control")(33,"nz-select",66),c(34,"nz-option",38)(35,"nz-option",39)(36,"nz-option",40)(37,"nz-option",41)(38,"nz-option",42)(39,"nz-option",43)(40,"nz-option",44)(41,"nz-option",45)(42,"nz-option",46)(43,"nz-option",47)(44,"nz-option",48),o()()()()(),t(45,"div",11)(46,"nz-form-item")(47,"nz-form-label"),s(48,"Validez"),o(),t(49,"nz-form-control")(50,"nz-range-picker",67),g("nzOnCalendarChange",function(n){z(e);let a=p();return f(a.mapDateValues(n))}),o()()()()(),t(51,"div",12)(52,"div",50)(53,"nz-form-item")(54,"nz-form-label"),s(55,"Mete"),o(),c(56,"nz-switch",68),o()(),t(57,"div",50)(58,"nz-form-item")(59,"nz-form-label"),s(60,"Saca"),o(),c(61,"nz-switch",69),o()(),t(62,"div",53)(63,"nz-form-label"),s(64,"Precio"),o(),c(65,"nz-input-number",54),S(66,Kn,3,2,"div",55),o(),t(67,"div",50)(68,"nz-form-item")(69,"nz-form-label"),s(70,"Calculado"),o(),c(71,"nz-switch",56),o()(),t(72,"div",53)(73,"div")(74,"nz-form-label"),s(75,"Asientos"),o(),c(76,"nz-input-number",57),o()()(),t(77,"div",12)(78,"div",11)(79,"nz-form-item")(80,"nz-form-label"),s(81,"Frecuencias (Opcional)"),o(),t(82,"nz-select",58),c(83,"nz-option",59)(84,"nz-option",59)(85,"nz-option",59)(86,"nz-option",59)(87,"nz-option",59),o()()(),t(88,"div",11)(89,"nz-form-item")(90,"nz-form-label"),s(91,"Tipo de Producto (Opcional)"),o(),t(92,"nz-select",60),c(93,"nz-option",59)(94,"nz-option",59),o()()()()()}if(r&2){let e=w(25),i=p();m("formGroup",i.validateFormE),l(20),O("nzFileList",i.fileListE),m("nzShowButton",!0)("nzShowUploadList",i.showUploadList)("nzPreview",i.handlePreviewE),l(3),m("nzVisible",i.previewVisibleE)("nzContent",e)("nzFooter",null),l(10),m("disabled",!0),l(17),m("disabled",!0),l(6),m("disabled",!0),l(5),m("disabled",!0),l(4),m("nzMin",0)("nzMax",12e4)("nzStep",1),l(),m("ngIf",i.isPriceInvalid()),l(10),m("nzMin",0)("nzMax",200)("nzStep",1),l(7),m("nzValue",1)("nzLabel",1),l(),m("nzValue",2)("nzLabel",2),l(),m("nzValue",3)("nzLabel",3),l(),m("nzValue",4)("nzLabel",4),l(),m("nzValue",5)("nzLabel",5),l(6),m("nzValue",i.camioneta)("nzLabel",i.camioneta),l(),m("nzValue",i.camion)("nzLabel",i.camion)}}function eo(r,u){if(r&1){let e=x();t(0,"li",77),g("click",function(){z(e);let n=p().$implicit,a=p(2);return f(a.toggleActivateProduct(n))}),t(1,"a"),c(2,"i",85),t(3,"span",79),s(4,"Detener venta"),o()()()}}function to(r,u){if(r&1){let e=x();t(0,"li",77),g("click",function(){z(e);let n=p().$implicit,a=p(2);return f(a.toggleActivateProduct(n))}),t(1,"a"),c(2,"i",86),t(3,"span",79),s(4,"Activar venta"),o()()()}}function io(r,u){r&1&&(t(0,"nz-tag",83),s(1,"Venta Activa"),o()),r&2&&m("nzColor","green")}function no(r,u){r&1&&(t(0,"nz-tag",83),s(1,"Venta Detenida"),o()),r&2&&m("nzColor","red")}function oo(r,u){if(r&1&&c(0,"img",87),r&2){let e=p().$implicit;Re("src",e.imageUrl,Oe)}}function ro(r,u){if(r&1){let e=x();t(0,"div",53)(1,"nz-card",71),c(2,"nz-card-meta",72),t(3,"div")(4,"a",73),c(5,"i",74),o(),t(6,"nz-dropdown-menu",null,5)(8,"ul",75),S(9,eo,5,0,"li",76)(10,to,5,0,"li",76),t(11,"li",77),g("click",function(){let n=z(e).$implicit,a=p(2),d=w(25);return f(a.editProduct(n,d))}),t(12,"a"),c(13,"i",78),t(14,"span",79),s(15,"Editar"),o()()(),c(16,"li",80),t(17,"li",77),g("click",function(){let n=z(e).$implicit,a=p(2);return f(a.deleteProduct(n))}),t(18,"a"),c(19,"i",81),t(20,"span",79),s(21,"Eliminar "),o()()()()()(),t(22,"div",82)(23,"div")(24,"nz-tag",83),s(25),o(),S(26,io,2,1,"nz-tag",84)(27,no,2,1,"nz-tag",84),o()(),S(28,oo,1,1,"ng-template",null,6,I),o()()}if(r&2){let e=u.$implicit,i=w(7),n=w(29);l(),m("nzCover",n),l(),Re("nzTitle",e.name),Re("nzDescription",e.description),l(2),m("nzDropdownMenu",i),l(5),m("ngIf",e.active),l(),m("ngIf",!e.active),l(14),m("nzColor","blue"),l(),E(e.type),l(),m("ngIf",e.active),l(),m("ngIf",!e.active)}}function ao(r,u){if(r&1&&(t(0,"div",12),S(1,ro,30,10,"div",70),o()),r&2){let e=p();l(),m("ngForOf",e.productsList)}}function so(r,u){r&1&&(t(0,"nz-tag",83),s(1,"Activo"),o()),r&2&&m("nzColor","green")}function lo(r,u){if(r&1){let e=x();t(0,"li",77),g("click",function(){z(e);let n=p().$implicit,a=p(2);return f(a.toggleActivateProduct(n))}),t(1,"a"),c(2,"i",85),t(3,"span",79),s(4,"Detener venta"),o()()()}}function mo(r,u){if(r&1){let e=x();t(0,"li",77),g("click",function(){z(e);let n=p().$implicit,a=p(2);return f(a.toggleActivateProduct(n))}),t(1,"a"),c(2,"i",86),t(3,"span",79),s(4,"Activar venta"),o()()()}}function co(r,u){if(r&1){let e=x();t(0,"tr")(1,"td")(2,"div",91),c(3,"nz-avatar",92),t(4,"div",79)(5,"h5",93),s(6),o()()()(),t(7,"td"),s(8),o(),t(9,"td"),s(10),o(),t(11,"td")(12,"nz-tag",83),s(13),o()(),t(14,"td",89),S(15,so,2,1,"nz-tag",84),o(),t(16,"td",94)(17,"div")(18,"a",73),c(19,"i",74),o(),t(20,"nz-dropdown-menu",null,8)(22,"ul",75),S(23,lo,5,0,"li",76)(24,mo,5,0,"li",76),t(25,"li",95)(26,"a"),c(27,"i",78),t(28,"span",79),s(29,"Editar"),o()()(),c(30,"li",80),t(31,"li",77),g("click",function(){let n=z(e).$implicit,a=p(2);return f(a.deleteProduct(n))}),t(32,"a"),c(33,"i",81),t(34,"span",79),s(35,"Eliminar "),o()()()()()()()()}if(r&2){let e=u.$implicit,i=w(21);l(3),Re("nzSrc",e.imageUrl),l(3),E(e.name),l(2),E(e.category),l(2),E(e.description),l(2),m("nzColor","blue"),l(),E(e.type),l(2),m("ngIf",e.active),l(3),m("nzDropdownMenu",i),l(5),m("ngIf",e.active),l(),m("ngIf",!e.active)}}function po(r,u){if(r&1&&(t(0,"nz-card")(1,"nz-table",88,7)(3,"thead")(4,"tr")(5,"th"),s(6,"Nombre"),o(),t(7,"th"),s(8,"Categor\xEDa"),o(),t(9,"th"),s(10,"Descripci\xF3n"),o(),t(11,"th"),s(12,"Tipo"),o(),t(13,"th",89),s(14,"Status"),o(),c(15,"th"),o()(),t(16,"tbody"),S(17,co,36,10,"tr",90),o()()()),r&2){let e=w(2),i=p();l(),m("nzData",i.productsList),l(16),m("ngForOf",e.data)}}var Pi=(()=>{class r{constructor(e,i,n,a,d,_){this.modal=e,this.bucketStorage=i,this.afs=n,this.modalService=a,this.messageService=d,this.fb=_,this.accountId="",this.rolService=C(ne),this.productsService=C(fi),this.usersService=C(Je),this.view="cardView",this.productsList=[],this.productsListLoaded=[],this.infoLoad=[],this.userService=C(Ye),this.authService=C($),this.fileListInfo=[],this.fileList=[],this.fileListE=[],this.fileUrl="http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg",this.autosave=!0,this.uploading=!1,this.bucketPath="products1/products",this.uploadvalue=0,this.showUploadList={showPreviewIcon:!0,showRemoveIcon:!0,hidePreviewIconInNonImage:!0},this.previewImage="",this.previewImageE="",this.camioneta="Camioneta",this.camion="Cami\xF3n",this.previewVisible=!1,this.previewVisibleE=!1,this.weekControls=[],this.weekControlsE=[],this.handlePreview=h=>{this.previewImage=h.url||h.thumbUrl,this.previewVisible=!0},this.handlePreviewE=h=>{this.previewImageE=h.url||h.thumbUrl,this.previewVisibleE=!0},this.authService.user.subscribe(h=>{h&&(this.user=h,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(y=>{this.infoLoad=y,this.userlevelAccess=this.infoLoad.optionAccessLavel}))})}ngOnInit(){this.createForm(),this.getSubscriptions(),this.validateForm.get("weeks").valueChanges.subscribe(e=>{this.onFrequencyChange(e)})}ngOnDestroy(){}createForm(){this.validateForm=this.fb.group({active:[!1,[v.required]],category:[null,[v.required]],date_created:[new Date,[v.required]],description:[null,[v.required]],isTaskIn:[!0,[v.required]],isTaskOut:[!0,[v.required]],name:[null,[v.required]],price:[null,[v.required,v.min(1)]],timesSold:[0,[v.required]],type:["Servicio"],rangeDatePicker:[null],validFrom:[new Date,[v.required]],validTo:[new Date,[v.required]],imageUrl:[""],frequencies:[""],transportType:[""],weeks:[""],disable:[!1],rangeWeeks:this.fb.group({}),amountTrips:[0],id:[],sits:[0],isCalculate:[!1],customerId:[""]}),this.validateFormE=this.fb.group({active:[!1,[v.required]],category:[null],date_created:[new Date],description:[null,[v.required]],isTaskIn:[!0],isTaskOut:[!0],name:[null,[v.required]],price:[null,[v.required,v.min(1)]],timesSold:[0],type:["Servicio"],rangeDatePicker:[null],validFrom:[new Date],validTo:[new Date],imageUrl:[""],frequencies:[""],transportType:[""],weeks:[""],disable:[!1],rangeWeeks:this.fb.group({}),amountTrips:[0],sits:[0],id:[],isCalculate:[],customerId:[""]})}get price(){return this.validateForm.get("price")}isPriceInvalid(){let e=this.price;return!!(e&&e.invalid&&(e.dirty||e.touched))}isPriceRequired(){let e=this.price;return!!(e&&e.errors?.required)}isPriceMin(){let e=this.price;return!!(e&&e.errors?.min)}resetForm(){this.fileList=[],this.fileListE=[],this.validateForm.reset({active:!1,date_created:new Date,isTaskIn:!0,isTaskOut:!0,price:0,timesSold:0,validFrom:new Date,validTo:new Date,frequencies:"",transportType:"",weeks:"",imageUrl:"",amountTrips:0,sits:0,customerId:""}),this.validateFormE.reset({active:!1,date_created:new Date,isTaskIn:!0,isTaskOut:!0,price:0,timesSold:0,validFrom:new Date,validTo:new Date,frequencies:"",transportType:"",imageUrl:"",weeks:"",amountTrips:0,sits:0,customerId:""})}mapDateValues(e){e.length>1&&(this.validateForm.controls.validFrom.patchValue(new Date(e[0])),this.validateForm.controls.validTo.patchValue(new Date(e[1])))}sendMessage(e,i){this.messageService.create(e,i)}submitForm(e){var i=0;if(this.userlevelAccess!="3")if(e=="A")if(this.validateForm.valid){let n=this.validateForm.controls.frequencies.value||0;n>0&&(i=Number(n)*80),this.validateForm.controls.amountTrips.setValue(i),this.validateForm.controls.type.setValue("Servicio"),this.validateForm.controls.disable.setValue(!1),this.validateForm.controls.customerId.setValue(this.accountId),this.productsService.setProduct(this.accountId,this.validateForm.value).then(()=>{this.resetForm(),this.modalService.closeAll(),this.messageService.success("Todo sali\xF3 bien.",{nzPauseOnHover:!0,nzDuration:3e3})})}else this.sendMessage("error","Hay valores requeridos para crear el producto, favor de validar.");else if(this.validateFormE.valid){let n=this.validateFormE.controls.id.value,a=this.validateFormE.controls.frequencies.value||0;a>0&&(i=Number(a)*80),this.validateFormE.controls.amountTrips.setValue(i),this.validateFormE.controls.type.setValue("Servicio"),this.validateFormE.controls.disable.setValue(!1),this.validateFormE.controls.customerId.setValue(this.accountId),this.productsService.updateProduct(this.accountId,this.validateFormE.controls.id.value,this.validateFormE.value).then(()=>{this.resetForm(),this.modalService.closeAll(),this.messageService.success("Todo sali\xF3 bien.",{nzPauseOnHover:!0,nzDuration:3e3})})}else this.sendMessage("error","Hay valores requeridos para crear el producto, favor de validar.")}toggleActivateProduct(e){e.active?this.showDeactivateConfirm(e):this.processtoDeactivateProduct(this.accountId,e.id,e.active)}showDeactivateConfirm(e){this.modal.confirm({nzTitle:"Estas Seguro de detener la venta? ",nzContent:`<b style="color: red;">${e.name}</b> ser\xE1 desacrivado. </b>  Una ves realizado todos los pases asociados se desactivaran`,nzOkText:"Yes",nzOkType:"primary",nzOnOk:()=>this.processtoDeactivateProduct(this.accountId,e.id,e.active),nzCancelText:"No"})}processtoDeactivateProduct(e,i,n){this.productsService.toggleProductActive(e,i,n),this.productsService.toggleBoardingPass(i,n),this.productsService.togglePurchaseRequests(i,n)}getSubscriptions(){this.sub=this.usersService.getAccountProducts(this.accountId).pipe(T(e=>e.map(i=>{let n=i.payload.doc.id,a=i.payload.doc.data();return se(F({},a),{id:n})}))).subscribe(e=>{this.productsList=e,this.productsListLoaded=e})}deleteProduct(e){this.userlevelAccess=="1"?this.productsService.deleteProduct(this.accountId,e.id).then(()=>{this.messageService.success(`El ${e.type} ${e.name} ha sido eliminado.`,{nzPauseOnHover:!0,nzDuration:3e3}),this.productsService.toggleBoardingPass(e.id,!1),this.productsService.togglePurchaseRequests(e.id,!1)}):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}initializeRangeDatePicker(e,i){let n=this.convertTimestampToDate(e),a=this.convertTimestampToDate(i);return[n,a]}convertTimestampToDate(e){return new Date(e.seconds*1e3)}editProduct(e,i){this.resetForm();let n=this.initializeRangeDatePicker(e.validFrom,e.validTo)??null;if(this.validateFormE.patchValue({active:e.active||!1,category:e.category||null,date_created:e.date_created||new Date,description:e.description||null,isTaskIn:e.isTaskIn||!0,isTaskOut:e.isTaskOut||!0,name:e.name||null,price:e.price||0,timesSold:e.timesSold||0,type:e.type||null,rangeDatePicker:n,validFrom:e.validFrom||new Date,validTo:e.validTo||new Date,imageUrl:e.imageUrl||"",frequencies:e.frequencies||null,transportType:e.transportType||"",amountTrips:e.amountTrips||0,weeks:e.weeks||0,rangeWeeks:e.rangeWeeks||{},id:e.id,isCalculate:e.isCalculate||!1,sits:e.sits||0,customerId:e.customerId||""}),e.rangeWeeks!=null){let d=this.validateFormE.get("rangeWeeks");for(let[_,h]of Object.entries(e.rangeWeeks))d.addControl(_,this.fb.control(h))}this.validateFormE.get("category")?.disable(),this.validateFormE.get("date_created")?.disable(),this.validateFormE.get("timesSold")?.disable(),this.validateFormE.get("type")?.disable(),this.validateFormE.get("validFrom")?.disable(),this.validateFormE.get("validTo")?.disable(),this.validateFormE.get("isTaskIn")?.disable(),this.validateFormE.get("isTaskOut")?.disable();let a=this.modalService.create({nzTitle:"Editar Producto / Servicio",nzContent:i,nzFooter:[{label:"Guardar Cambios",type:"primary",onClick:()=>this.modalService.confirm({nzTitle:"\xBFEstas seguro de los cambios?",nzOnOk:()=>{this.submitForm("E")}})}],nzWidth:800})}showNewModal(e){this.resetForm();let i=this.modalService.create({nzTitle:"Nuevo Servicio",nzContent:e,nzFooter:[{label:"Crear",type:"primary",onClick:()=>this.modalService.confirm({nzTitle:"\xBFEst\xE1 seguro?",nzOnOk:()=>{this.submitForm("A")}})}],nzWidth:800})}handleChange(e){let i=e.file.status;i!=="uploading"&&(this.fileList=e.fileList,e.file.originFileObj&&this.getBase64(e.file.originFileObj,n=>{let a=e.file.name,d=`${this.bucketPath}/${a}`,_=this.bucketStorage.ref(d);this.task=this.bucketStorage.ref(d).putString(n,"data_url"),this.uploadPercent=this.task.percentageChanges(),this.uploadPercent.pipe(T(h=>Number((h/100).toFixed(2)))).subscribe(h=>{this.uploading=h!=0,this.uploadvalue=h}),this.task.snapshotChanges().pipe(Me(()=>{this.uploading=!1,this.downloadURL=_.getDownloadURL(),this.downloadURL.subscribe(h=>ce(this,null,function*(){this.updateAdvanceURL(h,"A"),h.length>0?this.sendMessage("success",`${e.file.name} Archivo cargado satisfactoriamente.`):i==="error"&&this.sendMessage("error",`${e.file.name} archivo fallido, favor de validar.`)}))})).subscribe()}))}handleChange2(e){if(e.file.status!=="uploading"){let n=e.file.status;this.fileListE=e.fileList,e.file.originFileObj&&this.getBase64(e.file.originFileObj,a=>{this.fileUrl=a;let d=e.file.name,_=`${this.bucketPath}/${d}`,h=this.bucketStorage.ref(_);this.task=this.bucketStorage.ref(_).putString(a,"data_url"),this.uploadPercent=this.task.percentageChanges(),this.uploadPercent.pipe(T(y=>Number((y/100).toFixed(2)))).subscribe(y=>{this.uploading=y!=0,this.uploadvalue=y}),this.task.snapshotChanges().pipe(Me(()=>{this.uploading=!1,this.downloadURL=h.getDownloadURL(),this.downloadURL.subscribe(y=>ce(this,null,function*(){this.updateAdvanceURL(y,"E"),y.length>0?this.sendMessage("success",`${e.file.name} Archivo cargado satisfactoriamente.`):n==="error"&&this.sendMessage("error",`${e.file.name} archivo fallido, favor de validar.`)}))})).subscribe()})}}getBase64(e,i){let n=new FileReader;n.readAsDataURL(e),n.onload=()=>i(n.result),n.onerror=a=>this.sendMessage("error",a.toString())}updateAdvanceURL(e,i){return ce(this,null,function*(){i=="A"?this.validateForm.controls.imageUrl.patchValue(e):this.validateFormE.controls.imageUrl.patchValue(e)})}onFrequencyChange(e){this.weekControls=[];let i=this.fb.group({});for(let n=0;n<e;n++){let a=new ft(null);a.valueChanges.subscribe(d=>this.getWeek(d,n)),this.weekControls.push(a),i.addControl(`week${n+1}`,new ft(null))}this.validateForm.setControl("rangeWeeks",i)}onFrequencyChangeE(e){this.weekControlsE=[];let i=this.fb.group({});for(let n=0;n<e;n++){let a=new ft(null);a.valueChanges.subscribe(d=>this.getWeekE(d,n)),this.weekControlsE.push(a),i.addControl(`week${n+1}`,new ft(null))}this.validateFormE.setControl("rangeWeeks",i)}getWeekNumber(e){let i=new Date(e.getFullYear(),0,1),n=(e.getDay()+6)%7;return i.setDate(i.getDate()+4-(i.getDay()||7)),Math.ceil(((e.getTime()-i.getTime())/864e5+1)/7).toString().padStart(2,"0")}getWeek(e,i){if(e){let n=e.getFullYear(),a=this.getWeekNumber(e),d=this.getStartOfWeek(new Date(e)),_=this.getEndOfWeek(new Date(e)),h={week:`${n}-${a}`,startDay:d.toISOString().split("T")[0],endDay:_.toISOString().split("T")[0]};this.validateForm.get("rangeWeeks").controls[`week${i+1}`].setValue(h)}}getWeekE(e,i){if(e){let n=e.getFullYear(),a=this.getWeekNumber(e),d=this.getStartOfWeek(new Date(e)),_=this.getEndOfWeek(new Date(e)),h={week:`${n}-${a}`,startDay:d.toISOString().split("T")[0],endDay:_.toISOString().split("T")[0]};this.validateFormE.get("rangeWeeks").controls[`week${i+1}`].setValue(h)}}getStartOfWeek(e){let i=new Date(e);i.setDate(i.getDate()+7);let n=i.getDay(),a=i.getDate()-n+(n===0?-6:1);return i.setDate(a),new Date(i.setHours(0,0,0,0))}getEndOfWeek(e){let i=this.getStartOfWeek(e);return i.setUTCDate(i.getUTCDate()+4),new Date(i.setUTCHours(23,59,59,999))}getItems(e){let i=e;if(!i){this.productsList=this.productsListLoaded.slice();return}let n=i.toLowerCase();this.productsList=this.productsListLoaded.filter(a=>a.description.toLowerCase().includes(n))}static{this.\u0275fac=function(i){return new(i||r)(b(ve),b(at),b(he),b(ve),b(D),b(A))}}static{this.\u0275cmp=V({type:r,selectors:[["app-shared-products-list"]],inputs:{accountId:"accountId"},decls:30,vars:4,consts:[["searchBar",""],["suffixIconSearch",""],["newContent",""],["editContent",""],["modalContent",""],["projectListSetting","nzDropdownMenu"],["coverTemplate",""],["listViewTable",""],["projectListSetting2","nzDropdownMenu"],[1,"page-header"],[1,"row","align-items-md-center"],[1,"col-md-6"],[1,"row"],[2,"margin-left","10px","width","280px"],[3,"nzSuffix"],["type","text","nz-input","","placeholder","Selecciona unn producto",3,"keyup"],[1,"text-md-right","m-v-10"],[1,"m-r-10",3,"ngModelChange","ngModel"],["nz-radio-button","","nzValue","cardView","nzTitle","Vista de tarjeta","nzPlacement","bottom","nz-tooltip",""],["nz-icon","","nzType","appstore","theme","outline",1,"font-size-16"],["nz-radio-button","","nzValue","listView","nzTitle","Vista de lista","nzPlacement","bottom","nz-tooltip",""],["nz-icon","","nzType","ordered-list","theme","outline",1,"font-size-16"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["nz-icon","","nzType","plus"],[1,"container-fluid"],["class","row",4,"ngIf"],[4,"ngIf"],["nz-icon","","nzType","search"],["nz-form","","nzLayout","vertical",3,"ngSubmit","formGroup"],[1,"col-md-8"],["nzRequired","true"],["type","text","formControlName","name","nz-input","","placeholder","Escriba el nombre del producto / servicio"],[1,"col-md-4"],["formControlName","active"],["nz-input","","formControlName","description"],["nzAction","https://www.mocky.io/v2/5cc8019d300000980a055e76","nzListType","picture-card",3,"nzFileListChange","nzChange","nzFileList","nzShowButton","nzShowUploadList","nzPreview"],[1,"ant-upload-text"],["nzPlaceHolder","Selecciona una opci\xF3n","formControlName","category",1,"w-100"],["nzLabel","Servicio de Transporte Ordinario","nzValue","permanente"],["nzLabel","Servicio Especial","nzValue","especial"],["nzLabel","Producto","nzValue","producto"],["nzLabel","Comedor","nzValue","comedor"],["nzLabel","Seguridad","nzValue","seguridad"],["nzLabel","Monitoreo","nzValue","monitoreo"],["nzLabel","Limpieza","nzValue","limpieza"],["nzLabel","Construcci\xF3n","nzValue","construccion"],["nzLabel","Bienes Raices","nzValue","bienesRaices"],["nzLabel","Mantenimiento","nzValue","mantenimiento"],["nzLabel","Otros","nzValue","otros"],["formControlName","rangeDatePicker",3,"nzOnCalendarChange"],[1,"col-md-2"],["formControlName","isTaskIn"],["formControlName","isTaskOut"],[1,"col-md-3"],["formControlName","price",3,"nzMin","nzMax","nzStep"],["class","error-message",4,"ngIf"],["formControlName","isCalculate"],["formControlName","sits",3,"nzMin","nzMax","nzStep"],["formControlName","frequencies"],[3,"nzValue","nzLabel"],["formControlName","transportType"],[3,"src","ngStyle"],[1,"error-message"],["type","text","formControlName","name","nz-input","","placeholder","Escriba el nombre del servicio"],["nzAction","/api/posts/","nzListType","picture-card",3,"nzFileListChange","nzChange","nzFileList","nzShowButton","nzShowUploadList","nzPreview"],[3,"nzOnCancel","nzVisible","nzContent","nzFooter"],["nzPlaceHolder","Selecciona una opci\xF3n","formControlName","category",1,"w-100",3,"disabled"],["formControlName","rangeDatePicker",3,"nzOnCalendarChange","disabled"],["formControlName","isTaskIn",3,"disabled"],["formControlName","isTaskOut",3,"disabled"],["class","col-md-3",4,"ngFor","ngForOf"],["nzHoverable","",2,"width","240px",3,"nzCover"],[3,"nzTitle","nzDescription"],["nz-dropdown","","nzPlacement","bottomRight","nzTrigger","click",1,"text-gray","font-size-18",3,"nzDropdownMenu"],["nz-icon","","nzType","ellipsis","theme","outline"],["nz-menu","","nzSelectable",""],["nz-menu-item","",3,"click",4,"ngIf"],["nz-menu-item","",3,"click"],["nz-icon","","nzType","edit","theme","outline"],[1,"m-l-10"],["nz-menu-divider",""],["nz-icon","","nzType","delete","theme","outline"],[1,"d-flex","justify-content-between","align-items-center"],[1,"m-b-0",3,"nzColor"],["class","m-b-0",3,"nzColor",4,"ngIf"],["nz-icon","","nzType","pause-circle","theme","outline"],["nz-icon","","nzType","check-circle","theme","outline"],["alt","",3,"src"],[3,"nzData"],[1,"text-center"],[4,"ngFor","ngForOf"],[1,"media","align-items-center"],["nzShape","square",3,"nzSrc"],[1,"m-b-0"],[1,"text-right"],["nz-menu-item",""]],template:function(i,n){if(i&1){let a=x();t(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"div",13)(5,"nz-form-control")(6,"nz-input-group",14)(7,"input",15,0),g("keyup",function(){z(a);let _=w(8);return f(n.getItems(_.value))}),o()(),S(9,Bn,1,0,"ng-template",null,1,I),o()()()(),t(11,"div",11)(12,"div",16)(13,"nz-radio-group",17),U("ngModelChange",function(_){return z(a),R(n.view,_)||(n.view=_),f(_)}),t(14,"label",18),c(15,"i",19),o(),t(16,"label",20),c(17,"i",21),o()(),t(18,"button",22),g("click",function(){z(a);let _=w(23);return f(n.showNewModal(_))}),c(19,"i",23),t(20,"span"),s(21,"Agregar nuevo"),o()(),S(22,Xn,103,26,"ng-template",null,2,I)(24,Zn,95,33,"ng-template",null,3,I),o()()()(),t(26,"div",24),S(27,ao,2,1,"div",25)(28,po,18,2,"nz-card",26),o(),c(29,"nz-modal")}if(i&2){let a=w(10);l(6),m("nzSuffix",a),l(7),O("ngModel",n.view),l(14),m("ngIf",n.view=="cardView"),l(),m("ngIf",n.view=="listView")}},dependencies:[k,pe,We,ze,K,Q,ee,Z,ie,te,fe,ri,oi,st,zi,di,ci,Ve,Ne,Ie,Le,De,Pe,Ee,Xe,Ft,lt,ye,xe,Qe,Te,we,Fe,Ce,X,W,G,be,Tt,rt,re,ae,j,ue,M,q,B,H,Ge,gi],styles:[".error-message[_ngcontent-%COMP%]{color:red;font-size:.8em}"]})}}return r})();var Li=[{name:"Tienda de conveniencia",description:"Pago en tienda de conveniencia",icon:"pricetag",method:"store",userNavigation:"reference/list",active:!1},{name:"Tarjeta de cr\xE9dito/d\xE9bito",description:"Pago en l\xEDnea con tarjeta",icon:"card",method:"card",userNavigation:"card/purchase",active:!1}],ki=(()=>{class r{constructor(e){this.afs=e}getAccountPaymentMethods(e){return this.afs.collection("customers").doc(e).collection("paymentMethods").snapshotChanges()}getPaymentMethods(){return ut(Li)}createDefaultPaymentMethods(e){return Li.forEach(i=>{this.setAccountPaymentMethod(e,i)})}setAccountPaymentMethod(e,i){return this.afs.collection("customers").doc(e).collection("paymentMethods").add(i)}toggleActiveAccountPaymentMethod(e,i,n){return this.afs.collection("customers").doc(e).collection("paymentMethods").doc(i).update({active:n})}deleteAccountPaymentMethod(e,i){return this.afs.collection("customers").doc(e).collection("paymentMethods").doc(i).delete()}static{this.\u0275fac=function(i){return new(i||r)(Ae(he))}}static{this.\u0275prov=je({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function ho(r,u){if(r&1){let e=x();ht(0),t(1,"div",4)(2,"label",5),s(3),o(),t(4,"nz-switch",6),g("ngModelChange",function(n){let a=z(e).$implicit,d=p();return f(d.onChange(n,a))}),o()(),zt()}if(r&2){let e=u.$implicit;l(3),N("",e.name,"\xA0"),l(),m("ngModel",e.active)}}var Mi=(()=>{class r{constructor(e){this.messageService=e,this.loading=!1,this.rolService=C(ne),this.stopSubscription$=new J,this.paymentMethodsList=[],this.accountPaymentMethods=[],this.infoLoad=[],this.paymentMethodsService=C(ki),this.authService=C($),this.authService.user.subscribe(i=>{i&&this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&(this.user=i,this.rolService.getRol(this.user.rolId).valueChanges().subscribe(n=>{this.infoLoad=n,this.userlevelAccess=this.infoLoad.optionAccessLavel}))})}ngOnInit(){this.getSubscriptions()}ngOnDestroy(){this.stopSubscription$.next(!1),this.stopSubscription$.complete()}sendMessage(e,i){this.messageService.create(e,i)}getSubscriptions(){this.paymentMethodsService.getAccountPaymentMethods(this.accountId).pipe(L(this.stopSubscription$),T(e=>e.map(i=>{let n=i.payload.doc.id,a=i.payload.doc.data();return F({id:n},a)})),_e(e=>(this.accountPaymentMethods=e,e.length==0&&this.createDefaultPaymentMethods(),e))).subscribe(()=>{this.loading=!1})}createDefaultPaymentMethods(){this.userlevelAccess!="3"?this.paymentMethodsService.createDefaultPaymentMethods(this.accountId):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}onChange(e,i){this.paymentMethodsService.toggleActiveAccountPaymentMethod(this.accountId,i.id,e)}static{this.\u0275fac=function(i){return new(i||r)(b(D))}}static{this.\u0275cmp=V({type:r,selectors:[["app-shared-account-payment-methods"]],inputs:{accountId:"accountId"},decls:4,vars:2,consts:[[1,"container"],["nzType","inner","nzTitle","M\xE9todos de Pago (Aplican cuando el Usuario es responsable del Pago)",3,"nzLoading"],[1,"row"],[4,"ngFor","ngForOf"],[1,"col-md-6"],["nzFor","pm.name"],["nzCheckedChildren","Si","nzUnCheckedChildren","No",3,"ngModelChange","ngModel"]],template:function(i,n){i&1&&(t(0,"div",0)(1,"nz-card",1)(2,"div",2),S(3,ho,5,2,"ng-container",3),o()()()),i&2&&(l(),m("nzLoading",n.loading),l(2),m("ngForOf",n.accountPaymentMethods))},dependencies:[k,Ft,be,M,Ge]})}}return r})();function fo(r,u){if(r&1&&(t(0,"h5",68),s(1),o()),r&2){let e=p(2);l(),E(e.record.name)}}function go(r,u){if(r&1&&(t(0,"nz-option",69),c(1,"i",70),s(2),o()),r&2){let e=u.$implicit;m("nzLabel",e.name)("nzValue",e.uid),l(2),N(" ",e.name,"")}}function _o(r,u){if(r&1&&(t(0,"nz-option",69),c(1,"i",70),s(2),o()),r&2){let e=u.$implicit;m("nzLabel",e.displayName)("nzValue",e.uid),l(2),N(" ",e.displayName,"")}}function vo(r,u){if(r&1){let e=x();t(0,"a",71),g("click",function(){z(e);let n=p(2);return f(n.onSubmit())}),s(1,"Actualizar"),o()}}function So(r,u){if(r&1){let e=x();t(0,"div",2)(1,"form",3),g("ngSubmit",function(){z(e);let n=p();return f(n.onSubmit())}),t(2,"nz-card",4)(3,"div",5),c(4,"nz-avatar",6),t(5,"div",7),S(6,fo,2,1,"h5",8),t(7,"p",9),s(8),c(9,"br"),s(10),o()(),t(11,"nz-upload",10),g("nzChange",function(n){z(e);let a=p();return f(a.handleChange(n))}),t(12,"button",11)(13,"span"),s(14,"Cambiar im\xE1gen "),o()()()(),c(15,"hr",12),t(16,"div",13)(17,"div",14)(18,"nz-form-item")(19,"nz-form-label",15),s(20,"Nombre"),o(),t(21,"nz-form-control"),c(22,"input",16),o()()(),t(23,"div",14)(24,"nz-form-item")(25,"nz-form-label",17),s(26,"Raz\xF3n Social"),o(),t(27,"nz-form-control"),c(28,"input",18),o()()()(),t(29,"div",13)(30,"div",19)(31,"nz-form-item")(32,"nz-form-label",20),s(33,"RFC"),o(),t(34,"nz-form-control"),c(35,"input",21),o()()(),t(36,"div",19)(37,"nz-form-item")(38,"nz-form-label",20),s(39,"Giro"),o(),t(40,"nz-form-control")(41,"nz-select",22),g("ngModelChange",function(n){z(e);let a=p();return f(a.onJobTypeSelected(n))}),S(42,go,3,3,"nz-option",23),o()()()(),t(43,"div",19)(44,"nz-form-item")(45,"nz-form-label",20),s(46,"Consecutivo"),o(),t(47,"nz-form-control"),c(48,"input",24),o()()()(),t(49,"div",13)(50,"div",25)(51,"nz-form-item")(52,"nz-form-label",26),s(53,"Tel\xE9fono"),o(),t(54,"nz-form-control"),c(55,"input",27),o()()(),t(56,"div",25)(57,"nz-form-item")(58,"nz-form-label",28),s(59,"Sitio Web"),o(),t(60,"nz-form-control"),c(61,"input",29),o()()(),t(62,"div",25)(63,"nz-form-item")(64,"nz-form-label",30),s(65,"Persona Contacto"),o(),t(66,"nz-form-control"),c(67,"input",31),o()()(),t(68,"div",25)(69,"nz-form-item")(70,"nz-form-label",32),s(71,"Responsable"),o(),t(72,"nz-form-control")(73,"nz-select",33),S(74,_o,3,3,"nz-option",23),o()()()()()(),S(75,vo,2,0,"ng-template",null,0,I),t(77,"nz-card",34)(78,"div",13)(79,"div",35)(80,"nz-form-item")(81,"nz-form-label",36),s(82,"Calle"),o(),t(83,"nz-form-control"),c(84,"input",37),o()()(),t(85,"div",25)(86,"nz-form-item")(87,"nz-form-label",38),s(88,"N\xFAmero"),o(),t(89,"nz-form-control"),c(90,"input",39),o()()()(),t(91,"div",13)(92,"div",14)(93,"nz-form-item")(94,"nz-form-label",36),s(95,"Entre Calles"),o(),t(96,"nz-form-control"),c(97,"input",40),o()()(),t(98,"div",14)(99,"nz-form-item")(100,"nz-form-label",41),s(101,"Fracc / Colonia"),o(),t(102,"nz-form-control"),c(103,"input",42),o()()()(),t(104,"div",13)(105,"div",43)(106,"nz-form-item")(107,"nz-form-label",44),s(108,"C\xF3digo Postal"),o(),t(109,"nz-form-control"),c(110,"input",45),o()()(),t(111,"div",46)(112,"nz-form-item")(113,"nz-form-label",47),s(114,"Ciudad / Municipio"),o(),t(115,"nz-form-control"),c(116,"input",48),o()()(),t(117,"div",46)(118,"nz-form-item")(119,"nz-form-label",49),s(120,"Estado"),o(),t(121,"nz-form-control"),c(122,"input",50),o()()()()(),t(123,"nz-card",51)(124,"div",13)(125,"div",19)(126,"nz-form-item")(127,"nz-form-label",52)(128,"span"),s(129," Origen de los pagos "),c(130,"i",53),o()(),t(131,"nz-form-control",54)(132,"nz-select",55),c(133,"nz-option",56)(134,"nz-option",57),o()()()()(),t(135,"div",13)(136,"div",19)(137,"nz-form-item")(138,"nz-form-label",58)(139,"span"),s(140," Obligatorio subir en la estaci\xF3n definida "),c(141,"i",59),o()(),t(142,"nz-form-control",54)(143,"nz-select",60),c(144,"nz-option",61)(145,"nz-option",62),o()()()(),t(146,"div",19)(147,"nz-form-item")(148,"nz-form-label",63)(149,"span"),s(150," Obligatorio subir en el turno definido "),c(151,"i",64),o()(),t(152,"nz-form-control",54)(153,"nz-select",65),c(154,"nz-option",61)(155,"nz-option",62),o()()()(),t(156,"div",19)(157,"nz-form-item")(158,"nz-form-label",63)(159,"span"),s(160," Obligatorio subir en la operaci\xF3n definida "),c(161,"i",66),o()(),t(162,"nz-form-control",54)(163,"nz-select",67),c(164,"nz-option",61)(165,"nz-option",62),o()()()()()()()()}if(r&2){let e=w(76),i=p();l(),m("formGroup",i.objectForm),l(),m("nzExtra",e)("nzLoading",i.loading),l(2),m("nzSize",80)("nzSrc",i.record.imageUrl),l(2),m("ngIf",!!i.record),l(2),N(" ",i.record.address," "),l(2),xt(" ",i.record.address2," ",i.record.address3," "),l(),m("nzShowUploadList",!1),l(31),m("ngForOf",i.jobType),l(32),m("ngForOf",i.usersList),l(57),m("nzSpan",12),l(11),m("nzSpan",12),l(10),m("nzSpan",12),l(10),m("nzSpan",12)}}var Ai=(()=>{class r{constructor(e,i,n){this.messageService=e,this.bucketStorage=i,this.fb=n,this.stopSubscription$=new J,this.loading=!0,this.infoLoad=[],this.rolService=C(ne),this.authService=C($),this.accountsService=C(Ke),this.userService=C(Ye),this.infoSegment=[],this.avatarUrl="http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg",this.uploading=!1,this.bucketPath="customers/",this.uploadvalue=0,this.vendorService=C(ot),this.authService.user.subscribe(a=>{a&&(this.user=a,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&(this.rolService.getRol(this.user.rolId).valueChanges().subscribe(d=>{this.infoLoad=d,this.userlevelAccess=this.infoLoad.optionAccessLavel}),this.accountsSubscription=this.accountsService.getJobType().pipe(T(d=>d.map(_=>{let h=_.payload.doc.id,y=_.payload.doc.data();return F({id:h},y)}))).subscribe(d=>{this.jobType=d}),this.accountsSubscription=this.accountsService.getUsersByCustomer(this.accountId).pipe(T(d=>d.map(_=>{let h=_.payload.doc.id,y=_.payload.doc.data();return F({id:h},y)}))).subscribe(d=>{this.usersList=d}),this.accountsService.getSegmentLevel(this.user.idSegment).pipe(L(this.stopSubscription$),T(d=>{let _=d.payload.id,h=d.payload.data();return F({id:_},h)}),_e(d=>(this.infoSegment=d,d))).subscribe()))})}ngOnInit(){this.createForm(),this.getSubscription()}createForm(){this.objectForm=this.fb.group({active:[!1,[v.required]],imageUrl:[""],address:[""],paymentResponsible:[1,[v.required]],name:["",[v.required]],socialName:[""],rfc:[""],addressNumber:[""],address2:[""],address3:[""],zip:[""],city:[""],state:[""],forceStopPoints:[!0],forceRoute:[!0],forceRound:[!0],website:[""],phoneNumber:[""],jobTypeID:[""],custConsecutive:[""],primaryContact:[""],responsableUser:[""]})}patchForm(e){this.objectForm.patchValue({active:e.active||!1,imageUrl:e.imageUrl||"",address:e.address||"",addressNumber:e.addressNumber||"",name:e.name||"",paymentResponsible:e.paymentResponsible||1,socialName:e.socialName||"",rfc:e.rfc||"",address2:e.address2||"",address3:e.address3||"",zip:e.zip||"",city:e.city||"",state:e.state||"",forceStopPoints:e.forceStopPoints||!0,forceRoute:e.forceRoute||!0,forceRound:e.forceRound||!0,website:e.website||"",phoneNumber:e.phoneNumber||"",jobTypeID:e.jobTypeID||"",custConsecutive:e.custConsecutive||"",primaryContact:e.primaryContact||"",responsableUser:e.responsableUser||""})}ngOnDestroy(){this.stopSubscription$.next(!1),this.stopSubscription$.complete()}getSubscription(){this.accountsService.getAccount(this.accountId).pipe(L(this.stopSubscription$),T(e=>{let i=e.payload.id,n=e.payload.data();return F({id:i},n)}),_e(e=>(this.patchForm(e),this.record=e,this.loading=!1,e))).subscribe()}getBase64(e,i){let n=new FileReader;n.addEventListener("load",()=>{n.result!==null&&typeof n.result=="string"?i(n.result):this.messageService.error("Invalid Form")}),n.readAsDataURL(e)}handleChange(e){e.file.originFileObj&&this.getBase64(e.file.originFileObj,i=>{this.avatarUrl=i;let n=e.file.name,a=`${this.bucketPath}/${n}`,d=this.bucketStorage.ref(a);this.task=this.bucketStorage.ref(a).putString(i,"data_url"),this.uploadPercent=this.task.percentageChanges(),this.uploadPercent.pipe(T(_=>Number((_/100).toFixed(2)))).subscribe(_=>{this.uploading=_!=0,this.uploadvalue=_}),this.task.snapshotChanges().pipe(Me(()=>{this.uploading=!1,this.downloadURL=d.getDownloadURL(),this.downloadURL.subscribe(_=>ce(this,null,function*(){this.updatePhotoURL(_)}))})).subscribe()})}updatePhotoURL(e){return ce(this,null,function*(){this.objectForm.controls.imageUrl.patchValue(e),this.userlevelAccess!="3"?this.accountsService.updateAvatarAccount(this.accountId,e):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")})}sendMessage(e,i){this.messageService.create(e,i)}onSubmit(){this.userlevelAccess!="3"?this.accountsService.updateAccount(this.accountId,this.objectForm.value).then(()=>{this.sendMessage("sucess","El registro a sido actualizado con \xE9xito.")},e=>{this.sendMessage("error",e)}).catch(e=>this.sendMessage("error",e)):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}onJobTypeSelected(e){if(console.log(e),e!=null){let i=this.jobType.filter(n=>n.uid===e);if(i.length>0){let n=i[0].consecutive;n=parseInt(n,10)+1,n=n.toString().padStart(4,"0"),this.objectForm.controls.custConsecutive.setValue(i[0].type+n)}}}static{this.\u0275fac=function(i){return new(i||r)(b(D),b(at),b(A))}}static{this.\u0275cmp=V({type:r,selectors:[["app-shared-account-edit"]],inputs:{accountId:"accountId"},decls:1,vars:1,consts:[["basicTpl",""],["class","container",4,"ngIf"],[1,"container"],["nz-form","","nzLayout","vertical",3,"ngSubmit","formGroup"],["nzType","inner","nzTitle","Informaci\xF3n B\xE1sica",3,"nzExtra","nzLoading"],[1,"media","align-items-center"],["nzIcon","user","nzSize","large","nzSrc","",2,"background-color","white","color","#4F6F57",3,"nzSize","nzSrc"],[1,"m-l-20","m-r-20"],["class","m-b-5 font-size-18",4,"ngIf"],[1,"opacity-07","font-size-13","m-b-0"],["nzName","imageUrl",3,"nzChange","nzShowUploadList"],["nz-button","","nzGhost","",2,"background-color","#4F6F57","color","#f6f3ea"],[1,"m-v-25"],[1,"row"],[1,"col-md-6"],["nzFor","name"],["nz-input","","formControlName","name","type","text"],["nzFor","socialName"],["nz-input","","formControlName","socialName","type","text"],[1,"col-md-4"],["nzFor","rfc"],["nz-input","","formControlName","rfc","type","text"],["formControlName","jobTypeID","nzAllowClear","","nzPlaceHolder","Selecciona el Giro de la Empresa",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nz-input","","formControlName","custConsecutive","nzDisabled",""],[1,"col-md-3"],["nzFor","phoneNumber"],["nz-input","","formControlName","phoneNumber","placeholder","Tel\xE9fono"],["nzFor","website"],["nz-input","","formControlName","website","placeholder","website"],["nzFor","primaryContact"],["nz-input","","formControlName","primaryContact","placeholder","Contacto principal"],["nzFor","responsableUser"],["formControlName","responsableUser","nzAllowClear","","nzPlaceHolder","Selecciona Usuario Responsable"],["nzType","inner","nzTitle","Direcci\xF3n"],[1,"col-md-9"],["nzFor","address"],["nz-input","","formControlName","address","placeholder","Calle"],["nzFor","addressNumber"],["nz-input","","formControlName","addressNumber","placeholder","N\xFAmero"],["nz-input","","formControlName","address2","placeholder","Entre calles"],["nzFor","address3"],["nz-input","","formControlName","address3","placeholder","Fracc / Colonia"],[1,"col-md-2"],["nzFor","zip"],["nz-input","","formControlName","zip","placeholder","C\xF3digo Postal"],[1,"col-md-5"],["nzFor","city"],["nz-input","","formControlName","city","placeholder","Ciudad / Municipio"],["nzFor","state"],["nz-input","","formControlName","state","placeholder","Estado"],["nzType","inner","nzTitle","Par\xE1metros de Servicio"],["nzFor","paymentResponsible","nzRequired",""],["nz-icon","","nz-tooltip","","nzTooltipTitle","\xBFQui\xE9n es el responsable de emitir un pago por el servicio?","nzType","question-circle","nzTheme","outline"],[3,"nzSpan"],["name","select-error","formControlName","paymentResponsible"],["nzValue","0","nzLabel","Empresa"],["nzValue","1","nzLabel","Usuario"],["nzFor","forceStopPoints","nzRequired",""],["nz-icon","","nz-tooltip","","nzTooltipTitle","\xBFEs obligatorio que el usuario suba exclusivamente en la estaci\xF3n seleccionada?","nzType","question-circle","nzTheme","outline"],["name","select-error","formControlName","forceStopPoints"],["nzValue","true","nzLabel","Si"],["nzValue","false","nzLabel","No"],["nzFor","forceRound","nzRequired",""],["nz-icon","","nz-tooltip","","nzTooltipTitle","\xBFEs obligatorio que el usuario suba exclusivamente en el turno seleccionada?","nzType","question-circle","nzTheme","outline"],["name","select-error","formControlName","forceRound"],["nz-icon","","nz-tooltip","","nzTooltipTitle","\xBFEs obligatorio que el usuario suba exclusivamente en la operaci\xF3n seleccionada?","nzType","question-circle","nzTheme","outline"],["name","select-error","formControlName","forceRoute"],[1,"m-b-5","font-size-18"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon",""],[3,"click"]],template:function(i,n){i&1&&S(0,So,166,16,"div",1),i&2&&m("ngIf",!!n.record)},dependencies:[k,pe,ze,K,Q,ee,Z,ie,te,fe,Xe,lt,Ce,X,W,G,be,re,ae,j,ue,M,q,B,H]})}}return r})();var Bt=Jt(Bi());var Oi=()=>({x:"1000px"});function bo(r,u){if(r&1&&c(0,"nz-option",19),r&2){let e=u.$implicit;m("nzValue",e.routeId)("nzLabel",e.routeName)}}function xo(r,u){if(r&1&&(ht(0),t(1,"tr")(2,"td"),s(3),o(),t(4,"td"),s(5),o(),t(6,"td"),s(7),o(),t(8,"td"),s(9),o(),t(10,"td"),s(11),o(),t(12,"td"),s(13),o()(),zt()),r&2){let e=u.$implicit;l(3),xt("",e.firstName," ",e.lastName,""),l(2),E(e.email),l(2),E(e.phoneNumber),l(2),E(e.curp),l(2),E(e.age),l(2),E(e.adress)}}function yo(r,u){if(r&1&&c(0,"nz-option",19),r&2){let e=u.$implicit;m("nzValue",e.routeId)("nzLabel",e.routeName)}}function Eo(r,u){if(r&1&&(ht(0),t(1,"tr")(2,"td"),s(3),o(),t(4,"td"),s(5),o(),t(6,"td"),s(7),o(),t(8,"td"),s(9),o(),t(10,"td"),s(11),o(),t(12,"td"),s(13),o(),t(14,"td"),s(15),o()(),zt()),r&2){let e=u.$implicit;l(3),E(e.date),l(2),E(e.studentName),l(2),E(e.user.group),l(2),E(e.op),l(2),E(e.round),l(2),E(e.driver),l(2),E(e.vehicleName)}}var Ri=(()=>{class r{constructor(e,i,n){this.notification=e,this.messageService=i,this.fb=n,this.accountId="",this.usersService=C(Je),this.usrService=C(Ye),this.authService=C($),this.vendorsService=C(ot),this.routesService=C(nt),this.userData=[],this.listOfCurrentPageData=[],this.listOfCurrentPageDataScan=[],this.pageSize=10,this.routeNamesMap={},this.selectedRouteId="",this.selectedRouteIdScan="",this.selectedRouteNameScan="",this.filteredUserData=[],this.filteredUserDataScan=[],this.stopSubscription$=new J,this.logisticsService=C(_i),this.liveService=C(vi),this.startDate=kt(),this.endDate=Lt(),this.authService.user.subscribe(a=>{a&&a.rolId&&(this.user=a)}),this.dateRangeForm=this.fb.group({startDate:[kt()],endDate:[Lt()],selectedOption:[null]})}getusers(){this.usersService.getAccountUsers(this.accountId).pipe(T(e=>e.map(i=>{let n=i.payload.doc.id,a=i.payload.doc.data();return F({id:n},a)}))).subscribe(e=>{this.userData=e,this.filteredUserData=[...this.userData]})}ngOnInit(){this.loadRoutes(),this.getusers()}filterUsersByRoute(){this.selectedRouteId?this.filteredUserData=this.userData.filter(e=>e.defaultRoute===this.selectedRouteId):this.filteredUserData=[...this.userData]}filterUsersByRouteScan(){}loadRoutes(){this.routesService.getRoutes(this.accountId).pipe(L(this.stopSubscription$),T(e=>e.map(i=>{let n=i.payload.doc.id,a=i.payload.doc.data();return{routeId:n,routeName:a.description??"Sin nombre"}}))).subscribe(e=>{this.routesList=e})}export(){let e=this.routesList.find(h=>h.routeId===this.selectedRouteId)?.routeName||"Todas",i=this.filteredUserData.map(h=>({Nombre:`${h.firstName} ${h.lastName}`,Correo:h.email,Tel\u00E9fono:h.phoneNumber,Ruta:e,Curp:h.curp,Edad:h.age,Direcci\u00F3n:h.adress,Poblacion:h.group})),a={Sheets:{Usuarios:At.json_to_sheet(i)},SheetNames:["Usuarios"]},d=Mt(a,{bookType:"xlsx",type:"array"}),_=new Blob([d],{type:"application/octet-stream"});Bt.saveAs(_,`usuarios_exportados_${new Date().toISOString().slice(0,10)}.xlsx`)}exportScan(){let e=this.filteredUserDataScan.map(h=>({Nombre:h.studentName,Fecha:h.date,Ruta:h.op,Turno:h.round,Conductor:h.driver,Vehiculo:h.vehicleName,Email:h.user?.email||"",CURP:h.user?.curp||"",Tel\u00E9fono:h.user?.phoneNumber||"",C\u00F3digoPostal:h.user?.zipCode||"",Direcci\u00F3n:h.user?.adress||"",Edad:h.user?.age||"",NombreCompleto:h.user?.displayName||"",NombreUsuario:h.user?.firstName||"",Apellido:h.user?.lastName||"",Grupo:h.user?.group||"",Ocupaci\u00F3n:h.user?.occupation||"",Username:h.user?.username||"",Cliente:h.user?.customerName||"",Status:h.user?.status||"",RutaDefault:h.user?.defaultRoute||"",FechaRegistro:h.user?.dateCreateUserFormat||"",ViajeRedondo:h.user?.roundTrip||"",Poblacion:h.user?.group||""})),i=At.json_to_sheet(e),n="Usuarios Escaneados",a={Sheets:{[n]:i},SheetNames:[n]},d=Mt(a,{bookType:"xlsx",type:"array"}),_=new Blob([d],{type:"application/octet-stream"});Bt.saveAs(_,`usuarios_scan_exportados_${new Date().toISOString().slice(0,10)}.xlsx`)}ngOnDestroy(){this.stopSubscription$.next(),this.stopSubscription$.complete()}loadData(){this.startDate=this.dateRangeForm.get("startDate").value,this.endDate=this.dateRangeForm.get("endDate").value,this.startDate=this.dateRangeForm.get("startDate").value,this.endDate=this.dateRangeForm.get("endDate").value;let e=this.routesList.find(i=>i.routeId===this.selectedRouteIdScan);if(this.selectedRouteNameScan=e?e.routeName:"",this.selectedRouteIdScan!="")if(this.startDate&&this.endDate)this.logisticsService.getActivityLogByCustomerByRoute(this.startDate,this.endDate,this.accountId,this.selectedRouteIdScan).pipe(_e(i=>{}),Zt(i=>{let n=i.map(a=>{let d=a.payload.doc.data(),_=a.payload.doc.id,h=d.userId;return this.usrService.getUserInfoScan(h).pipe(Kt(1),Qt(y=>(console.error("Error al obtener usuario",h,y),ut(null))),T(y=>se(F({},d),{id:_,op:this.selectedRouteNameScan,user:y||{}})))});return n.length>0?Yt(n):ut([])})).subscribe(i=>{this.filteredUserDataScan=i});else{this.notification.create("error","Error","Se Requiere un rango de fechas");return}}onDateRangeChange(){}onDateChange(){this.filteredUserDataScan=[],this.listOfCurrentPageDataScan=[],this.selectedRouteIdScan=""}static{this.\u0275fac=function(i){return new(i||r)(b(Et),b(D),b(A))}}static{this.\u0275cmp=V({type:r,selectors:[["app-reports"]],inputs:{accountId:"accountId"},decls:68,vars:25,consts:[[1,"site-page-header-ghost-wrapper"],[2,"background-color","#f9fbfd",3,"nzGhost"],[2,"font-weight","bold"],["nzTitle","Usuarios"],[2,"margin-bottom","16px"],["for","routeFilter",2,"margin-right","8px","font-weight","bold"],["id","routeFilter","nzPlaceHolder","Selecciona una Operaci\xF3n",3,"ngModelChange","ngModel"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],[3,"nzCurrentPageDataChange","nzData","nzPageSize","nzFrontPagination","nzShowPagination","nzScroll","nzSize"],[4,"ngFor","ngForOf"],["nzTitle","Escaneos"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[3,"formGroup"],["formControlName","startDate",3,"ngModelChange"],["formControlName","endDate",3,"ngModelChange"],["for","routeFilter1",2,"margin-right","8px","font-weight","bold"],["id","routeFilter1","nzPlaceHolder","Selecciona una Operaci\xF3n",3,"ngModelChange","ngModel"],[3,"nzValue","nzLabel"]],template:function(i,n){i&1&&(t(0,"div",0)(1,"nz-page-header",1)(2,"nz-page-header-extra")(3,"div",2),s(4),o()()()(),t(5,"nz-tabset")(6,"nz-tab",3)(7,"div",4)(8,"label",5),s(9,"Filtrar por Ruta:"),o(),t(10,"nz-select",6),U("ngModelChange",function(d){return R(n.selectedRouteId,d)||(n.selectedRouteId=d),d}),g("ngModelChange",function(){return n.filterUsersByRoute()}),S(11,bo,1,2,"nz-option",7),o(),t(12,"div",2),s(13),t(14,"button",8),g("click",function(){return n.export()}),s(15,"Exportar"),o()()(),t(16,"nz-table",9),g("nzCurrentPageDataChange",function(d){return n.listOfCurrentPageData=d.slice()}),t(17,"thead")(18,"tr")(19,"th"),s(20,"Nombre"),o(),t(21,"th"),s(22,"Correo"),o(),t(23,"th"),s(24,"Tel\xE9fono"),o(),t(25,"th"),s(26,"Curp"),o(),t(27,"th"),s(28,"Edad"),o(),t(29,"th"),s(30,"Direccion"),o()()(),t(31,"tbody"),S(32,xo,14,7,"ng-container",10),o()()(),t(33,"nz-tab",11)(34,"div",12)(35,"h5",13),s(36,"Actividad en Vivo"),o()(),t(37,"form",14)(38,"nz-date-picker",15),g("ngModelChange",function(){return n.onDateChange()}),o(),t(39,"nz-date-picker",16),g("ngModelChange",function(){return n.onDateChange()}),o()(),t(40,"div")(41,"label",17),s(42,"Filtrar por Ruta:"),o(),t(43,"nz-select",18),U("ngModelChange",function(d){return R(n.selectedRouteIdScan,d)||(n.selectedRouteIdScan=d),d}),g("ngModelChange",function(){return n.loadData()}),S(44,yo,1,2,"nz-option",7),o(),t(45,"div",2),s(46),t(47,"button",8),g("click",function(){return n.exportScan()}),s(48,"Exportar"),o()()(),t(49,"nz-table",9),g("nzCurrentPageDataChange",function(d){return n.listOfCurrentPageDataScan=d.slice()}),t(50,"thead")(51,"tr")(52,"th"),s(53,"Fecha"),o(),t(54,"th"),s(55,"Nombre"),o(),t(56,"th"),s(57,"Grupo"),o(),t(58,"th"),s(59,"Operaci\xF3n"),o(),t(60,"th"),s(61,"Turno"),o(),t(62,"th"),s(63,"Veh\xEDculo"),o(),t(64,"th"),s(65,"Chofer"),o()()(),t(66,"tbody"),S(67,Eo,16,7,"ng-container",10),o()()()()),i&2&&(l(),m("nzGhost",!1),l(3),N(" Usuarios Actuales: ",n.userData.length," "),l(6),O("ngModel",n.selectedRouteId),l(),m("ngForOf",n.routesList),l(2),N(" Usuarios Totales: ",n.filteredUserData.length," "),l(3),m("nzData",n.filteredUserData)("nzPageSize",n.pageSize)("nzFrontPagination",!0)("nzShowPagination",!0)("nzScroll",de(23,Oi))("nzSize","middle"),l(16),m("ngForOf",n.listOfCurrentPageData),l(5),m("formGroup",n.dateRangeForm),l(6),O("ngModel",n.selectedRouteIdScan),l(),m("ngForOf",n.routesList),l(2),N(" Usuarios Totales: ",n.filteredUserDataScan.length," "),l(3),m("nzData",n.filteredUserDataScan)("nzPageSize",n.pageSize)("nzFrontPagination",!0)("nzShowPagination",!0)("nzScroll",de(24,Oi))("nzSize","middle"),l(18),m("ngForOf",n.listOfCurrentPageDataScan))},dependencies:[k,st,Ve,Ne,Ie,Le,De,Pe,X,W,G,oe,ge,re,ae,j,M,q,B,H,Ge,it,tt]})}}return r})();function wo(r,u){if(r&1&&c(0,"app-shared-account-edit",10),r&2){let e=p();m("accountId",e.recordId)}}function Fo(r,u){if(r&1&&c(0,"app-shared-account-payment-methods",10),r&2){let e=p();m("accountId",e.recordId)}}function No(r,u){if(r&1&&c(0,"app-shared-routes-list",10),r&2){let e=p();m("accountId",e.recordId)}}function Io(r,u){if(r&1&&c(0,"app-shared-customer-vendor-assignments",10),r&2){let e=p();m("accountId",e.recordId)}}function Do(r,u){if(r&1&&c(0,"app-shared-products-list",10),r&2){let e=p();m("accountId",e.recordId)}}function Vo(r,u){if(r&1&&c(0,"app-promotions",10),r&2){let e=p();m("accountId",e.recordId)}}function Po(r,u){if(r&1&&c(0,"app-reports",10),r&2){let e=p();m("accountId",e.recordId)}}var Da=(()=>{class r{constructor(e,i,n,a){this.fb=e,this.route=i,this.modalService=n,this.message=a,this.accountsService=C(Ke),this.selectedIndex=0,this.record=[],this.avatarUrl="http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg"}ngOnInit(){this.sub=this.route.params.subscribe(e=>{this.recordId=e.id,this.selectedIndex=e.index,this.getSubscriptions()}),this.changePWForm=this.fb.group({oldPassword:[null,[v.required]],newPassword:[null,[v.required]],confirmPassword:[null,[v.required]]})}ngOnDestroy(){this.sub.unsubscribe()}showConfirm(){this.modalService.confirm({nzTitle:"<i>Do you want to change your password?</i>",nzOnOk:()=>this.message.success("Password Change Successfully")})}getSubscriptions(){this.accountsService.getAccount(this.recordId).pipe(T(e=>{let i=e.payload.id,n=e.payload.data();return F({id:i},n)})).subscribe(e=>{this.record=e})}submitForm(){for(let e in this.changePWForm.controls)this.changePWForm.controls[e].markAsDirty(),this.changePWForm.controls[e].updateValueAndValidity();this.showConfirm()}getBase64(e,i){let n=new FileReader;n.addEventListener("load",()=>i(n.result)),n.readAsDataURL(e)}static{this.\u0275fac=function(i){return new(i||r)(b(A),b(ti),b(ve),b(D))}}static{this.\u0275cmp=V({type:r,selectors:[["app-edit"]],decls:21,vars:2,consts:[["nzBackIcon","",1,"page-header",2,"background-color","#f9fbfd"],[1,"page-header-tab",3,"nzSelectedIndex"],["nzTitle","General"],["nz-tab",""],["nzTitle","M\xE9todos de Pago"],["nzTitle","Operaci\xF3n"],["nzTitle","Asignaciones"],["nzTitle","Productos"],["nzTitle","Promociones"],["nzTitle","Reportes"],[3,"accountId"]],template:function(i,n){i&1&&(t(0,"nz-page-header",0)(1,"nz-page-header-title"),s(2),o(),t(3,"nz-page-header-subtitle"),s(4,"Detalles de la empresa"),o(),t(5,"nz-page-header-content")(6,"nz-tabset",1)(7,"nz-tab",2),S(8,wo,1,1,"ng-template",3),o(),t(9,"nz-tab",4),S(10,Fo,1,1,"ng-template",3),o(),t(11,"nz-tab",5),S(12,No,1,1,"ng-template",3),o(),t(13,"nz-tab",6),S(14,Io,1,1,"ng-template",3),o(),t(15,"nz-tab",7),S(16,Do,1,1,"ng-template",3),o(),t(17,"nz-tab",8),S(18,Vo,1,1,"ng-template",3),o(),t(19,"nz-tab",9),S(20,Po,1,1,"ng-template",3),o()()()()),i&2&&(l(2),E(n.record.name),l(4),m("nzSelectedIndex",n.selectedIndex))},dependencies:[oe,Ze,et,wt,it,tt,mi,yi,Ti,Di,Pi,Mi,Ai,Ri]})}}return r})();export{Wo as a,Da as b};
