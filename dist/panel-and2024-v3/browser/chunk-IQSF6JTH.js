import{a as Z}from"./chunk-JLBX7FC6.js";import{a as W}from"./chunk-VM5DQTXF.js";import{a as J,b as K}from"./chunk-N5UMGXMM.js";import{a as Q}from"./chunk-C7EU4JWI.js";import{d as V}from"./chunk-V6TECCBK.js";import{a as $,c as B,f as H,g as U,h as q,j as G}from"./chunk-UZE4SSVE.js";import{$b as T,Bf as R,De as j,Ea as u,Ga as d,Ib as N,O as x,Q as y,Sd as A,Ua as e,Va as i,Wa as m,Xe as k,Y as h,_ as D,ac as L,af as F,bf as O,c as z,db as g,kb as w,lb as C,m as p,mb as M,nb as v,ob as a,pb as _,qb as b,qf as P,rb as I,sa as l,ta as f,wa as E}from"./chunk-W3I2I5DW.js";import{a as S}from"./chunk-SIAVTO45.js";var ee=["map"];function te(o,c){o&1&&m(0,"i",16)}function ie(o,c){o&1&&m(0,"i",46)}function ne(o,c){o&1&&m(0,"i",46)}function ae(o,c){o&1&&m(0,"i",18)}function oe(o,c){if(o&1&&(e(0,"div",42),u(1,te,1,0,"i",43)(2,ie,1,0,"i",44)(3,ne,1,0,"i",44)(4,ae,1,0,"i",45),i()),o&2){let t=g().$implicit;l(),d("ngIf",t.type=="access"),l(),d("ngIf",t.type=="Attached file"),l(),d("ngIf",t.type=="Commented"),l(),d("ngIf",t.type=="duplicate")}}function me(o,c){if(o&1&&(e(0,"nz-timeline-item",37)(1,"div",38)(2,"h5",39),a(3),i(),e(4,"p",8)(5,"span",40),a(6),i(),e(7,"span",27),a(8),i()(),e(9,"span",41),m(10,"i",24),e(11,"span",27),a(12),i()()(),u(13,oe,5,4,"ng-template",null,2,N),i()),o&2){let t=c.$implicit,n=v(14),r=g();d("nzDot",n),l(3),_(t.studentName),l(3),I("",t.vehicle," - ",t.route,""),l(2),b(" ",t.studentId,""),l(4),_(r.formatDate(t.created))}}var Ce=(()=>{class o{constructor(t,n){this.logisticsService=t,this.zone=n,this.lat=37.75,this.lng=-122.41,this.loading=!1,this.authService=h(j),this.infoSegment=[],this.accountsService=h(H),this.stopSubscription$=new z,this.authService.user.subscribe(r=>{r&&(this.user=r,this.user!==null&&this.user!==void 0&&this.user.idSegment!==void 0&&this.accountsService.getSegmentLevel(this.user.idSegment).pipe(x(this.stopSubscription$),p(s=>{let X=s.payload.id,Y=s.payload.data();return S({id:X},Y)}),y(s=>(this.infoSegment=s,s))).subscribe())}),this.markers=[],this.startDate=P(),this.endDate=k()}ngOnInit(){this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1?this.markers=this.logisticsService.getMarkersByCustomer(this.startDate,this.endDate,this.user.customerId):this.markers=this.logisticsService.getMarkers(this.startDate,this.endDate)}ngAfterViewInit(){}ngOnDestroy(){}initializeMap(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(t=>{this.lat=t.coords.latitude,this.lng=t.coords.longitude,this.map.flyTo({center:[this.lng,this.lat]})}),this.buildMap()}formatDate(t){return F(O(t.seconds),"HH:mm",{locale:W})}buildMap(){}flyTo(t){this.map.flyTo({center:t.geometry.coordinates})}loadMap(){}loadData(){this.infoSegment.nivelNum!==void 0&&this.infoSegment.nivelNum==1?this.logisticsService.getActivityLogByCustomer(this.startDate,this.endDate,this.user.customerId).pipe(p(t=>t.map(n=>{let r=n.payload.doc.data(),s=n.payload.doc.id;return r}))).subscribe(t=>{this.rowData=t,this.activityList=this.rowData.slice(0,5),this.chartData=this.rowData.map(n=>({country:n.vehicle,visits:n.studentId}))}):this.logisticsService.getActivityLog(this.startDate,this.endDate).pipe(p(t=>t.map(n=>{let r=n.payload.doc.data(),s=n.payload.doc.id;return r}))).subscribe(t=>{this.rowData=t,this.activityList=this.rowData.slice(0,5),this.chartData=this.rowData.map(n=>({country:n.vehicle,visits:n.studentId}))})}onGridReady(t){this.gridApi=t.api,this.gridColumnApi=t.columnApi}static{this.\u0275fac=function(n){return new(n||o)(f(Z),f(E))}}static{this.\u0275cmp=D({type:o,selectors:[["app-main"]],viewQuery:function(n,r){if(n&1&&w(ee,7),n&2){let s;C(s=M())&&(r.mapElement=s.first)}},decls:89,vars:4,consts:[["projectCompletionDropDown","nzDropdownMenu"],["map",""],["dotTemplate",""],[1,"page-header"],[1,"d-md-flex","align-items-md-center","justify-content-between"],[1,"media","m-v-10","align-items-center"],["nz-icon","user","nz-size","50","nz-src","assets/images/avatars/thumb-3.jpg",2,"background-color","white","color","#4F6F57"],[1,"media-body","m-l-15"],[1,"m-b-0"],[1,"text-gray"],[1,"d-md-flex","align-items-center","d-none"],[1,"media","align-items-center","m-r-40","m-v-5"],[1,"font-size-27"],["nz-icon","","theme","outline",1,"text-primary"],[1,"d-flex","align-items-center","m-l-10"],[1,"m-b-0","m-r-5"],["nz-icon","","theme","outline",1,"text-success"],[1,"media","align-items-center","m-v-5"],["nz-icon","","theme","outline",1,"text-danger"],[1,"row"],[1,"col-lg-9"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-0"],["nz-dropdown","",1,"text-dark","font-size-20",3,"nzTrigger","nzPlacement","nzDropdownMenu"],["nz-icon","","theme","outline"],["nz-menu",""],["nz-menu-item",""],[1,"m-l-5"],[1,"d-md-flex","justify-content-space","m-t-50"],["id","chartdiv",2,"width","100%","height","500px"],[1,"col-lg-3"],[1,"m-t-40"],[1,"overflow-y-auto","p-l-10","p-t-15"],[3,"nzDot",4,"ngFor","ngForOf"],[1,"col-lg-12"],[1,"m-t-30"],["id","map",1,"match-parent"],[3,"nzDot"],[1,"m-l-20"],[1,"m-b-5"],[1,"font-weight-semibold"],[1,"text-muted","font-size-13"],[1,"font-size-20","p-5"],["class","text-success","nz-icon","","theme","outline",4,"ngIf"],["class","text-info","nz-icon","","theme","outline",4,"ngIf"],["class","text-danger","nz-icon","","theme","outline",4,"ngIf"],["nz-icon","","theme","outline",1,"text-info"]],template:function(n,r){if(n&1&&(e(0,"div",3)(1,"div",4)(2,"div",5),m(3,"nz-avatar",6),e(4,"div",7)(5,"h4",8),a(6,"Seguimiento de actividades"),i(),e(7,"span",9),a(8,"Sistema de monitoreo"),i()()(),e(9,"div",10)(10,"div",11)(11,"div",12),m(12,"i",13),i(),e(13,"div",14)(14,"h2",15),a(15,"0"),i(),e(16,"span",9),a(17,"Veh\xEDculos"),i()()(),e(18,"div",11)(19,"div",12),m(20,"i",16),i(),e(21,"div",14)(22,"h2",15),a(23,"0"),i(),e(24,"span",9),a(25,"Acceso"),i()()(),e(26,"div",17)(27,"div",12),m(28,"i",18),i(),e(29,"div",14)(30,"h2",15),a(31,"0"),i(),e(32,"span",9),a(33,"Negados"),i()()()()()(),e(34,"div",19)(35,"div",20)(36,"nz-card")(37,"div",21)(38,"h5",22),a(39,"Diagrama de actividad "),i(),e(40,"div")(41,"a",23),m(42,"i",24),i(),e(43,"nz-dropdown-menu",null,0)(45,"ul",25)(46,"li",26),m(47,"i",24),e(48,"span",27),a(49,"Matutino"),i()(),e(50,"li",26),m(51,"i",24),e(52,"span",27),a(53,"Vespertino"),i()(),e(54,"li",26),m(55,"i",24),e(56,"span",27),a(57,"Ayer"),i()(),e(58,"li",26),m(59,"i",24),e(60,"span",27),a(61,"Anti\xE9r"),i()()()()()(),e(62,"div",28),m(63,"div",29),i()()(),e(64,"div",30)(65,"nz-card")(66,"div",21)(67,"h5",22),a(68,"Actividad"),i()(),e(69,"div",31)(70,"div",32)(71,"nz-timeline"),u(72,me,15,6,"nz-timeline-item",33),i()()()()()(),e(73,"div",19)(74,"div",34)(75,"nz-card")(76,"div",21)(77,"h5",22),a(78,"Informaci\xF3n detallada"),i()(),m(79,"div",35),i()()(),e(80,"div",19)(81,"div",34)(82,"nz-card")(83,"div",21)(84,"h5",22),a(85,"Mapa"),i()(),e(86,"div",35),m(87,"div",36,1),i()()()()),n&2){let s=v(44);l(41),d("nzTrigger","click")("nzPlacement","bottomRight")("nzDropdownMenu",s),l(31),d("ngForOf",r.activityList)}},dependencies:[T,L,A,Q,B,$,U,q,G,R,V,J,K],styles:[".match-parent[_ngcontent-%COMP%]{width:100%!important;height:600px!important;background-color:#f6f6f4}"]})}}return o})();export{Ce as a};
