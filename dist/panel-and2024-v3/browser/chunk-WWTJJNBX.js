import{a as ui}from"./chunk-WPTEGAK5.js";import{a as xt}from"./chunk-7ZXPMSQE.js";import{a as Ze}from"./chunk-MZQR3OOF.js";import{d as hi}from"./chunk-NLE3ZJ6O.js";import{c as et}from"./chunk-KBPHMAHQ.js";import{a as Ue}from"./chunk-LES3IH4G.js";import{a as gi,b as _i}from"./chunk-M2UEDHQK.js";import{a as Ke,c as zi,h as yt,i as fi}from"./chunk-HY4NALPB.js";import{B as Xe,C as Je,D as Ye,E as Qe,G as Et,a as oe,c as He,d as $e,e as vt,g as Te,h as ci,k as ue,m as mi,n as St,o as Ct,s as di,t as pi,w as We,z as Ge}from"./chunk-7WQN67TU.js";import{$ as ai,M as ve,P as Q,Q as K,R as Z,S as ee,_ as pe,aa as si,b as ce,c as g,d as M,da as gt,e as H,ea as Ui,fa as _t,g as rt,h as ht,ha as ge,i as $,ja as xe,k as W,la as li,m as G,pa as ze,q as O,qa as he,sa as bt,t as J,u as Y}from"./chunk-QOFVDSBV.js";import{a as Se,b as ft}from"./chunk-N73LEDZ7.js";import{a as Ce,c as be,d as je,f as Be,g as ye,h as Ee,j as we}from"./chunk-Z3V3S6TE.js";import{$ as k,Bb as Re,Ca as _,Db as qe,Ea as m,Fa as Dt,Fb as V,Fe as at,Ga as ut,H as Ve,Ia as R,Ib as Zt,Mc as me,P as A,Pd as de,R as Ne,Ra as i,Sa as o,Ta as d,Ua as nt,V as Me,Va as ot,Vb as L,W as Wt,Wb as B,Xa as x,Y as ke,Z as y,_a as v,_b as _e,aa as Gt,ab as u,ba as Xt,bb as Jt,bc as zt,c as le,cb as Yt,db as De,fa as Pt,ga as h,ha as f,l as $t,lb as w,m as F,mb as c,md as ni,nb as N,ob as I,od as oi,pb as Qt,ra as Pe,rb as q,rc as ei,sa as l,sb as U,sf as te,ta as b,tb as j,tf as ie,uc as ti,vb as Lt,vc as ii,vf as ne,wb as Le,we as P,xb as Oe,ye as ri,zb as Kt,ze as X}from"./chunk-Y43Y5JPN.js";import{b as Ht}from"./chunk-IOYOIITG.js";import{a as E,b as fe,f as qi,h as se}from"./chunk-SIAVTO45.js";var vi=(()=>{let s=class s{constructor(e){this.afs=e}getSummarized(){return this.afs.collection("summarized").valueChanges()}setAccounts(){}};s.\u0275fac=function(t){return new(t||s)(ke(me))},s.\u0275prov=Me({token:s,factory:s.\u0275fac,providedIn:"root"});let a=s;return a})();var ji=["nzType","avatar"];var Bi=["*"];function Hi(a,s){if(a&1&&(i(0,"div",5),d(1,"nz-skeleton-element",6),o()),a&2){let r=u(2);l(),m("nzSize",r.avatar.size||"default")("nzShape",r.avatar.shape||"circle")}}function $i(a,s){if(a&1&&d(0,"h3",7),a&2){let r=u(2);Dt("width",r.toCSSUnit(r.title.width))}}function Wi(a,s){if(a&1&&d(0,"li"),a&2){let r=s.index,e=u(3);Dt("width",e.toCSSUnit(e.widthList[r]))}}function Gi(a,s){if(a&1&&(i(0,"ul",8),_(1,Wi,1,2,"li",9),o()),a&2){let r=u(2);l(),m("ngForOf",r.rowsList)}}function Xi(a,s){if(a&1&&(nt(0),_(1,Hi,2,2,"div",1),i(2,"div",2),_(3,$i,1,2,"h3",3)(4,Gi,2,1,"ul",4),o(),ot()),a&2){let r=u();l(),m("ngIf",!!r.nzAvatar),l(2),m("ngIf",!!r.nzTitle),l(),m("ngIf",!!r.nzParagraph)}}function Ji(a,s){a&1&&(nt(0),Yt(1),ot())}var Yi=(()=>{let s=class s{constructor(){this.nzActive=!1,this.nzBlock=!1}};s.\u0275fac=function(t){return new(t||s)},s.\u0275dir=Xt({type:s,selectors:[["nz-skeleton-element"]],hostAttrs:[1,"ant-skeleton","ant-skeleton-element"],hostVars:4,hostBindings:function(t,n){t&2&&ut("ant-skeleton-active",n.nzActive)("ant-skeleton-block",n.nzBlock)},inputs:{nzActive:"nzActive",nzType:"nzType",nzBlock:"nzBlock"},standalone:!0});let a=s;return Ht([oi()],a.prototype,"nzBlock",void 0),a})();var Qi=(()=>{let s=class s{constructor(){this.nzShape="circle",this.nzSize="default",this.styleMap={}}ngOnChanges(e){if(e.nzSize&&typeof this.nzSize=="number"){let t=`${this.nzSize}px`;this.styleMap={width:t,height:t,"line-height":t}}else this.styleMap={}}};s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=k({type:s,selectors:[["nz-skeleton-element","nzType","avatar"]],inputs:{nzShape:"nzShape",nzSize:"nzSize"},standalone:!0,features:[Pt,Lt],attrs:ji,decls:1,vars:9,consts:[[1,"ant-skeleton-avatar",3,"ngStyle"]],template:function(t,n){t&1&&d(0,"span",0),t&2&&(ut("ant-skeleton-avatar-square",n.nzShape==="square")("ant-skeleton-avatar-circle",n.nzShape==="circle")("ant-skeleton-avatar-lg",n.nzSize==="large")("ant-skeleton-avatar-sm",n.nzSize==="small"),m("ngStyle",n.styleMap))},dependencies:[_e],encapsulation:2,changeDetection:0});let a=s;return a})();var Si=(()=>{let s=class s{constructor(e){this.cdr=e,this.nzActive=!1,this.nzLoading=!0,this.nzRound=!1,this.nzTitle=!0,this.nzAvatar=!1,this.nzParagraph=!0,this.rowsList=[],this.widthList=[]}toCSSUnit(e=""){return ni(e)}getTitleProps(){let e=!!this.nzAvatar,t=!!this.nzParagraph,n="";return!e&&t?n="38%":e&&t&&(n="50%"),E({width:n},this.getProps(this.nzTitle))}getAvatarProps(){let e=this.nzTitle&&!this.nzParagraph?"square":"circle";return E({shape:e,size:"large"},this.getProps(this.nzAvatar))}getParagraphProps(){let e=!!this.nzAvatar,t=!!this.nzTitle,n={};return(!e||!t)&&(n.width="61%"),!e&&t?n.rows=3:n.rows=2,E(E({},n),this.getProps(this.nzParagraph))}getProps(e){return e&&typeof e=="object"?e:{}}getWidthList(){let{width:e,rows:t}=this.paragraph,n=[];return e&&Array.isArray(e)?n=e:e&&!Array.isArray(e)&&(n=[],n[t-1]=e),n}updateProps(){this.title=this.getTitleProps(),this.avatar=this.getAvatarProps(),this.paragraph=this.getParagraphProps(),this.rowsList=[...Array(this.paragraph.rows)],this.widthList=this.getWidthList(),this.cdr.markForCheck()}ngOnInit(){this.updateProps()}ngOnChanges(e){(e.nzTitle||e.nzAvatar||e.nzParagraph)&&this.updateProps()}};s.\u0275fac=function(t){return new(t||s)(b(Zt))},s.\u0275cmp=k({type:s,selectors:[["nz-skeleton"]],hostAttrs:[1,"ant-skeleton"],hostVars:6,hostBindings:function(t,n){t&2&&ut("ant-skeleton-with-avatar",!!n.nzAvatar)("ant-skeleton-active",n.nzActive)("ant-skeleton-round",!!n.nzRound)},inputs:{nzActive:"nzActive",nzLoading:"nzLoading",nzRound:"nzRound",nzTitle:"nzTitle",nzAvatar:"nzAvatar",nzParagraph:"nzParagraph"},exportAs:["nzSkeleton"],standalone:!0,features:[Pt,Lt],ngContentSelectors:Bi,decls:2,vars:2,consts:[[4,"ngIf"],["class","ant-skeleton-header",4,"ngIf"],[1,"ant-skeleton-content"],["class","ant-skeleton-title",3,"width",4,"ngIf"],["class","ant-skeleton-paragraph",4,"ngIf"],[1,"ant-skeleton-header"],["nzType","avatar",3,"nzSize","nzShape"],[1,"ant-skeleton-title"],[1,"ant-skeleton-paragraph"],[3,"width",4,"ngFor","ngForOf"]],template:function(t,n){t&1&&(Jt(),_(0,Xi,5,3,"ng-container",0)(1,Ji,2,0,"ng-container",0)),t&2&&(m("ngIf",n.nzLoading),l(),m("ngIf",!n.nzLoading))},dependencies:[Yi,Qi,B,L],encapsulation:2,changeDetection:0});let a=s;return a})(),Bo=(()=>{let s=class s{};s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=Gt({type:s}),s.\u0275inj=Wt({});let a=s;return a})();var en=(a,s,r)=>[a,s,r],tn=()=>({size:"large"}),nn=a=>["/accounts/edit",a,0],on=a=>["/accounts/edit",a,1],Ci=a=>["/accounts/edit",a,2],rn=a=>["/accounts/edit",a,3];function an(a,s){a&1&&d(0,"nz-empty")}function sn(a,s){if(a&1&&d(0,"nz-avatar",28),a&2){let r=u().$implicit;m("nzSrc",r.imageUrl)}}function ln(a,s){if(a&1){let r=x();i(0,"i",31),v("click",function(){h(r);let t=u(2).$implicit,n=u();return f(n.toggleAccountActive(t.id,!0))}),o()}a&2&&m("nzType","check-circle")("nzTheme","twotone")("nzTwotoneColor","#52c41a")}function cn(a,s){if(a&1){let r=x();i(0,"i",32),v("click",function(){h(r);let t=u(2).$implicit,n=u();return f(n.toggleAccountActive(t.id,!1))}),o()}a&2&&m("nzType","pause-circle")("nzTheme","twotone")("nzTwotoneColor","#de4436")}function mn(a,s){if(a&1&&_(0,ln,1,3,"i",29)(1,cn,1,3,"i",30),a&2){let r=u().$implicit;m("ngIf",r.active),l(),m("ngIf",!r.active)}}function dn(a,s){if(a&1&&d(0,"i",33),a&2){let r=u().$implicit;m("routerLink",Oe(1,nn,r.id))}}function pn(a,s){if(a&1){let r=x();i(0,"a",34),d(1,"i",35),o(),i(2,"nz-dropdown-menu",null,5)(4,"ul",36)(5,"li",37),d(6,"i",38),c(7," Usuarios "),o(),i(8,"li",37),d(9,"i",39),c(10," Productos "),o(),i(11,"li",37),d(12,"i",39),c(13," Promociones "),o(),i(14,"li",37),d(15,"i",40),c(16," Operaci\xF3n y horarios "),o(),d(17,"li",41),i(18,"li",42),v("click",function(){h(r);let t=u().$implicit,n=u();return f(n.deleteAccountModal(t))}),d(19,"i",43),c(20," Eliminar "),o()()()}if(a&2){let r=w(3),e=u().$implicit;m("nzDropdownMenu",r),l(5),m("routerLink",Oe(5,on,e.id)),l(3),m("routerLink",Oe(7,Ci,e.id)),l(3),m("routerLink",Oe(9,Ci,e.id)),l(3),m("routerLink",Oe(11,rn,e.id))}}function un(a,s){if(a&1&&(i(0,"div",24)(1,"nz-card",25)(2,"nz-skeleton",26),d(3,"nz-card-meta",27),o()(),_(4,sn,1,1,"ng-template",null,1,V)(6,mn,2,2,"ng-template",null,2,V)(8,dn,1,3,"ng-template",null,3,V)(10,pn,21,13,"ng-template",null,4,V),o()),a&2){let r=s.$implicit,e=w(5),t=w(7),n=w(9),p=w(11),z=u();l(),m("nzActions",Kt(6,en,t,n,p)),l(),m("nzActive",!0)("nzLoading",z.loading)("nzAvatar",Le(10,tn)),l(),m("nzAvatar",e)("nzTitle",r.name)}}function zn(a,s){if(a&1&&(i(0,"nz-option",61),d(1,"i",62),c(2),o()),a&2){let r=s.$implicit;m("nzLabel",r.name)("nzValue",r.uid),l(2),I(" ",r.name,"")}}function hn(a,s){if(a&1){let r=x();i(0,"form",44),v("ngSubmit",function(){h(r);let t=u();return f(t.submitForm())}),i(1,"nz-form-item")(2,"nz-form-label",45),c(3,"Nombre"),o(),i(4,"nz-form-control",46),d(5,"input",47),o()(),i(6,"nz-form-item")(7,"nz-form-label",48)(8,"span"),c(9," Giro "),o()(),i(10,"nz-form-control",49)(11,"nz-select",50),v("ngModelChange",function(t){h(r);let n=u();return f(n.onJobTypeSelected(t))}),_(12,zn,3,3,"nz-option",51),o()()(),i(13,"nz-form-item")(14,"nz-form-label",52),c(15,"Consecutivo"),o(),i(16,"nz-form-control",53)(17,"input",54),v("[nzDisabled]",function(){h(r);let t=u();return f(t.isDisabled)}),o()()(),i(18,"nz-form-item")(19,"nz-form-label",55),c(20,"Tel\xE9fono"),o(),i(21,"nz-form-control",56),d(22,"input",57),o()(),i(23,"nz-form-item")(24,"nz-form-label",58),c(25,"Sitio web"),o(),i(26,"nz-form-control",59),d(27,"input",60),o()()()}if(a&2){let r=u();m("formGroup",r.validateForm),l(2),m("nzSm",6)("nzXs",24),l(2),m("nzSm",14)("nzXs",24),l(3),m("nzSm",6)("nzXs",24),l(3),m("nzSm",14)("nzXs",24),l(2),m("ngForOf",r.jobType),l(2),m("nzSm",6)("nzXs",24),l(2),m("nzSm",14)("nzXs",24),l(3),m("nzSm",6)("nzXs",24),l(2),m("nzSm",14)("nzXs",24),l(3),m("nzSm",6)("nzXs",24),l(2),m("nzSm",14)("nzXs",24)}}var tr=(()=>{let s=class s{constructor(e,t,n){this.messageService=e,this.modalService=t,this.fb=n,this.rolService=y(oe),this.summarizedService=y(vi),this.authService=y(X),this.accountsService=y(Be),this.selectedRecord=!1,this.accountsList=[],this.summarized=[],this.loading=!0,this.isVisibleAdd=!1,this.isDeleteVisible=!1,this.isOkLoading=!1,this.infoLoad=[],this.infoSegment=[],this.stopSubscription$=new le,this.isDisabled=!0,this.currentConsecutive="",this.currentJobType=""}ngOnInit(){this.userSubscription=this.authService.getUser().subscribe(e=>{this.user=e,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&(this.rolService.getRol(this.user.rolId).valueChanges().subscribe(t=>{this.infoLoad=t,this.userlevelAccess=this.infoLoad.optionAccessLavel}),this.accountsService.getSegmentLevel(this.user.idSegment).pipe(A(this.stopSubscription$),F(t=>{let n=t.payload.id,p=t.payload.data();return E({id:n},p)}),Ne(t=>(this.infoSegment=t,this.getSubscriptions(),t))).subscribe())}),this.validateForm=this.fb.group({name:[null,[g.minLength(5),g.maxLength(40),g.required]],address:[null,[g.required]],phoneNumber:[null,[g.required]],website:[null,[g.required]],active:[!1],canShowDevices:[!0],showFromHour:[5],jobTypeID:[null,[g.required]],custConsecutive:[null,[g.required]],showToHour:[20]})}ngOnDestroy(){this.accountsSubscription&&this.accountsSubscription.unsubscribe(),this.userSubscription&&this.userSubscription.unsubscribe(),this.stopSubscription$&&this.stopSubscription$.unsubscribe()}submitForm(){this.isOkLoading=!0;for(let e in this.validateForm.controls)this.validateForm.controls[e].markAsDirty(),this.validateForm.controls[e].updateValueAndValidity();this.userlevelAccess!="3"?this.accountsService.setAccount(this.validateForm.value,this.currentConsecutive).then(t=>{this.currentJobType.length>0&&this.accountsService.updateJobType(this.currentJobType,this.currentConsecutive).then(()=>{},n=>{console.log("err: ",n)}).catch(n=>console.log(n)),this.isVisibleAdd=!1,this.isOkLoading=!1}).catch(t=>console.log(t)):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}toggleAccountActive(e,t){this.accountsService.toggleAccountActive(e,t)}deleteAccount(e){this.isOkLoading=!0,this.userlevelAccess=="1"?this.accountsService.deleteAccount(e.id).then(n=>{this.isOkLoading=!1}).catch(n=>console.log(n)):this.sendMessage("error","El usuario no tiene permisos para borrar datos, favor de contactar al administrador.")}getSubscriptions(){this.loading=!0,this.infoSegment!==void 0&&this.infoSegment.nivelNum==1?this.accountsSubscription=this.accountsService.getAccountsByCustomer(this.user.customerId).pipe(F(e=>{let t=e.payload.id,n=e.payload.data();return E({id:t},n)})).subscribe(e=>{this.accountsList=[e],console.log(this.accountsList),this.loading=!1}):this.accountsSubscription=this.accountsService.getAccounts().pipe(F(e=>e.map(t=>{let n=t.payload.doc.id,p=t.payload.doc.data();return E({id:n},p)}))).subscribe(e=>{this.accountsList=e,console.log(this.accountsList),this.loading=!1})}deleteAccountModal(e){this.modalService.warning({nzTitle:"\xBFEst\xE1 seguro?",nzContent:"Eliminar\xE1 toda la informaci\xF3n de "+e.name,nzCancelText:"Cancelar",nzOkText:"Eliminar",nzOkLoading:this.isOkLoading,nzOnOk:()=>{this.deleteAccount(e)},nzOnCancel:()=>console.log("cancel")})}createBasicMessage(e){this.messageService.success(`Se encontraron ${e} registros.`,{nzDuration:3e3})}showModalAdd(){this.isVisibleAdd=!0,this.accountsSubscription=this.accountsService.getJobType().pipe(F(e=>e.map(t=>{let n=t.payload.doc.id,p=t.payload.doc.data();return E({id:n},p)}))).subscribe(e=>{this.jobType=e})}handleCancel(){this.isVisibleAdd=!1}sendMessage(e,t){this.messageService.create(e,t)}onJobTypeSelected(e){let t=this.jobType.filter(n=>n.uid===e);if(t.length>0){let n=t[0].consecutive;this.currentJobType=e,n=parseInt(n,10)+1,n=n.toString().padStart(4,"0"),this.validateForm.controls.custConsecutive.setValue(t[0].type+n),this.currentConsecutive=n}}};s.\u0275fac=function(t){return new(t||s)(b(P),b(ge),b(O))},s.\u0275cmp=k({type:s,selectors:[["app-dashboard"]],decls:29,vars:6,consts:[["modalContentAdd",""],["avatarTemplate",""],["actionSetting",""],["actionEdit",""],["actionEllipsis",""],["menu","nzDropdownMenu"],[2,"margin","buttom 15px"],[1,"site-page-header-ghost-wrapper"],[2,"background-color","#f9fbfd",3,"nzGhost"],[2,"margin-left","350px"],[1,"d-md-flex","align-items-center","d-none"],[1,"media","align-items-center","m-r-40","m-v-5"],[1,"font-size-27"],["nz-icon","","theme","outline",1,"text-primary"],["nz-icon","","theme","outline",1,"text-success"],[1,"media","align-items-center","m-v-5"],["nz-icon","","theme","outline",1,"text-danger"],[1,"media","align-items-center","m-v-5","m-l-10"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],[1,"body"],[4,"ngIf"],["nz-row","",3,"nzGutter"],["nz-col","","nzSpan","6",4,"ngFor","ngForOf"],["nzTitle","Nueva Empresa","nzCancelText","Cancelar","nzOkText","Crear","nzOkType","primary",3,"nzOnCancel","nzOnOk","nzVisible","nzContent"],["nz-col","","nzSpan","6"],[3,"nzActions"],[3,"nzActive","nzLoading","nzAvatar"],[3,"nzAvatar","nzTitle"],["nzSize","large",2,"vertical-align","middle",3,"ngStyle","nzSrc"],["nz-icon","","nzTooltipTitle","Activo","nzTooltipPlacement","topLeft","nz-tooltip","",3,"nzType","nzTheme","nzTwotoneColor","click",4,"ngIf"],["nz-icon","","nzTooltipTitle","Inactivo","nzTooltipPlacement","topLeft","nz-tooltip","",3,"nzType","nzTheme","nzTwotoneColor","click",4,"ngIf"],["nz-icon","","nzTooltipTitle","Activo","nzTooltipPlacement","topLeft","nz-tooltip","",3,"click","nzType","nzTheme","nzTwotoneColor"],["nz-icon","","nzTooltipTitle","Inactivo","nzTooltipPlacement","topLeft","nz-tooltip","",3,"click","nzType","nzTheme","nzTwotoneColor"],["nz-icon","","nzType","edit","routerLinkActive","router-link-active","nzTooltipTitle","Editar","nzTooltipPlacement","topLeft","nz-tooltip","",3,"routerLink"],["nz-dropdown","","nzPlacement","bottomRight",3,"nzDropdownMenu"],["nz-icon","","nzType","ellipsis","nzTooltipTitle","M\xE1s informaci\xF3n","nzTooltipPlacement","topLeft","nz-tooltip",""],["nz-menu","","nzSelectable",""],["nz-menu-item","","routerLinkActive","router-link-active",3,"routerLink"],["nz-icon","","nzType","user"],["nz-icon","","nzType","shopping"],["nz-icon","","nzType","clock-circle"],["nz-menu-divider",""],["nz-menu-item","",3,"click"],["nz-icon","","nzTheme","twotone","nzTwotoneColor","#de4436","nzType","delete"],["nz-form","",3,"ngSubmit","formGroup"],["nzRequired","","nzFor","name",3,"nzSm","nzXs"],["nzErrorTip","Debe contener entre 5 y 30 caracteres.",3,"nzSm","nzXs"],["nz-input","","formControlName","name","id","name"],["nzFor","address","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Ingrese el Giro",3,"nzSm","nzXs"],["formControlName","jobTypeID","nzAllowClear","","nzPlaceHolder","Selecciona el Giro de la Empresa",2,"width","320px",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzRequired","","nzFor","custConsecutive",3,"nzSm","nzXs"],["nzErrorTip","Consecutivo es necesario para crear la empresa.",3,"nzSm","nzXs"],["nz-input","","formControlName","custConsecutive","id","custConsecutive",3,"[nzDisabled]"],["nzRequired","","nzFor","phoneNumber",3,"nzSm","nzXs"],["nzErrorTip","Ingrese el tel\xE9fono de contacto con la empresa.",3,"nzSm","nzXs"],["nz-input","","formControlName","phoneNumber","id","phoneNumber"],["nzFor","website","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Ingrese el sitio web!",3,"nzSm","nzXs"],["nz-input","","id","website","formControlName","website","placeholder","website"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon",""]],template:function(t,n){if(t&1){let p=x();i(0,"div",6)(1,"div",7)(2,"nz-page-header",8)(3,"nz-page-header-title",9),c(4,"CRM"),o(),i(5,"nz-page-header-subtitle"),c(6,"Informaci\xF3n Comercial "),o(),i(7,"nz-page-header-extra")(8,"div",10)(9,"div",11)(10,"div",12),d(11,"i",13),o()(),i(12,"div",11)(13,"div",12),d(14,"i",14),o()(),i(15,"div",15)(16,"div",12),d(17,"i",16),o()(),i(18,"div",17)(19,"button",18),v("click",function(){return h(p),f(n.showModalAdd())}),c(20,"Nueva Empresa"),o()()()(),d(21,"nz-page-header-footer"),o()(),i(22,"div",19),_(23,an,1,0,"nz-empty",20),i(24,"div",21),_(25,un,12,11,"div",22),o()()(),i(26,"nz-modal",23),v("nzOnCancel",function(){return h(p),f(n.handleCancel())})("nzOnOk",function(){return h(p),f(n.submitForm())}),o(),_(27,hn,28,22,"ng-template",null,0,V)}if(t&2){let p=w(28);l(2),m("nzGhost",!1),l(21),m("ngIf",n.accountsList.length===0),l(),m("nzGutter",8),l(),m("ngForOf",n.accountsList),l(),m("nzVisible",n.isVisibleAdd)("nzContent",p)}},dependencies:[L,B,_e,de,Y,J,K,Q,ee,Z,pe,xe,Ue,li,be,Ce,je,ye,Ee,we,ve,ne,te,ie,Se,ft,ue,He,$e,Te,ci,ze,he,ti,ii,$,ce,M,H,W,G,Si]});let a=s;return a})();function gn(a,s){if(a&1&&d(0,"nz-option",12),a&2){let r=s.$implicit;m("nzValue",r)("nzLabel",r)}}function _n(a,s){if(a&1&&d(0,"nz-option",12),a&2){let r=s.$implicit;m("nzValue",r)("nzLabel",r)}}function vn(a,s){if(a&1&&(i(0,"form",6)(1,"nz-form-item")(2,"nz-form-label"),c(3,"Nombre de la Operaci\xF3n"),o(),i(4,"nz-form-control"),d(5,"input",7),o()(),i(6,"nz-form-item")(7,"nz-form-label"),c(8,"Descripci\xF3n"),o(),i(9,"nz-form-control"),d(10,"textarea",8),o()(),i(11,"nz-form-item")(12,"nz-form-label"),c(13,"Horarios Entradas (Opcional)"),o(),i(14,"nz-form-control")(15,"nz-select",9),_(16,gn,1,2,"nz-option",10),o()()(),i(17,"nz-form-item")(18,"nz-form-label"),c(19,"Horarios Salidas (Opcional)"),o(),i(20,"nz-form-control")(21,"nz-select",11),_(22,_n,1,2,"nz-option",10),o()()()()),a&2){let r=u();m("formGroup",r.objectForm),l(16),m("ngForOf",r.timeOptions),l(6),m("ngForOf",r.timeOptions)}}function Sn(a,s){if(a&1&&(i(0,"nz-tab",13),d(1,"app-shared-stoppoints-list",14),o()),a&2){let r=s.$implicit,e=u();m("nzTitle",e.getTabTitle(r)),l(),m("accountId",e.accountId)("routeId",r.id)}}var xi=(()=>{let s=class s{constructor(e,t,n,p){this.afs=e,this.modalService=t,this.messageService=n,this.fb=p,this.accountId="",this.routesService=y(bt),this.tabs=[],this.nzTabPosition="top",this.selectedIndex=0,this.routesList=[],this.stopPointsList=[],this.stopSubscription$=new le,this.customersService=y(gt),this.timeOptions=[]}ngOnInit(){this.createForm(),this.getSubscriptions(),this.generateTimeOptions()}ngOnDestroy(){this.sub.unsubscribe()}generateTimeOptions(){console.log("inicia");let e=7,t=21;for(let n=e;n<=t;n++){let p=n%12||12,z=n<12?"AM":"PM",S=`${p.toString().padStart(2,"0")}:${n%60===30?"30":"00"} ${z}`;this.timeOptions.push(S)}console.log("end")}createForm(){this.objectForm=this.fb.group({active:[!1,[g.required]],description:["",[g.required]],imageUrl:[""],kmzUrl:[""],name:["",[g.minLength(5),g.maxLength(20),g.required]],routeId:[""],customerId:["",[g.required]],customerName:[""],initialStart:[[]],initialEnd:[[]]})}resetForm(){this.objectForm.reset({active:!1,description:"",imageUrl:"",kmzUrl:"",name:"",routeId:"",customerId:"",customerName:"",initialStart:[],initialEnd:[]})}addNewRoute(e){var t,n;let p=this.modalService.create({nzTitle:"Nueva Operaci\xF3n",nzContent:e,nzFooter:[{label:"Crear Operaci\xF3n ",type:"primary",onClick:()=>this.modalService.confirm({nzTitle:"\xBFEst\xE1 la informaci\xF3n completa?",nzOnOk:()=>{if(this.objectForm.get("customerId").setValue(this.accountId),this.objectForm.valid){let z=this.objectForm.value,S=z.initialStart&&z.initialStart.length>0?z.initialStart.map(D=>({value:D})):null,C=z.initialEnd&&z.initialEnd.length>0?z.initialEnd.map(D=>({value:D})):[],T=E(E({},z),S?{initialStart:S}:{}),ae=this.afs.createId(),qt=this.routesService.setRoute2(ae,this.accountId,this.objectForm.value).then(()=>{}).catch(D=>console.log(D));this.routesService.getInternalCustomer(this.accountId).pipe(A(this.stopSubscription$),F(D=>D.map(Ie=>{let it=Ie.payload.doc.id,Ut=Ie.payload.doc.data();return fe(E({},Ut),{id:it})}))).subscribe(D=>{let Ie=this.objectForm.controls.name.value,it=new Date,jt=new Date(it.getFullYear()+3,it.getMonth(),it.getDate()).toISOString();console.log(Ie);var Mi="";let kt={authorization:"portalAuth",operation_type:"in",method:"Liquidacion",transaction_type:"charge",card:{type:"",brand:"",address:"",card_number:"",holder_name:"",expiration_year:"",expiration_month:"",allows_charges:"",allows_payouts:"",bank_name:"",bank_code:"",points_card:"",points_type:""},status:"completed",conciliated:!1,creation_date:new Date().toISOString(),operation_date:new Date().toISOString(),description:"Pago a traves de portal",error_message:"",order_id:"portalOrder",currency:"MXN",amount:0,customer:{name:"",last_name:"",email:"",phone_number:"",address:"",creation_date:"",external_id:"",clabe:""},product:{product_id:"",amountTrips:0,frequencies:0,rangeWeeks:{},weeks:0,name:""},customerId:this.accountId,active:!0,category:"permanente",date_created:new Date().toISOString(),product_description:"Pago a traves de portal proceso interno al crear una ruta",product_id:"",name:Ie,isTaskIn:"false",isTaskOut:"false",type:"Servicio",isOpenpay:!1,paidApp:"portal",price:0,round:"",routeId:ae,routeName:Ie,stopDescription:"",stopId:"",stopName:"Internal",validFrom:new Date().toISOString(),validTo:jt,idBoardingPass:D[0].id,idPurchasteRequest:"",is_courtesy:!1,typePayment:"Liquidacion"};t={active:!0,amountPayment:0,payment:"Liquidacion",status:"completed",customer_id:this.accountId,customerId:this.accountId,creation_date:new Date().toISOString(),name:"internal",price:0,operation_date:new Date().toISOString(),routeId:ae,routeName:Ie,round:"",stopName:"internal",stopId:"",typePayment:"Liquidacion",validFrom:new Date().toISOString(),validTo:jt,idBoardingPass:D[0].uid,idPurchaseRequest:"",baja:!1,type:"Servicio",fileURL:Mi},this.customersService.saveBoardingPassToUserPurchaseCollection(D[0].id,kt).then(Bt=>{this.customersService.saveBoardingPassDetailToUserPurchaseCollection(D[0].id,ae,kt).then(Oi=>{let Ri=D[0];this.customersService.createPurchaseCloud(kt,Ri,D[0].id)}).catch(Oi=>{console.log("error")})}).catch(Bt=>{console.log(Bt)}),this.modalService.closeAll()})}}})}],nzWidth:500})}getSubscriptions(){this.sub=this.routesService.getRoutes(this.accountId).pipe(F(e=>e.map(t=>{let n=t.payload.doc.id,p=t.payload.doc.data();return fe(E({},p),{id:n})}))).subscribe(e=>{this.routesList=e,e.forEach(t=>{this.tabs.push({name:t.name,content:`Content of tab ${t.name}`})})})}getTabTitle(e){return`${e.name}`}};s.\u0275fac=function(t){return new(t||s)(b(me),b(ge),b(P),b(O))},s.\u0275cmp=k({type:s,selectors:[["app-shared-routes-list"]],inputs:{accountId:"accountId"},decls:9,vars:4,consts:[["newProjectContent",""],[1,"site-page-header-ghost-wrapper"],[2,"background-color","#f9fbfd",3,"nzGhost"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],[3,"nzSelectedIndexChange","nzTabPosition","nzSelectedIndex"],[3,"nzTitle",4,"ngFor","ngForOf"],["nz-form","","nzLayout","vertical",3,"formGroup"],["type","text","formControlName","name","nz-input","","placeholder","Escriba el nombre de la Operaci\xF3n"],["formControlName","description","nz-input",""],["formControlName","initialStart","nzMode","multiple"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["formControlName","initialEnd","nzMode","multiple"],[3,"nzValue","nzLabel"],[3,"nzTitle"],[3,"accountId","routeId"]],template:function(t,n){if(t&1){let p=x();i(0,"div",1)(1,"nz-page-header",2)(2,"nz-page-header-extra")(3,"button",3),v("click",function(){h(p);let S=w(6);return f(n.addNewRoute(S))}),c(4,"Agregar Operaci\xF3n"),o()()()(),_(5,vn,23,3,"ng-template",null,0,V),i(7,"nz-tabset",4),j("nzSelectedIndexChange",function(S){return h(p),U(n.selectedIndex,S)||(n.selectedIndex=S),f(S)}),_(8,Sn,2,3,"nz-tab",5),o()}t&2&&(l(),m("nzGhost",!1),l(6),m("nzTabPosition",n.nzTabPosition),q("nzSelectedIndex",n.selectedIndex),l(),m("ngForOf",n.routesList))},dependencies:[L,Y,J,K,Q,ee,Z,pe,ne,te,ie,ue,Te,ze,he,$,ce,M,H,W,G,Ct,St,ui]});let a=s;return a})();var Nt=qi(Ui());function bn(a,s){if(a&1&&(i(0,"nz-tag",10),c(1,"Dom"),o()),a&2){let r=u().$implicit;m("nzColor",r.isSunday?"geekblue":"")}}function xn(a,s){if(a&1&&(i(0,"nz-tag",10),c(1,"Lun"),o()),a&2){let r=u().$implicit;m("nzColor",r.isMonday?"geekblue":"")}}function yn(a,s){if(a&1&&(i(0,"nz-tag",10),c(1,"Mar"),o()),a&2){let r=u().$implicit;m("nzColor",r.isTuesday?"geekblue":"")}}function En(a,s){if(a&1&&(i(0,"nz-tag",10),c(1,"Mi\xE9"),o()),a&2){let r=u().$implicit;m("nzColor",r.isWednesday?"geekblue":"")}}function wn(a,s){if(a&1&&(i(0,"nz-tag",10),c(1,"Jue"),o()),a&2){let r=u().$implicit;m("nzColor",r.isThursday?"geekblue":"")}}function Tn(a,s){if(a&1&&(i(0,"nz-tag",10),c(1,"Vie"),o()),a&2){let r=u().$implicit;m("nzColor",r.isFriday?"geekblue":"")}}function Fn(a,s){if(a&1&&(i(0,"nz-tag",10),c(1,"S\xE1b"),o()),a&2){let r=u().$implicit;m("nzColor",r.isSaturday?"geekblue":"")}}function In(a,s){a&1&&d(0,"i",24)}function Vn(a,s){if(a&1){let r=x();i(0,"li",19),v("click",function(){h(r);let t=u().$implicit,n=u(2);return f(n.toggleActive(t))}),d(1,"i",25),c(2," Activar "),o()}}function Nn(a,s){if(a&1){let r=x();i(0,"li",19),v("click",function(){h(r);let t=u().$implicit,n=u(2);return f(n.toggleActive(t))}),d(1,"i",26),c(2," Desactivar "),o()}}function kn(a,s){if(a&1){let r=x();i(0,"tr")(1,"td"),c(2),o(),i(3,"td"),c(4),o(),i(5,"td")(6,"nz-tag",10),c(7),o()(),i(8,"td"),_(9,bn,2,1,"nz-tag",11)(10,xn,2,1,"nz-tag",11)(11,yn,2,1,"nz-tag",11)(12,En,2,1,"nz-tag",11)(13,wn,2,1,"nz-tag",11)(14,Tn,2,1,"nz-tag",11)(15,Fn,2,1,"nz-tag",11),o(),i(16,"td"),c(17),o(),i(18,"td"),c(19),Re(20,"date"),o(),i(21,"td")(22,"nz-tag",10),_(23,In,1,0,"i",12),i(24,"span"),c(25),o()()(),i(26,"td")(27,"nz-tag",13),c(28),o(),c(29),o(),i(30,"td")(31,"nz-tag",14),c(32),o(),c(33),o(),i(34,"td"),c(35),o(),i(36,"td")(37,"a",15),d(38,"i",16),o(),i(39,"nz-dropdown-menu",null,2)(41,"ul",17),_(42,Vn,3,0,"li",18)(43,Nn,3,0,"li",18),i(44,"li",19),v("click",function(){let t=h(r).$implicit,n=u(2);return f(n.showModalEdit(t))}),d(45,"i",20),c(46," Editar "),o(),d(47,"li",21),i(48,"li",22),v("nzOnConfirm",function(){let t=h(r).$implicit,n=u(2);return f(n.showModalDelete(t))})("nzOnCancel",function(){h(r);let t=u(2);return f(t.handleCancel())}),d(49,"i",23),c(50," Eliminar "),o()()()()()}if(a&2){let r=s.$implicit,e=w(40),t=u(2);l(),R(r.active?"text-dark":"text-muted font-italic"),l(),N(r.vendorName),l(),R(r.active?"text-dark":"text-muted font-italic"),l(),N(t.getRouteName(r.routeId)),l(),R(r.active?"text-dark":"text-muted font-italic"),l(),m("nzColor",r.program=="M"?"green":"red"),l(),N(r.program=="M"?"Mete":"Saca"),l(),R(r.active?"text-dark":"text-muted font-italic"),l(),m("ngIf",r.isSunday),l(),m("ngIf",r.isMonday),l(),m("ngIf",r.isTuesday),l(),m("ngIf",r.isWednesday),l(),m("ngIf",r.isThursday),l(),m("ngIf",r.isFriday),l(),m("ngIf",r.isSaturday),l(),R(r.active?"text-dark":"text-muted font-italic"),l(),N(r.round),l(),R(r.active?"text-dark":"text-muted font-italic"),l(),I("",qe(20,46,r.time.toDate(),"HH:mm")," "),l(2),R(r.active?"text-dark":"text-muted font-italic"),l(),m("nzColor",r.acRequired?"blue":""),l(),m("ngIf",r.acRequired),l(2),N(r.acRequired?"":"No"),l(),R(r.active?"text-dark":"text-muted font-italic"),l(2),N(r.stopBeginHour),l(),I(" ",r.stopBeginName,""),l(),R(r.active?"text-dark":"text-muted font-italic"),l(2),N(r.stopEndHour),l(),I(" ",r.stopEndName,""),l(),R(r.active?"text-dark":"text-muted font-italic"),l(),N(r.type),l(),R(r.active?"text-dark":"text-muted font-italic"),l(),m("nzDropdownMenu",e),l(5),m("ngIf",!r.active),l(),m("ngIf",r.active)}}function Pn(a,s){if(a&1){let r=x();i(0,"nz-table",8,1),j("nzPageSizeChange",function(t){h(r);let n=u();return U(n.pageSize,t)||(n.pageSize=t),f(t)}),i(2,"thead")(3,"tr")(4,"th"),c(5,"Asignado A"),o(),i(6,"th"),c(7,"Operaci\xF3n"),o(),i(8,"th"),c(9,"Tarea"),o(),i(10,"th"),c(11,"D\xEDas"),o(),i(12,"th"),c(13,"Turno"),o(),i(14,"th"),c(15,"Hora"),o(),i(16,"th"),c(17,"AC"),o(),i(18,"th"),c(19,"Inicio"),o(),i(20,"th"),c(21,"Fin"),o(),i(22,"th"),c(23,"Tipo"),o(),d(24,"th"),o()(),i(25,"tbody"),_(26,kn,51,49,"tr",9),o()()}if(a&2){let r=w(1),e=u();m("nzData",e.programsList)("nzLoading",e.loading),q("nzPageSize",e.pageSize),l(26),m("ngForOf",r.data)}}function Dn(a,s){if(a&1&&(i(0,"nz-option",50),d(1,"i",51),c(2),d(3,"br"),c(4),o()),a&2){let r=s.$implicit;m("nzLabel",r.name)("nzValue",r.id),l(2),I(" ",r.name," "),l(2),I(" ",r.description,"")}}function Ln(a,s){if(a&1&&(i(0,"nz-option",50),d(1,"i",51),c(2),d(3,"br"),c(4),o()),a&2){let r=s.$implicit;m("nzLabel",r.name)("nzValue",r.id),l(2),I(" ",r.name," "),l(2),I(" ",r.description,"")}}function An(a,s){if(a&1&&(i(0,"nz-option",50),d(1,"i",51),c(2),d(3,"br"),c(4),o()),a&2){let r=s.$implicit;m("nzLabel",r.name)("nzValue",r.id),l(2),I(" ",r.name," "),l(2),I(" ",r.description,"")}}function Mn(a,s){if(a&1&&(i(0,"nz-option",50),d(1,"i",51),c(2),d(3,"br"),c(4),o()),a&2){let r=s.$implicit;m("nzLabel",r.name)("nzValue",r.id),l(2),I(" ",r.name," "),l(2),I(" ",r.description,"")}}function On(a,s){if(a&1){let r=x();i(0,"form",27),v("ngSubmit",function(){h(r);let t=u();return f(t.createProgram())}),i(1,"nz-form-item")(2,"nz-form-label"),c(3,"Divisi\xF3n"),o(),i(4,"nz-form-control")(5,"nz-select",28),v("ngModelChange",function(t){h(r);let n=u();return f(n.onVendorSelected(t,"vendorName"))}),_(6,Dn,5,4,"nz-option",29),o()()(),i(7,"div",30)(8,"div",31)(9,"nz-form-item")(10,"nz-form-label"),c(11,"Tipo de asignaci\xF3n"),o(),i(12,"nz-form-control")(13,"nz-select",32),d(14,"nz-option",33),o()()()(),i(15,"div",31)(16,"nz-form-item")(17,"nz-form-label"),c(18,"Operaci\xF3n"),o(),i(19,"nz-form-control")(20,"nz-select",34),v("ngModelChange",function(t){h(r);let n=u();return f(n.onRouteSelected(t))}),_(21,Ln,5,4,"nz-option",29),o()()()()(),i(22,"div",30)(23,"div",31)(24,"nz-form-item")(25,"nz-form-label"),c(26,"Turno"),o(),i(27,"nz-form-control")(28,"nz-select",35),d(29,"nz-option",36)(30,"nz-option",37)(31,"nz-option",38),o()()()(),i(32,"div",31)(33,"nz-form-item")(34,"nz-form-label"),c(35,"Tarea"),o(),i(36,"nz-form-control")(37,"nz-select",39),d(38,"nz-option",40)(39,"nz-option",41),o()()()()(),i(40,"div",30)(41,"div",42)(42,"nz-form-item")(43,"nz-form-label"),c(44,"Hora Compromiso"),o(),i(45,"nz-form-control"),d(46,"nz-time-picker",43),o()()(),i(47,"div",42)(48,"nz-form-item")(49,"nz-form-label"),c(50,"Hora Inicio"),o(),i(51,"nz-form-control"),d(52,"nz-time-picker",44),o()()(),i(53,"div",42)(54,"nz-form-item")(55,"nz-form-label"),c(56,"Hora fin"),o(),i(57,"nz-form-control"),d(58,"nz-time-picker",45),o()()()(),i(59,"nz-form-item")(60,"nz-form-label",46),c(61,"D\xEDas"),o(),i(62,"nz-form-control")(63,"nz-tag",47),v("nzCheckedChange",function(t){h(r);let n=u();return f(n.checkChange("isSunday",t))}),c(64,"Dom"),o(),i(65,"nz-tag",47),v("nzCheckedChange",function(t){h(r);let n=u();return f(n.checkChange("isMonday",t))}),c(66,"Lun"),o(),i(67,"nz-tag",47),v("nzCheckedChange",function(t){h(r);let n=u();return f(n.checkChange("isTuesday",t))}),c(68,"Mar"),o(),i(69,"nz-tag",47),v("nzCheckedChange",function(t){h(r);let n=u();return f(n.checkChange("isWednesday",t))}),c(70,"Mi\xE9"),o(),i(71,"nz-tag",47),v("nzCheckedChange",function(t){h(r);let n=u();return f(n.checkChange("isThursday",t))}),c(72,"Jue"),o(),i(73,"nz-tag",47),v("nzCheckedChange",function(t){h(r);let n=u();return f(n.checkChange("isFriday",t))}),c(74,"Vie"),o(),i(75,"nz-tag",47),v("nzCheckedChange",function(t){h(r);let n=u();return f(n.checkChange("isSaturday",t))}),c(76,"S\xE1b"),o()()(),i(77,"div",30)(78,"div",31)(79,"nz-form-item")(80,"nz-form-label"),c(81,"Inicia en"),o(),i(82,"nz-form-control")(83,"nz-select",48),v("ngModelChange",function(t){h(r);let n=u();return f(n.onStopPointSelected(t,"stopBeginName","stopBeginHourT"))}),_(84,An,5,4,"nz-option",29),o()()()(),i(85,"div",31)(86,"nz-form-item")(87,"nz-form-label"),c(88,"Termina en"),o(),i(89,"nz-form-control")(90,"nz-select",49),v("ngModelChange",function(t){h(r);let n=u();return f(n.onStopPointSelected(t,"stopEndName","stopEndHourT"))}),_(91,Mn,5,4,"nz-option",29),o()()()()()()}if(a&2){let r=u();m("formGroup",r.programForm),l(6),m("ngForOf",r.vendorsList),l(15),m("ngForOf",r.routesList),l(42),m("nzChecked",r.programForm.controls.isSunday.value),l(2),m("nzChecked",r.programForm.controls.isMonday.value),l(2),m("nzChecked",r.programForm.controls.isTuesday.value),l(2),m("nzChecked",r.programForm.controls.isWednesday.value),l(2),m("nzChecked",r.programForm.controls.isThursday.value),l(2),m("nzChecked",r.programForm.controls.isFriday.value),l(2),m("nzChecked",r.programForm.controls.isSaturday.value),l(9),m("ngForOf",r.stopPointsList),l(7),m("ngForOf",r.stopPointsList)}}var wi=(()=>{let s=class s{constructor(e,t,n){this.notification=e,this.messageService=t,this.fb=n,this.rolService=y(oe),this.authService=y(X),this.vendorsService=y(xt),this.routesService=y(bt),this.loading=!0,this.pageSize=10,this.stopSubscription$=new le,this.programsList=[],this.routesList=[],this.stopPointsList=[],this.vendorsList=[],this.isCreateVisible=!1,this.isEditMode=!1,this.infoLoad=[],this.authService.user.subscribe(p=>{this.user=p,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(z=>{this.infoLoad=z,this.userlevelAccess=this.infoLoad.optionAccessLavel})}),this.createForm()}ngOnInit(){this.getSubscriptions()}ngOnDestroy(){this.stopSubscription$.next(void 0),this.stopSubscription$.complete()}getSubscriptions(){this.routesService.getRoutes(this.accountId).pipe(A(this.stopSubscription$),F(e=>e.map(t=>{let n=t.payload.doc.id,p=t.payload.doc.data();return E({id:n},p)}))).subscribe(e=>{this.routesList=e,this.loading=!1}),this.routesService.getCustomerVendorAssignments(this.accountId).pipe(A(this.stopSubscription$),F(e=>e.map(t=>{let n=t.payload.doc.id,p=t.payload.doc.data();return fe(E({},p),{id:n})}))).subscribe(e=>{this.programsList=e,this.loading=!1}),this.vendorsService.getVendors().pipe(A(this.stopSubscription$),F(e=>e.map(t=>{let n=t.payload.doc.id,p=t.payload.doc.data();return fe(E({},p),{id:n})}))).subscribe(e=>{this.vendorsList=e,this.loading=!1})}getRouteName(e){let t="";if(this.routesList.length>0){let n=Nt.filter(this.routesList,p=>p.id==e);n.length>0&&(t=n[0].name)}return t}createForm(){this.programForm=this.fb.group({active:[!1,[g.required]],acRequired:[!1,[g.required]],isSunday:[!1,[g.required]],isMonday:[!0,[g.required]],isTuesday:[!0,[g.required]],isWednesday:[!0,[g.required]],isThursday:[!0,[g.required]],isFriday:[!0,[g.required]],isSaturday:[!1,[g.required]],program:["",[g.required]],round:["",[g.required]],stopBeginId:["",[g.required]],stopBeginName:["",[g.required]],stopBeginHour:["",[g.required]],stopBeginHourT:[""],stopEndId:["",[g.required]],stopEndName:["",[g.required]],stopEndHour:["",[g.required]],stopEndHourT:[""],time:[new Date,[g.required]],type:[this.assigmentType,[g.required]],customerName:["",[g.required]],customerId:[this.accountId,[g.required]],vendorName:["",[g.required]],vendorId:["",[g.required]],routeId:["",[g.required]]})}patchForm(e){let t=e.stopBeginHour.split(":"),n=e.stopEndHour.split(":");this.programForm.patchValue({active:e.active,acRequired:e.acRequired,isSunday:e.isSunday,isMonday:e.isMonday,isTuesday:e.isTuesday,isWednesday:e.isWednesday,isThursday:e.isThursday,isFriday:e.isFriday,isSaturday:e.isSaturday,program:e.program,round:e.round,stopBeginId:e.stopBeginId,stopBeginName:e.stopBeginName,stopBeginHour:e.stopBeginHour,stopBeginHourT:e.stopBeginHour,stopEndId:e.stopEndId,stopEndName:e.stopEndName,stopEndHour:e.stopEndHour,stopEndHourT:e.stopEndHour,time:e.time,type:e.type,customerName:e.customerName,customerId:this.accountId,vendorName:e.vendorName,vendorId:e.vendorId,routeId:e.routeId})}toggleActive(e){this.routesService.toggleRouteAssignment(this.accountId,e.routeId,e.id,e).then(()=>{this.isCreateVisible=!1,this.isEditMode=!1}).catch(t=>console.log(t))}showCreateModal(){this.programForm.reset(),this.isCreateVisible=!0,this.currentSelectedId="",this.currentSelected=null}sendMessage(e,t){this.messageService.create(e,t)}showModalDelete(e){this.userlevelAccess=="1"?this.routesService.deleteRouteAssignments(this.accountId,e.routeId,e.id).then(()=>{this.isCreateVisible=!1,this.isEditMode=!1}).catch(t=>console.log(t)):this.sendMessage("error","El usuario no tiene permisos para borrar datos, favor de contactar al administrador.")}showModalEdit(e){this.currentSelectedId=e.id,this.currentSelected=e,this.patchForm(e),setTimeout(()=>{this.isCreateVisible=!0},100),this.isEditMode=!0}handleCancel(){this.isCreateVisible=!1,this.isEditMode=!1,this.currentSelectedId=""}createProgram(){this.programForm!==null&&this.programForm!==void 0&&this.programForm.get("customerId").setValue(this.accountId);let e=new Date(this.programForm.controls.stopBeginHourT.value),t=new Date(this.programForm.controls.stopEndHourT.value),n=[e.getHours(),String(e.getMinutes()).padStart(2,"0")].join(":"),p=[t.getHours(),String(t.getMinutes()).padStart(2,"0")].join(":");this.programForm.controls.stopBeginHour.setValue(n),this.programForm.controls.stopEndHour.setValue(p);let z=this.programForm.get("stopBeginHour"),S=this.programForm.get("stopEndHour");if(z==""||S==""){this.notification.create("error","Problema con la informaci\xF3n","No est\xE1n definidos los tiempos entre estaci\xF3n de esta operaci\xF3n para el turno seleccionado");return}if(this.isEditMode)if(this.userlevelAccess!="3"){let C=this.programForm.get("routeId");if(C){this.routesService.updateRouteAssignment(this.accountId,C,this.currentSelectedId,this.programForm.value).then(()=>{this.isCreateVisible=!1,this.isEditMode=!1,this.currentSelectedId=""}).catch(T=>console.log(T));return}}else{this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.");return}else if(this.userlevelAccess!="3"){let C=this.programForm.get("routeId");if(C){this.routesService.setRouteAssignments(this.accountId,C.value,this.programForm.value).then(()=>{this.isCreateVisible=!1,this.isEditMode=!1}).catch(T=>console.log(T));return}}else{this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.");return}}checkChange(e,t){this.programForm.controls[e].setValue(t)}onRouteSelected(e){this.routesService.getRouteStopPoints(this.accountId,e).pipe(A(this.stopSubscription$),F(t=>t.map(n=>{let p=n.payload.doc.id,z=n.payload.doc.data();return fe(E({},z),{id:p})}))).subscribe(t=>{this.stopPointsList=t,this.loading=!1})}onStopPointSelected(e,t,n){let p=this.programForm.controls.time.value,z=this.programForm.controls.program.value,S=t,C="";if(z=="M"?S=="stopBeginName"?C="stopBeginHourT":C="stopEndHourT":S=="stopEndName"?C="stopBeginHourT":C="stopEndHourT",e){let ae=Nt.filter(this.stopPointsList,D=>D.id==e)[0],qt=this.programForm.controls.round.value;switch(this.programForm.controls[t].setValue(ae.name),qt){case"D\xEDa":this.programForm.controls[C].setValue(at(p,ae.round1MinutesSinceStart));break;case"Tarde":this.programForm.controls[C].setValue(at(p,ae.round2MinutesSinceStart));break;case"Noche":this.programForm.controls[C].setValue(at(p,ae.round3MinutesSinceStart));break;default:this.programForm.controls[C].setValue(at(p,ae.round1MinutesSinceStart));break}}}onVendorSelected(e,t){if(e){let p=Nt.filter(this.vendorsList,z=>z.id==e)[0];this.programForm.controls[t].setValue(p.name)}}};s.\u0275fac=function(t){return new(t||s)(b(ri),b(P),b(O))},s.\u0275cmp=k({type:s,selectors:[["app-shared-customer-vendor-assignments"]],inputs:{accountId:"accountId"},decls:9,vars:4,consts:[["modalContentAdd",""],["programsListTable",""],["menu","nzDropdownMenu"],[1,"site-page-header-ghost-wrapper"],[2,"background-color","#f9fbfd",3,"nzGhost"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["nzShowSizeChanger","",3,"nzData","nzLoading","nzPageSize","nzPageSizeChange",4,"ngIf"],["nzTitle","Agregar asignaci\xF3n","nzWidth","600","nzOkText","Generar",3,"nzOnCancel","nzOnOk","nzVisible","nzContent"],["nzShowSizeChanger","",3,"nzPageSizeChange","nzData","nzLoading","nzPageSize"],[4,"ngFor","ngForOf"],[3,"nzColor"],[3,"nzColor",4,"ngIf"],["nz-icon","","nzType","deployment-unit",4,"ngIf"],["nzColor","green"],["nzColor","orange"],["nz-dropdown","","nzPlacement","bottomRight",3,"nzDropdownMenu"],["nz-icon","","nzType","ellipsis","nzTooltipTitle","M\xE1s informaci\xF3n","nzTooltipPlacement","topLeft","nz-tooltip",""],["nz-menu",""],["nz-menu-item","",3,"click",4,"ngIf"],["nz-menu-item","",3,"click"],["nz-icon","","nzType","edit"],["nz-menu-divider",""],["nz-menu-item","","nz-popconfirm","","nzPopconfirmTitle","\xBFEst\xE1s seguro de eliminar esta asignaci\xF3n?","nzPopconfirmPlacement","topRight",3,"nzOnConfirm","nzOnCancel"],["nz-icon","","nzTheme","twotone","nzTwotoneColor","#de4436","nzType","delete"],["nz-icon","","nzType","deployment-unit"],["nz-icon","","nzType","check-circle"],["nz-icon","","nzType","pause-circle"],["nz-form","",3,"ngSubmit","formGroup"],["formControlName","vendorId","nzAllowClear","","nzPlaceHolder","Selecciona la estaci\xF3n",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],[1,"row"],[1,"col-md-6","col-sm-12"],["formControlName","type"],["nzValue","Permanente","nzLabel","Permanente"],["formControlName","routeId",3,"ngModelChange"],["formControlName","round"],["nzValue","D\xEDa","nzLabel","D\xEDa"],["nzValue","Tarde","nzLabel","Tarde"],["nzValue","Noche","nzLabel","Noche"],["formControlName","program"],["nzValue","M","nzLabel","Mete"],["nzValue","S","nzLabel","Saca"],[1,"col-md-4","col-sm-12"],["name","time","formControlName","time","nzFormat","HH:mm"],["name","stopBeginHourT","formControlName","stopBeginHourT","nzFormat","HH:mm"],["name","stopEndHourT","formControlName","stopEndHourT","nzFormat","HH:mm"],["nzFor","days"],["nzMode","checkable",3,"nzCheckedChange","nzChecked"],["formControlName","stopBeginId","nzAllowClear","","nzPlaceHolder","Selecciona la estaci\xF3n",3,"ngModelChange"],["formControlName","stopEndId","nzAllowClear","","nzPlaceHolder","Selecciona la estaci\xF3n",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon","","nzType","flag"]],template:function(t,n){if(t&1){let p=x();i(0,"div",3)(1,"nz-page-header",4)(2,"nz-page-header-extra")(3,"button",5),v("click",function(){return h(p),f(n.showCreateModal())}),c(4,"Agregar asignaci\xF3n"),o()()()(),_(5,Pn,27,4,"nz-table",6),i(6,"nz-modal",7),v("nzOnCancel",function(){return h(p),f(n.handleCancel())})("nzOnOk",function(){return h(p),f(n.createProgram())}),o(),_(7,On,92,12,"ng-template",null,0,V)}if(t&2){let p=w(8);l(),m("nzGhost",!1),l(4),m("ngIf",n.routesList.length>0),l(),m("nzVisible",n.isCreateVisible)("nzContent",p)}},dependencies:[L,B,de,Y,J,K,Q,ee,Z,Je,We,Ge,Qe,Xe,Ye,xe,be,Ce,je,ye,Ee,we,ve,ne,te,ie,ue,Te,Ke,ze,he,$,M,H,W,G,zi,hi,zt]});let a=s;return a})();var Ti=(()=>{let s=class s{constructor(e,t){this.afs=e,this.messageService=t,this.promotion=this.afs.collection("customer")}getPromotionsList(e){return this.afs.collection("customers").doc(e).collection("promotions",n=>n.orderBy("date_created","asc")).snapshotChanges()}savePromotion(e,t){let n=this.afs.createId(),p=this.afs.collection("customers").doc(t).collection("promotions").doc(n),z=this.afs.firestore.batch();return z.set(p.ref,e),z.commit()}editPromotion(e,t,n,p,z,S){return this.afs.collection("customers").doc(t).collection("promotions").doc(e).update({name:n,description:p,validFrom:z,validTo:z}).then(()=>{this.sendMessage("success","\xA1Listo! la promoci\xF3n fue actualizada")}).catch(T=>{this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal ... ${T}`)})}deactivePromotion(e,t,n){return this.afs.collection("customers").doc(n).collection("promotions").doc(e).update({active:t}).then(()=>{this.sendMessage("success","\xA1Listo! la promoci\xF3n fue desactivada")}).catch(z=>{this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal ... ${z}`)})}deletePromotion(e,t){this.afs.collection("customers").doc(e).collection("promotions").doc(t).delete().then(()=>this.sendMessage("success","La Promocion a sido eliminada.")).catch(p=>this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal ... ${p}`))}sendMessage(e,t){this.messageService.create(e,t)}};s.\u0275fac=function(t){return new(t||s)(ke(me),ke(P))},s.\u0275prov=Me({token:s,factory:s.\u0275fac,providedIn:"root"});let a=s;return a})();var Un=()=>({width:"100%"});function jn(a,s){a&1&&(i(0,"nz-tag",20),c(1,"Activo"),o()),a&2&&m("nzColor","cyan")}function Bn(a,s){a&1&&(i(0,"nz-tag",20),c(1,"Suspendido"),o()),a&2&&m("nzColor","red")}function Hn(a,s){if(a&1){let r=x();i(0,"li",27),v("click",function(){h(r);let t=u().$implicit,n=u(2);return f(n.diactivePromotion(!1,t.id))}),c(1,"Suspender Promoci\xF3n "),o()}}function $n(a,s){if(a&1){let r=x();i(0,"li",27),v("click",function(){h(r);let t=u().$implicit,n=u(2);return f(n.diactivePromotion(!0,t.id))}),c(1,"Reactivar Promoci\xF3n "),o()}}function Wn(a,s){if(a&1){let r=x();i(0,"tr",18),v("click",function(){let t=h(r).$implicit,n=u(2);return f(n.promotionSelected(t))}),i(1,"td"),_(2,jn,2,1,"nz-tag",19)(3,Bn,2,1,"nz-tag",19),o(),i(4,"td")(5,"nz-tag",20),c(6),o()(),i(7,"td")(8,"nz-tag",20),c(9),o()(),i(10,"td")(11,"span",21),c(12),Re(13,"date"),o()(),i(14,"td")(15,"span",21),c(16),Re(17,"date"),o()(),i(18,"td")(19,"span",21),c(20),Re(21,"date"),o()(),i(22,"td")(23,"a",22),c(24,"Ver Imagen"),o()(),i(25,"td")(26,"a",23),d(27,"i",24),o(),i(28,"nz-dropdown-menu",null,4)(30,"ul",25),_(31,Hn,2,0,"li",26)(32,$n,2,0,"li",26),i(33,"li",27),v("click",function(){let t=h(r).$implicit,n=u(2);return f(n.editPromotion(t.id,t.name,t.description,t.validFrom.toDate(),t.validTo.toDate()))}),c(34,"Editar Promoci\xF3n"),o(),i(35,"li",27),v("click",function(){let t=h(r).$implicit,n=u(2);return f(n.deletePromotiom(t.id))}),c(36,"Borrar Promoci\xF3m"),o()()()()()}if(a&2){let r=s.$implicit,e=w(29);l(2),m("ngIf",r.active),l(),m("ngIf",!r.active),l(2),m("nzColor","blue"),l(),N(r.name),l(2),m("nzColor","blue"),l(),N(r.description),l(3),I(" ",r.validFrom?qe(13,13,r.validFrom.toDate(),"mediumDate"):""," "),l(4),I(" ",r.validTo?qe(17,16,r.validTo.toDate(),"mediumDate"):""," "),l(4),I(" ",r.date_created?qe(21,19,r.date_created.toDate(),"mediumDate"):""," "),l(3),De("href",r.imageUrl,Pe),l(3),m("nzDropdownMenu",e),l(5),m("ngIf",r.active),l(),m("ngIf",!r.active)}}function Gn(a,s){if(a&1&&(i(0,"nz-table",16,3)(2,"thead")(3,"tr")(4,"th"),c(5,"Activo"),o(),i(6,"th"),c(7,"Nombre"),o(),i(8,"th"),c(9,"Descripci\xF3n"),o(),i(10,"th"),c(11,"Desde "),o(),i(12,"th"),c(13,"Hasta"),o(),i(14,"th"),c(15,"Fecha Creaci\xF3n"),o(),i(16,"th"),c(17,"Imagen"),o(),d(18,"th"),o()(),i(19,"tbody"),_(20,Wn,37,22,"tr",17),o()()),a&2){let r=w(1),e=u();m("nzData",e.promotionsList)("nzPageSize",e.pageSize3)("nzLoading",e.loadingLatestPurchases)("nzLoadingDelay",500),l(20),m("ngForOf",r.data)}}function Xn(a,s){if(a&1&&d(0,"img",41),a&2){let r=u(2);m("src",r.previewImage,Pe)("ngStyle",Le(2,Un))}}function Jn(a,s){if(a&1){let r=x();i(0,"form",28),v("ngSubmit",function(){h(r);let t=u();return f(t.createPromotion())}),i(1,"div",29)(2,"div",30)(3,"nz-form-item")(4,"nz-form-label"),c(5,"Nombre"),o(),i(6,"nz-form-control"),d(7,"input",31),o()()(),i(8,"div",30)(9,"nz-form-item")(10,"nz-form-label"),c(11,"Descripci\xF3n"),o(),i(12,"nz-form-control"),d(13,"input",32),o()()(),i(14,"div",33)(15,"nz-form-item")(16,"nz-form-label"),c(17,"Fecha Inicio"),o(),i(18,"nz-form-control"),d(19,"nz-date-picker",34),o()()(),i(20,"div",33)(21,"nz-form-item")(22,"nz-form-label"),c(23,"Fecha Fin"),o(),i(24,"nz-form-control"),d(25,"nz-date-picker",35),o()()(),i(26,"div",33)(27,"nz-form-item")(28,"nz-form-label"),c(29,"Fecha de Creaci\xF3n"),o(),i(30,"nz-form-control"),d(31,"nz-date-picker",36),o()()(),i(32,"div",30)(33,"nz-form-item")(34,"nz-form-label"),c(35,"Adjuntar Promoci\xF3n"),o(),i(36,"nz-form-control")(37,"nz-upload",37),j("nzFileListChange",function(t){h(r);let n=u();return U(n.fileList,t)||(n.fileList=t),f(t)}),v("nzChange",function(t){h(r);let n=u();return f(n.handleChange2(t))}),d(38,"i",38),i(39,"div",39),c(40,"Cargar"),o()(),i(41,"nz-modal",40),v("nzOnCancel",function(){h(r);let t=u();return f(t.previewVisible=!1)}),o()(),_(42,Xn,1,3,"ng-template",null,1,V),o()()()()}if(a&2){let r=w(43),e=u();m("formGroup",e.programForm),l(37),q("nzFileList",e.fileList),m("nzShowButton",!0)("nzShowUploadList",e.showUploadList)("nzPreview",e.handlePreview),l(4),m("nzVisible",e.previewVisible)("nzContent",r)("nzFooter",null)}}function Yn(a,s){if(a&1){let r=x();i(0,"form",28),v("ngSubmit",function(){h(r);let t=u();return f(t.editSavePromotion())}),i(1,"div",29)(2,"div",30)(3,"nz-form-item")(4,"nz-form-label"),c(5,"Nombre"),o(),i(6,"nz-form-control"),d(7,"input",31),o()()(),i(8,"div",30)(9,"nz-form-item")(10,"nz-form-label"),c(11,"Descripci\xF3n"),o(),i(12,"nz-form-control"),d(13,"input",32),o()()(),i(14,"div",33)(15,"nz-form-item")(16,"nz-form-label"),c(17,"Fecha Inicio"),o(),i(18,"nz-form-control"),d(19,"nz-date-picker",34),o()()(),i(20,"div",33)(21,"nz-form-item")(22,"nz-form-label"),c(23,"Fecha Fin"),o(),i(24,"nz-form-control"),d(25,"nz-date-picker",35),o()()()()()}if(a&2){let r=u();m("formGroup",r.programEditForm)}}var Vi=(()=>{let s=class s{constructor(e,t,n){this.bucketStorage=e,this.messageService=t,this.fb=n,this.accountId="",this.pageSize3=3,this.loadingLatestPurchases=!1,this.rolService=y(oe),this.promotionsService=y(Ti),this.authService=y(X),this.view="cardView",this.infoLoad=[],this.isCreateVisible=!1,this.isEditMode=!1,this.fileListInfo=[],this.fileUrl="http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg",this.autosave=!0,this.uploading=!1,this.bucketPath="promotions/",this.uploadvalue=0,this.pageSize=10,this.usersList=[],this.rowGroupPanelShow=[],this.promotionsList=[],this.promotionsListLoaded=[],this.showUploadList={showPreviewIcon:!0,showRemoveIcon:!0,hidePreviewIconInNonImage:!0},this.previewImage="",this.previewVisible=!1,this.isEditVisible=!1,this.handlePreview=p=>{this.previewImage=p.url||p.thumbUrl,this.previewVisible=!0},this.authService.user.subscribe(p=>{this.user=p,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(z=>{this.infoLoad=z,this.userlevelAccess=this.infoLoad.optionAccessLavel})}),this.programEditForm=this.fb.group({imageUrl:[""],active:[""],uid:[""],name:["",[g.required]],description:["",[g.required]],category:[],validFrom:[new Date],validTo:[new Date],date_created:[]}),this.createForm()}editPromotion(e,t,n,p,z){this.programEditForm.controls.uid.setValue(e),this.programEditForm.controls.name.setValue(t),this.programEditForm.controls.description.setValue(n),this.programEditForm.controls.validFrom.setValue(p),this.programEditForm.controls.validTo.setValue(z),this.isEditVisible=!0}deletePromotiom(e){this.promotionsService.deletePromotion(this.accountId,e)}diactivePromotion(e,t){this.promotionsService.deactivePromotion(t,e,this.accountId)}promotionSelected(e){}createForm(){this.programForm=this.fb.group({imageUrl:[""],active:[""],name:["",[g.required]],description:["",[g.required]],category:[],validFrom:[],validTo:[],date_created:[]})}toggleActive(){}ngOnInit(){this.sub=this.promotionsService.getPromotionsList(this.accountId).pipe(F(e=>e.map(t=>{let n=t.payload.doc.id,p=t.payload.doc.data();return E({id:n},p)}))).subscribe(e=>{this.promotionsList=e,this.promotionsListLoaded=e})}showCreateModal(){this.programForm.reset(),this.isCreateVisible=!0,this.currentSelectedId="",this.currentSelected=null}showModalDelete(e){}sendMessage(e,t){this.messageService.create(e,t)}handleCancel(){this.isCreateVisible=!1,this.isEditMode=!1,this.currentSelectedId="",this.isEditVisible=!1}createPromotion(){if(this.programForm.valid){var e;e={active:!0,name:this.programForm.controls.name.value,description:this.programForm.controls.description.value,validFrom:this.programForm.controls.validFrom.value,validTo:this.programForm.controls.validTo.value,imageUrl:this.programForm.controls.imageUrl.value||"",customerId:this.user.customerId,category:"",date_created:this.programForm.controls.date_created.value},this.userlevelAccess!="3"?this.promotionsService.savePromotion(e,this.accountId).then(()=>{this.messageService.success("Se agreg\xF3 la promoci\xF3n con \xE9xito.",{nzPauseOnHover:!0,nzDuration:3e3}),this.isCreateVisible=!1}):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}}handleChange2(e){if(e.file.status!=="uploading"){let n=e.file.status;this.fileListInfo=e.fileList,e.file.originFileObj&&this.getBase64(e.file.originFileObj,p=>{this.fileUrl=p;let z=e.file.name,S=`${this.bucketPath}/${z}`,C=this.bucketStorage.ref(S);this.task=this.bucketStorage.ref(S).putString(p,"data_url"),this.uploadPercent=this.task.percentageChanges(),this.uploadPercent.pipe(F(T=>Number((T/100).toFixed(2)))).subscribe(T=>{this.uploading=T!=0,this.uploadvalue=T}),this.task.snapshotChanges().pipe(Ve(()=>{this.uploading=!1,this.downloadURL=C.getDownloadURL(),this.downloadURL.subscribe(T=>se(this,null,function*(){this.updateAdvanceURL(T),T.length>0?this.sendMessage("success",`${e.file.name} Archivo cargado satisfactoriamente.`):n==="error"&&this.sendMessage("error",`${e.file.name} archivo fallido, favor de validar.`)}))})).subscribe()})}}getBase64(e,t){let n=new FileReader;n.readAsDataURL(e),n.onload=()=>t(n.result),n.onerror=p=>console.log("Error: ",p)}updateAdvanceURL(e){return se(this,null,function*(){this.programForm.controls.imageUrl.patchValue(e)})}onGridReady(e){this.gridApi=e.api,this.gridColumnApi=e.columnApi}setPaginationPageSize(e=10){this.pageSize=e,this.gridApi.paginationSetPageSize(Number(e))}editSavePromotion(){console.log("save"),this.programEditForm.valid?(this.promotionsService.editPromotion(this.programEditForm.controls.uid.value,this.accountId,this.programEditForm.controls.name.value,this.programEditForm.controls.description.value,this.programEditForm.controls.validFrom.value,this.programEditForm.controls.validTo.value).then(()=>{this.messageService.success("Todo sali\xF3 bien.",{nzPauseOnHover:!0,nzDuration:3e3})}),this.isEditVisible=!1):this.sendMessage("error","Datos invalidos favor de validar")}getItems(e){let t=e;if(!t){this.promotionsList=this.promotionsListLoaded.slice();return}let n=t.toLowerCase();this.promotionsList=this.promotionsListLoaded.filter(p=>Object.values(p).some(z=>String(z).toLowerCase().includes(n)))}};s.\u0275fac=function(t){return new(t||s)(b(Ze),b(P),b(O))},s.\u0275cmp=k({type:s,selectors:[["app-promotions"]],inputs:{accountId:"accountId"},decls:25,vars:6,consts:[["searchBar",""],["modalContent",""],["modalContentEdit",""],["basicTable",""],["chatSetting","nzDropdownMenu"],[1,"site-page-header",2,"background-color","#f9fbfd"],[1,"site-page-header-ghost-wrapper"],[3,"nzGhost"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["nz-row",""],[1,"content"],["nz-icon","","nzTheme","outline",1,"search-icon"],["placeholder","Buscar",3,"keyup"],[3,"nzData","nzPageSize","nzLoading","nzLoadingDelay",4,"ngIf"],["nzTitle","Agregar Promoci\xF3n",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible","nzContent"],["nzTitle","Editar Promoci\xF3n",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible","nzContent"],[3,"nzData","nzPageSize","nzLoading","nzLoadingDelay"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[3,"nzColor",4,"ngIf"],[3,"nzColor"],["nz-text","","nzType","secondary"],["target","_blank",3,"href"],["nz-dropdown","",3,"nzDropdownMenu"],["nz-icon","","nzType","more","nzTheme","outline"],["nz-menu",""],["nz-menu-item","",3,"click",4,"ngIf"],["nz-menu-item","",3,"click"],["nz-form","","nzLayout","vertical",3,"ngSubmit","formGroup"],[1,"row"],[1,"col-md-12","col-sm-12"],["nz-input","","formControlName","name","id","descriptioA"],["nz-input","","formControlName","description","id","descriptioA"],[1,"col-md-7","col-sm-12"],["formControlName","validFrom"],["formControlName","validTo"],["formControlName","date_created"],["zAction","/api/posts/","nzListType","picture-card",3,"nzFileListChange","nzChange","nzFileList","nzShowButton","nzShowUploadList","nzPreview"],["nz-icon",""],[1,"ant-upload-text"],[3,"nzOnCancel","nzVisible","nzContent","nzFooter"],[3,"src","ngStyle"]],template:function(t,n){if(t&1){let p=x();i(0,"nz-page-header",5)(1,"nz-page-header-title"),c(2,"Promociones"),o(),i(3,"nz-page-header-subtitle"),c(4,"Promociones de esta empresa"),o(),i(5,"nz-page-header-extra")(6,"div",6)(7,"nz-page-header",7)(8,"nz-page-header-extra")(9,"button",8),v("click",function(){return h(p),f(n.showCreateModal())}),c(10,"Agregar Promocion"),o()()()()(),i(11,"nz-page-header-content")(12,"div",9)(13,"div",10),d(14,"i",11),i(15,"input",12,0),v("keyup",function(){h(p);let S=w(16);return f(n.getItems(S.value))}),o()()()()(),d(17,"br"),_(18,Gn,21,5,"nz-table",13),i(19,"nz-modal",14),j("nzVisibleChange",function(S){return h(p),U(n.isCreateVisible,S)||(n.isCreateVisible=S),f(S)}),v("nzOnCancel",function(){return h(p),f(n.handleCancel())})("nzOnOk",function(){return h(p),f(n.createPromotion())}),o(),_(20,Jn,44,8,"ng-template",null,1,V),i(22,"nz-modal",15),j("nzVisibleChange",function(S){return h(p),U(n.isEditVisible,S)||(n.isEditVisible=S),f(S)}),v("nzOnCancel",function(){return h(p),f(n.handleCancel())})("nzOnOk",function(){return h(p),f(n.editSavePromotion())}),o(),_(23,Yn,26,1,"ng-template",null,2,V)}if(t&2){let p=w(21),z=w(24);l(7),m("nzGhost",!1),l(11),m("ngIf",n.promotionsList),l(),q("nzVisible",n.isCreateVisible),m("nzContent",p),l(3),q("nzVisible",n.isEditVisible),m("nzContent",z)}},dependencies:[L,B,_e,de,Y,J,K,Q,ee,Z,pe,yt,Je,We,Ge,Qe,Xe,Ye,xe,et,be,Ce,ye,Ee,we,ne,te,ie,ue,He,$e,vt,Te,Ke,$,ce,M,H,W,G,zt]});let a=s;return a})();var Ni=()=>({width:"100%"});function Zn(a,s){a&1&&d(0,"span",27)}function eo(a,s){if(a&1&&d(0,"img",61),a&2){let r=u(2);m("src",r.previewImage,Pe)("ngStyle",Le(2,Ni))}}function to(a,s){a&1&&(i(0,"div",62),c(1," El precio es requerido. "),o())}function io(a,s){a&1&&(i(0,"div",62),c(1," El precio debe ser mayor a 0. "),o())}function no(a,s){if(a&1&&(i(0,"div",62),_(1,to,2,0,"div",55)(2,io,2,0,"div",55),o()),a&2){let r=u(2);l(),m("ngIf",r.isPriceRequired()),l(),m("ngIf",r.isPriceMin())}}function oo(a,s){if(a&1){let r=x();i(0,"form",28),v("ngSubmit",function(){h(r);let t=u();return f(t.submitForm("A"))}),i(1,"div",12)(2,"div",29)(3,"nz-form-item")(4,"nz-form-label",30),c(5,"Nombre"),o(),i(6,"nz-form-control"),d(7,"input",31),o()()(),i(8,"div",32)(9,"nz-form-item")(10,"nz-form-label"),c(11,"Activo"),o(),i(12,"nz-form-control"),d(13,"nz-switch",33),o()()()(),i(14,"div",12)(15,"div",29)(16,"nz-form-item")(17,"nz-form-label"),c(18,"Descripci\xF3n"),o(),i(19,"nz-form-control"),d(20,"textarea",34),o()()(),i(21,"div",32)(22,"nz-form-item")(23,"nz-form-label"),c(24,"Adjuntar Imagen"),o(),i(25,"nz-form-control")(26,"nz-upload",35),j("nzFileListChange",function(t){h(r);let n=u();return U(n.fileList,t)||(n.fileList=t),f(t)}),v("nzChange",function(t){h(r);let n=u();return f(n.handleChange(t))}),i(27,"div",36),c(28,"Cargar"),o()()(),_(29,eo,1,3,"ng-template",null,4,V),o()()(),i(31,"div",12)(32,"div",11)(33,"nz-form-item")(34,"nz-form-label"),c(35,"Categor\xEDa"),o(),i(36,"nz-form-control")(37,"nz-select",37),d(38,"nz-option",38)(39,"nz-option",39)(40,"nz-option",40)(41,"nz-option",41)(42,"nz-option",42)(43,"nz-option",43)(44,"nz-option",44)(45,"nz-option",45)(46,"nz-option",46)(47,"nz-option",47)(48,"nz-option",48),o()()()(),i(49,"div",11)(50,"nz-form-item")(51,"nz-form-label"),c(52,"Validez"),o(),i(53,"nz-form-control")(54,"nz-range-picker",49),v("nzOnCalendarChange",function(t){h(r);let n=u();return f(n.mapDateValues(t))}),o()()()()(),i(55,"div",12)(56,"div",50)(57,"nz-form-item")(58,"nz-form-label"),c(59,"Mete"),o(),i(60,"nz-form-control"),d(61,"nz-switch",51),o()()(),i(62,"div",50)(63,"nz-form-item")(64,"nz-form-label"),c(65,"Saca"),o(),i(66,"nz-form-control"),d(67,"nz-switch",52),o()()(),i(68,"div",53)(69,"nz-form-label"),c(70,"Precio"),o(),i(71,"nz-form-control"),d(72,"nz-input-number",54),_(73,no,3,2,"div",55),o()(),i(74,"div",50)(75,"nz-form-item")(76,"nz-form-label"),c(77,"Calculado"),o(),i(78,"nz-form-control"),d(79,"nz-switch",56),o()()(),i(80,"div",53)(81,"div")(82,"nz-form-label"),c(83,"Asientos"),o(),d(84,"nz-input-number",57),o()()(),i(85,"div",12)(86,"div",11)(87,"nz-form-item")(88,"nz-form-label"),c(89,"Frecuencias (Opcional)"),o(),i(90,"nz-select",58),d(91,"nz-option",59)(92,"nz-option",59)(93,"nz-option",59)(94,"nz-option",59)(95,"nz-option",59),o()()(),i(96,"div",11)(97,"nz-form-item")(98,"nz-form-label"),c(99,"Tipo de Producto (Opcional)"),o(),i(100,"nz-select",60),d(101,"nz-option",59)(102,"nz-option",59),o()()()()()}if(a&2){let r=u();m("formGroup",r.validateForm),l(26),q("nzFileList",r.fileList),m("nzShowButton",!0)("nzShowUploadList",r.showUploadList)("nzPreview",r.handlePreview),l(46),m("nzMin",0)("nzMax",12e4)("nzStep",1),l(),m("ngIf",r.isPriceInvalid()),l(11),m("nzMin",0)("nzMax",200)("nzStep",1),l(7),m("nzValue",1)("nzLabel",1),l(),m("nzValue",2)("nzLabel",2),l(),m("nzValue",3)("nzLabel",3),l(),m("nzValue",4)("nzLabel",4),l(),m("nzValue",5)("nzLabel",5),l(6),m("nzValue",r.camioneta)("nzLabel",r.camioneta),l(),m("nzValue",r.camion)("nzLabel",r.camion)}}function ro(a,s){if(a&1&&d(0,"img",61),a&2){let r=u(2);m("src",r.previewImage,Pe)("ngStyle",Le(2,Ni))}}function ao(a,s){a&1&&(i(0,"div",62),c(1," El precio es requerido. "),o())}function so(a,s){a&1&&(i(0,"div",62),c(1," El precio debe ser mayor a 0. "),o())}function lo(a,s){if(a&1&&(i(0,"div",62),_(1,ao,2,0,"div",55)(2,so,2,0,"div",55),o()),a&2){let r=u(2);l(),m("ngIf",r.isPriceRequired()),l(),m("ngIf",r.isPriceMin())}}function co(a,s){if(a&1){let r=x();i(0,"form",28),v("ngSubmit",function(){h(r);let t=u();return f(t.submitForm("A"))}),i(1,"div",12)(2,"div",29)(3,"nz-form-item")(4,"nz-form-label",30),c(5,"Nombre"),o(),i(6,"nz-form-control"),d(7,"input",63),o()()()(),i(8,"div",12)(9,"div",29)(10,"nz-form-item")(11,"nz-form-label"),c(12,"Descripci\xF3n"),o(),i(13,"nz-form-control"),d(14,"textarea",34),o()()(),i(15,"div",32)(16,"nz-form-item")(17,"nz-form-label"),c(18,"Adjuntar Imagen"),o(),i(19,"nz-form-control")(20,"nz-upload",64),j("nzFileListChange",function(t){h(r);let n=u();return U(n.fileListE,t)||(n.fileListE=t),f(t)}),v("nzChange",function(t){h(r);let n=u();return f(n.handleChange2(t))}),i(21,"div",36),c(22,"Cargar"),o()(),i(23,"nz-modal",65),v("nzOnCancel",function(){h(r);let t=u();return f(t.previewVisibleE=!1)}),o()(),_(24,ro,1,3,"ng-template",null,4,V),o()()(),i(26,"div",12)(27,"div",11)(28,"nz-form-item")(29,"nz-form-label"),c(30,"Categor\xEDa"),o(),i(31,"nz-form-control")(32,"nz-form-control")(33,"nz-select",66),d(34,"nz-option",38)(35,"nz-option",39)(36,"nz-option",40)(37,"nz-option",41)(38,"nz-option",42)(39,"nz-option",43)(40,"nz-option",44)(41,"nz-option",45)(42,"nz-option",46)(43,"nz-option",47)(44,"nz-option",48),o()()()()(),i(45,"div",11)(46,"nz-form-item")(47,"nz-form-label"),c(48,"Validez"),o(),i(49,"nz-form-control")(50,"nz-range-picker",67),v("nzOnCalendarChange",function(t){h(r);let n=u();return f(n.mapDateValues(t))}),o()()()()(),i(51,"div",12)(52,"div",50)(53,"nz-form-item")(54,"nz-form-label"),c(55,"Mete"),o(),d(56,"nz-switch",68),o()(),i(57,"div",50)(58,"nz-form-item")(59,"nz-form-label"),c(60,"Saca"),o(),d(61,"nz-switch",69),o()(),i(62,"div",53)(63,"nz-form-label"),c(64,"Precio"),o(),d(65,"nz-input-number",54),_(66,lo,3,2,"div",55),o(),i(67,"div",50)(68,"nz-form-item")(69,"nz-form-label"),c(70,"Calculado"),o(),d(71,"nz-switch",56),o()(),i(72,"div",53)(73,"div")(74,"nz-form-label"),c(75,"Asientos"),o(),d(76,"nz-input-number",57),o()()(),i(77,"div",12)(78,"div",11)(79,"nz-form-item")(80,"nz-form-label"),c(81,"Frecuencias (Opcional)"),o(),i(82,"nz-select",58),d(83,"nz-option",59)(84,"nz-option",59)(85,"nz-option",59)(86,"nz-option",59)(87,"nz-option",59),o()()(),i(88,"div",11)(89,"nz-form-item")(90,"nz-form-label"),c(91,"Tipo de Producto (Opcional)"),o(),i(92,"nz-select",60),d(93,"nz-option",59)(94,"nz-option",59),o()()()()()}if(a&2){let r=w(25),e=u();m("formGroup",e.validateFormE),l(20),q("nzFileList",e.fileListE),m("nzShowButton",!0)("nzShowUploadList",e.showUploadList)("nzPreview",e.handlePreviewE),l(3),m("nzVisible",e.previewVisibleE)("nzContent",r)("nzFooter",null),l(10),m("disabled",!0),l(17),m("disabled",!0),l(6),m("disabled",!0),l(5),m("disabled",!0),l(4),m("nzMin",0)("nzMax",12e4)("nzStep",1),l(),m("ngIf",e.isPriceInvalid()),l(10),m("nzMin",0)("nzMax",200)("nzStep",1),l(7),m("nzValue",1)("nzLabel",1),l(),m("nzValue",2)("nzLabel",2),l(),m("nzValue",3)("nzLabel",3),l(),m("nzValue",4)("nzLabel",4),l(),m("nzValue",5)("nzLabel",5),l(6),m("nzValue",e.camioneta)("nzLabel",e.camioneta),l(),m("nzValue",e.camion)("nzLabel",e.camion)}}function mo(a,s){if(a&1){let r=x();i(0,"li",77),v("click",function(){h(r);let t=u().$implicit,n=u(2);return f(n.toggleActivateProduct(t))}),i(1,"a"),d(2,"i",85),i(3,"span",79),c(4,"Detener venta"),o()()()}}function po(a,s){if(a&1){let r=x();i(0,"li",77),v("click",function(){h(r);let t=u().$implicit,n=u(2);return f(n.toggleActivateProduct(t))}),i(1,"a"),d(2,"i",86),i(3,"span",79),c(4,"Activar venta"),o()()()}}function uo(a,s){a&1&&(i(0,"nz-tag",83),c(1,"Venta Activa"),o()),a&2&&m("nzColor","green")}function zo(a,s){a&1&&(i(0,"nz-tag",83),c(1,"Venta Detenida"),o()),a&2&&m("nzColor","red")}function ho(a,s){if(a&1&&d(0,"img",87),a&2){let r=u().$implicit;De("src",r.imageUrl,Pe)}}function fo(a,s){if(a&1){let r=x();i(0,"div",53)(1,"nz-card",71),d(2,"nz-card-meta",72),i(3,"div")(4,"a",73),d(5,"i",74),o(),i(6,"nz-dropdown-menu",null,5)(8,"ul",75),_(9,mo,5,0,"li",76)(10,po,5,0,"li",76),i(11,"li",77),v("click",function(){let t=h(r).$implicit,n=u(2),p=w(25);return f(n.editProduct(t,p))}),i(12,"a"),d(13,"i",78),i(14,"span",79),c(15,"Editar"),o()()(),d(16,"li",80),i(17,"li",77),v("click",function(){let t=h(r).$implicit,n=u(2);return f(n.deleteProduct(t))}),i(18,"a"),d(19,"i",81),i(20,"span",79),c(21,"Eliminar "),o()()()()()(),i(22,"div",82)(23,"div")(24,"nz-tag",83),c(25),o(),_(26,uo,2,1,"nz-tag",84)(27,zo,2,1,"nz-tag",84),o()(),_(28,ho,1,1,"ng-template",null,6,V),o()()}if(a&2){let r=s.$implicit,e=w(7),t=w(29);l(),m("nzCover",t),l(),De("nzTitle",r.name),De("nzDescription",r.description),l(2),m("nzDropdownMenu",e),l(5),m("ngIf",r.active),l(),m("ngIf",!r.active),l(14),m("nzColor","blue"),l(),N(r.type),l(),m("ngIf",r.active),l(),m("ngIf",!r.active)}}function go(a,s){if(a&1&&(i(0,"div",12),_(1,fo,30,10,"div",70),o()),a&2){let r=u();l(),m("ngForOf",r.productsList)}}function _o(a,s){a&1&&(i(0,"nz-tag",83),c(1,"Activo"),o()),a&2&&m("nzColor","green")}function vo(a,s){if(a&1){let r=x();i(0,"li",77),v("click",function(){h(r);let t=u().$implicit,n=u(2);return f(n.toggleActivateProduct(t))}),i(1,"a"),d(2,"i",85),i(3,"span",79),c(4,"Detener venta"),o()()()}}function So(a,s){if(a&1){let r=x();i(0,"li",77),v("click",function(){h(r);let t=u().$implicit,n=u(2);return f(n.toggleActivateProduct(t))}),i(1,"a"),d(2,"i",86),i(3,"span",79),c(4,"Activar venta"),o()()()}}function Co(a,s){if(a&1){let r=x();i(0,"tr")(1,"td")(2,"div",91),d(3,"nz-avatar",92),i(4,"div",79)(5,"h5",93),c(6),o()()()(),i(7,"td"),c(8),o(),i(9,"td"),c(10),o(),i(11,"td")(12,"nz-tag",83),c(13),o()(),i(14,"td",89),_(15,_o,2,1,"nz-tag",84),o(),i(16,"td",94)(17,"div")(18,"a",73),d(19,"i",74),o(),i(20,"nz-dropdown-menu",null,8)(22,"ul",75),_(23,vo,5,0,"li",76)(24,So,5,0,"li",76),i(25,"li",95)(26,"a"),d(27,"i",78),i(28,"span",79),c(29,"Editar"),o()()(),d(30,"li",80),i(31,"li",77),v("click",function(){let t=h(r).$implicit,n=u(2);return f(n.deleteProduct(t))}),i(32,"a"),d(33,"i",81),i(34,"span",79),c(35,"Eliminar "),o()()()()()()()()}if(a&2){let r=s.$implicit,e=w(21);l(3),De("nzSrc",r.imageUrl),l(3),N(r.name),l(2),N(r.category),l(2),N(r.description),l(2),m("nzColor","blue"),l(),N(r.type),l(2),m("ngIf",r.active),l(3),m("nzDropdownMenu",e),l(5),m("ngIf",r.active),l(),m("ngIf",!r.active)}}function bo(a,s){if(a&1&&(i(0,"nz-card")(1,"nz-table",88,7)(3,"thead")(4,"tr")(5,"th"),c(6,"Nombre"),o(),i(7,"th"),c(8,"Categor\xEDa"),o(),i(9,"th"),c(10,"Descripci\xF3n"),o(),i(11,"th"),c(12,"Tipo"),o(),i(13,"th",89),c(14,"Status"),o(),d(15,"th"),o()(),i(16,"tbody"),_(17,Co,36,10,"tr",90),o()()()),a&2){let r=w(2),e=u();l(),m("nzData",e.productsList),l(16),m("ngForOf",r.data)}}var ki=(()=>{let s=class s{constructor(e,t,n,p,z,S){this.modal=e,this.bucketStorage=t,this.afs=n,this.modalService=p,this.messageService=z,this.fb=S,this.accountId="",this.rolService=y(oe),this.productsService=y(gi),this.usersService=y(gt),this.view="cardView",this.productsList=[],this.productsListLoaded=[],this.infoLoad=[],this.userService=y(_t),this.authService=y(X),this.fileListInfo=[],this.fileList=[],this.fileListE=[],this.fileUrl="http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg",this.autosave=!0,this.uploading=!1,this.bucketPath="products1/products",this.uploadvalue=0,this.showUploadList={showPreviewIcon:!0,showRemoveIcon:!0,hidePreviewIconInNonImage:!0},this.previewImage="",this.previewImageE="",this.camioneta="Camioneta",this.camion="Cami\xF3n",this.previewVisible=!1,this.previewVisibleE=!1,this.weekControls=[],this.weekControlsE=[],this.handlePreview=C=>{this.previewImage=C.url||C.thumbUrl,this.previewVisible=!0},this.handlePreviewE=C=>{this.previewImageE=C.url||C.thumbUrl,this.previewVisibleE=!0},this.authService.user.subscribe(C=>{this.user=C,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(T=>{this.infoLoad=T,this.userlevelAccess=this.infoLoad.optionAccessLavel})})}ngOnInit(){this.createForm(),this.getSubscriptions(),this.validateForm.get("weeks").valueChanges.subscribe(e=>{this.onFrequencyChange(e)})}ngOnDestroy(){}createForm(){this.validateForm=this.fb.group({active:[!1,[g.required]],category:[null,[g.required]],date_created:[new Date,[g.required]],description:[null,[g.required]],isTaskIn:[!0,[g.required]],isTaskOut:[!0,[g.required]],name:[null,[g.required]],price:[null,[g.required,g.min(1)]],timesSold:[0,[g.required]],type:["Servicio"],rangeDatePicker:[null],validFrom:[new Date,[g.required]],validTo:[new Date,[g.required]],imageUrl:[""],frequencies:[""],transportType:[""],weeks:[""],disable:[!1],rangeWeeks:this.fb.group({}),amountTrips:[0],id:[],sits:[0],isCalculate:[!1],customerId:[""]}),this.validateFormE=this.fb.group({active:[!1,[g.required]],category:[null],date_created:[new Date],description:[null,[g.required]],isTaskIn:[!0],isTaskOut:[!0],name:[null,[g.required]],price:[null,[g.required,g.min(1)]],timesSold:[0],type:["Servicio"],rangeDatePicker:[null],validFrom:[new Date],validTo:[new Date],imageUrl:[""],frequencies:[""],transportType:[""],weeks:[""],disable:[!1],rangeWeeks:this.fb.group({}),amountTrips:[0],sits:[0],id:[],isCalculate:[],customerId:[""]})}get price(){return this.validateForm.get("price")}isPriceInvalid(){let e=this.price;return!!(e&&e.invalid&&(e.dirty||e.touched))}isPriceRequired(){let e=this.price;return!!(e&&e.errors?.required)}isPriceMin(){let e=this.price;return!!(e&&e.errors?.min)}resetForm(){this.fileList=[],this.fileListE=[],this.validateForm.reset({active:!1,date_created:new Date,isTaskIn:!0,isTaskOut:!0,price:0,timesSold:0,validFrom:new Date,validTo:new Date,frequencies:"",transportType:"",weeks:"",imageUrl:"",amountTrips:0,sits:0,customerId:""}),this.validateFormE.reset({active:!1,date_created:new Date,isTaskIn:!0,isTaskOut:!0,price:0,timesSold:0,validFrom:new Date,validTo:new Date,frequencies:"",transportType:"",imageUrl:"",weeks:"",amountTrips:0,sits:0,customerId:""})}mapDateValues(e){e.length>1&&(this.validateForm.controls.validFrom.patchValue(new Date(e[0])),this.validateForm.controls.validTo.patchValue(new Date(e[1])))}sendMessage(e,t){this.messageService.create(e,t)}submitForm(e){var t=0;if(this.userlevelAccess!="3")if(e=="A")if(this.validateForm.valid){let n=this.validateForm.controls.frequencies.value||0;n>0&&(t=Number(n)*80),this.validateForm.controls.amountTrips.setValue(t),this.validateForm.controls.type.setValue("Servicio"),this.validateForm.controls.disable.setValue(!1),this.validateForm.controls.customerId.setValue(this.accountId),this.productsService.setProduct(this.accountId,this.validateForm.value).then(()=>{this.resetForm(),this.modalService.closeAll(),this.messageService.success("Todo sali\xF3 bien.",{nzPauseOnHover:!0,nzDuration:3e3})})}else this.sendMessage("error","Hay valores requeridos para crear el producto, favor de validar.");else if(this.validateFormE.valid){let n=this.validateFormE.controls.id.value,p=this.validateFormE.controls.frequencies.value||0;p>0&&(t=Number(p)*80),this.validateFormE.controls.amountTrips.setValue(t),this.validateFormE.controls.type.setValue("Servicio"),this.validateFormE.controls.disable.setValue(!1),this.validateFormE.controls.customerId.setValue(this.accountId),this.productsService.updateProduct(this.accountId,this.validateFormE.controls.id.value,this.validateFormE.value).then(()=>{this.resetForm(),this.modalService.closeAll(),this.messageService.success("Todo sali\xF3 bien.",{nzPauseOnHover:!0,nzDuration:3e3})})}else this.sendMessage("error","Hay valores requeridos para crear el producto, favor de validar.")}toggleActivateProduct(e){e.active?this.showDeactivateConfirm(e):this.processtoDeactivateProduct(this.accountId,e.id,e.active)}showDeactivateConfirm(e){this.modal.confirm({nzTitle:"Estas Seguro de detener la venta? ",nzContent:`<b style="color: red;">${e.name}</b> ser\xE1 desacrivado. </b>  Una ves realizado todos los pases asociados se desactivaran`,nzOkText:"Yes",nzOkType:"primary",nzOnOk:()=>this.processtoDeactivateProduct(this.accountId,e.id,e.active),nzCancelText:"No",nzOnCancel:()=>console.log("Cancel")})}processtoDeactivateProduct(e,t,n){this.productsService.toggleProductActive(e,t,n),this.productsService.toggleBoardingPass(t,n),this.productsService.togglePurchaseRequests(t,n)}getSubscriptions(){this.sub=this.usersService.getAccountProducts(this.accountId).pipe(F(e=>e.map(t=>{let n=t.payload.doc.id,p=t.payload.doc.data();return fe(E({},p),{id:n})}))).subscribe(e=>{this.productsList=e,this.productsListLoaded=e})}deleteProduct(e){this.userlevelAccess=="1"?this.productsService.deleteProduct(this.accountId,e.id).then(()=>{this.messageService.success(`El ${e.type} ${e.name} ha sido eliminado.`,{nzPauseOnHover:!0,nzDuration:3e3}),this.productsService.toggleBoardingPass(e.id,!1),this.productsService.togglePurchaseRequests(e.id,!1)}):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}initializeRangeDatePicker(e,t){let n=this.convertTimestampToDate(e),p=this.convertTimestampToDate(t);return[n,p]}convertTimestampToDate(e){return new Date(e.seconds*1e3)}editProduct(e,t){this.resetForm();let n=this.initializeRangeDatePicker(e.validFrom,e.validTo)??null;if(this.validateFormE.patchValue({active:e.active||!1,category:e.category||null,date_created:e.date_created||new Date,description:e.description||null,isTaskIn:e.isTaskIn||!0,isTaskOut:e.isTaskOut||!0,name:e.name||null,price:e.price||0,timesSold:e.timesSold||0,type:e.type||null,rangeDatePicker:n,validFrom:e.validFrom||new Date,validTo:e.validTo||new Date,imageUrl:e.imageUrl||"",frequencies:e.frequencies||null,transportType:e.transportType||"",amountTrips:e.amountTrips||0,weeks:e.weeks||0,rangeWeeks:e.rangeWeeks||{},id:e.id,isCalculate:e.isCalculate||!1,sits:e.sits||0,customerId:e.customerId||""}),e.rangeWeeks!=null){let z=this.validateFormE.get("rangeWeeks");for(let[S,C]of Object.entries(e.rangeWeeks))z.addControl(S,this.fb.control(C))}this.validateFormE.get("category")?.disable(),this.validateFormE.get("date_created")?.disable(),this.validateFormE.get("timesSold")?.disable(),this.validateFormE.get("type")?.disable(),this.validateFormE.get("validFrom")?.disable(),this.validateFormE.get("validTo")?.disable(),this.validateFormE.get("isTaskIn")?.disable(),this.validateFormE.get("isTaskOut")?.disable();let p=this.modalService.create({nzTitle:"Editar Producto / Servicio",nzContent:t,nzFooter:[{label:"Guardar Cambios",type:"primary",onClick:()=>this.modalService.confirm({nzTitle:"\xBFEstas seguro de los cambios?",nzOnOk:()=>{this.submitForm("E")}})}],nzWidth:800})}showNewModal(e){this.resetForm();let t=this.modalService.create({nzTitle:"Nuevo Servicio",nzContent:e,nzFooter:[{label:"Crear",type:"primary",onClick:()=>this.modalService.confirm({nzTitle:"\xBFEst\xE1 seguro?",nzOnOk:()=>{this.submitForm("A")}})}],nzWidth:800})}handleChange(e){let t=e.file.status;t!=="uploading"&&(this.fileList=e.fileList,e.file.originFileObj&&this.getBase64(e.file.originFileObj,n=>{let p=e.file.name,z=`${this.bucketPath}/${p}`,S=this.bucketStorage.ref(z);this.task=this.bucketStorage.ref(z).putString(n,"data_url"),this.uploadPercent=this.task.percentageChanges(),this.uploadPercent.pipe(F(C=>Number((C/100).toFixed(2)))).subscribe(C=>{this.uploading=C!=0,this.uploadvalue=C}),this.task.snapshotChanges().pipe(Ve(()=>{this.uploading=!1,this.downloadURL=S.getDownloadURL(),this.downloadURL.subscribe(C=>se(this,null,function*(){this.updateAdvanceURL(C,"A"),C.length>0?this.sendMessage("success",`${e.file.name} Archivo cargado satisfactoriamente.`):t==="error"&&this.sendMessage("error",`${e.file.name} archivo fallido, favor de validar.`)}))})).subscribe()}))}handleChange2(e){if(e.file.status!=="uploading"){let n=e.file.status;this.fileListE=e.fileList,e.file.originFileObj&&this.getBase64(e.file.originFileObj,p=>{this.fileUrl=p;let z=e.file.name,S=`${this.bucketPath}/${z}`,C=this.bucketStorage.ref(S);this.task=this.bucketStorage.ref(S).putString(p,"data_url"),this.uploadPercent=this.task.percentageChanges(),this.uploadPercent.pipe(F(T=>Number((T/100).toFixed(2)))).subscribe(T=>{this.uploading=T!=0,this.uploadvalue=T}),this.task.snapshotChanges().pipe(Ve(()=>{this.uploading=!1,this.downloadURL=C.getDownloadURL(),this.downloadURL.subscribe(T=>se(this,null,function*(){this.updateAdvanceURL(T,"E"),T.length>0?this.sendMessage("success",`${e.file.name} Archivo cargado satisfactoriamente.`):n==="error"&&this.sendMessage("error",`${e.file.name} archivo fallido, favor de validar.`)}))})).subscribe()})}}getBase64(e,t){let n=new FileReader;n.readAsDataURL(e),n.onload=()=>t(n.result),n.onerror=p=>console.log("Error: ",p)}updateAdvanceURL(e,t){return se(this,null,function*(){t=="A"?this.validateForm.controls.imageUrl.patchValue(e):this.validateFormE.controls.imageUrl.patchValue(e)})}onFrequencyChange(e){this.weekControls=[];let t=this.fb.group({});for(let n=0;n<e;n++){let p=new rt(null);p.valueChanges.subscribe(z=>this.getWeek(z,n)),this.weekControls.push(p),t.addControl(`week${n+1}`,new rt(null))}this.validateForm.setControl("rangeWeeks",t)}onFrequencyChangeE(e){this.weekControlsE=[];let t=this.fb.group({});for(let n=0;n<e;n++){let p=new rt(null);p.valueChanges.subscribe(z=>this.getWeekE(z,n)),this.weekControlsE.push(p),t.addControl(`week${n+1}`,new rt(null))}this.validateFormE.setControl("rangeWeeks",t)}getWeekNumber(e){let t=new Date(e.getFullYear(),0,1),n=(e.getDay()+6)%7;return t.setDate(t.getDate()+4-(t.getDay()||7)),Math.ceil(((e.getTime()-t.getTime())/864e5+1)/7).toString().padStart(2,"0")}getWeek(e,t){if(e){let n=e.getFullYear(),p=this.getWeekNumber(e),z=this.getStartOfWeek(new Date(e)),S=this.getEndOfWeek(new Date(e)),C={week:`${n}-${p}`,startDay:z.toISOString().split("T")[0],endDay:S.toISOString().split("T")[0]};this.validateForm.get("rangeWeeks").controls[`week${t+1}`].setValue(C)}}getWeekE(e,t){if(e){let n=e.getFullYear(),p=this.getWeekNumber(e),z=this.getStartOfWeek(new Date(e)),S=this.getEndOfWeek(new Date(e)),C={week:`${n}-${p}`,startDay:z.toISOString().split("T")[0],endDay:S.toISOString().split("T")[0]};this.validateFormE.get("rangeWeeks").controls[`week${t+1}`].setValue(C)}}getStartOfWeek(e){let t=new Date(e);t.setDate(t.getDate()+7);let n=t.getDay(),p=t.getDate()-n+(n===0?-6:1);return t.setDate(p),new Date(t.setHours(0,0,0,0))}getEndOfWeek(e){let t=this.getStartOfWeek(e);return t.setUTCDate(t.getUTCDate()+4),new Date(t.setUTCHours(23,59,59,999))}getItems(e){let t=e;if(!t){this.productsList=this.productsListLoaded.slice();return}let n=t.toLowerCase();this.productsList=this.productsListLoaded.filter(p=>p.description.toLowerCase().includes(n))}};s.\u0275fac=function(t){return new(t||s)(b(ge),b(Ze),b(me),b(ge),b(P),b(O))},s.\u0275cmp=k({type:s,selectors:[["app-shared-products-list"]],inputs:{accountId:"accountId"},decls:30,vars:4,consts:[["searchBar",""],["suffixIconSearch",""],["newContent",""],["editContent",""],["modalContent",""],["projectListSetting","nzDropdownMenu"],["coverTemplate",""],["listViewTable",""],["projectListSetting2","nzDropdownMenu"],[1,"page-header"],[1,"row","align-items-md-center"],[1,"col-md-6"],[1,"row"],[2,"margin-left","10px","width","280px"],[3,"nzSuffix"],["type","text","nz-input","","placeholder","Selecciona unn producto",3,"keyup"],[1,"text-md-right","m-v-10"],[1,"m-r-10",3,"ngModelChange","ngModel"],["nz-radio-button","","nzValue","cardView","nzTitle","Vista de tarjeta","nzPlacement","bottom","nz-tooltip",""],["nz-icon","","nzType","appstore","theme","outline",1,"font-size-16"],["nz-radio-button","","nzValue","listView","nzTitle","Vista de lista","nzPlacement","bottom","nz-tooltip",""],["nz-icon","","nzType","ordered-list","theme","outline",1,"font-size-16"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["nz-icon","","nzType","plus"],[1,"container-fluid"],["class","row",4,"ngIf"],[4,"ngIf"],["nz-icon","","nzType","search"],["nz-form","","nzLayout","vertical",3,"ngSubmit","formGroup"],[1,"col-md-8"],["nzRequired","true"],["type","text","formControlName","name","nz-input","","placeholder","Escriba el nombre del producto / servicio"],[1,"col-md-4"],["formControlName","active"],["nz-input","","formControlName","description"],["nzAction","https://www.mocky.io/v2/5cc8019d300000980a055e76","nzListType","picture-card",3,"nzFileListChange","nzChange","nzFileList","nzShowButton","nzShowUploadList","nzPreview"],[1,"ant-upload-text"],["nzPlaceHolder","Selecciona una opci\xF3n","formControlName","category",1,"w-100"],["nzLabel","Servicio de Transporte Ordinario","nzValue","permanente"],["nzLabel","Servicio Especial","nzValue","especial"],["nzLabel","Producto","nzValue","producto"],["nzLabel","Comedor","nzValue","comedor"],["nzLabel","Seguridad","nzValue","seguridad"],["nzLabel","Monitoreo","nzValue","monitoreo"],["nzLabel","Limpieza","nzValue","limpieza"],["nzLabel","Construcci\xF3n","nzValue","construccion"],["nzLabel","Bienes Raices","nzValue","bienesRaices"],["nzLabel","Mantenimiento","nzValue","mantenimiento"],["nzLabel","Otros","nzValue","otros"],["formControlName","rangeDatePicker",3,"nzOnCalendarChange"],[1,"col-md-2"],["formControlName","isTaskIn"],["formControlName","isTaskOut"],[1,"col-md-3"],["formControlName","price",3,"nzMin","nzMax","nzStep"],["class","error-message",4,"ngIf"],["formControlName","isCalculate"],["formControlName","sits",3,"nzMin","nzMax","nzStep"],["formControlName","frequencies"],[3,"nzValue","nzLabel"],["formControlName","transportType"],[3,"src","ngStyle"],[1,"error-message"],["type","text","formControlName","name","nz-input","","placeholder","Escriba el nombre del servicio"],["nzAction","/api/posts/","nzListType","picture-card",3,"nzFileListChange","nzChange","nzFileList","nzShowButton","nzShowUploadList","nzPreview"],[3,"nzOnCancel","nzVisible","nzContent","nzFooter"],["nzPlaceHolder","Selecciona una opci\xF3n","formControlName","category",1,"w-100",3,"disabled"],["formControlName","rangeDatePicker",3,"nzOnCalendarChange","disabled"],["formControlName","isTaskIn",3,"disabled"],["formControlName","isTaskOut",3,"disabled"],["class","col-md-3",4,"ngFor","ngForOf"],["nzHoverable","",2,"width","240px",3,"nzCover"],[3,"nzTitle","nzDescription"],["nz-dropdown","","nzPlacement","bottomRight","nzTrigger","click",1,"text-gray","font-size-18",3,"nzDropdownMenu"],["nz-icon","","nzType","ellipsis","theme","outline"],["nz-menu","","nzSelectable",""],["nz-menu-item","",3,"click",4,"ngIf"],["nz-menu-item","",3,"click"],["nz-icon","","nzType","edit","theme","outline"],[1,"m-l-10"],["nz-menu-divider",""],["nz-icon","","nzType","delete","theme","outline"],[1,"d-flex","justify-content-between","align-items-center"],[1,"m-b-0",3,"nzColor"],["class","m-b-0",3,"nzColor",4,"ngIf"],["nz-icon","","nzType","pause-circle","theme","outline"],["nz-icon","","nzType","check-circle","theme","outline"],["alt","",3,"src"],[3,"nzData"],[1,"text-center"],[4,"ngFor","ngForOf"],[1,"media","align-items-center"],["nzShape","square",3,"nzSrc"],[1,"m-b-0"],[1,"text-right"],["nz-menu-item",""]],template:function(t,n){if(t&1){let p=x();i(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"div",13)(5,"nz-form-control")(6,"nz-input-group",14)(7,"input",15,0),v("keyup",function(){h(p);let S=w(8);return f(n.getItems(S.value))}),o()(),_(9,Zn,1,0,"ng-template",null,1,V),o()()()(),i(11,"div",11)(12,"div",16)(13,"nz-radio-group",17),j("ngModelChange",function(S){return h(p),U(n.view,S)||(n.view=S),f(S)}),i(14,"label",18),d(15,"i",19),o(),i(16,"label",20),d(17,"i",21),o()(),i(18,"button",22),v("click",function(){h(p);let S=w(23);return f(n.showNewModal(S))}),d(19,"i",23),i(20,"span"),c(21,"Agregar nuevo"),o()(),_(22,oo,103,26,"ng-template",null,2,V)(24,co,95,33,"ng-template",null,3,V),o()()()(),i(26,"div",24),_(27,go,2,1,"div",25)(28,bo,18,2,"nz-card",26),o(),d(29,"nz-modal")}if(t&2){let p=w(10);l(6),m("nzSuffix",p),l(7),q("ngModel",n.view),l(14),m("ngIf",n.view=="cardView"),l(),m("ngIf",n.view=="listView")}},dependencies:[L,B,_e,de,Y,J,K,Q,ee,Z,pe,si,ai,yt,fi,pi,di,Je,We,Ge,Qe,Xe,Ye,xe,Ue,Et,et,be,Ce,je,ye,Ee,we,ve,ne,te,ie,Se,ft,Ke,ze,he,$,ce,M,H,W,G,ht,_i],styles:[".error-message[_ngcontent-%COMP%]{color:red;font-size:.8em}"]});let a=s;return a})();var Pi=[{name:"Tienda de conveniencia",description:"Pago en tienda de conveniencia",icon:"pricetag",method:"store",userNavigation:"reference/list",active:!1},{name:"Tarjeta de cr\xE9dito/d\xE9bito",description:"Pago en l\xEDnea con tarjeta",icon:"card",method:"card",userNavigation:"card/purchase",active:!1}],Di=(()=>{let s=class s{constructor(e){this.afs=e}getAccountPaymentMethods(e){return this.afs.collection("customers").doc(e).collection("paymentMethods").snapshotChanges()}getPaymentMethods(){return $t(Pi)}createDefaultPaymentMethods(e){return Pi.forEach(t=>{this.setAccountPaymentMethod(e,t)})}setAccountPaymentMethod(e,t){return this.afs.collection("customers").doc(e).collection("paymentMethods").add(t)}toggleActiveAccountPaymentMethod(e,t,n){return this.afs.collection("customers").doc(e).collection("paymentMethods").doc(t).update({active:n})}deleteAccountPaymentMethod(e,t){return this.afs.collection("customers").doc(e).collection("paymentMethods").doc(t).delete()}};s.\u0275fac=function(t){return new(t||s)(ke(me))},s.\u0275prov=Me({token:s,factory:s.\u0275fac,providedIn:"root"});let a=s;return a})();function yo(a,s){if(a&1){let r=x();nt(0),i(1,"div",4)(2,"label",5),c(3),o(),i(4,"nz-switch",6),v("ngModelChange",function(t){let n=h(r).$implicit,p=u();return f(p.onChange(t,n))}),o()(),ot()}if(a&2){let r=s.$implicit;l(3),I("",r.name,"\xA0"),l(),m("ngModel",r.active)}}var Li=(()=>{let s=class s{constructor(e){this.messageService=e,this.loading=!1,this.rolService=y(oe),this.stopSubscription$=new le,this.paymentMethodsList=[],this.accountPaymentMethods=[],this.infoLoad=[],this.paymentMethodsService=y(Di),this.authService=y(X),this.authService.user.subscribe(t=>{this.user=t,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(n=>{this.infoLoad=n,this.userlevelAccess=this.infoLoad.optionAccessLavel})})}ngOnInit(){this.getSubscriptions()}ngOnDestroy(){this.stopSubscription$.next(!1),this.stopSubscription$.complete()}sendMessage(e,t){this.messageService.create(e,t)}getSubscriptions(){this.paymentMethodsService.getAccountPaymentMethods(this.accountId).pipe(A(this.stopSubscription$),F(e=>e.map(t=>{let n=t.payload.doc.id,p=t.payload.doc.data();return E({id:n},p)})),Ne(e=>(this.accountPaymentMethods=e,e.length==0&&this.createDefaultPaymentMethods(),e))).subscribe(()=>{this.loading=!1})}createDefaultPaymentMethods(){this.userlevelAccess!="3"?this.paymentMethodsService.createDefaultPaymentMethods(this.accountId):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}onChange(e,t){this.paymentMethodsService.toggleActiveAccountPaymentMethod(this.accountId,t.id,e)}};s.\u0275fac=function(t){return new(t||s)(b(P))},s.\u0275cmp=k({type:s,selectors:[["app-shared-account-payment-methods"]],inputs:{accountId:"accountId"},decls:4,vars:2,consts:[[1,"container"],["nzType","inner","nzTitle","M\xE9todos de Pago (Aplican cuando el Usuario es responsable del Pago)",3,"nzLoading"],[1,"row"],[4,"ngFor","ngForOf"],[1,"col-md-6"],["nzFor","pm.name"],["nzCheckedChildren","Si","nzUnCheckedChildren","No",3,"ngModelChange","ngModel"]],template:function(t,n){t&1&&(i(0,"div",0)(1,"nz-card",1)(2,"div",2),_(3,yo,5,2,"ng-container",3),o()()()),t&2&&(l(),m("nzLoading",n.loading),l(2),m("ngForOf",n.accountPaymentMethods))},dependencies:[L,Et,Se,M,ht]});let a=s;return a})();function wo(a,s){if(a&1&&(i(0,"h5",68),c(1),o()),a&2){let r=u(2);l(),N(r.record.name)}}function To(a,s){if(a&1&&(i(0,"nz-option",69),d(1,"i",70),c(2),o()),a&2){let r=s.$implicit;m("nzLabel",r.name)("nzValue",r.uid),l(2),I(" ",r.name,"")}}function Fo(a,s){if(a&1&&(i(0,"nz-option",69),d(1,"i",70),c(2),o()),a&2){let r=s.$implicit;m("nzLabel",r.displayName)("nzValue",r.uid),l(2),I(" ",r.displayName,"")}}function Io(a,s){if(a&1){let r=x();i(0,"a",71),v("click",function(){h(r);let t=u(2);return f(t.onSubmit())}),c(1,"Actualizar"),o()}}function Vo(a,s){if(a&1){let r=x();i(0,"div",2)(1,"form",3),v("ngSubmit",function(){h(r);let t=u();return f(t.onSubmit())}),i(2,"nz-card",4)(3,"div",5),d(4,"nz-avatar",6),i(5,"div",7),_(6,wo,2,1,"h5",8),i(7,"p",9),c(8),d(9,"br"),c(10),o()(),i(11,"nz-upload",10),v("nzChange",function(t){h(r);let n=u();return f(n.handleChange(t))}),i(12,"button",11)(13,"span"),c(14,"Cambiar im\xE1gen "),o()()()(),d(15,"hr",12),i(16,"div",13)(17,"div",14)(18,"nz-form-item")(19,"nz-form-label",15),c(20,"Nombre"),o(),i(21,"nz-form-control"),d(22,"input",16),o()()(),i(23,"div",14)(24,"nz-form-item")(25,"nz-form-label",17),c(26,"Raz\xF3n Social"),o(),i(27,"nz-form-control"),d(28,"input",18),o()()()(),i(29,"div",13)(30,"div",19)(31,"nz-form-item")(32,"nz-form-label",20),c(33,"RFC"),o(),i(34,"nz-form-control"),d(35,"input",21),o()()(),i(36,"div",19)(37,"nz-form-item")(38,"nz-form-label",20),c(39,"Giro"),o(),i(40,"nz-form-control")(41,"nz-select",22),v("ngModelChange",function(t){h(r);let n=u();return f(n.onJobTypeSelected(t))}),_(42,To,3,3,"nz-option",23),o()()()(),i(43,"div",19)(44,"nz-form-item")(45,"nz-form-label",20),c(46,"Consecutivo"),o(),i(47,"nz-form-control"),d(48,"input",24),o()()()(),i(49,"div",13)(50,"div",25)(51,"nz-form-item")(52,"nz-form-label",26),c(53,"Tel\xE9fono"),o(),i(54,"nz-form-control"),d(55,"input",27),o()()(),i(56,"div",25)(57,"nz-form-item")(58,"nz-form-label",28),c(59,"Sitio Web"),o(),i(60,"nz-form-control"),d(61,"input",29),o()()(),i(62,"div",25)(63,"nz-form-item")(64,"nz-form-label",30),c(65,"Persona Contacto"),o(),i(66,"nz-form-control"),d(67,"input",31),o()()(),i(68,"div",25)(69,"nz-form-item")(70,"nz-form-label",32),c(71,"Responsable"),o(),i(72,"nz-form-control")(73,"nz-select",33),_(74,Fo,3,3,"nz-option",23),o()()()()()(),_(75,Io,2,0,"ng-template",null,0,V),i(77,"nz-card",34)(78,"div",13)(79,"div",35)(80,"nz-form-item")(81,"nz-form-label",36),c(82,"Calle"),o(),i(83,"nz-form-control"),d(84,"input",37),o()()(),i(85,"div",25)(86,"nz-form-item")(87,"nz-form-label",38),c(88,"N\xFAmero"),o(),i(89,"nz-form-control"),d(90,"input",39),o()()()(),i(91,"div",13)(92,"div",14)(93,"nz-form-item")(94,"nz-form-label",36),c(95,"Entre Calles"),o(),i(96,"nz-form-control"),d(97,"input",40),o()()(),i(98,"div",14)(99,"nz-form-item")(100,"nz-form-label",41),c(101,"Fracc / Colonia"),o(),i(102,"nz-form-control"),d(103,"input",42),o()()()(),i(104,"div",13)(105,"div",43)(106,"nz-form-item")(107,"nz-form-label",44),c(108,"C\xF3digo Postal"),o(),i(109,"nz-form-control"),d(110,"input",45),o()()(),i(111,"div",46)(112,"nz-form-item")(113,"nz-form-label",47),c(114,"Ciudad / Municipio"),o(),i(115,"nz-form-control"),d(116,"input",48),o()()(),i(117,"div",46)(118,"nz-form-item")(119,"nz-form-label",49),c(120,"Estado"),o(),i(121,"nz-form-control"),d(122,"input",50),o()()()()(),i(123,"nz-card",51)(124,"div",13)(125,"div",19)(126,"nz-form-item")(127,"nz-form-label",52)(128,"span"),c(129," Origen de los pagos "),d(130,"i",53),o()(),i(131,"nz-form-control",54)(132,"nz-select",55),d(133,"nz-option",56)(134,"nz-option",57),o()()()()(),i(135,"div",13)(136,"div",19)(137,"nz-form-item")(138,"nz-form-label",58)(139,"span"),c(140," Obligatorio subir en la estaci\xF3n definida "),d(141,"i",59),o()(),i(142,"nz-form-control",54)(143,"nz-select",60),d(144,"nz-option",61)(145,"nz-option",62),o()()()(),i(146,"div",19)(147,"nz-form-item")(148,"nz-form-label",63)(149,"span"),c(150," Obligatorio subir en el turno definido "),d(151,"i",64),o()(),i(152,"nz-form-control",54)(153,"nz-select",65),d(154,"nz-option",61)(155,"nz-option",62),o()()()(),i(156,"div",19)(157,"nz-form-item")(158,"nz-form-label",63)(159,"span"),c(160," Obligatorio subir en la operaci\xF3n definida "),d(161,"i",66),o()(),i(162,"nz-form-control",54)(163,"nz-select",67),d(164,"nz-option",61)(165,"nz-option",62),o()()()()()()()()}if(a&2){let r=w(76),e=u();l(),m("formGroup",e.objectForm),l(),m("nzExtra",r)("nzLoading",e.loading),l(2),m("nzSize",80)("nzSrc",e.record.imageUrl),l(2),m("ngIf",!!e.record),l(2),I(" ",e.record.address," "),l(2),Qt(" ",e.record.address2," ",e.record.address3," "),l(),m("nzShowUploadList",!1),l(31),m("ngForOf",e.jobType),l(32),m("ngForOf",e.usersList),l(57),m("nzSpan",12),l(11),m("nzSpan",12),l(10),m("nzSpan",12),l(10),m("nzSpan",12)}}var Ai=(()=>{let s=class s{constructor(e,t,n){this.messageService=e,this.bucketStorage=t,this.fb=n,this.stopSubscription$=new le,this.loading=!0,this.infoLoad=[],this.rolService=y(oe),this.authService=y(X),this.accountsService=y(Be),this.userService=y(_t),this.infoSegment=[],this.avatarUrl="http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg",this.uploading=!1,this.bucketPath="customers/",this.uploadvalue=0,this.vendorService=y(xt),this.authService.user.subscribe(p=>{this.user=p,this.user!==null&&this.user!==void 0&&this.user.rolId!==void 0&&(this.rolService.getRol(this.user.rolId).valueChanges().subscribe(z=>{this.infoLoad=z,this.userlevelAccess=this.infoLoad.optionAccessLavel}),this.accountsSubscription=this.accountsService.getJobType().pipe(F(z=>z.map(S=>{let C=S.payload.doc.id,T=S.payload.doc.data();return E({id:C},T)}))).subscribe(z=>{this.jobType=z}),this.accountsSubscription=this.accountsService.getUsersByCustomer(this.accountId).pipe(F(z=>z.map(S=>{let C=S.payload.doc.id,T=S.payload.doc.data();return E({id:C},T)}))).subscribe(z=>{this.usersList=z}),this.accountsService.getSegmentLevel(this.user.idSegment).pipe(A(this.stopSubscription$),F(z=>{let S=z.payload.id,C=z.payload.data();return E({id:S},C)}),Ne(z=>(this.infoSegment=z,z))).subscribe())})}ngOnInit(){this.createForm(),this.getSubscription()}createForm(){this.objectForm=this.fb.group({active:[!1,[g.required]],imageUrl:[""],address:[""],paymentResponsible:[1,[g.required]],name:["",[g.required]],socialName:[""],rfc:[""],addressNumber:[""],address2:[""],address3:[""],zip:[""],city:[""],state:[""],forceStopPoints:[!0],forceRoute:[!0],forceRound:[!0],website:[""],phoneNumber:[""],jobTypeID:[""],custConsecutive:[""],primaryContact:[""],responsableUser:[""]})}patchForm(e){this.objectForm.patchValue({active:e.active||!1,imageUrl:e.imageUrl||"",address:e.address||"",addressNumber:e.addressNumber||"",name:e.name||"",paymentResponsible:e.paymentResponsible||1,socialName:e.socialName||"",rfc:e.rfc||"",address2:e.address2||"",address3:e.address3||"",zip:e.zip||"",city:e.city||"",state:e.state||"",forceStopPoints:e.forceStopPoints||!0,forceRoute:e.forceRoute||!0,forceRound:e.forceRound||!0,website:e.website||"",phoneNumber:e.phoneNumber||"",jobTypeID:e.jobTypeID||"",custConsecutive:e.custConsecutive||"",primaryContact:e.primaryContact||"",responsableUser:e.responsableUser||""})}ngOnDestroy(){this.stopSubscription$.next(!1),this.stopSubscription$.complete()}getSubscription(){this.accountsService.getAccount(this.accountId).pipe(A(this.stopSubscription$),F(e=>{let t=e.payload.id,n=e.payload.data();return E({id:t},n)}),Ne(e=>(this.patchForm(e),this.record=e,this.loading=!1,e))).subscribe()}getBase64(e,t){let n=new FileReader;n.addEventListener("load",()=>{n.result!==null&&typeof n.result=="string"?t(n.result):console.error("Invalid result from FileReader")}),n.readAsDataURL(e)}handleChange(e){console.log(e),e.file.originFileObj&&this.getBase64(e.file.originFileObj,t=>{this.avatarUrl=t;let n=e.file.name,p=`${this.bucketPath}/${n}`,z=this.bucketStorage.ref(p);this.task=this.bucketStorage.ref(p).putString(t,"data_url"),this.uploadPercent=this.task.percentageChanges(),console.log(p),this.uploadPercent.pipe(F(S=>Number((S/100).toFixed(2)))).subscribe(S=>{this.uploading=S!=0,this.uploadvalue=S}),this.task.snapshotChanges().pipe(Ve(()=>{this.uploading=!1,this.downloadURL=z.getDownloadURL(),this.downloadURL.subscribe(S=>se(this,null,function*(){this.updatePhotoURL(S)}))})).subscribe()})}updatePhotoURL(e){return se(this,null,function*(){console.log("started updatePhotoURL with url: ",e),this.objectForm.controls.imageUrl.patchValue(e),this.userlevelAccess!="3"?(console.log("update"),this.accountsService.updateAvatarAccount(this.accountId,e),console.log("afdter")):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")})}sendMessage(e,t){this.messageService.create(e,t)}onSubmit(){this.userlevelAccess!="3"?(console.log(this.objectForm.value),this.accountsService.updateAccount(this.accountId,this.objectForm.value).then(()=>{},e=>{console.log("err: ",e)}).catch(e=>console.log(e))):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}onJobTypeSelected(e){let t=this.jobType.filter(n=>n.uid===e);if(t.length>0){let n=t[0].consecutive;n=parseInt(n,10)+1,n=n.toString().padStart(4,"0"),this.objectForm.controls.custConsecutive.setValue(t[0].type+n)}}};s.\u0275fac=function(t){return new(t||s)(b(P),b(Ze),b(O))},s.\u0275cmp=k({type:s,selectors:[["app-shared-account-edit"]],inputs:{accountId:"accountId"},decls:1,vars:1,consts:[["basicTpl",""],["class","container",4,"ngIf"],[1,"container"],["nz-form","","nzLayout","vertical",3,"ngSubmit","formGroup"],["nzType","inner","nzTitle","Informaci\xF3n B\xE1sica",3,"nzExtra","nzLoading"],[1,"media","align-items-center"],["nzIcon","user","nzSize","large","nzSrc","",2,"background-color","white","color","#4F6F57",3,"nzSize","nzSrc"],[1,"m-l-20","m-r-20"],["class","m-b-5 font-size-18",4,"ngIf"],[1,"opacity-07","font-size-13","m-b-0"],["nzName","imageUrl",3,"nzChange","nzShowUploadList"],["nz-button","","nzGhost","",2,"background-color","#4F6F57","color","#f6f3ea"],[1,"m-v-25"],[1,"row"],[1,"col-md-6"],["nzFor","name"],["nz-input","","formControlName","name","type","text"],["nzFor","socialName"],["nz-input","","formControlName","socialName","type","text"],[1,"col-md-4"],["nzFor","rfc"],["nz-input","","formControlName","rfc","type","text"],["formControlName","jobTypeID","nzAllowClear","","nzPlaceHolder","Selecciona el Giro de la Empresa",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nz-input","","formControlName","custConsecutive","nzDisabled",""],[1,"col-md-3"],["nzFor","phoneNumber"],["nz-input","","formControlName","phoneNumber","placeholder","Tel\xE9fono"],["nzFor","website"],["nz-input","","formControlName","website","placeholder","website"],["nzFor","primaryContact"],["nz-input","","formControlName","primaryContact","placeholder","Contacto principal"],["nzFor","responsableUser"],["formControlName","responsableUser","nzAllowClear","","nzPlaceHolder","Selecciona Usuario Responsable"],["nzType","inner","nzTitle","Direcci\xF3n"],[1,"col-md-9"],["nzFor","address"],["nz-input","","formControlName","address","placeholder","Calle"],["nzFor","addressNumber"],["nz-input","","formControlName","addressNumber","placeholder","N\xFAmero"],["nz-input","","formControlName","address2","placeholder","Entre calles"],["nzFor","address3"],["nz-input","","formControlName","address3","placeholder","Fracc / Colonia"],[1,"col-md-2"],["nzFor","zip"],["nz-input","","formControlName","zip","placeholder","C\xF3digo Postal"],[1,"col-md-5"],["nzFor","city"],["nz-input","","formControlName","city","placeholder","Ciudad / Municipio"],["nzFor","state"],["nz-input","","formControlName","state","placeholder","Estado"],["nzType","inner","nzTitle","Par\xE1metros de Servicio"],["nzFor","paymentResponsible","nzRequired",""],["nz-icon","","nz-tooltip","","nzTooltipTitle","\xBFQui\xE9n es el responsable de emitir un pago por el servicio?","nzType","question-circle","nzTheme","outline"],[3,"nzSpan"],["name","select-error","formControlName","paymentResponsible"],["nzValue","0","nzLabel","Empresa"],["nzValue","1","nzLabel","Usuario"],["nzFor","forceStopPoints","nzRequired",""],["nz-icon","","nz-tooltip","","nzTooltipTitle","\xBFEs obligatorio que el usuario suba exclusivamente en la estaci\xF3n seleccionada?","nzType","question-circle","nzTheme","outline"],["name","select-error","formControlName","forceStopPoints"],["nzValue","true","nzLabel","Si"],["nzValue","false","nzLabel","No"],["nzFor","forceRound","nzRequired",""],["nz-icon","","nz-tooltip","","nzTooltipTitle","\xBFEs obligatorio que el usuario suba exclusivamente en el turno seleccionada?","nzType","question-circle","nzTheme","outline"],["name","select-error","formControlName","forceRound"],["nz-icon","","nz-tooltip","","nzTooltipTitle","\xBFEs obligatorio que el usuario suba exclusivamente en la operaci\xF3n seleccionada?","nzType","question-circle","nzTheme","outline"],["name","select-error","formControlName","forceRoute"],[1,"m-b-5","font-size-18"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon",""],[3,"click"]],template:function(t,n){t&1&&_(0,Vo,166,16,"div",1),t&2&&m("ngIf",!!n.record)},dependencies:[L,B,de,Y,J,K,Q,ee,Z,pe,Ue,et,ve,ne,te,ie,Se,ze,he,$,ce,M,H,W,G]});let a=s;return a})();function ko(a,s){if(a&1&&d(0,"app-shared-account-edit",9),a&2){let r=u();m("accountId",r.recordId)}}function Po(a,s){if(a&1&&d(0,"app-shared-account-payment-methods",9),a&2){let r=u();m("accountId",r.recordId)}}function Do(a,s){if(a&1&&d(0,"app-shared-routes-list",9),a&2){let r=u();m("accountId",r.recordId)}}function Lo(a,s){if(a&1&&d(0,"app-shared-customer-vendor-assignments",9),a&2){let r=u();m("accountId",r.recordId)}}function Ao(a,s){if(a&1&&d(0,"app-shared-products-list",9),a&2){let r=u();m("accountId",r.recordId)}}function Mo(a,s){if(a&1&&d(0,"app-promotions",9),a&2){let r=u();m("accountId",r.recordId)}}var wa=(()=>{let s=class s{constructor(e,t,n,p){this.fb=e,this.route=t,this.modalService=n,this.message=p,this.accountsService=y(Be),this.selectedIndex=0,this.record=[],this.avatarUrl="http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg"}ngOnInit(){this.sub=this.route.params.subscribe(e=>{this.recordId=e.id,this.selectedIndex=e.index,this.getSubscriptions()}),this.changePWForm=this.fb.group({oldPassword:[null,[g.required]],newPassword:[null,[g.required]],confirmPassword:[null,[g.required]]})}ngOnDestroy(){this.sub.unsubscribe()}showConfirm(){this.modalService.confirm({nzTitle:"<i>Do you want to change your password?</i>",nzOnOk:()=>this.message.success("Password Change Successfully")})}getSubscriptions(){this.accountsService.getAccount(this.recordId).pipe(F(e=>{let t=e.payload.id,n=e.payload.data();return E({id:t},n)})).subscribe(e=>{this.record=e})}submitForm(){for(let e in this.changePWForm.controls)this.changePWForm.controls[e].markAsDirty(),this.changePWForm.controls[e].updateValueAndValidity();this.showConfirm()}getBase64(e,t){let n=new FileReader;n.addEventListener("load",()=>t(n.result)),n.readAsDataURL(e)}};s.\u0275fac=function(t){return new(t||s)(b(O),b(ei),b(ge),b(P))},s.\u0275cmp=k({type:s,selectors:[["app-edit"]],decls:19,vars:2,consts:[["nzBackIcon","",1,"page-header",2,"background-color","#f9fbfd"],[1,"page-header-tab",3,"nzSelectedIndex"],["nzTitle","General"],["nz-tab",""],["nzTitle","M\xE9todos de Pago"],["nzTitle","Operaci\xF3n"],["nzTitle","Asignaciones"],["nzTitle","Productos"],["nzTitle","Promociones"],[3,"accountId"]],template:function(t,n){t&1&&(i(0,"nz-page-header",0)(1,"nz-page-header-title"),c(2),o(),i(3,"nz-page-header-subtitle"),c(4,"Detalles de la empresa"),o(),i(5,"nz-page-header-content")(6,"nz-tabset",1)(7,"nz-tab",2),_(8,ko,1,1,"ng-template",3),o(),i(9,"nz-tab",4),_(10,Po,1,1,"ng-template",3),o(),i(11,"nz-tab",5),_(12,Do,1,1,"ng-template",3),o(),i(13,"nz-tab",6),_(14,Lo,1,1,"ng-template",3),o(),i(15,"nz-tab",7),_(16,Ao,1,1,"ng-template",3),o(),i(17,"nz-tab",8),_(18,Mo,1,1,"ng-template",3),o()()()()),t&2&&(l(2),N(n.record.name),l(4),m("nzSelectedIndex",n.selectedIndex))},dependencies:[ue,He,$e,vt,Ct,St,mi,xi,wi,Vi,ki,Li,Ai]});let a=s;return a})();export{Bo as a,tr as b,wa as c};
