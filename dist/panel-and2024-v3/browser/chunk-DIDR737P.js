import{a as rt,b as Ft,c as Dt,d as Pt,f as Li}from"./chunk-XSJ6ZKTD.js";import{b as Mi}from"./chunk-MXGTFI36.js";import{a as nt}from"./chunk-RBC24LWF.js";import{a as Ui,b as Bi}from"./chunk-LAUCBWMD.js";import{a as Qe,c as kt,h as Mt,i as Oi}from"./chunk-NYOFACGL.js";import{a as st,c as Ri,e as Ot}from"./chunk-YNUDQCIW.js";import{a as Lt,b as At}from"./chunk-ZB3SUYLH.js";import{a as Ai}from"./chunk-Y6BYNUAW.js";import{A as xe,B as at,C as ye,D as Ee,a as oe,c as _e,d as Se,e as Xe,f as Ii,g as de,h as Fi,j as Di,k as re,m as Pi,n as wt,o as It,s as Vi,t as ki,w as Ce,y as be}from"./chunk-P4EMRIXJ.js";import{Sc as Vt}from"./chunk-2XE4ZSNN.js";import{a as he,b as Ti,c as fe,d as Ni,e as ot,g as ge,h as We,i as wi,j as ve}from"./chunk-TVJR76CI.js";import{a as ne,b as Oe,c as Re,f as je,h as He}from"./chunk-IMWJHJ4Y.js";import{a as Be,b as yi}from"./chunk-N4FQRY36.js";import{a as Ue}from"./chunk-4LJQEPB6.js";import{a as qe}from"./chunk-3VV4NY5F.js";import{$ as un,L as ze,N as Z,O as ee,P as te,Q as ie,_ as pe,aa as Nt,b as me,c as f,e as O,ea as Ei,f as W,h as Et,i as X,ia as $e,ja as Ge,k as Q,m as J,q as R,u as xi,v as Y,w as U,x as B}from"./chunk-3MM2LZV7.js";import{$ as ai,$a as li,Aa as h,Ae as ht,Bb as F,Ca as c,Da as Gt,Db as ui,Ea as St,Ec as vi,Fc as _i,Ga as se,Gc as Si,H as oi,Jc as ce,Jd as K,O as ae,Ob as A,Pa as t,Pb as M,Q as we,Qa as n,Ra as d,Sa as Le,Ta as Ae,Tb as it,U as et,V as ri,Va as x,Wb as Me,X as Ye,Xb as zi,Y as C,Ya as g,_ as I,_a as u,aa as si,ab as mi,af as Tt,bb as ci,c as ue,da as Ht,ea as v,eb as Ct,fa as _,fb as bt,gb as xt,hb as T,ib as s,jb as N,jc as hi,kb as y,kd as Ci,l as ni,lb as di,m as w,mc as fi,md as bi,nb as q,nc as gi,nf as P,ob as j,of as V,pa as $t,pb as H,qa as m,qf as k,ra as b,rb as Wt,sb as yt,tb as tt,ue as D,vb as pi,xb as G,yb as Xt,zb as le}from"./chunk-M4WL67FH.js";import{c as ii}from"./chunk-X7FOUD52.js";import{a as E,b as ke,f as pn,h as zt}from"./chunk-WT5K5NLM.js";var qi=(()=>{let l=class l{constructor(e){this.afs=e}getSummarized(){return this.afs.collection("summarized").valueChanges()}setAccounts(){}};l.\u0275fac=function(i){return new(i||l)(Ye(ce))},l.\u0275prov=et({token:l,factory:l.\u0275fac,providedIn:"root"});let o=l;return o})();var zn=["nzType","avatar"];var hn=["*"];function fn(o,l){if(o&1&&(t(0,"div",5),d(1,"nz-skeleton-element",6),n()),o&2){let a=u(2);m(),c("nzSize",a.avatar.size||"default")("nzShape",a.avatar.shape||"circle")}}function gn(o,l){if(o&1&&d(0,"h3",7),o&2){let a=u(2);Gt("width",a.toCSSUnit(a.title.width))}}function vn(o,l){if(o&1&&d(0,"li"),o&2){let a=l.index,e=u(3);Gt("width",e.toCSSUnit(e.widthList[a]))}}function _n(o,l){if(o&1&&(t(0,"ul",8),h(1,vn,1,2,"li",9),n()),o&2){let a=u(2);m(),c("ngForOf",a.rowsList)}}function Sn(o,l){if(o&1&&(Le(0),h(1,fn,2,2,"div",1),t(2,"div",2),h(3,gn,1,2,"h3",3)(4,_n,2,1,"ul",4),n(),Ae()),o&2){let a=u();m(),c("ngIf",!!a.nzAvatar),m(2),c("ngIf",!!a.nzTitle),m(),c("ngIf",!!a.nzParagraph)}}function Cn(o,l){o&1&&(Le(0),mi(1),Ae())}var bn=(()=>{let l=class l{constructor(){this.nzActive=!1,this.nzBlock=!1}};l.\u0275fac=function(i){return new(i||l)},l.\u0275dir=si({type:l,selectors:[["nz-skeleton-element"]],hostAttrs:[1,"ant-skeleton","ant-skeleton-element"],hostVars:4,hostBindings:function(i,r){i&2&&St("ant-skeleton-active",r.nzActive)("ant-skeleton-block",r.nzBlock)},inputs:{nzActive:"nzActive",nzType:"nzType",nzBlock:"nzBlock"},standalone:!0});let o=l;return ii([bi()],o.prototype,"nzBlock",void 0),o})();var xn=(()=>{let l=class l{constructor(){this.nzShape="circle",this.nzSize="default",this.styleMap={}}ngOnChanges(e){if(e.nzSize&&typeof this.nzSize=="number"){let i=`${this.nzSize}px`;this.styleMap={width:i,height:i,"line-height":i}}else this.styleMap={}}};l.\u0275fac=function(i){return new(i||l)},l.\u0275cmp=I({type:l,selectors:[["nz-skeleton-element","nzType","avatar"]],inputs:{nzShape:"nzShape",nzSize:"nzSize"},standalone:!0,features:[Ht,Wt],attrs:zn,decls:1,vars:9,consts:[[1,"ant-skeleton-avatar",3,"ngStyle"]],template:function(i,r){i&1&&d(0,"span",0),i&2&&(St("ant-skeleton-avatar-square",r.nzShape==="square")("ant-skeleton-avatar-circle",r.nzShape==="circle")("ant-skeleton-avatar-lg",r.nzSize==="large")("ant-skeleton-avatar-sm",r.nzSize==="small"),c("ngStyle",r.styleMap))},dependencies:[it],encapsulation:2,changeDetection:0});let o=l;return o})();var ji=(()=>{let l=class l{constructor(e){this.cdr=e,this.nzActive=!1,this.nzLoading=!0,this.nzRound=!1,this.nzTitle=!0,this.nzAvatar=!1,this.nzParagraph=!0,this.rowsList=[],this.widthList=[]}toCSSUnit(e=""){return Ci(e)}getTitleProps(){let e=!!this.nzAvatar,i=!!this.nzParagraph,r="";return!e&&i?r="38%":e&&i&&(r="50%"),E({width:r},this.getProps(this.nzTitle))}getAvatarProps(){let e=this.nzTitle&&!this.nzParagraph?"square":"circle";return E({shape:e,size:"large"},this.getProps(this.nzAvatar))}getParagraphProps(){let e=!!this.nzAvatar,i=!!this.nzTitle,r={};return(!e||!i)&&(r.width="61%"),!e&&i?r.rows=3:r.rows=2,E(E({},r),this.getProps(this.nzParagraph))}getProps(e){return e&&typeof e=="object"?e:{}}getWidthList(){let{width:e,rows:i}=this.paragraph,r=[];return e&&Array.isArray(e)?r=e:e&&!Array.isArray(e)&&(r=[],r[i-1]=e),r}updateProps(){this.title=this.getTitleProps(),this.avatar=this.getAvatarProps(),this.paragraph=this.getParagraphProps(),this.rowsList=[...Array(this.paragraph.rows)],this.widthList=this.getWidthList(),this.cdr.markForCheck()}ngOnInit(){this.updateProps()}ngOnChanges(e){(e.nzTitle||e.nzAvatar||e.nzParagraph)&&this.updateProps()}};l.\u0275fac=function(i){return new(i||l)(b(ui))},l.\u0275cmp=I({type:l,selectors:[["nz-skeleton"]],hostAttrs:[1,"ant-skeleton"],hostVars:6,hostBindings:function(i,r){i&2&&St("ant-skeleton-with-avatar",!!r.nzAvatar)("ant-skeleton-active",r.nzActive)("ant-skeleton-round",!!r.nzRound)},inputs:{nzActive:"nzActive",nzLoading:"nzLoading",nzRound:"nzRound",nzTitle:"nzTitle",nzAvatar:"nzAvatar",nzParagraph:"nzParagraph"},exportAs:["nzSkeleton"],standalone:!0,features:[Ht,Wt],ngContentSelectors:hn,decls:2,vars:2,consts:[[4,"ngIf"],["class","ant-skeleton-header",4,"ngIf"],[1,"ant-skeleton-content"],["class","ant-skeleton-title",3,"width",4,"ngIf"],["class","ant-skeleton-paragraph",4,"ngIf"],[1,"ant-skeleton-header"],["nzType","avatar",3,"nzSize","nzShape"],[1,"ant-skeleton-title"],[1,"ant-skeleton-paragraph"],[3,"width",4,"ngFor","ngForOf"]],template:function(i,r){i&1&&(li(),h(0,Sn,5,3,"ng-container",0)(1,Cn,2,0,"ng-container",0)),i&2&&(c("ngIf",r.nzLoading),m(),c("ngIf",!r.nzLoading))},dependencies:[bn,xn,M,A],encapsulation:2,changeDetection:0});let o=l;return o})(),Fr=(()=>{let l=class l{};l.\u0275fac=function(i){return new(i||l)},l.\u0275mod=ai({type:l}),l.\u0275inj=ri({});let o=l;return o})();var Tn=(o,l,a)=>[o,l,a],Nn=()=>({size:"large"}),wn=o=>["/accounts/edit",o,0],In=o=>["/accounts/edit",o,1],Hi=o=>["/accounts/edit",o,2],Fn=o=>["/accounts/edit",o,3];function Dn(o,l){o&1&&d(0,"nz-empty")}function Pn(o,l){if(o&1&&d(0,"nz-avatar",46),o&2){let a=u().$implicit;c("nzText",a.name)}}function Vn(o,l){if(o&1){let a=x();t(0,"i",49),g("click",function(){v(a);let i=u(2).$implicit,r=u();return _(r.toggleAccountActive(i.id,!0))}),n()}o&2&&c("nzTheme","twotone")}function kn(o,l){if(o&1){let a=x();t(0,"i",50),g("click",function(){v(a);let i=u(2).$implicit,r=u();return _(r.toggleAccountActive(i.id,!1))}),n()}o&2&&c("nzTheme","twotone")}function Ln(o,l){if(o&1&&h(0,Vn,1,1,"i",47)(1,kn,1,1,"i",48),o&2){let a=u().$implicit;c("ngIf",a.active),m(),c("ngIf",!a.active)}}function An(o,l){if(o&1&&d(0,"i",51),o&2){let a=u().$implicit;c("routerLink",tt(1,wn,a.id))}}function Mn(o,l){if(o&1){let a=x();t(0,"a",52),d(1,"i",53),n(),t(2,"nz-dropdown-menu",null,4)(4,"ul",54)(5,"li",55),d(6,"i",56),s(7," Usuarios "),n(),t(8,"li",55),d(9,"i",57),s(10," Productos y servicios "),n(),t(11,"li",55),d(12,"i",57),s(13," Promociones "),n(),t(14,"li",55),d(15,"i",58),s(16," Rutas y horarios "),n(),d(17,"li",59),t(18,"li",60),g("click",function(){v(a);let i=u().$implicit,r=u();return _(r.deleteAccountModal(i))}),d(19,"i",61),s(20," Eliminar "),n()()()}if(o&2){let a=T(3),e=u().$implicit;c("nzDropdownMenu",a),m(5),c("routerLink",tt(5,In,e.id)),m(3),c("routerLink",tt(7,Hi,e.id)),m(3),c("routerLink",tt(9,Hi,e.id)),m(3),c("routerLink",tt(11,Fn,e.id))}}function On(o,l){if(o&1&&(t(0,"div",42)(1,"nz-card",43)(2,"nz-skeleton",44),d(3,"nz-card-meta",45),n()(),h(4,Pn,1,1,"ng-template",null,0,F)(6,Ln,2,2,"ng-template",null,1,F)(8,An,1,3,"ng-template",null,2,F)(10,Mn,21,13,"ng-template",null,3,F),n()),o&2){let a=l.$implicit,e=T(5),i=T(7),r=T(9),p=T(11);m(),c("nzActions",pi(5,Tn,i,r,p)),m(),c("nzActive",!0)("nzAvatar",yt(9,Nn)),m(),c("nzAvatar",e)("nzTitle",a.name)}}var Br=(()=>{let l=class l{constructor(e,i,r){this.messageService=e,this.modalService=i,this.fb=r,this.rolService=C(oe),this.summarizedService=C(qi),this.authService=C(Y),this.accountsService=C(nt),this.selectedRecord=!1,this.accountsList=[],this.summarized=[],this.loading=!0,this.isVisible=!1,this.isDeleteVisible=!1,this.isOkLoading=!1,this.infoLoad=[]}ngOnInit(){this.userSubscription=this.authService.getUser().subscribe(e=>{this.user=e,this.user.rolId!=null&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(i=>{this.infoLoad=i,this.userlevelAccess=this.infoLoad.optionAccessLavel})}),this.getSubscriptions(),this.validateForm=this.fb.group({name:[null,[f.minLength(5),f.maxLength(40),f.required]],address:[null,[f.required]],phoneNumber:[null,[f.required]],website:[null,[f.required]],active:[!1],canShowDevices:[!0],showFromHour:[5],showToHour:[20]})}ngOnDestroy(){this.accountsSubscription.unsubscribe(),this.summarizedSubscription.unsubscribe(),this.userSubscription.unsubscribe()}submitForm(){this.isOkLoading=!0;for(let e in this.validateForm.controls)this.validateForm.controls[e].markAsDirty(),this.validateForm.controls[e].updateValueAndValidity();this.userlevelAccess!="3"?this.accountsService.setAccount(this.validateForm.value).then(i=>{console.log(i),this.isVisible=!1,this.isOkLoading=!1}).catch(i=>console.log(i)):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}toggleAccountActive(e,i){this.accountsService.toggleAccountActive(e,i)}deleteAccount(e){this.isOkLoading=!0,this.userlevelAccess=="1"?this.accountsService.deleteAccount(e.id).then(r=>{console.log(r),this.isOkLoading=!1}).catch(r=>console.log(r)):this.sendMessage("error","El usuario no tiene permisos para borrar datos, favor de contactar al administrador.")}getSubscriptions(){this.loading=!0,this.accountsSubscription=this.accountsService.getAccounts().pipe(w(e=>e.map(i=>{let r=i.payload.doc.id,p=i.payload.doc.data();return E({id:r},p)}))).subscribe(e=>{this.accountsList=e,this.loading=!1}),this.summarizedSubscription=this.summarizedService.getSummarized().subscribe(e=>{this.summarized=e[0],console.log(e),this.loading=!1})}deleteAccountModal(e){this.modalService.warning({nzTitle:"\xBFEst\xE1 seguro?",nzContent:"Eliminar\xE1 toda la informaci\xF3n de "+e.name,nzCancelText:"Cancelar",nzOkText:"Eliminar",nzOkLoading:this.isOkLoading,nzOnOk:()=>{this.deleteAccount(e)},nzOnCancel:()=>console.log("cancel")})}createBasicMessage(e){this.messageService.success(`Se encontraron ${e} registros.`,{nzDuration:3e3})}showModal(){this.isVisible=!0}handleCancel(){this.isVisible=!1}sendMessage(e,i){this.messageService.create(e,i)}};l.\u0275fac=function(i){return new(i||l)(b(D),b(je),b(R))},l.\u0275cmp=I({type:l,selectors:[["app-dashboard"]],decls:86,vars:33,consts:[["avatarTemplate",""],["actionSetting",""],["actionEdit",""],["actionEllipsis",""],["menu","nzDropdownMenu"],[1,"d-md-flex","align-items-center","d-none"],[1,"media","align-items-center","m-r-40","m-v-5"],[1,"font-size-27"],["nz-icon","","nzType","folder","theme","outline",1,"text-primary"],[1,"d-flex","align-items-center","m-l-10"],[1,"m-b-0","m-r-5"],[1,"text-gray"],["nz-icon","","nzType","idcard","theme","outline",1,"text-success"],[1,"media","align-items-center","m-v-5"],["nz-icon","","nzType","security-scan","theme","outline",1,"text-danger"],[1,"media","align-items-center","m-v-5","m-l-10"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["nz-icon","","nzType","plus-circle"],["nz-menu","","nzMode","horizontal"],["nz-submenu","","nzTitle","Ventas","nzIcon","dollar"],["nz-menu-group","","nzTitle","Mostrar por"],["nz-menu-item",""],["nz-submenu","","nzTitle","Reportes","nzIcon","pie-chart"],["nz-menu-group","","nzTitle","Periodos"],[4,"ngIf"],["nz-row","",3,"nzGutter"],["nz-col","","nzSpan","6",4,"ngFor","ngForOf"],["nzTitle","Nueva Empresa","nzCancelText","Cancelar","nzOkText","Crear","nzOkType","primary",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible","nzOkLoading","nzOkDisabled"],["nz-form","",3,"ngSubmit","formGroup"],["nzRequired","","nzFor","name",3,"nzSm","nzXs"],["nzErrorTip","Debe contener entre 5 y 30 caracteres.",3,"nzSm","nzXs"],["nz-input","","formControlName","name","id","name"],["nzFor","address","nzRequired","",3,"nzSm","nzXs"],["nz-icon","","nz-tooltip","","nzTitle","Domicilio completo de la Empresa","nzType","question-circle","nzTheme","outline"],["nzErrorTip","Ingrese el domicilio!",3,"nzSm","nzXs"],["nz-input","","id","address","formControlName","address"],["nzRequired","","nzFor","phoneNumber",3,"nzSm","nzXs"],["nzErrorTip","Ingrese el tel\xE9fono de contacto con la empresa.",3,"nzSm","nzXs"],["nz-input","","formControlName","phoneNumber","id","phoneNumber"],["nzFor","website","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Ingrese el sitio web!",3,"nzSm","nzXs"],["nz-input","","id","website","formControlName","website","placeholder","website"],["nz-col","","nzSpan","6"],[3,"nzActions"],[3,"nzActive","nzAvatar"],[3,"nzAvatar","nzTitle"],["nzSize","large",2,"vertical-align","middle",3,"ngStyle","nzText"],["nz-icon","","nzType","'check-circle'","nzTwotoneColor","'#52c41a'","nzTooltipTitle","Activo","nzTooltipPlacement","topLeft","nz-tooltip","",3,"nzTheme","click",4,"ngIf"],["nz-icon","","nzType","'pause-circle'","nzTwotoneColor","'#de4436'","nzTooltipTitle","Inactivo","nzTooltipPlacement","topLeft","nz-tooltip","",3,"nzTheme","click",4,"ngIf"],["nz-icon","","nzType","'check-circle'","nzTwotoneColor","'#52c41a'","nzTooltipTitle","Activo","nzTooltipPlacement","topLeft","nz-tooltip","",3,"click","nzTheme"],["nz-icon","","nzType","'pause-circle'","nzTwotoneColor","'#de4436'","nzTooltipTitle","Inactivo","nzTooltipPlacement","topLeft","nz-tooltip","",3,"click","nzTheme"],["nz-icon","","nzType","edit","routerLinkActive","router-link-active","nzTooltipTitle","Editar","nzTooltipPlacement","topLeft","nz-tooltip","",3,"routerLink"],["nz-dropdown","","nzPlacement","bottomRight",3,"nzDropdownMenu"],["nz-icon","","nzType","ellipsis","nzTooltipTitle","M\xE1s informaci\xF3n","nzTooltipPlacement","topLeft","nz-tooltip",""],["nz-menu","","nzSelectable",""],["nz-menu-item","","routerLinkActive","router-link-active",3,"routerLink"],["nz-icon","","nzType","user"],["nz-icon","","nzType","shopping"],["nz-icon","","nzType","clock-circle"],["nz-menu-divider",""],["nz-menu-item","",3,"click"],["nz-icon","","nzTheme","twotone","nzTwotoneColor","#de4436","nzType","delete"]],template:function(i,r){i&1&&(t(0,"nz-page-header")(1,"nz-page-header-title"),s(2,"CRM"),n(),t(3,"nz-page-header-subtitle"),s(4,"Informaci\xF3n Comercial"),n(),t(5,"nz-page-header-extra")(6,"div",5)(7,"div",6)(8,"div",7),d(9,"i",8),n(),t(10,"div",9)(11,"h2",10),s(12),G(13,"number"),n(),t(14,"span",11),s(15,"Empresas"),n()()(),t(16,"div",6)(17,"div",7),d(18,"i",12),n(),t(19,"div",9)(20,"h2",10),s(21),G(22,"number"),n(),t(23,"span",11),s(24,"Usuarios"),n()()(),t(25,"div",13)(26,"div",7),d(27,"i",14),n(),t(28,"div",9)(29,"h2",10),s(30),G(31,"number"),n(),t(32,"span",11),s(33,"Padres"),n()()(),t(34,"div",15)(35,"button",16),g("click",function(){return r.showModal()}),d(36,"i",17),s(37,"Nueva Empresa"),n()()()(),t(38,"nz-page-header-footer")(39,"ul",18)(40,"li",19)(41,"ul")(42,"li",20)(43,"ul")(44,"li",21),s(45,"Empresas"),n(),t(46,"li",21),s(47,"Rutas"),n(),t(48,"li",21),s(49,"Clientes"),n()()()()(),t(50,"li",22)(51,"ul")(52,"li",23)(53,"ul")(54,"li",21),s(55,"Este mes"),n(),t(56,"li",21),s(57,"Mes pasado"),n()()()()()()()(),d(58,"br"),h(59,Dn,1,0,"nz-empty",24),t(60,"div",25),h(61,On,12,10,"div",26),n(),t(62,"nz-modal",27),H("nzVisibleChange",function(z){return j(r.isVisible,z)||(r.isVisible=z),z}),g("nzOnCancel",function(){return r.handleCancel()})("nzOnOk",function(){return r.submitForm()}),t(63,"form",28),g("ngSubmit",function(){return r.submitForm()}),t(64,"nz-form-item")(65,"nz-form-label",29),s(66,"Nombre Corto"),n(),t(67,"nz-form-control",30),d(68,"input",31),n()(),t(69,"nz-form-item")(70,"nz-form-label",32)(71,"span"),s(72," Direcci\xF3n "),d(73,"i",33),n()(),t(74,"nz-form-control",34),d(75,"input",35),n()(),t(76,"nz-form-item")(77,"nz-form-label",36),s(78,"Tel\xE9fono"),n(),t(79,"nz-form-control",37),d(80,"input",38),n()(),t(81,"nz-form-item")(82,"nz-form-label",39),s(83,"Sitio web"),n(),t(84,"nz-form-control",40),d(85,"input",41),n()()()()),i&2&&(m(12),N(le(13,26,r.summarized.currentAccounts,"1.0-2")),m(9),N(Xt(22,29,r.summarized.currentUsers)),m(9),N(Xt(31,31,r.summarized.currentParents)),m(29),c("ngIf",r.accountsList.length===0),m(),c("nzGutter",8),m(),c("ngForOf",r.accountsList),m(),q("nzVisible",r.isVisible),c("nzOkLoading",r.isOkLoading)("nzOkDisabled",!r.validateForm.valid),m(),c("formGroup",r.validateForm),m(2),c("nzSm",6)("nzXs",24),m(2),c("nzSm",14)("nzXs",24),m(3),c("nzSm",6)("nzXs",24),m(4),c("nzSm",14)("nzXs",24),m(3),c("nzSm",6)("nzXs",24),m(2),c("nzSm",14)("nzXs",24),m(3),c("nzSm",6)("nzXs",24),m(2),c("nzSm",14)("nzXs",24))},dependencies:[A,M,it,K,B,U,ee,Z,ie,te,ne,He,Ue,Ei,fe,he,Ti,ot,Ni,ge,We,ve,ze,k,P,V,Be,yi,re,_e,Se,de,Fi,fi,gi,X,me,O,W,Q,J,ji,zi]});let o=l;return o})();function Bn(o,l){o&1&&d(0,"i",25)}var $i=(()=>{let l=class l{constructor(e,i,r){this.afs=e,this.msg=i,this.ngxCsvParser=r,this.customersService=C(pe),this.accountId="",this.accountName="",this.rolService=C(oe),this.authService=C(Y),this.usersList=[],this.columnDefs=rt,this.rowGroupPanelShow=Ft,this.gridOptions=this.getGridOptions(),this.pageSize=10,this.isVisible=!1,this.isConfirmLoading=!1,this.current=0,this.index="First-content",this.csvRecords=[],this.header=!0,this.isSavingUsers=!1,this.isDone=!1,this.infoLoad=[],this.usersService=C(pe),this.authService.user.subscribe(p=>{this.user=p,this.user.rolId!=null&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(z=>{this.infoLoad=z,this.userlevelAccess=this.infoLoad.optionAccessLavel})}),this.popupParent=document.querySelector("body")}ngOnInit(){this.getSubscriptions()}ngOnDestroy(){this.sub.unsubscribe()}getSubscriptions(){this.sub=this.usersService.getAccountUsers(this.accountId).pipe(w(e=>e.map(i=>{let r=i.payload.doc.id,p=i.payload.doc.data();return E({id:r},p)}))).subscribe(e=>{this.usersList=e,console.log(this.usersList)})}repairUsers(){this.usersList.forEach(e=>{let i=this.afs.doc(`/users/${e.id}`),r=this.afs.doc(`/users/${e.uid}`);e.uid==e.id?console.log("skipped user: ",e):r.set(e,{merge:!0}).then(()=>{i.delete()})})}sendMessage(e,i){this.msg.create(e,i)}deleteUsers(){this.userlevelAccess=="1"?this.usersList.forEach(e=>{console.log(e),this.usersService.deleteUser(e.id)}):this.sendMessage("error","El usuario no tiene permisos para borrar datos, favor de contactar al administrador.")}onGridReady(e){this.gridApi=e.api,this.gridColumnApi=e.columnApi}getGridOptions(){return{columnDefs:rt,context:{thisComponent:this},rowData:null,rowSelection:"single",pagination:!0,paginationPageSize:this.pageSize,defaultColDef:{sortable:!0,filter:!0},statusBar:{statusPanels:[{statusPanel:"agFilteredRowCountComponent"},{statusPanel:"agSelectedRowCountComponent"},{statusPanel:"agAggregationComponent"}]},enableRangeSelection:!0}}setPaginationPageSize(e=10){this.pageSize=e,console.log(this.gridApi),this.gridApi.paginationSetPageSize(Number(e))}getContextMenuItems(e){var i=[{name:"Ver detalles de "+e.node.data.firstName,action:()=>{console.log(e),e.context.thisComponent.afs.collection("testFCM").doc(e.value).set({name:"hola"})},icon:'<nz-avatar nzIcon="user"></nz-avatar>',cssClasses:["redFont","bold"]},"separator",{name:"Checked",checked:!0,action:function(){console.log("Checked Selected")},icon:'<img src="../images/skills/mac.png"/>'},"copy","separator"];return i}showModal(){this.isVisible=!0,this.isDone=!1,this.isSavingUsers=!1}handleOk(){console.log("Button ok clicked!"),this.isSavingUsers=!1,this.isVisible=!1,this.csvRecords=[],this.current=0,this.isDone=!1}handleCancel(){console.log("Button cancel clicked!"),this.isVisible=!1,this.csvRecords=[],this.current=0,this.isDone=!1}pre(){this.current-=1,this.changeContent()}next(){this.current+=1,this.changeContent()}done(){this.isSavingUsers=!0,this.userlevelAccess!="3"?this.csvRecords.forEach(e=>{this.usersService.createUserWithoutApp(this.makeUserObject(e)).then(i=>{console.log(i);let r=e.createBoardingPass;console.log("create boarding pass: ",r),r&&(e.uid=i,console.log("will create a boarding pass for this user"),this.makeBoardingPassObject(e)),console.log(i),e.result="Creado"}).catch(i=>{console.log(i),e.result=i.message})}):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador."),this.isDone=!0}makeBoardingPassObject(e){return zt(this,null,function*(){console.log(e);let i,r,p,S=this.afs.collection("customers").doc(this.accountId).collection("products").ref.where("name","==",e.service),Ve=this.afs.collection("customers").doc(this.accountId).collection("routes").ref.where("name","==",e.routeName);this.userlevelAccess!="3"?S.get().then(Ne=>{let ut=Ne.size;if(console.log("size of services found: ",ut),ut>0)Ne.forEach(Ke=>{let gt=Ke.id,vt=Ke.data();i=E({id:gt},vt)});else return;Ve.get().then(Ke=>{let gt=Ke.size;if(console.log("size of route found; ",gt),gt>0)Ke.forEach(vt=>{let an=vt.id,sn=vt.data();r=E({id:an},sn);let ln=this.afs.collection("customers").doc(this.accountId).collection("routes").doc(r.id).collection("stops").ref,mn=vi(ln,_i("order","==",+e.stop));Si(mn).then(Zt=>{let ei=Zt.size;if(console.log("size of stop found; ",ei),ei>0){Zt.forEach(_t=>{let cn=_t.id,dn=_t.data(),yr=E({id:cn},dn)}),console.log(i,r,p);let ti={active:e.validated,amount:i.price,authorization:"",category:i.category,conciliated:!1,creation_date:new Date().toISOString(),currency:"MXN",customer_id:this.accountId,date_created:new Date().toISOString(),description:i.description,due_date:new Date(i.validTo.toDate()).toISOString(),name:i.name,price:i.price,product_description:i.description,product_id:i.id,realValidTo:new Date(i.validTo.toDate()).toISOString(),error_message:"",fee:{amount:0,currency:"MXN",tax:0},isOpenpay:!1,isTaskIn:!0,isTaskOut:!0,is_courtesy:!1,method:"cash",operation_date:new Date().toISOString(),operation_type:"in",order_id:"",paidApp:"web",payment_method:{barcode_url:"",reference:"",type:"cash"},round:e.round,routeId:r.id,routeName:r.name,status:"completed",stopDescription:p.description,stopId:p.id,stopName:p.name,transaction_type:"charge",validFrom:i.validFrom,validTo:i.validTo};console.log(ti),this.customersService.saveBoardingPassToUserPurchaseCollection(e.uid,ti).then(_t=>{this.isVisible=!1,this.isConfirmLoading=!1}).catch(_t=>{this.isConfirmLoading=!1});return}else return})});else return})}):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")})}makeUserObject(e){return{_isEditMode:!1,customerId:this.accountId,customerName:this.accountName,disabled:!1,displayName:e.firstName+" "+e.lastName,email:e.email||"",emailVerified:!1,firstName:e.firstName,lastName:e.lastName,lastUpdatedAt:new Date,occupation:"user",paid:!1,phone:e.phone,phoneNumber:e.phone,photoURL:"",roles:["user"],studentId:e.employeeId,uid:"",username:e.firstName,userRegisteredBy:"fromWizard"}}handleChange(e){let i=e.file.status;e.fileList.length==0&&(this.csvRecords=[]),i!=="uploading"&&console.log(e.file,e.fileList,e),i==="done"?(this.msg.success(`${e.file.name} Se ha cargado con \xE9xito.`),console.log(e.file),e.file.originFileObj&&this.parser(e.file.originFileObj)):i==="error"&&this.msg.error(`${e.file.name} no ha podido ser cargado.`)}parser(e){setTimeout(()=>{this.ngxCsvParser.parse(e,{header:this.header,delimiter:","}).subscribe(i=>{if(i instanceof Dt)console.log("Error",i);else{let r=i;console.log("Result",r),this.csvRecords=r}})},100)}sanitizeResults(e){let i=[];for(let r of e){let p=r.createBoardingPass.toLowerCase()==="true",z=Object.assign(r);z.createBoardingPass=p,i.push(z)}this.csvRecords=i,console.log(this.csvRecords)}changeContent(){switch(this.current){case 0:{this.index="First-content";break}case 1:{this.index="Second-content";break}case 2:{this.index="third-content";break}default:this.index="error"}}};l.\u0275fac=function(i){return new(i||l)(b(ce),b(D),b(Pt))},l.\u0275cmp=I({type:l,selectors:[["app-shared-users-list"]],inputs:{accountId:"accountId",accountName:"accountName"},decls:58,vars:5,consts:[["menu","nzDropdownMenu"],["suffixIconSearch",""],["nz-page-header-avatar","","nzSrc","https://avatars0.githubusercontent.com/u/22736418?s=88&v=4",2,"background-color","white","color","#4F6F57"],[3,"nzColor"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea"],["nz-button","","nzNoAnimation","","nz-dropdown","",2,"border","none","padding","0",3,"nzDropdownMenu"],["nz-icon","","nzType","ellipsis","nzTheme","outline",2,"font-size","20px","vertical-align","top"],["nz-menu",""],["nz-menu-item",""],[1,"wrap"],[1,"content"],["nz-paragraph",""],[1,"content-link"],["src","https://gw.alipayobjects.com/zos/rmsportal/MjEImQtenlyueSmVEfUD.svg","alt","start"],["src","https://gw.alipayobjects.com/zos/rmsportal/NbuDUAuBlIApFuDvWiND.svg","alt","info"],["src","https://gw.alipayobjects.com/zos/rmsportal/ohOEPSYdDTNnyMbGuyLb.svg","alt","doc"],[1,"extra-content"],["src","https://gw.alipayobjects.com/mdn/mpaas_user/afts/img/A*KsfVQbuLRlYAAAAAAAAAAABjAQAAAQ/original","alt","content"],["nz-row","","nzGutter","8","nzAlign","bottom","nzJustify","end","nzType","flex"],["nz-col","","nzSpan","8"],["nzSize","large",3,"nzSuffix"],["type","text","nz-input","","placeholder","input search text"],["nz-row",""],["nz-col","","nzSpan","24"],[1,"ag-theme-material",2,"width","100%","height","350px",3,"rowData","columnDefs"],["nz-icon","","nzType","search"]],template:function(i,r){if(i&1&&(t(0,"nz-page-header"),d(1,"nz-avatar",2),t(2,"nz-page-header-title"),s(3,"Cuentas de Empresas"),n(),t(4,"nz-page-header-subtitle"),s(5,"Listado de cuentas de la empresa And"),n(),t(6,"nz-page-header-tags")(7,"nz-tag",3),s(8,"Empresas"),n()(),t(9,"nz-page-header-extra")(10,"button",4),s(11,"Agregar"),n(),t(12,"button",4),s(13,"Editar"),n(),t(14,"button",4),s(15,"Kardex"),n(),t(16,"button",5),d(17,"i",6),n(),t(18,"nz-dropdown-menu",null,0)(20,"ul",7)(21,"li",8),s(22,"Desactivar cuenta"),n(),t(23,"li",8),s(24,"Eliminar cuenta"),n(),t(25,"li",8),s(26,"Exportar a excel"),n()()()(),t(27,"nz-page-header-content")(28,"div",9)(29,"div",10)(30,"div",10)(31,"p",11),s(32," Los usuarios de And pertenecen a una cuenta. Esta determina los productos y servicios a los que los usuarios tienen acceso. "),n(),t(33,"p",11),s(34," Ant Design's design team preferred to design with the HSB color model, which makes it easier for designers to have a clear psychological expectation of color when adjusting colors, as well as facilitate communication in teams. "),n(),t(35,"p",12)(36,"a"),d(37,"img",13),s(38,"Quick Start "),n(),t(39,"a"),d(40,"img",14),s(41,"Product Info "),n(),t(42,"a"),d(43,"img",15),s(44,"Product Doc "),n()()()(),t(45,"div",16),d(46,"img",17),n()()()(),t(47,"div",18)(48,"div",19)(49,"nz-input-group",20),d(50,"input",21),n(),h(51,Bn,1,0,"ng-template",null,1,F),n()(),t(53,"div",22)(54,"div",23),d(55,"ag-grid-angular",24),n()(),d(56,"br")(57,"br")),i&2){let p=T(19),z=T(52);m(7),c("nzColor","blue"),m(9),c("nzDropdownMenu",p),m(33),c("nzSuffix",z),m(6),c("rowData",r.accountsList)("columnDefs",r.columnDefs)}},dependencies:[Vt,K,B,U,ne,Re,Oe,Ue,fe,he,ge,ve,wi,k,P,V,re,_e,Se,Xe,Ii,de,Di,Qe],encapsulation:2});let o=l;return o})();var $n=["download"];function Gn(o,l){if(o&1&&(t(0,"nz-timeline-item",4),s(1),G(2,"date"),t(3,"p"),s(4),n(),t(5,"p"),s(6),n(),t(7,"p"),s(8),n(),t(9,"p"),s(10),n(),t(11,"p"),s(12),n()()),o&2){let a=l.$implicit;c("nzColor",a.allowedOnBoard?"green":"red"),m(),y(" ",le(2,7,a.created.toDate(),"medium")," "),m(3),y("Programa: ",a.program==="S"?"Salida":"Entrada",""),m(2),y("Turno: ",a.round,""),m(2),y("Unidad: ",a.vehicle,""),m(2),y("PR: ",a.driver,""),m(2),y("Mensaje: ",a.description,"")}}function Wn(o,l){if(o&1){let a=x();t(0,"tr")(1,"td"),s(2),n(),t(3,"td")(4,"div",8),d(5,"nz-qrcode",9)(6,"a",null,0),t(8,"button",10),g("click",function(){v(a);let i=u(2);return _(i.downloadImg())}),s(9,"Descargar"),n()()(),t(10,"td"),s(11,"qrcode.uid,qrcode.credentialId,C"),n(),t(12,"td"),s(13," qrcode.studentId "),n(),t(14,"td"),s(15," qrcode.displayName "),n()()}if(o&2){let a=l.index;m(2),N(a+1)}}function Xn(o,l){if(o&1&&(t(0,"table",5)(1,"thead")(2,"th",6),s(3,"#"),n(),t(4,"th",6),s(5,"QRCode"),n(),t(6,"th",6),s(7,"Texto Credencial"),n(),t(8,"th",6),s(9,"Matr\xEDcula / ID Empleado"),n(),t(10,"th",6),s(11,"Usuario"),n()(),t(12,"tbody"),h(13,Wn,16,1,"tr",7),n()()),o&2){let a=u();m(13),c("ngForOf",a.userCredentials)}}var Gi=(()=>{let l=class l{constructor(){this.accountId="",this.customersService=C(pe),this.usersService=C(qe),this.stopSubscription$=new ue,this.activityLogList=[],this.loading=!0,this.userCredentials=[]}ngOnInit(){this.getSubscriptions()}ngOnDestroy(){this.stopSubscription$.next(void 0),this.stopSubscription$.complete()}getSubscriptions(){this.customersService.getAccountUsersWithCredential(this.accountId,"user").pipe(ae(this.stopSubscription$),w(e=>e.map(i=>{let r=i.payload.doc.id,p=i.payload.doc.data();return E({id:r},p)})),we(e=>(console.log("users",e),this.userCredentials=e,e))).subscribe()}downloadImg(){let e=document.getElementById("download")?.querySelector("canvas");if(e){this.download.nativeElement.href=e.toDataURL("image/png"),this.download.nativeElement.download="ng-zorro-antd";let i=new MouseEvent("click");this.download.nativeElement.dispatchEvent(i)}}};l.\u0275fac=function(i){return new(i||l)},l.\u0275cmp=I({type:l,selectors:[["app-shared-credentials-qrcodes"]],viewQuery:function(i,r){if(i&1&&Ct($n,5),i&2){let p;bt(p=xt())&&(r.download=p.first)}},inputs:{accountId:"accountId"},decls:3,vars:2,consts:[["download",""],["nzMode","alternate"],[3,"nzColor",4,"ngFor","ngForOf"],["class","table table-bordered",4,"ngIf"],[3,"nzColor"],[1,"table","table-bordered"],[2,"color","#4F6F57"],[4,"ngFor","ngForOf"],["id","download"],["nzValue","qrcode.uid + ',' + qrcode.credentialId + ',C"],["nz-button","","nzType","primary",3,"click"]],template:function(i,r){i&1&&(t(0,"nz-timeline",1),h(1,Gn,13,10,"nz-timeline-item",2),n(),h(2,Xn,14,1,"table",3)),i&2&&(m(),c("ngForOf",r.activityLogList),m(),c("ngIf",!!r.userCredentials&&r.userCredentials.length>0))},dependencies:[A,M,kt,Ce,be,Ee,xe,ye,k,P,V,Lt,At,Me]});let o=l;return o})();var Jn=["download"];function Kn(o,l){if(o&1&&(t(0,"nz-timeline-item",4),s(1),G(2,"date"),t(3,"p"),s(4),n(),t(5,"p"),s(6),n(),t(7,"p"),s(8),n(),t(9,"p"),s(10),n(),t(11,"p"),s(12),n()()),o&2){let a=l.$implicit;c("nzColor",a.allowedOnBoard?"green":"red"),m(),y(" ",le(2,7,a.created.toDate(),"medium")," "),m(3),y("Programa: ",a.program==="S"?"Salida":"Entrada",""),m(2),y("Turno: ",a.round,""),m(2),y("Unidad: ",a.vehicle,""),m(2),y("PR: ",a.driver,""),m(2),y("Mensaje: ",a.description,"")}}function Yn(o,l){if(o&1){let a=x();t(0,"td")(1,"div",9),d(2,"nz-qrcode",10)(3,"a",null,0),t(5,"button",11),g("click",function(){v(a);let i=u(3);return _(i.downloadImg())}),s(6,"Descargar"),n()()()}}function Zn(o,l){o&1&&(t(0,"td"),s(1," No qrCode available "),n())}function eo(o,l){if(o&1&&(t(0,"tr")(1,"td"),s(2),n(),h(3,Yn,7,0,"td",8)(4,Zn,2,0,"td",8),t(5,"td"),s(6,"qrcode.user.studentId"),n(),t(7,"td"),s(8,"qrcode.user.displayName "),n()()),o&2){let a=l.$implicit,e=l.index;m(2),N(e+1),m(),c("ngIf",!!a&&a.user&&a.user.id&&a.boardingPass&&a.boardingPass.id),m(),c("ngIf",!!a&&!a.user||!a.boardingPass)}}function to(o,l){if(o&1&&(t(0,"table",5)(1,"thead")(2,"th",6),s(3,"#"),n(),t(4,"th",6),s(5,"QRCode"),n(),t(6,"th",6),s(7,"Matr\xEDcula / ID Empleado"),n(),t(8,"th",6),s(9,"Usuario"),n()(),t(10,"tbody"),h(11,eo,9,3,"tr",7),n()()),o&2){let a=u();m(11),c("ngForOf",a.userBoardingPass)}}var Wi=(()=>{let l=class l{constructor(){this.accountId="",this.customersService=C(pe),this.usersService=C(qe),this.stopSubscription$=new ue,this.activityLogList=[],this.loading=!0,this.userBoardingPass=[]}ngOnInit(){this.getSubscriptions()}ngOnDestroy(){this.stopSubscription$.next(void 0),this.stopSubscription$.complete()}getSubscriptions(){this.customersService.getAccountSystemUsers(this.accountId,"user").pipe(ae(this.stopSubscription$),w(e=>e.map(i=>{let r=i.payload.doc.id,p=i.payload.doc.data();return E({id:r},p)})),we(e=>(this.getLatestValidBoardingPass(e),e))).subscribe()}getLatestValidBoardingPass(e){this.userBoardingPass=[],e.forEach(i=>this.usersService.getLastValidBoardingPass(i.id).pipe(we(r=>(this.userBoardingPass.push({user:i,boardingPass:r[0]}),r))).subscribe())}downloadImg(){let e=document.getElementById("download")?.querySelector("canvas");if(e){this.download.nativeElement.href=e.toDataURL("image/png"),this.download.nativeElement.download="ng-zorro-antd";let i=new MouseEvent("click");this.download.nativeElement.dispatchEvent(i)}}};l.\u0275fac=function(i){return new(i||l)},l.\u0275cmp=I({type:l,selectors:[["app-shared-qrcodes"]],viewQuery:function(i,r){if(i&1&&Ct(Jn,5),i&2){let p;bt(p=xt())&&(r.download=p.first)}},inputs:{accountId:"accountId"},decls:3,vars:2,consts:[["download",""],["nzMode","alternate"],[3,"nzColor",4,"ngFor","ngForOf"],["class","table table-bordered",4,"ngIf"],[3,"nzColor"],[1,"table","table-bordered"],[2,"color","#4F6F57"],[4,"ngFor","ngForOf"],[4,"ngIf"],["id","download"],["nzValue","qrcode.user.id + ',' + qrcode.boardingPass.id"],["nz-button","","nzType","primary",3,"click"]],template:function(i,r){i&1&&(t(0,"nz-timeline",1),h(1,Kn,13,10,"nz-timeline-item",2),n(),h(2,to,12,1,"table",3)),i&2&&(m(),c("ngForOf",r.activityLogList),m(),c("ngIf",!!r.userBoardingPass&&r.userBoardingPass.length>0))},dependencies:[A,M,kt,Ce,be,Ee,xe,ye,k,P,V,Lt,At,Me]});let o=l;return o})();function no(o,l){o&1&&d(0,"i",14)}function oo(o,l){o&1&&s(0," Nuevo usuario de sistema ")}function ro(o,l){}function ao(o,l){o&1&&(Le(0),s(1," Por favor confirme su contrase\xF1a "),Ae())}function so(o,l){o&1&&(Le(0),s(1," Las contrase\xF1as no coinciden "),Ae())}function lo(o,l){if(o&1&&h(0,ao,2,0,"ng-container",39)(1,so,2,0,"ng-container",39),o&2){let a=l.$implicit;c("ngIf",a.hasError("required")),m(),c("ngIf",a.hasError("confirm"))}}function mo(o,l){if(o&1){let a=x();t(0,"button",40),g("click",function(){v(a);let i=u(2);return _(i.done())}),t(1,"span"),s(2,"Crear Usuario"),n()()}if(o&2){let a=u(2);c("nzLoading",a.isSavingUsers)}}function co(o,l){if(o&1){let a=x();t(0,"div",15)(1,"form",16),g("ngSubmit",function(){v(a);let i=u();return _(i.done())}),t(2,"nz-form-item")(3,"nz-form-label",17),s(4,"Correo"),n(),t(5,"nz-form-control",18),d(6,"input",19),n()(),t(7,"nz-form-item")(8,"nz-form-label",20),s(9,"Contrase\xF1a"),n(),t(10,"nz-form-control",21)(11,"input",22),g("ngModelChange",function(){v(a);let i=u();return _(i.updateConfirmValidator())}),n()()(),t(12,"nz-form-item")(13,"nz-form-label",23),s(14,"Confirmar"),n(),t(15,"nz-form-control",24),d(16,"input",25),h(17,lo,2,2,"ng-template",null,4,F),n()(),t(19,"nz-form-item")(20,"nz-form-label",26)(21,"span"),s(22," Nombre(s) "),d(23,"i",27),n()(),t(24,"nz-form-control",28),d(25,"input",29),n()(),t(26,"nz-form-item")(27,"nz-form-label",26)(28,"span"),s(29," Apellido(s) "),d(30,"i",27),n()(),t(31,"nz-form-control",28),d(32,"input",30),n()(),t(33,"nz-form-item")(34,"nz-form-label",31),s(35,"Tel\xE9fono"),n(),t(36,"nz-form-control",32)(37,"nz-input-group"),d(38,"input",33),n()()(),t(39,"nz-form-item")(40,"nz-form-label",34),s(41,"Rol del usuario"),n(),t(42,"nz-form-control",35)(43,"nz-select",36),d(44,"nz-option",37),n()()(),h(45,mo,3,1,"button",38),n()()}if(o&2){let a=T(18),e=u();m(),c("formGroup",e.validateForm),m(2),c("nzSm",6)("nzXs",24),m(2),c("nzSm",14)("nzXs",24),m(3),c("nzSm",6)("nzXs",24),m(2),c("nzSm",14)("nzXs",24),m(3),c("nzSm",6)("nzXs",24),m(2),c("nzSm",14)("nzXs",24)("nzErrorTip",a),m(5),c("nzSm",6)("nzXs",24),m(4),c("nzSm",14)("nzXs",24),m(3),c("nzSm",6)("nzXs",24),m(4),c("nzSm",14)("nzXs",24),m(3),c("nzSm",6)("nzXs",24),m(2),c("nzSm",14)("nzXs",24)("nzValidateStatus",e.validateForm.controls.phoneNumber),m(4),c("nzSm",6)("nzXs",24),m(2),c("nzSm",14)("nzXs",24),m(3),c("ngIf",!e.isDone)}}var Xi=(()=>{let l=class l{constructor(e,i,r,p){this.afs=e,this.msg=i,this.ngxCsvParser=r,this.fb=p,this.accountId="",this.accountName="",this.usersList=[],this.columnDefs=rt,this.rowGroupPanelShow=Ft,this.gridOptions=this.getGridOptions(),this.isVisible=!1,this.isConfirmLoading=!1,this.current=0,this.index="First-content",this.csvRecords=[],this.header=!0,this.isSavingUsers=!1,this.isDone=!1,this.usersService=C(pe),this.confirmationValidator=z=>{if(z.value){if(z.value!==this.validateForm.controls.password.value)return{confirm:!0,error:!0}}else return{required:!0};return{}},this.popupParent=document.querySelector("body")}ngOnInit(){this.createForm(),this.getSubscriptions()}ngOnDestroy(){this.sub.unsubscribe()}getSubscriptions(){this.sub=this.usersService.getAccountSystemUsers(this.accountId,"customer").pipe(w(e=>e.map(i=>{let r=i.payload.doc.id,p=i.payload.doc.data();return E({id:r},p)}))).subscribe(e=>{this.usersList=e,console.log(this.usersList)})}createForm(){this.validateForm=this.fb.group({email:[null,[f.email,f.required]],password:[null,[f.required]],checkPassword:[null,[f.required,this.confirmationValidator]],firstName:[null,[f.required]],lastName:[null,[f.required]],phoneNumber:[null,[f.required]],role:[null,[f.required]]})}updateConfirmValidator(){Promise.resolve().then(()=>this.validateForm.controls.checkPassword.updateValueAndValidity())}repairUsers(){this.usersList.forEach(e=>{let i=this.afs.doc(`/users/${e.id}`),r=this.afs.doc(`/users/${e.uid}`);e.uid==e.id?console.log("skipped user: ",e):r.set(e,{merge:!0}).then(()=>{i.delete()})})}getGridOptions(){return{columnDefs:rt,context:{thisComponent:this},rowData:null,rowSelection:"single",pagination:!0,defaultColDef:{sortable:!0,filter:!0},statusBar:{statusPanels:[{statusPanel:"agFilteredRowCountComponent"},{statusPanel:"agSelectedRowCountComponent"},{statusPanel:"agAggregationComponent"}]},enableRangeSelection:!0,paginationPageSize:20}}getContextMenuItems(e){var i=[{name:"Ver detalles de "+e.node.data.firstName,action:()=>{console.log(e),e.context.thisComponent.afs.collection("testFCM").doc(e.value).set({name:"hola"})},icon:'<nz-avatar nzIcon="user"></nz-avatar>',cssClasses:["redFont","bold"]},"separator",{name:"Checked",checked:!0,action:function(){console.log("Checked Selected")},icon:'<img src="../images/skills/mac.png"/>'},"copy","separator"];return i}showModal(){this.isVisible=!0,this.isDone=!1,this.isSavingUsers=!1}handleOk(){console.log("Button ok clicked!"),this.isSavingUsers=!1,this.isVisible=!1,this.csvRecords=[],this.current=0,this.isDone=!1}handleCancel(){console.log("Button cancel clicked!"),this.isVisible=!1,this.csvRecords=[],this.current=0,this.isDone=!1}pre(){this.current-=1,this.changeContent()}next(){this.current+=1,this.changeContent()}done(){this.isSavingUsers=!0,this.usersService.createSystemUser(this.makeUserObject(this.validateForm.value)).then(e=>{console.log(e)}).catch(e=>{console.log(e)}),this.isDone=!0,this.isVisible=!1,this.isSavingUsers=!1}makeUserObject(e){return{_isEditMode:!1,customerId:this.accountId,customerName:this.accountName,disabled:!1,displayName:e.firstName+" "+e.lastName,email:e.email||"",emailVerified:!1,firstName:e.firstName,lastName:e.lastName,lastUpdatedAt:new Date,occupation:"customer",paid:!1,phone:e.phoneNumber,phoneNumber:e.phoneNumber,photoURL:"",roles:[e.role],studentId:e.employeeId||"unspecified",uid:"",username:e.firstName,userRegisteredBy:"fromSystem"}}handleChange(e){let i=e.file.status;e.fileList.length==0&&(this.csvRecords=[]),i!=="uploading"&&console.log(e.file,e.fileList,e),i==="done"?(this.msg.success(`${e.file.name} Se ha cargado con \xE9xito.`),console.log(e.file),e.file.originFileObj&&this.parser(e.file.originFileObj)):i==="error"&&this.msg.error(`${e.file.name} no ha podido ser cargado.`)}parser(e){setTimeout(()=>{this.ngxCsvParser.parse(e,{header:this.header,delimiter:","}).subscribe(i=>{if(i instanceof Dt)console.log("Error",i);else{let r=i;console.log("Result",r),this.csvRecords=r}})},100)}changeContent(){switch(this.current){case 0:{this.index="First-content";break}case 1:{this.index="Second-content";break}case 2:{this.index="third-content";break}default:this.index="error"}}};l.\u0275fac=function(i){return new(i||l)(b(ce),b(D),b(Pt),b(R))},l.\u0275cmp=I({type:l,selectors:[["app-shared-system-users-list"]],inputs:{accountId:"accountId",accountName:"accountName"},decls:25,vars:11,consts:[["suffixIconSearch",""],["modalTitle",""],["modalContent",""],["modalFooter",""],["errorTpl",""],[1,"site-page-header"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["nz-row",""],[1,"content"],[1,"col-md-4","col-sm-12"],[3,"nzSuffix"],["type","text","nz-input","","placeholder","Buscar ..."],[1,"ag-theme-material",2,"width","100%","height","450px",3,"rowData","getContextMenuItems","columnDefs","gridOptions","popupParent"],[3,"nzVisibleChange","nzOnCancel","nzVisible","nzWidth","nzTitle","nzContent","nzFooter"],["nz-icon","","nzType","search"],[1,""],["nz-form","",3,"ngSubmit","formGroup"],["nzRequired","","nzFor","email",3,"nzSm","nzXs"],["nzErrorTip","Por favor escriba un correo electr\xF3nico",3,"nzSm","nzXs"],["nz-input","","formControlName","email","id","email"],["nzFor","password","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Escriba una contrase\xF1a",3,"nzSm","nzXs"],["nz-input","","type","password","id","password","formControlName","password",3,"ngModelChange"],["nzFor","checkPassword","nzRequired","",3,"nzSm","nzXs"],[3,"nzSm","nzXs","nzErrorTip"],["nz-input","","type","password","formControlName","checkPassword","id","checkPassword"],["nzFor","nickname","nzRequired","",3,"nzSm","nzXs"],["nz-icon","","nz-tooltip","","nzTooltipTitle","Escriba su nombre completo","nzType","question-circle","nzTheme","outline"],["nzErrorTip","Por favor ingrese su nombre completo",3,"nzSm","nzXs"],["nz-input","","id","firstName","formControlName","firstName"],["nz-input","","id","lastName","formControlName","lastName"],["nzFor","phoneNumber","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Ingrese su numero de tel\xE9fono",3,"nzSm","nzXs","nzValidateStatus"],["formControlName","phoneNumber","id","'phoneNumber'","nz-input",""],[3,"nzSm","nzXs"],["nzHasFeedback","",3,"nzSm","nzXs"],["name","select-error","formControlName","role"],["nzValue","customer","nzLabel","Empresa"],["nz-button","","style"," background-color: #4F6F57; color: #f6f3ea;","type","submit",3,"nzLoading","click",4,"ngIf"],[4,"ngIf"],["nz-button","","type","submit",2,"background-color","#4F6F57","color","#f6f3ea",3,"click","nzLoading"]],template:function(i,r){if(i&1){let p=x();t(0,"nz-page-header",5)(1,"nz-page-header-title"),s(2,"Usuarios del sistema"),n(),t(3,"nz-page-header-subtitle"),s(4,"Roles del sistema"),n(),t(5,"nz-page-header-extra")(6,"button",6),g("click",function(){return v(p),_(r.showModal())}),s(7,"Nuevo Usuario"),n()(),t(8,"nz-page-header-content")(9,"div",7)(10,"div",8)(11,"div",9)(12,"nz-input-group",10),d(13,"input",11),n(),h(14,no,1,0,"ng-template",null,0,F),n()()()()(),d(16,"br")(17,"ag-grid-angular",12),t(18,"nz-modal",13),H("nzVisibleChange",function(S){return v(p),j(r.isVisible,S)||(r.isVisible=S),_(S)}),g("nzOnCancel",function(){return v(p),_(r.handleCancel())}),h(19,oo,1,0,"ng-template",null,1,F)(21,ro,0,0,"ng-template",null,2,F)(23,co,46,32,"ng-template",null,3,F),n()}if(i&2){let p=T(15),z=T(20),S=T(22),L=T(24);m(12),c("nzSuffix",p),m(5),c("rowData",r.usersList)("getContextMenuItems",r.getContextMenuItems)("columnDefs",r.columnDefs)("gridOptions",r.gridOptions)("popupParent",r.popupParent),m(),q("nzVisible",r.isVisible),c("nzWidth",620)("nzTitle",z)("nzContent",S)("nzFooter",L)}},dependencies:[M,Vt,K,B,U,ee,Z,ie,te,ne,Re,Oe,He,ze,k,P,V,re,_e,Se,Xe,de,$e,Ge,X,me,O,W,Q,J]});let o=l;return o})();function zo(o,l){if(o&1&&(t(0,"form",6)(1,"nz-form-item")(2,"nz-form-label"),s(3,"Nombre de la Ruta"),n(),t(4,"nz-form-control"),d(5,"input",7),n()(),t(6,"nz-form-item")(7,"nz-form-label"),s(8,"Descripci\xF3n"),n(),t(9,"nz-form-control"),d(10,"textarea",8),n()()()),o&2){let a=u();c("formGroup",a.objectForm)}}function ho(o,l){if(o&1&&(t(0,"nz-tab",9),d(1,"app-shared-stoppoints-list",10),n()),o&2){let a=l.$implicit,e=u();c("nzTitle",a.name),m(),c("accountId",e.accountId)("routeId",a.id)}}var Qi=(()=>{let l=class l{constructor(e,i,r){this.modalService=e,this.messageService=i,this.fb=r,this.accountId="",this.routesService=C(Nt),this.tabs=[],this.nzTabPosition="top",this.selectedIndex=0,this.routesList=[],this.stopPointsList=[]}ngOnInit(){this.createForm(),this.getSubscriptions()}ngOnDestroy(){this.sub.unsubscribe()}createForm(){this.objectForm=this.fb.group({active:[!1,[f.required]],description:["",[f.required]],imageUrl:[""],kmzUrl:[""],name:["",[f.minLength(5),f.maxLength(20),f.required]],routeId:[""],customerId:["",[f.required]],customerName:[""]})}resetForm(){this.objectForm.reset({active:!1,description:"",imageUrl:"",kmzUrl:"",name:"",routeId:"",customerId:"",customerName:""})}addNewRoute(e){let i=this.modalService.create({nzTitle:"Nueva Ruta",nzContent:e,nzFooter:[{label:"Crear Ruta",type:"primary",onClick:()=>this.modalService.confirm({nzTitle:"\xBFEst\xE1 la informaci\xF3n completa?",nzOnOk:()=>{this.objectForm.get("customerId").setValue(this.accountId),this.objectForm.valid&&this.routesService.setRoute(this.accountId,this.objectForm.value).then(()=>{this.modalService.closeAll()}).catch(r=>console.log(r))}})}],nzWidth:500})}getSubscriptions(){this.sub=this.routesService.getRoutes(this.accountId).pipe(w(e=>e.map(i=>{let r=i.payload.doc.id,p=i.payload.doc.data();return ke(E({},p),{id:r})}))).subscribe(e=>{this.routesList=e,e.forEach(i=>{this.tabs.push({name:i.name,content:`Content of tab ${i.name}`})})})}};l.\u0275fac=function(i){return new(i||l)(b(je),b(D),b(R))},l.\u0275cmp=I({type:l,selectors:[["app-shared-routes-list"]],inputs:{accountId:"accountId"},decls:9,vars:4,consts:[["newProjectContent",""],[1,"site-page-header-ghost-wrapper"],[3,"nzGhost"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],[3,"nzSelectedIndexChange","nzTabPosition","nzSelectedIndex"],[3,"nzTitle",4,"ngFor","ngForOf"],["nz-form","","nzLayout","vertical",3,"formGroup"],["type","text","formControlName","name","nz-input","","placeholder","Escriba el nombre de la ruta"],["formControlName","description","nz-input",""],[3,"nzTitle"],[3,"accountId","routeId"]],template:function(i,r){if(i&1){let p=x();t(0,"div",1)(1,"nz-page-header",2)(2,"nz-page-header-extra")(3,"button",3),g("click",function(){v(p);let S=T(6);return _(r.addNewRoute(S))}),s(4,"Agregar Ruta"),n()()()(),h(5,zo,11,1,"ng-template",null,0,F),t(7,"nz-tabset",4),H("nzSelectedIndexChange",function(S){return v(p),j(r.selectedIndex,S)||(r.selectedIndex=S),_(S)}),h(8,ho,2,3,"nz-tab",5),n()}i&2&&(m(),c("nzGhost",!1),m(6),c("nzTabPosition",r.nzTabPosition),q("nzSelectedIndex",r.selectedIndex),m(),c("ngForOf",r.routesList))},dependencies:[A,B,U,ee,Z,ie,te,ne,k,P,V,re,de,X,me,O,W,Q,J,It,wt,Li]});let o=l;return o})();var jt=pn(un());function go(o,l){if(o&1&&(t(0,"nz-tag",36),s(1,"Dom"),n()),o&2){let a=u().$implicit;c("nzColor",a.isSunday?"geekblue":"")}}function vo(o,l){if(o&1&&(t(0,"nz-tag",36),s(1,"Lun"),n()),o&2){let a=u().$implicit;c("nzColor",a.isMonday?"geekblue":"")}}function _o(o,l){if(o&1&&(t(0,"nz-tag",36),s(1,"Mar"),n()),o&2){let a=u().$implicit;c("nzColor",a.isTuesday?"geekblue":"")}}function So(o,l){if(o&1&&(t(0,"nz-tag",36),s(1,"Mi\xE9"),n()),o&2){let a=u().$implicit;c("nzColor",a.isWednesday?"geekblue":"")}}function Co(o,l){if(o&1&&(t(0,"nz-tag",36),s(1,"Jue"),n()),o&2){let a=u().$implicit;c("nzColor",a.isThursday?"geekblue":"")}}function bo(o,l){if(o&1&&(t(0,"nz-tag",36),s(1,"Vie"),n()),o&2){let a=u().$implicit;c("nzColor",a.isFriday?"geekblue":"")}}function xo(o,l){if(o&1&&(t(0,"nz-tag",36),s(1,"S\xE1b"),n()),o&2){let a=u().$implicit;c("nzColor",a.isSaturday?"geekblue":"")}}function yo(o,l){o&1&&d(0,"i",50)}function Eo(o,l){if(o&1){let a=x();t(0,"li",45),g("click",function(){v(a);let i=u().$implicit,r=u(2);return _(r.toggleActive(i))}),d(1,"i",51),s(2," Activar "),n()}}function To(o,l){if(o&1){let a=x();t(0,"li",45),g("click",function(){v(a);let i=u().$implicit,r=u(2);return _(r.toggleActive(i))}),d(1,"i",52),s(2," Desactivar "),n()}}function No(o,l){if(o&1){let a=x();t(0,"tr")(1,"td"),s(2),n(),t(3,"td"),s(4),n(),t(5,"td")(6,"nz-tag",36),s(7),n()(),t(8,"td"),h(9,go,2,1,"nz-tag",37)(10,vo,2,1,"nz-tag",37)(11,_o,2,1,"nz-tag",37)(12,So,2,1,"nz-tag",37)(13,Co,2,1,"nz-tag",37)(14,bo,2,1,"nz-tag",37)(15,xo,2,1,"nz-tag",37),n(),t(16,"td"),s(17),n(),t(18,"td"),s(19),G(20,"date"),n(),t(21,"td")(22,"nz-tag",36),h(23,yo,1,0,"i",38),t(24,"span"),s(25),n()()(),t(26,"td")(27,"nz-tag",39),s(28),n(),s(29),n(),t(30,"td")(31,"nz-tag",40),s(32),n(),s(33),n(),t(34,"td"),s(35),n(),t(36,"td")(37,"a",41),d(38,"i",42),n(),t(39,"nz-dropdown-menu",null,1)(41,"ul",43),h(42,Eo,3,0,"li",44)(43,To,3,0,"li",44),t(44,"li",45),g("click",function(){let i=v(a).$implicit,r=u(2);return _(r.showModalEdit(i))}),d(45,"i",46),s(46," Editar "),n(),d(47,"li",47),t(48,"li",48),g("nzOnConfirm",function(){let i=v(a).$implicit,r=u(2);return _(r.showModalDelete(i))})("nzOnCancel",function(){v(a);let i=u(2);return _(i.handleCancel())}),d(49,"i",49),s(50," Eliminar "),n()()()()()}if(o&2){let a=l.$implicit,e=T(40),i=u(2);m(),se(a.active?"text-dark":"text-muted font-italic"),m(),N(a.vendorName),m(),se(a.active?"text-dark":"text-muted font-italic"),m(),N(i.getRouteName(a.routeId)),m(),se(a.active?"text-dark":"text-muted font-italic"),m(),c("nzColor",a.program=="M"?"green":"red"),m(),N(a.program=="M"?"Mete":"Saca"),m(),se(a.active?"text-dark":"text-muted font-italic"),m(),c("ngIf",a.isSunday),m(),c("ngIf",a.isMonday),m(),c("ngIf",a.isTuesday),m(),c("ngIf",a.isWednesday),m(),c("ngIf",a.isThursday),m(),c("ngIf",a.isFriday),m(),c("ngIf",a.isSaturday),m(),se(a.active?"text-dark":"text-muted font-italic"),m(),N(a.round),m(),se(a.active?"text-dark":"text-muted font-italic"),m(),y("",le(20,46,a.time.toDate(),"HH:mm")," "),m(2),se(a.active?"text-dark":"text-muted font-italic"),m(),c("nzColor",a.acRequired?"blue":""),m(),c("ngIf",a.acRequired),m(2),N(a.acRequired?"":"No"),m(),se(a.active?"text-dark":"text-muted font-italic"),m(2),N(a.stopBeginHour),m(),y(" ",a.stopBeginName,""),m(),se(a.active?"text-dark":"text-muted font-italic"),m(2),N(a.stopEndHour),m(),y(" ",a.stopEndName,""),m(),se(a.active?"text-dark":"text-muted font-italic"),m(),N(a.type),m(),se(a.active?"text-dark":"text-muted font-italic"),m(),c("nzDropdownMenu",e),m(5),c("ngIf",!a.active),m(),c("ngIf",a.active)}}function wo(o,l){if(o&1){let a=x();t(0,"nz-table",33,0),H("nzPageSizeChange",function(i){v(a);let r=u();return j(r.pageSize,i)||(r.pageSize=i),_(i)}),t(2,"thead")(3,"tr")(4,"th",34),s(5,"Asignado A"),n(),t(6,"th",34),s(7,"Ruta"),n(),t(8,"th",34),s(9,"Tarea"),n(),t(10,"th",34),s(11,"D\xEDas"),n(),t(12,"th",34),s(13,"Turno"),n(),t(14,"th",34),s(15,"Hora"),n(),t(16,"th",34),s(17,"AC"),n(),t(18,"th",34),s(19,"Inicio"),n(),t(20,"th",34),s(21,"Fin"),n(),t(22,"th",34),s(23,"Tipo"),n(),d(24,"th",34),n()(),t(25,"tbody"),h(26,No,51,49,"tr",35),n()()}if(o&2){let a=T(1),e=u();c("nzData",e.programsList)("nzLoading",e.loading),q("nzPageSize",e.pageSize),m(26),c("ngForOf",a.data)}}function Io(o,l){if(o&1&&(t(0,"nz-option",53),d(1,"i",54),s(2),d(3,"br"),s(4),n()),o&2){let a=l.$implicit;c("nzLabel",a.name)("nzValue",a.id),m(2),y(" ",a.name," "),m(2),y(" ",a.description,"")}}function Fo(o,l){if(o&1&&(t(0,"nz-option",53),d(1,"i",54),s(2),d(3,"br"),s(4),n()),o&2){let a=l.$implicit;c("nzLabel",a.name)("nzValue",a.id),m(2),y(" ",a.name," "),m(2),y(" ",a.description,"")}}function Do(o,l){if(o&1&&(t(0,"nz-option",53),d(1,"i",54),s(2),d(3,"br"),s(4),n()),o&2){let a=l.$implicit;c("nzLabel",a.name)("nzValue",a.id),m(2),y(" ",a.name," "),m(2),y(" ",a.description,"")}}function Po(o,l){if(o&1&&(t(0,"nz-option",53),d(1,"i",54),s(2),d(3,"br"),s(4),n()),o&2){let a=l.$implicit;c("nzLabel",a.name)("nzValue",a.id),m(2),y(" ",a.name," "),m(2),y(" ",a.description,"")}}var Ki=(()=>{let l=class l{constructor(e,i,r){this.notification=e,this.messageService=i,this.fb=r,this.rolService=C(oe),this.authService=C(Y),this.vendorsService=C(Ai),this.routesService=C(Nt),this.loading=!0,this.pageSize=10,this.stopSubscription$=new ue,this.programsList=[],this.routesList=[],this.stopPointsList=[],this.vendorsList=[],this.isCreateVisible=!1,this.isEditMode=!1,this.infoLoad=[],this.authService.user.subscribe(p=>{this.user=p,this.user.rolId!=null&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(z=>{this.infoLoad=z,this.userlevelAccess=this.infoLoad.optionAccessLavel})}),this.createForm(),console.log(this.assigmentType)}ngOnInit(){this.getSubscriptions()}ngOnDestroy(){this.stopSubscription$.next(void 0),this.stopSubscription$.complete()}getSubscriptions(){this.routesService.getRoutes(this.accountId).pipe(ae(this.stopSubscription$),w(e=>e.map(i=>{let r=i.payload.doc.id,p=i.payload.doc.data();return E({id:r},p)}))).subscribe(e=>{this.routesList=e,this.loading=!1}),this.routesService.getCustomerVendorAssignments(this.accountId).pipe(ae(this.stopSubscription$),w(e=>e.map(i=>{let r=i.payload.doc.id,p=i.payload.doc.data();return ke(E({},p),{id:r})}))).subscribe(e=>{this.programsList=e,console.log(e),this.loading=!1}),this.vendorsService.getVendors().pipe(ae(this.stopSubscription$),w(e=>e.map(i=>{let r=i.payload.doc.id,p=i.payload.doc.data();return ke(E({},p),{id:r})}))).subscribe(e=>{this.vendorsList=e,this.loading=!1})}getRouteName(e){let i="";if(this.routesList.length>0){let r=jt.filter(this.routesList,p=>p.id==e);r.length>0&&(i=r[0].name)}return i}createForm(){this.programForm=this.fb.group({active:[!1,[f.required]],acRequired:[!1,[f.required]],isSunday:[!1,[f.required]],isMonday:[!0,[f.required]],isTuesday:[!0,[f.required]],isWednesday:[!0,[f.required]],isThursday:[!0,[f.required]],isFriday:[!0,[f.required]],isSaturday:[!1,[f.required]],program:["",[f.required]],round:["",[f.required]],stopBeginId:["",[f.required]],stopBeginName:["",[f.required]],stopBeginHour:["",[f.required]],stopBeginHourT:[""],stopEndId:["",[f.required]],stopEndName:["",[f.required]],stopEndHour:["",[f.required]],stopEndHourT:[""],time:[new Date,[f.required]],type:[this.assigmentType,[f.required]],customerName:["",[f.required]],customerId:[this.accountId,[f.required]],vendorName:["",[f.required]],vendorId:["",[f.required]],routeId:["",[f.required]]})}patchForm(e){let i=e.stopBeginHour.split(":"),r=e.stopEndHour.split(":");console.log(Tt(e.time.toDate(),{hours:i[0],minutes:i[1]})),this.programForm.patchValue({active:e.active,acRequired:e.acRequired,isSunday:e.isSunday,isMonday:e.isMonday,isTuesday:e.isTuesday,isWednesday:e.isWednesday,isThursday:e.isThursday,isFriday:e.isFriday,isSaturday:e.isSaturday,program:e.program,round:e.round,stopBeginId:e.stopBeginId,stopBeginName:e.stopBeginName,stopBeginHour:e.stopBeginHour,stopBeginHourT:Tt(e.time.toDate(),{hours:i[0],minutes:i[1]}),stopEndId:e.stopEndId,stopEndName:e.stopEndName,stopEndHour:e.stopEndHour,stopEndHourT:Tt(e.time.toDate(),{hours:r[0],minutes:r[1]}),time:e.time.toDate(),type:e.type,customerName:e.customerName,customerId:this.accountId,vendorName:e.vendorName,vendorId:e.vendorId,routeId:e.routeId})}toggleActive(e){this.routesService.toggleRouteAssignment(this.accountId,e.routeId,e.id,e).then(()=>{this.isCreateVisible=!1,this.isEditMode=!1}).catch(i=>console.log(i))}showCreateModal(){this.programForm.reset(),this.isCreateVisible=!0,this.currentSelectedId="",this.currentSelected=null}sendMessage(e,i){this.messageService.create(e,i)}showModalDelete(e){console.log(e),this.userlevelAccess=="1"?this.routesService.deleteRouteAssignments(this.accountId,e.routeId,e.id).then(()=>{this.isCreateVisible=!1,this.isEditMode=!1}).catch(i=>console.log(i)):this.sendMessage("error","El usuario no tiene permisos para borrar datos, favor de contactar al administrador.")}showModalEdit(e){this.currentSelectedId=e.id,this.currentSelected=e,this.patchForm(e),console.log(e),setTimeout(()=>{this.isCreateVisible=!0},100),this.isEditMode=!0}handleCancel(){this.isCreateVisible=!1,this.isEditMode=!1,this.currentSelectedId=""}createProgram(){this.programForm!==null&&this.programForm!==void 0&&this.programForm.get("customerId").setValue(this.accountId);let e=new Date(this.programForm.controls.stopBeginHourT.value),i=new Date(this.programForm.controls.stopEndHourT.value),r=[e.getHours(),String(e.getMinutes()).padStart(2,"0")].join(":"),p=[i.getHours(),String(i.getMinutes()).padStart(2,"0")].join(":");this.programForm.controls.stopBeginHour.setValue(r),this.programForm.controls.stopEndHour.setValue(p),console.log(r,p);let z=this.programForm.get("stopBeginHour"),S=this.programForm.get("stopEndHour");if(z==""||S==""){this.notification.create("error","Problema con la informaci\xF3n","No est\xE1n definidos los tiempos entre estaci\xF3n de esta ruta para el turno seleccionado");return}if(this.isEditMode)if(this.userlevelAccess!="3"){let L=this.programForm.get("routeId");if(L){this.routesService.updateRouteAssignment(this.accountId,L,this.currentSelectedId,this.programForm.value).then(()=>{this.isCreateVisible=!1,this.isEditMode=!1,this.currentSelectedId=""}).catch(Ve=>console.log(Ve)),console.log(this.programForm.value);return}}else{this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.");return}else if(this.userlevelAccess!="3"){let L=this.programForm.get("routeId");if(L){this.routesService.setRouteAssignments(this.accountId,L,this.programForm.value).then(()=>{this.isCreateVisible=!1,this.isEditMode=!1}).catch(Ve=>console.log(Ve)),console.log(this.programForm.value);return}}else{this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.");return}}checkChange(e,i){this.programForm.controls[e].setValue(i),console.log(this.programForm.value)}onRouteSelected(e){this.routesService.getRouteStopPoints(this.accountId,e).pipe(ae(this.stopSubscription$),w(i=>i.map(r=>{let p=r.payload.doc.id,z=r.payload.doc.data();return ke(E({},z),{id:p})}))).subscribe(i=>{this.stopPointsList=i,this.loading=!1})}onStopPointSelected(e,i,r){console.log(this.currentSelected);let p=this.programForm.controls.time.value;console.log(p);let z=this.programForm.controls.program.value,S=i,L="";if(z=="M"?S=="stopBeginName"?L="stopBeginHourT":L="stopEndHourT":S=="stopEndName"?L="stopBeginHourT":L="stopEndHourT",console.log(p,z,e,i,L),e){let Ne=jt.filter(this.stopPointsList,Ke=>Ke.id==e)[0];console.log(Ne);let ut=this.programForm.controls.round.value;switch(console.log(ut),this.programForm.controls[i].setValue(Ne.name),ut){case"D\xEDa":this.programForm.controls[L].setValue(ht(p,Ne.round1MinutesSinceStart));break;case"Tarde":this.programForm.controls[L].setValue(ht(p,Ne.round2MinutesSinceStart));break;case"Noche":this.programForm.controls[L].setValue(ht(p,Ne.round3MinutesSinceStart));break;default:this.programForm.controls[L].setValue(ht(p,Ne.round1MinutesSinceStart));break}}}onVendorSelected(e,i){if(e){let p=jt.filter(this.vendorsList,z=>z.id==e)[0];console.log(p),this.programForm.controls[i].setValue(p.name)}}};l.\u0275fac=function(i){return new(i||l)(b(xi),b(D),b(R))},l.\u0275cmp=I({type:l,selectors:[["app-shared-customer-vendor-assignments"]],inputs:{accountId:"accountId"},decls:108,vars:15,consts:[["programsListTable",""],["menu","nzDropdownMenu"],[1,"site-page-header-ghost-wrapper"],[3,"nzGhost"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["nzShowSizeChanger","",3,"nzData","nzLoading","nzPageSize","nzPageSizeChange",4,"ngIf"],["nzTitle","Agregar asignaci\xF3n","nzWidth","600",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible"],["nz-form","",3,"ngSubmit","formGroup"],["formControlName","vendorId","nzAllowClear","","nzPlaceHolder","Selecciona la estaci\xF3n",3,"ngModelChange"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],[1,"row"],[1,"col-md-6","col-sm-12"],["formControlName","type"],["nzValue","Permanente","nzLabel","Permanente"],["nzValue","Temporal","nzLabel","Temporal"],["nzValue","Viaje Especial","nzLabel","Viaje Especial"],["formControlName","routeId",3,"ngModelChange"],["formControlName","round"],["nzValue","D\xEDa","nzLabel","D\xEDa"],["nzValue","Tarde","nzLabel","Tarde"],["nzValue","Noche","nzLabel","Noche"],["formControlName","program"],["nzValue","M","nzLabel","Mete"],["nzValue","S","nzLabel","Saca"],[1,"col-md-4","col-sm-12"],["formControlName","time","nzFormat","HH:mm"],["formControlName","stopBeginHourT","nzFormat","HH:mm"],["formControlName","stopEndHourT","nzFormat","HH:mm"],["formControlName","acRequired","nzCheckedChildren","Si","nzUnCheckedChildren","No"],["nzFor","days"],["nzMode","checkable",3,"nzCheckedChange","nzChecked"],["formControlName","stopBeginId","nzAllowClear","","nzPlaceHolder","Selecciona la estaci\xF3n",3,"ngModelChange"],["formControlName","stopEndId","nzAllowClear","","nzPlaceHolder","Selecciona la estaci\xF3n",3,"ngModelChange"],["nzShowSizeChanger","",3,"nzPageSizeChange","nzData","nzLoading","nzPageSize"],[2,"color","#4F6F57"],[4,"ngFor","ngForOf"],[3,"nzColor"],[3,"nzColor",4,"ngIf"],["nz-icon","","nzType","deployment-unit",4,"ngIf"],["nzColor","green"],["nzColor","orange"],["nz-dropdown","","nzPlacement","bottomRight",3,"nzDropdownMenu"],["nz-icon","","nzType","ellipsis","nzTooltipTitle","M\xE1s informaci\xF3n","nzTooltipPlacement","topLeft","nz-tooltip",""],["nz-menu",""],["nz-menu-item","",3,"click",4,"ngIf"],["nz-menu-item","",3,"click"],["nz-icon","","nzType","edit"],["nz-menu-divider",""],["nz-menu-item","","nz-popconfirm","","nzPopconfirmTitle","\xBFEst\xE1s seguro de eliminar esta asignaci\xF3n?","nzPopconfirmPlacement","topRight",3,"nzOnConfirm","nzOnCancel"],["nz-icon","","nzTheme","twotone","nzTwotoneColor","#de4436","nzType","delete"],["nz-icon","","nzType","deployment-unit"],["nz-icon","","nzType","check-circle"],["nz-icon","","nzType","pause-circle"],["nzCustomContent","",3,"nzLabel","nzValue"],["nz-icon","","nzType","flag"]],template:function(i,r){i&1&&(t(0,"div",2)(1,"nz-page-header",3)(2,"nz-page-header-extra")(3,"button",4),g("click",function(){return r.showCreateModal()}),s(4,"Agregar asignaci\xF3n"),n()()()(),h(5,wo,27,4,"nz-table",5),t(6,"nz-modal",6),H("nzVisibleChange",function(z){return j(r.isCreateVisible,z)||(r.isCreateVisible=z),z}),g("nzOnCancel",function(){return r.handleCancel()})("nzOnOk",function(){return r.createProgram()}),t(7,"form",7),g("ngSubmit",function(){return r.createProgram()}),t(8,"nz-form-item")(9,"nz-form-label"),s(10,"Clientes"),n(),t(11,"nz-form-control")(12,"nz-select",8),g("ngModelChange",function(z){return r.onVendorSelected(z,"vendorName")}),h(13,Io,5,4,"nz-option",9),n()()(),t(14,"div",10)(15,"div",11)(16,"nz-form-item")(17,"nz-form-label"),s(18,"Tipo de asignaci\xF3n"),n(),t(19,"nz-form-control")(20,"nz-select",12),d(21,"nz-option",13)(22,"nz-option",14)(23,"nz-option",15),n()()()(),t(24,"div",11)(25,"nz-form-item")(26,"nz-form-label"),s(27,"Ruta"),n(),t(28,"nz-form-control")(29,"nz-select",16),g("ngModelChange",function(z){return r.onRouteSelected(z)}),h(30,Fo,5,4,"nz-option",9),n()()()()(),t(31,"div",10)(32,"div",11)(33,"nz-form-item")(34,"nz-form-label"),s(35,"Turno"),n(),t(36,"nz-form-control")(37,"nz-select",17),d(38,"nz-option",18)(39,"nz-option",19)(40,"nz-option",20),n()()()(),t(41,"div",11)(42,"nz-form-item")(43,"nz-form-label"),s(44,"Tarea"),n(),t(45,"nz-form-control")(46,"nz-select",21),d(47,"nz-option",22)(48,"nz-option",23),n()()()()(),t(49,"div",10)(50,"div",24)(51,"nz-form-item")(52,"nz-form-label"),s(53,"Hora Compromiso"),n(),t(54,"nz-form-control"),d(55,"nz-time-picker",25),n()()(),t(56,"div",24)(57,"nz-form-item")(58,"nz-form-label"),s(59,"Hora Inicio"),n(),t(60,"nz-form-control"),d(61,"nz-time-picker",26),n()()(),t(62,"div",24)(63,"nz-form-item")(64,"nz-form-label"),s(65,"Hora fin"),n(),t(66,"nz-form-control"),d(67,"nz-time-picker",27),n()()()(),t(68,"div",10)(69,"div",24)(70,"nz-form-item")(71,"nz-form-label"),s(72,"Aire acondicionado"),n(),t(73,"nz-form-control"),d(74,"nz-switch",28),n()()()(),t(75,"nz-form-item")(76,"nz-form-label",29),s(77,"D\xEDas"),n(),t(78,"nz-form-control")(79,"nz-tag",30),g("nzCheckedChange",function(z){return r.checkChange("isSunday",z)}),s(80,"Dom"),n(),t(81,"nz-tag",30),g("nzCheckedChange",function(z){return r.checkChange("isMonday",z)}),s(82,"Lun"),n(),t(83,"nz-tag",30),g("nzCheckedChange",function(z){return r.checkChange("isTuesday",z)}),s(84,"Mar"),n(),t(85,"nz-tag",30),g("nzCheckedChange",function(z){return r.checkChange("isWednesday",z)}),s(86,"Mi\xE9"),n(),t(87,"nz-tag",30),g("nzCheckedChange",function(z){return r.checkChange("isThursday",z)}),s(88,"Jue"),n(),t(89,"nz-tag",30),g("nzCheckedChange",function(z){return r.checkChange("isFriday",z)}),s(90,"Vie"),n(),t(91,"nz-tag",30),g("nzCheckedChange",function(z){return r.checkChange("isSaturday",z)}),s(92,"S\xE1b"),n()()(),t(93,"div",10)(94,"div",11)(95,"nz-form-item")(96,"nz-form-label"),s(97,"Inicia en"),n(),t(98,"nz-form-control")(99,"nz-select",31),g("ngModelChange",function(z){return r.onStopPointSelected(z,"stopBeginName","stopBeginHourT")}),h(100,Do,5,4,"nz-option",9),n()()()(),t(101,"div",11)(102,"nz-form-item")(103,"nz-form-label"),s(104,"Termina en"),n(),t(105,"nz-form-control")(106,"nz-select",32),g("ngModelChange",function(z){return r.onStopPointSelected(z,"stopEndName","stopEndHourT")}),h(107,Po,5,4,"nz-option",9),n()()()()()()()),i&2&&(m(),c("nzGhost",!1),m(4),c("ngIf",r.routesList.length>0),m(),q("nzVisible",r.isCreateVisible),m(),c("formGroup",r.programForm),m(6),c("ngForOf",r.vendorsList),m(17),c("ngForOf",r.routesList),m(49),c("nzChecked",r.programForm.controls.isSunday.value),m(2),c("nzChecked",r.programForm.controls.isMonday.value),m(2),c("nzChecked",r.programForm.controls.isTuesday.value),m(2),c("nzChecked",r.programForm.controls.isWednesday.value),m(2),c("nzChecked",r.programForm.controls.isThursday.value),m(2),c("nzChecked",r.programForm.controls.isFriday.value),m(2),c("nzChecked",r.programForm.controls.isSaturday.value),m(9),c("ngForOf",r.stopPointsList),m(7),c("ngForOf",r.stopPointsList))},dependencies:[A,M,K,B,U,ee,Z,ie,te,at,Ce,be,Ee,xe,ye,He,st,fe,he,ot,ge,We,ve,ze,k,P,V,re,de,Qe,$e,Ge,X,O,W,Q,J,Me]});let o=l;return o})();var Yi=(()=>{let l=class l{constructor(e,i){this.afs=e,this.messageService=i,this.promotion=this.afs.collection("customer")}getPromotionsList(e){return this.afs.collection("customers").doc(e).collection("promotions",r=>r.orderBy("date_created","asc")).snapshotChanges()}savePromotion(e,i){let r=this.afs.createId(),p=this.afs.collection("customers").doc(i).collection("promotions").doc(r),z=this.afs.firestore.batch();return z.set(p.ref,e),z.commit()}editPromotion(e,i,r,p,z,S){return this.afs.collection("customers").doc(i).collection("promotions").doc(e).update({name:r,description:p,validFrom:z,validTo:z}).then(()=>{this.sendMessage("success","\xA1Listo! la promoci\xF3n fue actualizada")}).catch(Ve=>{this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal ... ${Ve}`)})}deactivePromotion(e,i,r){return this.afs.collection("customers").doc(r).collection("promotions").doc(e).update({active:i}).then(()=>{this.sendMessage("success","\xA1Listo! la promoci\xF3n fue desactivada")}).catch(z=>{this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal ... ${z}`)})}deletePromotion(e,i){this.afs.collection("customers").doc(e).collection("promotions").doc(i).delete().then(()=>this.sendMessage("success","La Promocion a sido eliminada.")).catch(p=>this.sendMessage("error",`\xA1Oops! Algo sali\xF3 mal ... ${p}`))}sendMessage(e,i){this.messageService.create(e,i)}};l.\u0275fac=function(i){return new(i||l)(Ye(ce),Ye(D))},l.\u0275prov=et({token:l,factory:l.\u0275fac,providedIn:"root"});let o=l;return o})();var Ao=()=>({width:"100%"});function Mo(o,l){o&1&&d(0,"i",29)}function Oo(o,l){o&1&&(t(0,"nz-tag",35),s(1,"Activo"),n()),o&2&&c("nzColor","cyan")}function Ro(o,l){o&1&&(t(0,"nz-tag",35),s(1,"Suspendido"),n()),o&2&&c("nzColor","red")}function Uo(o,l){if(o&1){let a=x();t(0,"li",42),g("click",function(){v(a);let i=u().$implicit,r=u(2);return _(r.diactivePromotion(!1,i.id))}),s(1,"Suspender Promoci\xF3n "),n()}}function Bo(o,l){if(o&1){let a=x();t(0,"li",42),g("click",function(){v(a);let i=u().$implicit,r=u(2);return _(r.diactivePromotion(!0,i.id))}),s(1,"Reactivar Promoci\xF3n "),n()}}function qo(o,l){if(o&1){let a=x();t(0,"tr",33),g("click",function(){let i=v(a).$implicit,r=u(2);return _(r.promotionSelected(i))}),t(1,"td"),h(2,Oo,2,1,"nz-tag",34)(3,Ro,2,1,"nz-tag",34),n(),t(4,"td")(5,"nz-tag",35),s(6),n()(),t(7,"td")(8,"nz-tag",35),s(9),n()(),t(10,"td")(11,"span",36),s(12),G(13,"date"),n()(),t(14,"td")(15,"span",36),s(16),G(17,"date"),n()(),t(18,"td")(19,"span",36),s(20),G(21,"date"),n()(),t(22,"td")(23,"a",37),s(24,"Ver Imagen"),n()(),t(25,"td")(26,"a",38),d(27,"i",39),n(),t(28,"nz-dropdown-menu",null,3)(30,"ul",40),h(31,Uo,2,0,"li",41)(32,Bo,2,0,"li",41),t(33,"li",42),g("click",function(){let i=v(a).$implicit,r=u(2);return _(r.editPromotion(i.id,i.name,i.description,i.validFrom.toDate(),i.validTo.toDate()))}),s(34,"Editar Promoci\xF3n"),n(),t(35,"li",42),g("click",function(){let i=v(a).$implicit,r=u(2);return _(r.deletePromotiom(i.id))}),s(36,"Borrar Promoci\xF3m"),n()()()()()}if(o&2){let a=l.$implicit,e=T(29);m(2),c("ngIf",a.active),m(),c("ngIf",!a.active),m(2),c("nzColor","blue"),m(),N(a.name),m(2),c("nzColor","blue"),m(),N(a.description),m(3),y(" ",a.validFrom?le(13,13,a.validFrom.toDate(),"mediumDate"):""," "),m(4),y(" ",a.validTo?le(17,16,a.validTo.toDate(),"mediumDate"):""," "),m(4),y(" ",a.date_created?le(21,19,a.date_created.toDate(),"mediumDate"):""," "),m(3),ci("href",a.imageUrl,$t),m(3),c("nzDropdownMenu",e),m(5),c("ngIf",a.active),m(),c("ngIf",!a.active)}}function jo(o,l){if(o&1&&(t(0,"nz-table",30,2)(2,"thead")(3,"tr")(4,"th",31),s(5,"Activo"),n(),t(6,"th",31),s(7,"Nombre"),n(),t(8,"th",31),s(9,"Descripci\xF3n"),n(),t(10,"th",31),s(11,"Desde "),n(),t(12,"th",31),s(13,"Hasta"),n(),t(14,"th",31),s(15,"Fecha Creaci\xF3n"),n(),t(16,"th",31),s(17,"Imagen"),n(),d(18,"th",31),n()(),t(19,"tbody"),h(20,qo,37,22,"tr",32),n()()),o&2){let a=T(1),e=u();c("nzData",e.promotionsList)("nzPageSize",e.pageSize3)("nzLoading",e.loadingLatestPurchases)("nzLoadingDelay",500),m(20),c("ngForOf",a.data)}}function Ho(o,l){if(o&1&&d(0,"img",43),o&2){let a=u();c("src",a.previewImage,$t)("ngStyle",yt(2,Ao))}}var Zi=(()=>{let l=class l{constructor(e,i,r){this.bucketStorage=e,this.messageService=i,this.fb=r,this.accountId="",this.pageSize3=3,this.loadingLatestPurchases=!1,this.rolService=C(oe),this.promotionsService=C(Yi),this.authService=C(Y),this.view="cardView",this.infoLoad=[],this.isCreateVisible=!1,this.isEditMode=!1,this.fileListInfo=[],this.fileUrl="http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg",this.autosave=!0,this.uploading=!1,this.bucketPath="promotions/",this.uploadvalue=0,this.pageSize=10,this.usersList=[],this.rowGroupPanelShow=[],this.gridOptions=this.getGridOptions(),this.promotionsList=[],this.showUploadList={showPreviewIcon:!0,showRemoveIcon:!0,hidePreviewIconInNonImage:!0},this.previewImage="",this.previewVisible=!1,this.isEditVisible=!1,this.handlePreview=p=>{this.previewImage=p.url||p.thumbUrl,this.previewVisible=!0},this.authService.user.subscribe(p=>{this.user=p,this.user.rolId!=null&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(z=>{this.infoLoad=z,this.userlevelAccess=this.infoLoad.optionAccessLavel})}),this.programEditForm=this.fb.group({imageUrl:[""],active:[""],uid:[""],name:["",[f.required]],description:["",[f.required]],category:[],validFrom:[new Date],validTo:[new Date],date_created:[]}),this.createForm()}editPromotion(e,i,r,p,z){this.programEditForm.controls.uid.setValue(e),this.programEditForm.controls.name.setValue(i),this.programEditForm.controls.description.setValue(r),this.programEditForm.controls.validFrom.setValue(p),this.programEditForm.controls.validTo.setValue(z),this.isEditVisible=!0}deletePromotiom(e){console.log("borrar promocion "+e),this.promotionsService.deletePromotion(this.accountId,e)}diactivePromotion(e,i){console.log("desactivar promocion "+i),this.promotionsService.deactivePromotion(i,e,this.accountId)}promotionSelected(e){}createForm(){this.programForm=this.fb.group({imageUrl:[""],active:[""],name:["",[f.required]],description:["",[f.required]],category:[],validFrom:[],validTo:[],date_created:[]})}toggleActive(){}ngOnInit(){console.log(this.accountId),this.sub=this.promotionsService.getPromotionsList(this.accountId).pipe(w(e=>e.map(i=>{let r=i.payload.doc.id,p=i.payload.doc.data();return E({id:r},p)}))).subscribe(e=>{this.promotionsList=e})}showCreateModal(){this.programForm.reset(),this.isCreateVisible=!0,this.currentSelectedId="",this.currentSelected=null}showModalDelete(e){console.log(e)}sendMessage(e,i){this.messageService.create(e,i)}handleCancel(){this.isCreateVisible=!1,this.isEditMode=!1,this.currentSelectedId="",this.isEditVisible=!1}createPromotion(){if(console.log(this.programForm.valid),this.programForm.valid){var e;e={active:!0,name:this.programForm.controls.name.value,description:this.programForm.controls.description.value,validFrom:this.programForm.controls.validFrom.value,validTo:this.programForm.controls.validTo.value,imageUrl:this.programForm.controls.imageUrl.value||"",customerId:this.user.customerId,category:"",date_created:this.programForm.controls.date_created.value},console.log(e),this.userlevelAccess!="3"?this.promotionsService.savePromotion(e,this.accountId).then(()=>{this.messageService.success("Todo sali\xF3 bien.",{nzPauseOnHover:!0,nzDuration:3e3}),this.isCreateVisible=!1}):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}}handleChange2(e){if(e.file.status!=="uploading"){let r=e.file.status;this.fileListInfo=e.file,r==="done"?this.sendMessage("success",`${e.file.name} Archivo cargado satisfactoriamente.`):r==="error"&&this.sendMessage("error",`${e.file.name} archivo fallido, favor de validar.`),e.file.originFileObj&&this.getBase64(e.file.originFileObj,p=>{this.fileUrl=p;let z=this.bucketStorage.ref(this.bucketPath);this.task=this.bucketStorage.ref(this.bucketPath).putString(p,"data_url"),this.uploadPercent=this.task.percentageChanges(),this.uploadPercent.pipe(w(S=>Number((S/100).toFixed(2)))).subscribe(S=>{this.uploading=S!=0,this.uploadvalue=S}),this.task.snapshotChanges().pipe(oi(()=>{this.uploading=!1,this.downloadURL=z.getDownloadURL(),this.downloadURL.subscribe(S=>zt(this,null,function*(){this.updateAdvanceURL(S)}))})).subscribe()})}}getBase64(e,i){let r=new FileReader;r.addEventListener("load",()=>{r.result!==null&&typeof r.result=="string"?i(r.result):console.error("Invalid result from FileReader")}),r.readAsDataURL(e)}updateAdvanceURL(e){return zt(this,null,function*(){console.log("url"),console.log(e),this.programForm.controls.imageUrl.patchValue(e)})}onGridReady(e){this.gridApi=e.api,this.gridColumnApi=e.columnApi}getGridOptions(){return{columnDefs:this.columnDefs,context:{thisComponent:this},rowData:null,rowSelection:"single",pagination:!0,paginationPageSize:this.pageSize,defaultColDef:{sortable:!0,filter:!0},statusBar:{statusPanels:[{statusPanel:"agFilteredRowCountComponent"},{statusPanel:"agSelectedRowCountComponent"},{statusPanel:"agAggregationComponent"}]},enableRangeSelection:!0}}setPaginationPageSize(e=10){this.pageSize=e,console.log(this.gridApi),this.gridApi.paginationSetPageSize(Number(e))}editSavePromotion(){console.log("save"),this.programEditForm.valid?(this.promotionsService.editPromotion(this.programEditForm.controls.uid.value,this.accountId,this.programEditForm.controls.name.value,this.programEditForm.controls.description.value,this.programEditForm.controls.validFrom.value,this.programEditForm.controls.validTo.value).then(()=>{this.messageService.success("Todo sali\xF3 bien.",{nzPauseOnHover:!0,nzDuration:3e3})}),this.isEditVisible=!1):this.sendMessage("error","Datos invalidos favor de validar")}};l.\u0275fac=function(i){return new(i||l)(b(Mi),b(D),b(R))},l.\u0275cmp=I({type:l,selectors:[["app-promotions"]],inputs:{accountId:"accountId"},decls:93,vars:14,consts:[["suffixIconSearch",""],["modalContent",""],["basicTable",""],["chatSetting","nzDropdownMenu"],[1,"site-page-header"],[1,"site-page-header-ghost-wrapper"],[3,"nzGhost"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["nz-row",""],[1,"content"],[1,"col-md-4","col-sm-12"],[3,"nzSuffix"],["type","text","nz-input","","placeholder","Buscar ..."],[3,"nzData","nzPageSize","nzLoading","nzLoadingDelay",4,"ngIf"],["nzTitle","Agregar Promoci\xF3n","nzWidth","600",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible"],["nz-form","","nzLayout","vertical",3,"ngSubmit","formGroup"],[1,"row"],[1,"col-md-12","col-sm-12"],["nz-input","","formControlName","name","id","descriptioA"],["nz-input","","formControlName","description","id","descriptioA"],[1,"col-md-7","col-sm-12"],["formControlName","validFrom"],["formControlName","validTo"],["formControlName","date_created"],["nzAction","https://jsonplaceholder.typicode.com/posts/","nzListType","picture-card",3,"nzFileListChange","nzChange","nzFileList","nzShowButton","nzShowUploadList","nzPreview"],["nz-icon","","nzType","plus"],[1,"ant-upload-text"],[3,"nzOnCancel","nzVisible","nzContent","nzFooter"],["nzTitle","Editar Promoci\xF3n","nzWidth","600",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible"],["nz-icon","","nzType","search"],[3,"nzData","nzPageSize","nzLoading","nzLoadingDelay"],[2,"color","#4F6F57"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[3,"nzColor",4,"ngIf"],[3,"nzColor"],["nz-text","","nzType","secondary"],[3,"href"],["nz-dropdown","",3,"nzDropdownMenu"],["nz-icon","","nzType","more","nzTheme","outline"],["nz-menu",""],["nz-menu-item","",3,"click",4,"ngIf"],["nz-menu-item","",3,"click"],[3,"src","ngStyle"]],template:function(i,r){if(i&1){let p=x();t(0,"nz-page-header",4)(1,"nz-page-header-title"),s(2,"Promociones"),n(),t(3,"nz-page-header-subtitle"),s(4,"Promociones de esta empresa"),n(),t(5,"nz-page-header-extra")(6,"div",5)(7,"nz-page-header",6)(8,"nz-page-header-extra")(9,"button",7),g("click",function(){return v(p),_(r.showCreateModal())}),s(10,"Agregar Promocion"),n()()()()(),t(11,"nz-page-header-content")(12,"div",8)(13,"div",9)(14,"div",10)(15,"nz-input-group",11),d(16,"input",12),n(),h(17,Mo,1,0,"ng-template",null,0,F),n()()()()(),d(19,"br"),h(20,jo,21,5,"nz-table",13),t(21,"nz-modal",14),H("nzVisibleChange",function(S){return v(p),j(r.isCreateVisible,S)||(r.isCreateVisible=S),_(S)}),g("nzOnCancel",function(){return v(p),_(r.handleCancel())})("nzOnOk",function(){return v(p),_(r.createPromotion())}),t(22,"form",15),g("ngSubmit",function(){return v(p),_(r.createPromotion())}),t(23,"div",16)(24,"div",17)(25,"nz-form-item")(26,"nz-form-label"),s(27,"Nombre"),n(),t(28,"nz-form-control"),d(29,"input",18),n()()(),t(30,"div",17)(31,"nz-form-item")(32,"nz-form-label"),s(33,"Descripci\xF3n"),n(),t(34,"nz-form-control"),d(35,"input",19),n()()(),t(36,"div",20)(37,"nz-form-item")(38,"nz-form-label"),s(39,"Fecha Inicio"),n(),t(40,"nz-form-control"),d(41,"nz-date-picker",21),n()()(),t(42,"div",20)(43,"nz-form-item")(44,"nz-form-label"),s(45,"Fecha Fin"),n(),t(46,"nz-form-control"),d(47,"nz-date-picker",22),n()()(),t(48,"div",20)(49,"nz-form-item")(50,"nz-form-label"),s(51,"Fecha de Creaci\xF3n"),n(),t(52,"nz-form-control"),d(53,"nz-date-picker",23),n()()(),t(54,"div",17)(55,"nz-form-item")(56,"nz-form-label"),s(57,"Adjuntar Promoci\xF3n"),n(),t(58,"nz-form-control")(59,"nz-upload",24),H("nzFileListChange",function(S){return v(p),j(r.fileList,S)||(r.fileList=S),_(S)}),g("nzChange",function(S){return v(p),_(r.handleChange2(S))}),d(60,"i",25),t(61,"div",26),s(62,"Upload"),n()(),t(63,"nz-modal",27),g("nzOnCancel",function(){return v(p),_(r.previewVisible=!1)}),n()(),h(64,Ho,1,3,"ng-template",null,1,F),n()()()()(),t(66,"nz-modal",28),H("nzVisibleChange",function(S){return v(p),j(r.isEditVisible,S)||(r.isEditVisible=S),_(S)}),g("nzOnCancel",function(){return v(p),_(r.handleCancel())})("nzOnOk",function(){return v(p),_(r.editSavePromotion())}),t(67,"form",15),g("ngSubmit",function(){return v(p),_(r.editSavePromotion())}),t(68,"div",16)(69,"div",17)(70,"nz-form-item")(71,"nz-form-label"),s(72,"Nombre"),n(),t(73,"nz-form-control"),d(74,"input",18),n()()(),t(75,"div",17)(76,"nz-form-item")(77,"nz-form-label"),s(78,"Descripci\xF3n"),n(),t(79,"nz-form-control"),d(80,"input",19),n()()(),t(81,"div",20)(82,"nz-form-item")(83,"nz-form-label"),s(84,"Fecha Inicio"),n(),t(85,"nz-form-control"),d(86,"nz-date-picker",21),n()()(),t(87,"div",20)(88,"nz-form-item")(89,"nz-form-label"),s(90,"Fecha Fin"),n(),t(91,"nz-form-control"),d(92,"nz-date-picker",22),n()()()()()()}if(i&2){let p=T(18),z=T(65);m(7),c("nzGhost",!1),m(8),c("nzSuffix",p),m(5),c("ngIf",r.promotionsList),m(),q("nzVisible",r.isCreateVisible),m(),c("formGroup",r.programForm),m(37),q("nzFileList",r.fileList),c("nzShowButton",!0)("nzShowUploadList",r.showUploadList)("nzPreview",r.handlePreview),m(4),c("nzVisible",r.previewVisible)("nzContent",z)("nzFooter",null),m(3),q("nzVisible",r.isEditVisible),m(),c("formGroup",r.programEditForm)}},dependencies:[A,M,it,K,B,U,ee,Z,ie,te,ne,Re,Oe,Mt,at,Ce,be,Ee,xe,ye,He,Ot,fe,he,ge,We,ve,k,P,V,re,_e,Se,Xe,de,Qe,X,me,O,W,Q,J,Me]});let o=l;return o})();function Go(o,l){o&1&&d(0,"i",23)}function Wo(o,l){if(o&1){let a=x();t(0,"form",24),g("ngSubmit",function(){v(a);let i=u();return _(i.submitForm())}),t(1,"div",8)(2,"div",25)(3,"nz-form-item")(4,"nz-form-label",26),s(5,"Nombre"),n(),t(6,"nz-form-control"),d(7,"input",27),n()()(),t(8,"div",28)(9,"nz-form-item")(10,"nz-form-label",26),s(11,"Tipo"),n(),t(12,"nz-radio-group",29)(13,"label",30),s(14,"Servicio"),n(),t(15,"label",31),s(16,"Producto"),n()()()(),t(17,"div",32)(18,"nz-form-item")(19,"nz-form-label"),s(20,"Activo"),n(),d(21,"nz-switch",33),n()()(),t(22,"nz-form-item")(23,"nz-form-label"),s(24,"Descripci\xF3n"),n(),t(25,"nz-form-control"),d(26,"textarea",34),n()(),t(27,"div",8)(28,"div",7)(29,"nz-form-item")(30,"nz-form-label"),s(31,"Categor\xEDa"),n(),t(32,"nz-form-control")(33,"nz-form-control")(34,"nz-select",35),d(35,"nz-option",36)(36,"nz-option",37)(37,"nz-option",38),n()()()()(),t(38,"div",7)(39,"nz-form-item")(40,"nz-form-label"),s(41,"Validez"),n(),t(42,"nz-form-control")(43,"nz-range-picker",39),g("nzOnCalendarChange",function(i){v(a);let r=u();return _(r.mapDateValues(i))}),n()()()()(),t(44,"div",8)(45,"div",28)(46,"nz-form-item")(47,"nz-form-label"),s(48,"Mete"),n(),d(49,"nz-switch",40),n()(),t(50,"div",28)(51,"nz-form-item")(52,"nz-form-label"),s(53,"Saca"),n(),d(54,"nz-switch",41),n()(),t(55,"div",7)(56,"nz-form-label"),s(57,"Precio"),n(),d(58,"nz-input-number",42),n()()()}if(o&2){let a=u();c("formGroup",a.validateForm),m(12),c("nzButtonStyle","solid"),m(46),c("nzMin",0)("nzMax",12e3)("nzStep",1)}}function Xo(o,l){if(o&1){let a=x();t(0,"li",68),g("click",function(){v(a);let i=u().$implicit,r=u(2);return _(r.toggleActivateProduct(i))}),t(1,"a"),d(2,"i",69),t(3,"span",47),s(4,"Detener venta"),n()()()}}function Qo(o,l){if(o&1){let a=x();t(0,"li",68),g("click",function(){v(a);let i=u().$implicit,r=u(2);return _(r.toggleActivateProduct(i))}),t(1,"a"),d(2,"i",70),t(3,"span",47),s(4,"Activar venta"),n()()()}}function Jo(o,l){if(o&1&&d(0,"nz-progress",71),o&2){let a=u().$implicit;c("nzPercent",a.price)}}function Ko(o,l){if(o&1&&d(0,"nz-progress",72),o&2){let a=u().$implicit;c("nzPercent",a.price)}}function Yo(o,l){o&1&&(t(0,"nz-tag",66),s(1,"Activo"),n()),o&2&&c("nzColor","green")}function Zo(o,l){o&1&&d(0,"a")}function er(o,l){if(o&1){let a=x();t(0,"div",28)(1,"nz-card")(2,"div",44)(3,"div",45),d(4,"nz-avatar",46),t(5,"div",47)(6,"h5",48),s(7),n(),t(8,"span",49),s(9),n()()(),t(10,"div")(11,"a",50),d(12,"i",51),n(),t(13,"nz-dropdown-menu",null,2)(15,"ul",52),h(16,Xo,5,0,"li",53)(17,Qo,5,0,"li",53),t(18,"li",54)(19,"a"),d(20,"i",55),t(21,"span",47),s(22,"Editar"),n()()(),d(23,"li",56),t(24,"li",54)(25,"a",57),g("nzOnConfirm",function(){let i=v(a).$implicit,r=u(2);return _(r.deleteProduct(i))}),d(26,"i",58),t(27,"span",47),s(28,"Eliminar"),n()()()()()()(),t(29,"p",59),s(30),n(),t(31,"div",60)(32,"div",44)(33,"span",61),s(34,"Ventas"),n(),t(35,"span",61),s(36),n()(),h(37,Jo,1,1,"nz-progress",62)(38,Ko,1,1,"nz-progress",63),n(),t(39,"div",64)(40,"div",65)(41,"div")(42,"nz-tag",66),s(43),n(),h(44,Yo,2,1,"nz-tag",67),n(),t(45,"div"),h(46,Zo,1,0,"a",22),n()()()()()}if(o&2){let a=l.$implicit,e=T(14);m(4),c("nzSize",40),m(3),N(a.name),m(2),y("",a.timesSold||0," Ventas"),m(2),c("nzDropdownMenu",e),m(5),c("ngIf",a.active),m(),c("ngIf",!a.active),m(13),N(a.description),m(6),N(a.timesSold),m(),c("ngIf",a.type!=="Behind"),m(),c("ngIf",a.type=="Behind"),m(4),c("nzColor","blue"),m(),N(a.type),m(),c("ngIf",a.active),m(2),c("ngIf",a.price>2)}}function tr(o,l){if(o&1&&(t(0,"div",8),h(1,er,47,14,"div",43),n()),o&2){let a=u();m(),c("ngForOf",a.productsList)}}function ir(o,l){o&1&&(t(0,"nz-tag",66),s(1,"Activo"),n()),o&2&&c("nzColor","green")}function nr(o,l){if(o&1){let a=x();t(0,"li",68),g("click",function(){v(a);let i=u().$implicit,r=u(2);return _(r.toggleActivateProduct(i))}),t(1,"a"),d(2,"i",69),t(3,"span",47),s(4,"Detener venta"),n()()()}}function or(o,l){if(o&1){let a=x();t(0,"li",68),g("click",function(){v(a);let i=u().$implicit,r=u(2);return _(r.toggleActivateProduct(i))}),t(1,"a"),d(2,"i",70),t(3,"span",47),s(4,"Activar venta"),n()()()}}function rr(o,l){if(o&1){let a=x();t(0,"tr")(1,"td")(2,"div",77),d(3,"nz-avatar",78),t(4,"div",47)(5,"h5",48),s(6),n()()()(),t(7,"td"),s(8),n(),t(9,"td"),s(10),n(),t(11,"td")(12,"nz-tag",66),s(13),n()(),t(14,"td",75),h(15,ir,2,1,"nz-tag",67),n(),t(16,"td",79)(17,"div")(18,"a",50),d(19,"i",51),n(),t(20,"nz-dropdown-menu",null,4)(22,"ul",52),h(23,nr,5,0,"li",53)(24,or,5,0,"li",53),t(25,"li",54)(26,"a"),d(27,"i",55),t(28,"span",47),s(29,"Editar"),n()()(),d(30,"li",56),t(31,"li",54)(32,"a",57),g("nzOnConfirm",function(){let i=v(a).$implicit,r=u(2);return _(r.deleteProduct(i))}),d(33,"i",58),t(34,"span",47),s(35,"Eliminar"),n()()()()()()()()}if(o&2){let a=l.$implicit,e=T(21);m(6),N(a.name),m(2),N(a.category),m(2),N(a.description),m(2),c("nzColor","blue"),m(),N(a.type),m(2),c("ngIf",a.active),m(3),c("nzDropdownMenu",e),m(5),c("ngIf",a.active),m(),c("ngIf",!a.active)}}function ar(o,l){if(o&1&&(t(0,"nz-card")(1,"nz-table",73,3)(3,"thead")(4,"tr")(5,"th",74),s(6,"Nombre"),n(),t(7,"th",74),s(8,"Categor\xEDa"),n(),t(9,"th",74),s(10,"Descripci\xF3n"),n(),t(11,"th",74),s(12,"Tipo"),n(),t(13,"th",75),s(14,"Status"),n(),d(15,"th",74),n()(),t(16,"tbody"),h(17,rr,36,9,"tr",76),n()()()),o&2){let a=T(2),e=u();m(),c("nzData",e.productsList),m(16),c("ngForOf",a.data)}}var en=(()=>{let l=class l{constructor(e,i,r,p){this.afs=e,this.modalService=i,this.messageService=r,this.fb=p,this.accountId="",this.rolService=C(oe),this.productsService=C(Ui),this.usersService=C(pe),this.view="cardView",this.productsList=[],this.infoLoad=[],this.userService=C(qe),this.authService=C(Y),this.authService.user.subscribe(z=>{this.user=z,this.user.rolId!=null&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(S=>{this.infoLoad=S,this.userlevelAccess=this.infoLoad.optionAccessLavel})})}ngOnInit(){this.createForm(),this.getSubscriptions()}ngOnDestroy(){}createForm(){this.validateForm=this.fb.group({active:[!1,[f.required]],category:[null,[f.required]],date_created:[new Date,[f.required]],description:[null,[f.required]],isTaskIn:[!0,[f.required]],isTaskOut:[!0,[f.required]],name:[null,[f.required]],price:[0,[f.required]],timesSold:[0,[f.required]],type:[null,[f.required]],rangeDatePicker:[null],validFrom:[new Date,[f.required]],validTo:[new Date,[f.required]]})}resetForm(){this.validateForm.reset({active:!1,date_created:new Date,isTaskIn:!0,isTaskOut:!0,price:0,timesSold:0,validFrom:new Date,validTo:new Date})}mapDateValues(e){e.length>1&&(this.validateForm.controls.validFrom.patchValue(new Date(e[0])),this.validateForm.controls.validTo.patchValue(new Date(e[1]))),console.log(this.validateForm.value),console.log(this.validateForm.valid)}sendMessage(e,i){this.messageService.create(e,i)}submitForm(){this.validateForm.valid&&(this.userlevelAccess!="3"?this.productsService.setProduct(this.accountId,this.validateForm.value).then(()=>{this.resetForm(),this.modalService.closeAll(),this.messageService.success("Todo sali\xF3 bien.",{nzPauseOnHover:!0,nzDuration:3e3})}):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador."))}toggleActivateProduct(e){this.productsService.toggleProductActive(this.accountId,e.id,e.active)}getSubscriptions(){this.sub=this.usersService.getAccountProducts(this.accountId).pipe(w(e=>e.map(i=>{let r=i.payload.doc.id,p=i.payload.doc.data();return ke(E({},p),{id:r})}))).subscribe(e=>{this.productsList=e,console.log(this.productsList)})}deleteProduct(e){this.userlevelAccess=="1"?this.productsService.deleteProduct(this.accountId,e.id).then(()=>{this.messageService.success(`El ${e.type} ${e.name} ha sido eliminado.`,{nzPauseOnHover:!0,nzDuration:3e3})}):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}showNewModal(e){let i=this.modalService.create({nzTitle:"Nuevo Producto / Servicio",nzContent:e,nzFooter:[{label:"Crear",type:"primary",onClick:()=>this.modalService.confirm({nzTitle:"\xBFEst\xE1 seguro?",nzOnOk:()=>{this.submitForm()}})}],nzWidth:800})}};l.\u0275fac=function(i){return new(i||l)(b(ce),b(je),b(D),b(R))},l.\u0275cmp=I({type:l,selectors:[["app-shared-products-list"]],inputs:{accountId:"accountId"},decls:25,vars:4,consts:[["searchPrefix",""],["newContent",""],["projectListSetting","nzDropdownMenu"],["listViewTable",""],["projectListSetting2","nzDropdownMenu"],[1,"page-header"],[1,"row","align-items-md-center"],[1,"col-md-6"],[1,"row"],[1,"col-md-5"],[3,"nzPrefix"],["type","text","nz-input","","placeholder","Buscar"],[1,"text-md-right","m-v-10"],[1,"m-r-10",3,"ngModelChange","ngModel"],["nz-radio-button","","nzValue","cardView","nzTitle","Vista de tarjeta","nzPlacement","bottom","nz-tooltip",""],["nz-icon","","nzType","appstore","theme","outline",1,"font-size-16"],["nz-radio-button","","nzValue","listView","nzTitle","Vista de lista","nzPlacement","bottom","nz-tooltip",""],["nz-icon","","nzType","ordered-list","theme","outline",1,"font-size-16"],["nz-button","",2,"background-color","#4F6F57","color","#f6f3ea",3,"click"],["nz-icon","","nzType","plus"],[1,"container-fluid"],["class","row",4,"ngIf"],[4,"ngIf"],["nz-icon","","nzType","search",1,"opacity-04"],["nz-form","","nzLayout","vertical",3,"ngSubmit","formGroup"],[1,"col-md-8"],["nzRequired","true"],["type","text","formControlName","name","nz-input","","placeholder","Escriba el nombre del producto / servicio"],[1,"col-md-3"],["formControlName","type",3,"nzButtonStyle"],["nz-radio-button","","nzValue","Servicio"],["nz-radio-button","","nzValue","Producto"],[1,"col-md-1"],["formControlName","active"],["nz-input","","formControlName","description"],["nzPlaceHolder","Selecciona una opci\xF3n","formControlName","category",1,"w-100"],["nzLabel","Servicio de Transporte Ordinario","nzValue","permanente"],["nzLabel","Servicio Especial","nzValue","especial"],["nzLabel","Producto","nzValue","producto"],["formControlName","rangeDatePicker",3,"nzOnCalendarChange"],["formControlName","isTaskIn"],["formControlName","isTaskOut"],["formControlName","price",3,"nzMin","nzMax","nzStep"],["class","col-md-3",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between"],[1,"media"],["nzShape","square",2,"background-color","white","color","#4F6F57",3,"nzSize","nzSrc"],[1,"m-l-10"],[1,"m-b-0"],[1,"text-muted","font-size-13"],["nz-dropdown","","nzPlacement","bottomRight","nzTrigger","click",1,"text-gray","font-size-18",3,"nzDropdownMenu"],["nz-icon","","nzType","ellipsis","theme","outline"],["nz-menu","","nzSelectable",""],["nz-menu-item","",3,"click",4,"ngIf"],["nz-menu-item",""],["nz-icon","","nzType","edit","theme","outline"],["nz-menu-divider",""],["nz-popconfirm","","nzPopconfirmTitle","\xBFEst\xE1s seguro de eliminarlo?","nzPopconfirmPlacement","bottom","nzOkType","danger",3,"nzOnConfirm"],["nz-icon","","nzType","delete","theme","outline"],[1,"m-t-25"],[1,"m-t-30"],[1,"font-weight-semibold"],["nzSize","small",3,"nzPercent",4,"ngIf"],["nzSize","small","nzStatus","exception",3,"nzPercent",4,"ngIf"],[1,"m-t-20"],[1,"d-flex","justify-content-between","align-items-center"],[1,"m-b-0",3,"nzColor"],["class","m-b-0",3,"nzColor",4,"ngIf"],["nz-menu-item","",3,"click"],["nz-icon","","nzType","pause-circle","theme","outline"],["nz-icon","","nzType","check-circle","theme","outline"],["nzSize","small",3,"nzPercent"],["nzSize","small","nzStatus","exception",3,"nzPercent"],[3,"nzData"],[2,"color","#4F6F57"],[1,"text-center"],[4,"ngFor","ngForOf"],[1,"media","align-items-center"],["nzShape","square",2,"background-color","white","color","#4F6F57",3,"nzSrc"],[1,"text-right"]],template:function(i,r){if(i&1){let p=x();t(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8)(4,"div",9)(5,"nz-input-group",10),d(6,"input",11),n(),h(7,Go,1,0,"ng-template",null,0,F),n()()(),t(9,"div",7)(10,"div",12)(11,"nz-radio-group",13),H("ngModelChange",function(S){return v(p),j(r.view,S)||(r.view=S),_(S)}),t(12,"label",14),d(13,"i",15),n(),t(14,"label",16),d(15,"i",17),n()(),t(16,"button",18),g("click",function(){v(p);let S=T(21);return _(r.showNewModal(S))}),d(17,"i",19),t(18,"span"),s(19,"Agregar nuevo"),n()(),h(20,Wo,59,5,"ng-template",null,1,F),n()()()(),t(22,"div",20),h(23,tr,2,1,"div",21)(24,ar,18,2,"nz-card",22),n()}if(i&2){let p=T(8);m(5),c("nzPrefix",p),m(6),q("ngModel",r.view),m(12),c("ngIf",r.view=="cardView"),m(),c("ngIf",r.view=="listView")}},dependencies:[A,M,K,B,U,ee,Z,ie,te,ne,Re,Oe,Mt,Oi,ki,Vi,at,Ce,be,Ee,xe,ye,Ue,st,fe,he,ot,ge,We,ve,ze,k,P,V,Be,Qe,$e,Ge,X,me,O,W,Q,J,Et,Bi,Ri]});let o=l;return o})();var tn=[{name:"Tienda de conveniencia",description:"Pago en tienda de conveniencia",icon:"pricetag",method:"store",userNavigation:"reference/list",active:!1},{name:"Tarjeta de cr\xE9dito/d\xE9bito",description:"Pago en l\xEDnea con tarjeta",icon:"card",method:"card",userNavigation:"card/purchase",active:!1}],nn=(()=>{let l=class l{constructor(e){this.afs=e}getAccountPaymentMethods(e){return this.afs.collection("customers").doc(e).collection("paymentMethods").snapshotChanges()}getPaymentMethods(){return ni(tn)}createDefaultPaymentMethods(e){return tn.forEach(i=>{this.setAccountPaymentMethod(e,i)})}setAccountPaymentMethod(e,i){return this.afs.collection("customers").doc(e).collection("paymentMethods").add(i)}toggleActiveAccountPaymentMethod(e,i,r){return this.afs.collection("customers").doc(e).collection("paymentMethods").doc(i).update({active:r})}deleteAccountPaymentMethod(e,i){return this.afs.collection("customers").doc(e).collection("paymentMethods").doc(i).delete()}};l.\u0275fac=function(i){return new(i||l)(Ye(ce))},l.\u0275prov=et({token:l,factory:l.\u0275fac,providedIn:"root"});let o=l;return o})();function lr(o,l){if(o&1){let a=x();Le(0),t(1,"div",4)(2,"label",5),s(3),n(),t(4,"nz-switch",6),g("ngModelChange",function(i){let r=v(a).$implicit,p=u();return _(p.onChange(i,r))}),n()(),Ae()}if(o&2){let a=l.$implicit;m(3),y("",a.name,"\xA0"),m(),c("ngModel",a.active)}}var on=(()=>{let l=class l{constructor(e){this.messageService=e,this.loading=!1,this.rolService=C(oe),this.stopSubscription$=new ue,this.paymentMethodsList=[],this.accountPaymentMethods=[],this.infoLoad=[],this.paymentMethodsService=C(nn),this.authService=C(Y),this.authService.user.subscribe(i=>{this.user=i,this.user.rolId!=null&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(r=>{this.infoLoad=r,this.userlevelAccess=this.infoLoad.optionAccessLavel})})}ngOnInit(){this.getSubscriptions()}ngOnDestroy(){this.stopSubscription$.next(!1),this.stopSubscription$.complete()}sendMessage(e,i){this.messageService.create(e,i)}getSubscriptions(){this.paymentMethodsService.getAccountPaymentMethods(this.accountId).pipe(ae(this.stopSubscription$),w(e=>e.map(i=>{let r=i.payload.doc.id,p=i.payload.doc.data();return E({id:r},p)})),we(e=>(this.accountPaymentMethods=e,e.length==0&&this.createDefaultPaymentMethods(),e))).subscribe(()=>{this.loading=!1})}createDefaultPaymentMethods(){this.userlevelAccess!="3"?this.paymentMethodsService.createDefaultPaymentMethods(this.accountId):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}onChange(e,i){this.paymentMethodsService.toggleActiveAccountPaymentMethod(this.accountId,i.id,e)}};l.\u0275fac=function(i){return new(i||l)(b(D))},l.\u0275cmp=I({type:l,selectors:[["app-shared-account-payment-methods"]],inputs:{accountId:"accountId"},decls:4,vars:2,consts:[[1,"container"],["nzType","inner","nzTitle","M\xE9todos de Pago (Aplican cuando el Usuario es responsable del Pago)",3,"nzLoading"],[1,"row"],[4,"ngFor","ngForOf"],[1,"col-md-6"],["nzFor","pm.name"],["nzCheckedChildren","Si","nzUnCheckedChildren","No",3,"ngModelChange","ngModel"]],template:function(i,r){i&1&&(t(0,"div",0)(1,"nz-card",1)(2,"div",2),h(3,lr,5,2,"ng-container",3),n()()()),i&2&&(m(),c("nzLoading",r.loading),m(2),c("ngForOf",r.accountPaymentMethods))},dependencies:[A,st,Be,O,Et]});let o=l;return o})();function cr(o,l){if(o&1&&(t(0,"h5",63),s(1),n()),o&2){let a=u(2);m(),N(a.record.name)}}function dr(o,l){if(o&1){let a=x();t(0,"a",64),g("click",function(){v(a);let i=u(2);return _(i.onSubmit())}),s(1,"Actualizar"),n()}}function pr(o,l){if(o&1){let a=x();t(0,"div",2)(1,"form",3),g("ngSubmit",function(){v(a);let i=u();return _(i.onSubmit())}),t(2,"nz-card",4)(3,"div",5),d(4,"nz-avatar",6),t(5,"div",7),h(6,cr,2,1,"h5",8),t(7,"p",9),s(8),d(9,"br"),s(10),n()(),t(11,"nz-upload",10),g("nzChange",function(){v(a);let i=u();return _(i.handleChange())}),t(12,"button",11)(13,"span"),s(14,"Cambiar im\xE1gen"),n()()()(),d(15,"hr",12),t(16,"div",13)(17,"div",14)(18,"nz-form-item")(19,"nz-form-label",15),s(20,"Nombre"),n(),t(21,"nz-form-control"),d(22,"input",16),n()()(),t(23,"div",17)(24,"nz-form-item")(25,"nz-form-label",18),s(26,"Raz\xF3n Social"),n(),t(27,"nz-form-control"),d(28,"input",19),n()()()(),t(29,"div",13)(30,"div",20)(31,"nz-form-item")(32,"nz-form-label",21),s(33,"RFC"),n(),t(34,"nz-form-control"),d(35,"input",22),n()()(),d(36,"div",20),n(),t(37,"div",13)(38,"div",23)(39,"nz-form-item")(40,"nz-form-label",24),s(41,"Tel\xE9fono"),n(),t(42,"nz-form-control"),d(43,"input",25),n()()(),t(44,"div",23)(45,"nz-form-item")(46,"nz-form-label",26),s(47,"Sitio Web"),n(),t(48,"nz-form-control"),d(49,"input",27),n()()(),t(50,"div",23)(51,"nz-form-item")(52,"nz-form-label",28),s(53,"Persona Contacto"),n(),t(54,"nz-form-control"),d(55,"input",29),n()()()()(),h(56,dr,2,0,"ng-template",null,0,F),t(58,"nz-card",30)(59,"div",13)(60,"div",17)(61,"nz-form-item")(62,"nz-form-label",31),s(63,"Calle"),n(),t(64,"nz-form-control"),d(65,"input",32),n()()(),t(66,"div",14)(67,"nz-form-item")(68,"nz-form-label",33),s(69,"N\xFAmero"),n(),t(70,"nz-form-control"),d(71,"input",34),n()()()(),t(72,"div",13)(73,"div",20)(74,"nz-form-item")(75,"nz-form-label",31),s(76,"Entre Calles"),n(),t(77,"nz-form-control"),d(78,"input",35),n()()(),t(79,"div",20)(80,"nz-form-item")(81,"nz-form-label",36),s(82,"Fracc / Colonia"),n(),t(83,"nz-form-control"),d(84,"input",37),n()()()(),t(85,"div",13)(86,"div",38)(87,"nz-form-item")(88,"nz-form-label",39),s(89,"C\xF3digo Postal"),n(),t(90,"nz-form-control"),d(91,"input",40),n()()(),t(92,"div",41)(93,"nz-form-item")(94,"nz-form-label",42),s(95,"Ciudad / Municipio"),n(),t(96,"nz-form-control"),d(97,"input",43),n()()(),t(98,"div",41)(99,"nz-form-item")(100,"nz-form-label",44),s(101,"Estado"),n(),t(102,"nz-form-control"),d(103,"input",45),n()()()()(),t(104,"nz-card",46)(105,"div",13)(106,"div",23)(107,"nz-form-item")(108,"nz-form-label",47)(109,"span"),s(110," Origen de los pagos "),d(111,"i",48),n()(),t(112,"nz-form-control",49)(113,"nz-select",50),d(114,"nz-option",51)(115,"nz-option",52),n()()()()(),t(116,"div",13)(117,"div",23)(118,"nz-form-item")(119,"nz-form-label",53)(120,"span"),s(121," Obligatorio subir en la estaci\xF3n definida "),d(122,"i",54),n()(),t(123,"nz-form-control",49)(124,"nz-select",55),d(125,"nz-option",56)(126,"nz-option",57),n()()()(),t(127,"div",23)(128,"nz-form-item")(129,"nz-form-label",58)(130,"span"),s(131," Obligatorio subir en el turno definido "),d(132,"i",59),n()(),t(133,"nz-form-control",49)(134,"nz-select",60),d(135,"nz-option",56)(136,"nz-option",57),n()()()(),t(137,"div",23)(138,"nz-form-item")(139,"nz-form-label",58)(140,"span"),s(141," Obligatorio subir en la ruta definida "),d(142,"i",61),n()(),t(143,"nz-form-control",49)(144,"nz-select",62),d(145,"nz-option",56)(146,"nz-option",57),n()()()()()()()()}if(o&2){let a=T(57),e=u();m(),c("formGroup",e.objectForm),m(),c("nzExtra",a)("nzLoading",e.loading),m(2),c("nzSize",80)("nzText",e.record.name),m(2),c("ngIf",!!e.record),m(2),y(" ",e.record.address," "),m(2),di(" ",e.record.address2," ",e.record.address3," "),m(),c("nzShowUploadList",!1),m(101),c("nzSpan",12),m(11),c("nzSpan",12),m(10),c("nzSpan",12),m(10),c("nzSpan",12)}}var rn=(()=>{let l=class l{constructor(e,i){this.messageService=e,this.fb=i,this.stopSubscription$=new ue,this.loading=!0,this.infoLoad=[],this.rolService=C(oe),this.authService=C(Y),this.accountsService=C(nt),this.userService=C(qe),this.authService.user.subscribe(r=>{this.user=r,this.user.rolId!=null&&this.rolService.getRol(this.user.rolId).valueChanges().subscribe(p=>{this.infoLoad=p,this.userlevelAccess=this.infoLoad.optionAccessLavel})})}ngOnInit(){this.createForm(),this.getSubscription()}createForm(){this.objectForm=this.fb.group({active:[!1,[f.required]],imageUrl:[""],address:[""],paymentResponsible:[1,[f.required]],name:["",[f.required]],socialName:[""],rfc:[""],addressNumber:[""],address2:[""],address3:[""],zip:[""],city:[""],state:[""],forceStopPoints:[!0],forceRoute:[!0],forceRound:[!0],website:[""],phoneNumber:[""],primaryContact:[""]})}patchForm(e){this.objectForm.patchValue({active:e.active||!1,imageUrl:e.avatar||"",address:e.address||"",addressNumber:e.addressNumber||"",name:e.name||"",paymentResponsible:e.paymentResponsible||1,socialName:e.socialName||"",rfc:e.rfc||"",address2:e.address2||"",address3:e.address3||"",zip:e.zip||"",city:e.city||"",state:e.state||"",forceStopPoints:e.forceStopPoints||!0,forceRoute:e.forceRoute||!0,forceRound:e.forceRound||!0,website:e.website||"",phoneNumber:e.phoneNumber||"",primaryContact:e.primaryContact||""})}ngOnDestroy(){this.stopSubscription$.next(!1),this.stopSubscription$.complete()}getSubscription(){this.accountsService.getAccount(this.accountId).pipe(ae(this.stopSubscription$),w(e=>{let i=e.payload.id,r=e.payload.data();return E({id:i},r)}),we(e=>(console.log(e),this.patchForm(e),this.record=e,this.loading=!1,e))).subscribe()}handleChange(){}sendMessage(e,i){this.messageService.create(e,i)}onSubmit(){this.userlevelAccess!="3"?this.accountsService.updateAccount(this.accountId,this.objectForm.value).then(()=>{console.log("ok")},e=>{console.log("err: ",e)}).catch(e=>console.log(e)):this.sendMessage("error","El usuario no tiene permisos para actualizar datos, favor de contactar al administrador.")}};l.\u0275fac=function(i){return new(i||l)(b(D),b(R))},l.\u0275cmp=I({type:l,selectors:[["app-shared-account-edit"]],inputs:{accountId:"accountId"},decls:1,vars:1,consts:[["basicTpl",""],["class","container",4,"ngIf"],[1,"container"],["nz-form","","nzLayout","vertical",3,"ngSubmit","formGroup"],["nzType","inner","nzTitle","Informaci\xF3n B\xE1sica",3,"nzExtra","nzLoading"],[1,"media","align-items-center"],["nzIcon","user","nzSize","large","nzSrc","http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg",2,"background-color","white","color","#4F6F57",3,"nzSize","nzText"],[1,"m-l-20","m-r-20"],["class","m-b-5 font-size-18",4,"ngIf"],[1,"opacity-07","font-size-13","m-b-0"],["nzName","avatar",3,"nzChange","nzShowUploadList"],["nz-button","","nzGhost","",2,"background-color","#4F6F57","color","#f6f3ea"],[1,"m-v-25"],[1,"row"],[1,"col-md-3"],["nzFor","name"],["nz-input","","formControlName","name","type","text"],[1,"col-md-9"],["nzFor","socialName"],["nz-input","","formControlName","socialName","type","text"],[1,"col-md-6"],["nzFor","rfc"],["nz-input","","formControlName","rfc","type","text"],[1,"col-md-4"],["nzFor","phoneNumber"],["nz-input","","formControlName","phoneNumber","placeholder","Tel\xE9fono"],["nzFor","website"],["nz-input","","formControlName","website","placeholder","website"],["nzFor","primaryContact"],["nz-input","","formControlName","primaryContact","placeholder","Contacto principal"],["nzType","inner","nzTitle","Direcci\xF3n"],["nzFor","address"],["nz-input","","formControlName","address","placeholder","Calle"],["nzFor","addressNumber"],["nz-input","","formControlName","addressNumber","placeholder","N\xFAmero"],["nz-input","","formControlName","address2","placeholder","Entre calles"],["nzFor","address3"],["nz-input","","formControlName","address3","placeholder","Fracc / Colonia"],[1,"col-md-2"],["nzFor","zip"],["nz-input","","formControlName","zip","placeholder","C\xF3digo Postal"],[1,"col-md-5"],["nzFor","city"],["nz-input","","formControlName","city","placeholder","Ciudad / Municipio"],["nzFor","state"],["nz-input","","formControlName","state","placeholder","Estado"],["nzType","inner","nzTitle","Par\xE1metros de Servicio"],["nzFor","paymentResponsible","nzRequired",""],["nz-icon","","nz-tooltip","","nzTooltipTitle","\xBFQui\xE9n es el responsable de emitir un pago por el servicio?","nzType","question-circle","nzTheme","outline"],[3,"nzSpan"],["name","select-error","formControlName","paymentResponsible"],["nzValue","0","nzLabel","Empresa"],["nzValue","1","nzLabel","Usuario"],["nzFor","forceStopPoints","nzRequired",""],["nz-icon","","nz-tooltip","","nzTooltipTitle","\xBFEs obligatorio que el usuario suba exclusivamente en la estaci\xF3n seleccionada?","nzType","question-circle","nzTheme","outline"],["name","select-error","formControlName","forceStopPoints"],["nzValue","true","nzLabel","Si"],["nzValue","false","nzLabel","No"],["nzFor","forceRound","nzRequired",""],["nz-icon","","nz-tooltip","","nzTooltipTitle","\xBFEs obligatorio que el usuario suba exclusivamente en el turno seleccionada?","nzType","question-circle","nzTheme","outline"],["name","select-error","formControlName","forceRound"],["nz-icon","","nz-tooltip","","nzTooltipTitle","\xBFEs obligatorio que el usuario suba exclusivamente en la ruta seleccionada?","nzType","question-circle","nzTheme","outline"],["name","select-error","formControlName","forceRoute"],[1,"m-b-5","font-size-18"],[3,"click"]],template:function(i,r){i&1&&h(0,pr,147,14,"div",1),i&2&&c("ngIf",!!r.record)},dependencies:[M,K,B,U,ee,Z,ie,te,ne,Ue,Ot,ze,k,P,V,Be,$e,Ge,X,me,O,W,Q,J]});let o=l;return o})();function zr(o,l){if(o&1&&d(0,"app-shared-account-edit",13),o&2){let a=u();c("accountId",a.recordId)}}function hr(o,l){if(o&1&&d(0,"app-shared-account-payment-methods",13),o&2){let a=u();c("accountId",a.recordId)}}function fr(o,l){if(o&1&&d(0,"app-shared-routes-list",13),o&2){let a=u();c("accountId",a.recordId)}}function gr(o,l){if(o&1&&d(0,"app-shared-customer-vendor-assignments",13),o&2){let a=u();c("accountId",a.recordId)}}function vr(o,l){if(o&1&&d(0,"app-shared-users-list",14),o&2){let a=u();c("accountId",a.recordId)("accountName",a.record.name)}}function _r(o,l){if(o&1&&d(0,"app-shared-qrcodes",13),o&2){let a=u();c("accountId",a.recordId)}}function Sr(o,l){if(o&1&&d(0,"app-shared-credentials-qrcodes",13),o&2){let a=u();c("accountId",a.recordId)}}function Cr(o,l){if(o&1&&d(0,"app-shared-system-users-list",14),o&2){let a=u();c("accountId",a.recordId)("accountName",a.record.name)}}function br(o,l){if(o&1&&d(0,"app-shared-products-list",13),o&2){let a=u();c("accountId",a.recordId)}}function xr(o,l){if(o&1&&d(0,"app-promotions",13),o&2){let a=u();c("accountId",a.recordId)}}var Ws=(()=>{let l=class l{constructor(e,i,r,p){this.fb=e,this.route=i,this.modalService=r,this.message=p,this.accountsService=C(nt),this.selectedIndex=0,this.record=[],this.avatarUrl="http://themenate.com/applicator/dist/assets/images/avatars/thumb-13.jpg"}ngOnInit(){this.sub=this.route.params.subscribe(e=>{this.recordId=e.id,this.selectedIndex=e.index,this.getSubscriptions()}),this.changePWForm=this.fb.group({oldPassword:[null,[f.required]],newPassword:[null,[f.required]],confirmPassword:[null,[f.required]]})}ngOnDestroy(){this.sub.unsubscribe()}showConfirm(){this.modalService.confirm({nzTitle:"<i>Do you want to change your password?</i>",nzOnOk:()=>this.message.success("Password Change Successfully")})}getSubscriptions(){this.accountsService.getAccount(this.recordId).pipe(w(e=>{let i=e.payload.id,r=e.payload.data();return E({id:i},r)})).subscribe(e=>{this.record=e})}submitForm(){for(let e in this.changePWForm.controls)this.changePWForm.controls[e].markAsDirty(),this.changePWForm.controls[e].updateValueAndValidity();this.showConfirm()}getBase64(e,i){let r=new FileReader;r.addEventListener("load",()=>i(r.result)),r.readAsDataURL(e)}};l.\u0275fac=function(i){return new(i||l)(b(R),b(hi),b(je),b(D))},l.\u0275cmp=I({type:l,selectors:[["app-edit"]],decls:27,vars:2,consts:[["nzBackIcon","",1,"page-header"],[1,"page-header-tab",3,"nzSelectedIndex"],["nzTitle","General"],["nz-tab",""],["nzTitle","M\xE9todos de Pago"],["nzTitle","Rutas"],["nzTitle","Asignaciones"],["nzTitle","Usuarios"],["nzTitle","Pases Activos"],["nzTitle","Credenciales"],["nzTitle","Acceso al sistema"],["nzTitle","Productos y Servicios"],["nzTitle","Promociones"],[3,"accountId"],[3,"accountId","accountName"]],template:function(i,r){i&1&&(t(0,"nz-page-header",0)(1,"nz-page-header-title"),s(2),n(),t(3,"nz-page-header-subtitle"),s(4,"Detalles de la empresa"),n(),t(5,"nz-page-header-content")(6,"nz-tabset",1)(7,"nz-tab",2),h(8,zr,1,1,"ng-template",3),n(),t(9,"nz-tab",4),h(10,hr,1,1,"ng-template",3),n(),t(11,"nz-tab",5),h(12,fr,1,1,"ng-template",3),n(),t(13,"nz-tab",6),h(14,gr,1,1,"ng-template",3),n(),t(15,"nz-tab",7),h(16,vr,1,2,"ng-template",3),n(),t(17,"nz-tab",8),h(18,_r,1,1,"ng-template",3),n(),t(19,"nz-tab",9),h(20,Sr,1,1,"ng-template",3),n(),t(21,"nz-tab",10),h(22,Cr,1,2,"ng-template",3),n(),t(23,"nz-tab",11),h(24,br,1,1,"ng-template",3),n(),t(25,"nz-tab",12),h(26,xr,1,1,"ng-template",3),n()()()()),i&2&&(m(2),N(r.record.name),m(4),c("nzSelectedIndex",r.selectedIndex))},dependencies:[re,_e,Se,Xe,It,wt,Pi,$i,Gi,Wi,Xi,Qi,Ki,Zi,en,on,rn]});let o=l;return o})();export{Fr as a,Br as b,Ws as c};
